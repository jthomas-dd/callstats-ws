/***
Copyright (c) 2013-2021, 8x8 Inc
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats  version = 3.73.21 2022-08-23 04-08-46  */
!function r(i,o,a){function s(t,e){if(!o[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}n=o[t]={exports:{}},i[t][0].call(n.exports,function(e){return s(i[t][1][e]||e)},n,n.exports,r,i,o,a)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,n){var r,i;r=this,i=function(f){"use strict";function r(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t,n){return(a=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(e){}}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);t=new(Function.bind.apply(e,r));return n&&o(t,n.prototype),t}).apply(null,arguments)}function e(e){var n="function"==typeof Map?new Map:void 0;return function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,i(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o(t,e)}(e)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t){var n,r;if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator])return(n=e[Symbol.iterator]()).next.bind(n);if(Array.isArray(e)||(n=function(e,t){var n;if(e)return"string"==typeof e?s(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p="3.0.0",t=p.includes("beta"),n="okpeabepajdgiepelmhkfhkjlhhmofma",h=["devices","activedevice","getinstallinfo","Version","setmmifocus","setactivedevice2","setbusylight","setremotemmilightaction"],y=((I=f.ErrorCodes||(f.ErrorCodes={}))[I.NoError=0]="NoError",I[I.SSLError=1]="SSLError",I[I.CertError=2]="CertError",I[I.NetworkError=3]="NetworkError",I[I.DownloadError=4]="DownloadError",I[I.ParseError=5]="ParseError",I[I.OtherError=6]="OtherError",I[I.DeviceInfoError=7]="DeviceInfoError",I[I.FileNotAccessible=8]="FileNotAccessible",I[I.FileNotCompatible=9]="FileNotCompatible",I[I.Device_NotFound=10]="Device_NotFound",I[I.Parameter_fail=11]="Parameter_fail",I[I.Authorization_failed=12]="Authorization_failed",I[I.FileNotAvailable=13]="FileNotAvailable",I[I.ConfigParseError=14]="ConfigParseError",I[I.SetSettings_Fail=15]="SetSettings_Fail",I[I.Device_Reboot=16]="Device_Reboot",I[I.Device_ReadFail=17]="Device_ReadFail",I[I.Device_NotReady=18]="Device_NotReady",I[I.FilePartiallyCompatible=19]="FilePartiallyCompatible",(I=f.ErrorReturnCodes||(f.ErrorReturnCodes={}))[I.Return_Ok=0]="Return_Ok",I[I.Device_Unknown=1]="Device_Unknown",I[I.Device_Invalid=2]="Device_Invalid",I[I.Not_Supported=3]="Not_Supported",I[I.Return_ParameterFail=4]="Return_ParameterFail",I[I.ProtectedSetting_Write=5]="ProtectedSetting_Write",I[I.No_Information=6]="No_Information",I[I.NetworkRequest_Fail=7]="NetworkRequest_Fail",I[I.Device_WriteFail=8]="Device_WriteFail",I[I.Device_ReadFails=9]="Device_ReadFails",I[I.No_FactorySupported=10]="No_FactorySupported",I[I.System_Error=11]="System_Error",I[I.Device_BadState=12]="Device_BadState",I[I.FileWrite_Fail=13]="FileWrite_Fail",I[I.File_AlreadyExists=14]="File_AlreadyExists",I[I.File_Not_Accessible=15]="File_Not_Accessible",I[I.Firmware_UpToDate=16]="Firmware_UpToDate",I[I.Firmware_Available=17]="Firmware_Available",I[I.Return_Async=18]="Return_Async",I[I.Invalid_Authorization=19]="Invalid_Authorization",I[I.FWU_Application_Not_Available=20]="FWU_Application_Not_Available",I[I.Device_AlreadyConnected=21]="Device_AlreadyConnected",I[I.Device_NotConnected=22]="Device_NotConnected",I[I.CannotClear_DeviceConnected=23]="CannotClear_DeviceConnected",I[I.Device_Rebooted=24]="Device_Rebooted",I[I.Upload_AlreadyInProgress=25]="Upload_AlreadyInProgress",I[I.Download_AlreadyInProgress=26]="Download_AlreadyInProgress",function(i){function e(e,t,n){var r=i.call(this,"Command "+e+" failed with error  message "+t+" and details: "+JSON.stringify(n||{}))||this;return r.command=e,r.errmessage=t,r.data=n,r.name="CommandError",r}return r(e,i),e}(e(Error))),v=new Map,m=(["mute","unmute","device attached","device detached","acceptcall","endcall","reject","flash","online","offline","linebusy","lineidle","redial","key0","key1","key2","key3","key4","key5","key6","key7","key8","key9","keyStar","keyPound","keyClear","Online","speedDial","voiceMail","LineBusy","outOfRange","intoRange","pseudoAcceptcall","pseudoEndcall","button1","button2","button3","volumeUp","volumeDown","fireAlarm","jackConnection","jackDisConnection","qdConnection","qdDisconnection","headsetConnection","headsetDisConnection","devlog","busylight","hearThrough","batteryStatus","gnpButton","mmi","error"].forEach(function(e){return v.set(e,[])}),(I=f.DeviceFeature||(f.DeviceFeature={}))[I.BusyLight=1e3]="BusyLight",I[I.FactoryReset=1001]="FactoryReset",I[I.PairingList=1002]="PairingList",I[I.RemoteMMI=1003]="RemoteMMI",I[I.MusicEqualizer=1004]="MusicEqualizer",I[I.EarbudInterconnectionStatus=1005]="EarbudInterconnectionStatus",I[I.StepRate=1006]="StepRate",I[I.HeartRate=1007]="HeartRate",I[I.RRInterval=1008]="RRInterval",I[I.RingtoneUpload=1009]="RingtoneUpload",I[I.ImageUpload=1010]="ImageUpload",I[I.NeedsExplicitRebootAfterOta=1011]="NeedsExplicitRebootAfterOta",I[I.NeedsToBePutIncCradleToCompleteFwu=1012]="NeedsToBePutIncCradleToCompleteFwu",I[I.RemoteMMIv2=1013]="RemoteMMIv2",I[I.Logging=1014]="Logging",I[I.PreferredSoftphoneListInDevice=1015]="PreferredSoftphoneListInDevice",I[I.VoiceAssistant=1016]="VoiceAssistant",I[I.PlayRingtone=1017]="PlayRingtone",(I=f.RemoteMmiType||(f.RemoteMmiType={}))[I.MMI_TYPE_MFB=0]="MMI_TYPE_MFB",I[I.MMI_TYPE_VOLUP=1]="MMI_TYPE_VOLUP",I[I.MMI_TYPE_VOLDOWN=2]="MMI_TYPE_VOLDOWN",I[I.MMI_TYPE_VCB=3]="MMI_TYPE_VCB",I[I.MMI_TYPE_APP=4]="MMI_TYPE_APP",I[I.MMI_TYPE_TR_FORW=5]="MMI_TYPE_TR_FORW",I[I.MMI_TYPE_TR_BACK=6]="MMI_TYPE_TR_BACK",I[I.MMI_TYPE_PLAY=7]="MMI_TYPE_PLAY",I[I.MMI_TYPE_MUTE=8]="MMI_TYPE_MUTE",I[I.MMI_TYPE_HOOK_OFF=9]="MMI_TYPE_HOOK_OFF",I[I.MMI_TYPE_HOOK_ON=10]="MMI_TYPE_HOOK_ON",I[I.MMI_TYPE_BLUETOOTH=11]="MMI_TYPE_BLUETOOTH",I[I.MMI_TYPE_JABRA=12]="MMI_TYPE_JABRA",I[I.MMI_TYPE_BATTERY=13]="MMI_TYPE_BATTERY",I[I.MMI_TYPE_PROG=14]="MMI_TYPE_PROG",I[I.MMI_TYPE_LINK=15]="MMI_TYPE_LINK",I[I.MMI_TYPE_ANC=16]="MMI_TYPE_ANC",I[I.MMI_TYPE_LISTEN_IN=17]="MMI_TYPE_LISTEN_IN",I[I.MMI_TYPE_DOT3=18]="MMI_TYPE_DOT3",I[I.MMI_TYPE_DOT4=19]="MMI_TYPE_DOT4",I[I.MMI_TYPE_BUSYLIGHT=128]="MMI_TYPE_BUSYLIGHT",(I=f.RemoteMmiSequence||(f.RemoteMmiSequence={}))[I.MMI_LED_SEQUENCE_OFF=0]="MMI_LED_SEQUENCE_OFF",I[I.MMI_LED_SEQUENCE_ON=1]="MMI_LED_SEQUENCE_ON",I[I.MMI_LED_SEQUENCE_SLOW=2]="MMI_LED_SEQUENCE_SLOW",I[I.MMI_LED_SEQUENCE_FAST=3]="MMI_LED_SEQUENCE_FAST",(I=f.RemoteMmiActionInput||(f.RemoteMmiActionInput={}))[I.MMI_ACTION_UP=1]="MMI_ACTION_UP",I[I.MMI_ACTION_DOWN=2]="MMI_ACTION_DOWN",I[I.MMI_ACTION_TAP=4]="MMI_ACTION_TAP",I[I.MMI_ACTION_DOUBLE_TAP=8]="MMI_ACTION_DOUBLE_TAP",I[I.MMI_ACTION_PRESS=16]="MMI_ACTION_PRESS",I[I.MMI_ACTION_LONG_PRESS=32]="MMI_ACTION_LONG_PRESS",I[I.MMI_ACTION_X_LONG_PRESS=64]="MMI_ACTION_X_LONG_PRESS",f.logLevel=2,new(function(){function e(){}var t=e.prototype;return t.trace=function(e){4<=f.logLevel&&console.log(e)},t.info=function(e){3<=f.logLevel&&console.log(e)},t.warn=function(e){2<=f.logLevel&&console.warn(e)},t.error=function(e){1<=f.logLevel&&console.error(e)},e}())),b=Math.random().toString(36).substr(2,9),w=new Map,c=1,S={};function u(t){var e;return Array.isArray(t)?(e=[].concat.apply([],t.map(u)),e=Array.from(new Set(e).values()),[].concat(e)):t instanceof RegExp?Array.from(v.keys()).filter(function(e){return t.test(e)}):v.has(t)?[t]:(m.warn("Unknown event "+t+" ignored when adding/removing eventlistener"),[])}function l(e,t){u(e).map(function(e){e=v.get(e);e.find(function(e){return e===t})||e.push(t)})}function d(){return T("getactivedevice")}function k(){return T("getdevices")}function C(e,t,n){if(void 0===t&&(t=null),(n=void 0===n?!0:n)&&!S.initialized)throw new Error("Browser integration not initialized");n={direction:"jabra-headset-extension-from-page-script",message:e,args:t||{},requestId:(c++).toString(),apiClientId:b,version_jsapi:p};m.trace("Sending command to content script: "+JSON.stringify(n)),window.postMessage(n,"*")}function T(n,r,e){var i;return void 0===r&&(r=null),!(e=void 0===e?!0:e)||S.initialized?(i=(c++).toString(),new Promise(function(e,t){w.set(i,{cmd:n,resolve:e,reject:t});e={direction:"jabra-headset-extension-from-page-script",message:n,args:r||{},requestId:i,apiClientId:b,version_jsapi:p};m.trace("Sending command to content script expecting result: "+JSON.stringify(e)),window.postMessage(e,"*")})):Promise.reject(new Error("Browser integration not initialized"))}function P(r,i,e){function o(e,t){var n=e.productID.toString(16).padStart(4,"0");return t.findIndex(function(e){return 0<=e.indexOf("(0b0e:"+n)})}function t(t,n,e){return e.find(function(e){return e.groupId==t&&e.kind==n})}var n,a,s,c,u,l;r&&r.deviceName&&(l=s=a=u=void 0,0<=(n=function(e){if(0<e.length){var t=o(r,e);if(0<=t)return t;var n=i.find(function(e){return e.deviceID===r.connectedDeviceID});if(n&&0<=(t=o(n,e)))return t}return-1}((e=e.filter(function(e){return e.label&&e.label.toLowerCase().includes("jabra")&&("audioinput"===e.kind||"audiooutput"===e.kind)})).map(function(e){return e.label})))&&(u=(n=e[n]).groupId,l=n.label,"audioinput"===n.kind?(a=n.deviceId,(c=t(u,"audiooutput",e))&&(s=c.deviceId)):"audiooutput"===n.kind&&(s=n.deviceId,(c=t(u,"audioinput",e))&&(a=c.deviceId))),u&&(r.browserGroupId=u),l&&(r.browserLabel=l),a&&(r.browserAudioInputId=a),s&&(r.browserAudioOutputId=s))}function _(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?S.initialized?"https:"!==location.protocol?Promise.reject(new Error("Your browser needs https for lookup to work")):Promise.all([d(),k(),navigator.mediaDevices.enumerateDevices()]).then(function(e){var t=e[0];return P(t,e[1],e[2]),t}):Promise.reject(new Error("Browser integration not initialized")):Promise.reject(new Error("Your browser does not support required media api"))}function O(e){if(""!==e&&("string"==typeof e||e instanceof String))return"true"===e||"1"===e;if("boolean"==typeof e)return e;throw new Error("Illegal/missing argument - boolean or string expected")}function E(e){if(""!==e&&("string"==typeof e||e instanceof String))return parseInt(e);if("number"==typeof e)return e;throw new Error("Illegal/missing argument - number or string expected")}var I=function(){function e(){this.listeners=new Map}var t=e.prototype;return t.addEventListener=function(e,t){var n=this.listeners.get(e)||[];this.listeners.set(e,[].concat(n,[t]))},t.on=function(e,t){this.addEventListener(e,t)},t.removeEventListener=function(e,t){var n=this.listeners.get(e)||[];this.listeners.set(e,n.filter(function(e){return e!==t}))},t.off=function(e,t){this.removeEventListener(e,t)},t.emit=function(e,t){e=this.listeners.get(e);e&&e.forEach(function(e){e(t)})},e}(),R={Speech_Analysis_TX:{eventType:"txspeech",valueType:"boolean"},Speech_Analysis_RX:{eventType:"rxspeech",valueType:"boolean"},"TX Acoustic Logging Level":{eventType:"txacousticlevel",valueType:"number"},"RX Acoustic Logging Level":{eventType:"rxacousticlevel",valueType:"number"},"TX Acoustic Logging Peak":{eventType:"txacousticpeak",valueType:"number"},"RX Acoustic Logging Peak":{eventType:"rxacousticpeak",valueType:"number"},"Boom Position Guidance OK":{eventType:"armpositionok",valueType:"boolean"},"Bad_Mic_detect Flag":{eventType:"badmic",valueType:"boolean"},"Mute State":{eventType:"mute",valueType:"boolean"}},M=function(e,t,n){this.type=e,this.value=t,this.timestamp=n||Date.now()};var j=function(){function e(){this.events=[]}var t=e.prototype;return t.add=function(t){var e=this.events.findIndex(function(e){return t.timestamp<e.timestamp});return-1===e&&(e=this.events.length),this.events=[].concat(this.events.slice(0,e),[t],this.events.slice(e)),t},t.newest=function(e){if(e){for(var t=this.events.length-1;0<t;t--){var n=this.events[t];if(n.type===e)return n}return null}return this.events[this.events.length-1]||null},t.find=function(e){var n,t,r,i,o=this.events;return e&&(n=e.eventType,t=e.limit,r=e.interval,i=e.limitEvent,e=e.offsetEvent,i&&(o=o.slice(0,this.events.indexOf(i))),e&&(o=o.slice(this.events.indexOf(e))),(n||r)&&(o=o.filter(function(e){var t=e.type,e=e.timestamp;return!(n&&!n.includes(t))&&(!(r&&r.start&&e<r.start)&&!(r&&r.end&&e>r.end))})),t&&(o=0<t?o.slice(0,t):o.slice(t))),o},t.clear=function(){this.events=[]},e}(),I=function(e){function t(t){var n;return void 0===t&&(t=null),(n=e.call(this)||this).events=new j,l("devlog",function(e){!n.startTime||n.stopTime||t&&t!==e.data.deviceID||(e=function(e){if("ID"in e.data)switch(e.data.ID){case"VOLUP TAP":return new M("volumeup",!0,e.data.TimeStampMs);case"VOLDOWN TAP":return new M("volumedown",!0,e.data.TimeStampMs)}for(var t in R)if(t in e.data){var n=R[t],r=e.data[t];switch(n.valueType){case"boolean":r="true"===r.toLowerCase();break;case"number":r=Number(r)}return new M(n.eventType,r,e.data.TimeStampMs)}return null}(e))&&(n.events.add(e),n.emit(e.type,e))}),console.warn("WARNING: The Analytics APIs are pre-release and subject to change without warning in future releases. Only use for evaluation purposes."),n}r(t,e);var n=t.prototype;return n.start=function(){this.clear(),this.startTime=Date.now(),this.stopTime=void 0},n.stop=function(){this.stopTime=Date.now()},n.clear=function(){this.events.clear()},n.getSpeechStatus=function(){var e=this.events.newest("txspeech"),t=this.events.newest("rxspeech"),e=!!e&&e.value,t=!!t&&t.value,n=e&&t;return{isSilent:!e&&!t,isCrosstalking:n,isTXSpeaking:!n&&e,isRXSpeaking:!n&&t}},n.getSpeechTime=function(e,t){var n,r,i,o={eventType:"txspeech rxspeech"},o=(e&&t&&(o.interval={start:e,end:t}),this.events.find(o)),a=e||this.startTime||0,s=t||this.stopTime||Date.now(),c=0,u=0,l=0;e&&t&&(e=this.events.find({eventType:"txspeech",limitEvent:o[0],limit:-1})[0],t=this.events.find({eventType:"rxspeech",limitEvent:o[0],limit:-1})[0],e&&!0===e.value&&o.unshift(new M("txspeech",!0,a)),t&&!0===t.value&&o.unshift(new M("rxspeech",!0,a)),o.push(new M("txspeech",!1,s),new M("rxspeech",!1,s)));for(var d=g(o);!(f=d()).done;){var f=f.value,p="txspeech"===f.type,h="rxspeech"===f.type;p&&!0===f.value&&!n&&(n=f),h&&!0===f.value&&!r&&(r=f),p&&!1===f.value&&n&&(i?(l+=f.timestamp-i.timestamp,i=void 0,r=r&&f):c+=f.timestamp-n.timestamp,n=void 0),h&&!1===f.value&&r&&(i?(l+=f.timestamp-i.timestamp,i=void 0,n=n&&f):u+=f.timestamp-r.timestamp,r=void 0),n&&r&&!i&&(i=f,p&&(u+=f.timestamp-r.timestamp),h&&(c+=f.timestamp-n.timestamp))}function y(e){return+(Math.round(100*e/v+"e+2")+"e-2")}var v=s-a,e=v-(c+u+l);return{totalTime:v,txSpeechTime:c,txSpeechTimePct:y(c),rxSpeechTime:u,rxSpeechTimePct:y(u),crosstalkTime:l,crosstalkTimePct:y(l),silenceTime:e,silenceTimePct:y(e)}},n.getMutedStatus=function(){var e=this.events.newest("mute");return!!e&&e.value},n.getMutedCount=function(){return this.events.find({eventType:"mute"}).filter(function(e){return e.value}).length},n.getBoomArmStatus=function(){var e=this.events.newest("boomarm");return e?e.value:void 0},n.getBoomArmMisalignedCount=function(){return this.events.find({eventType:"boomarm"}).filter(function(e){return e.value}).length},n.getVolumeUpCount=function(){return this.events.find({eventType:"volumeup"}).filter(function(e){return e.value}).length},n.getVolumeDownCount=function(){return this.events.find({eventType:"volumedown"}).filter(function(e){return e.value}).length},n.getAudioExposure=function(e){return this.events.find({limit:e=void 0===e?-15:e,eventType:"rxacousticlevel"})},n.getAverageAudioExposure=function(e,t){return this.getAverageAcousticLevel("rxacousticlevel",e,t)},n.getBackgroundNoise=function(e){return this.events.find({limit:e=void 0===e?-15:e,eventType:"txacousticlevel"})},n.getAverageBackgroundNoise=function(e,t){return this.getAverageAcousticLevel("txacousticlevel",e,t)},n.getAverageAcousticLevel=function(e,t,n){var r=[];if(0===(r=t&&n?(t=this.events.find({eventType:e,interval:{start:t,end:n}}),n=this.events.find({eventType:e,limitEvent:t[0],limit:-1}),[].concat(n,t)):this.events.find({eventType:e})).length)return 0;if(1===r.length)return r[0].value;for(var i=0,o=0,a=0;a<r.length-1;a++){var s=r[a],c=r[a+1].timestamp-s.timestamp;i+=c*s.value,o+=c}return Math.round(i/o)},t}(I);f.Analytics=I,f.CommandError=y,f._getEvents=u,f._setActiveDeviceId=function(e){var t=E(e);C("setactivedevice "+e.toString(),{id:t})},f.addEventListener=l,f.apiVersion=p,f.getActiveDevice=function(e){return(O(e=void 0===e?!1:e)?_:d)()},f.getDevices=function(e){return O(e=void 0===e?!1:e)?navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?S.initialized?"https:"===location.protocol?Promise.all([k(),navigator.mediaDevices.enumerateDevices()]).then(function(e){var t=e[0],n=e[1];return t.forEach(function(e){P(e,t,n)}),t}):Promise.reject(new Error("Your browser needs https for lookup to work")):Promise.reject(new Error("Browser integration not initialized")):Promise.reject(new Error("Your browser does not support required media api")):k()},f.getInstallInfo=function(){return T("getinstallinfo")},f.getUserDeviceMediaExt=function(n){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?S.initialized?("https:"!==location.protocol&&m.warn("This function needs to run under https for best UX experience (persisted permissions)"),null!=n&&"object"!=typeof n?Promise.reject(new Error("Optional constraints parameter must be an object")):navigator.mediaDevices.getUserMedia(i({audio:!0},n)).then(function(e){return _().then(function(t){return e.getTracks().forEach(function(e){e.stop()}),t&&t.browserAudioInputId?navigator.mediaDevices.getUserMedia(i({audio:{deviceId:t.browserAudioInputId}},n)).then(function(e){return{stream:e,deviceInfo:t}}):Promise.reject(new Error("Could not find a Jabra device with a microphone"))})})):Promise.reject(new Error("Browser integration not initialized")):Promise.reject(new Error("Your browser does not support required media api"));function i(e,t){if(null==t||"object"!=typeof e)return e;var n,r={};for(n in t)r[n]=t[n];for(n in e)r[n]=i(e[n],t[n]);return r}},f.hold=function(){C("hold")},f.init=function(){return new Promise(function(s,c){if(!(/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)))return c(new Error("Jabra Browser Integration: Only supported by <a href='https://google.com/chrome'>Google Chrome</a>."));if(S.initialized||S.initializing)return c(new Error("Jabra Browser Integration already initialized"));S.initializing=!0,w.clear();var u=!0;function l(e,t){var n=v.get(e);n?n.forEach(function(e){e(t)}):m.error("Unexpected unknown eventName: "+e)}function d(e){e?(t=w.get(e),w.delete(e)):1===w.size?(t=(e=w.entries().next().value)[1],w.delete(e[0])):t=void 0;var t,e=w.size;return 10<e&&e%10==0&&m.warn("Memory leak found - Request result map is getting too large (size #"+e+")"),t}S.eventCallback=function(e){if(e.source===window&&e.data.direction&&"jabra-headset-extension-from-content-script"===e.data.direction){var t=e.data.apiClientId||"",n=e.data.requestId||"";if(b===t||""===t)if(m.trace("Receiving event from content script: "+JSON.stringify(e.data)),"na"===e.data.message&&delete e.data.message,e.data.message&&e.data.message.startsWith("Error:")&&(e.data.error=e.data.message,delete e.data.message),e.data.message){m.trace("Got message: "+JSON.stringify(e.data));var r=e.data.message.substring(7);if(!r.startsWith("logLevel")){t=h.findIndex(function(e){return r.startsWith(e)});if(0<=t){"getinstallinfo"!==r&&!r.startsWith("Version ")||(e.data.data||(e.data.data={}),e.data.data.version_jsapi=p),"getinstallinfo"===r&&(e.data.data.installationOk=(o=e.data.data,!((a=[o.version_browserextension,o.version_chromehost,o.version_jsapi]).some(function(e){return!e})||!o.version_nativesdk)&&!!a.map(function(e){var t=e.lastIndexOf("beta");if(0<=t&&e.length>t+4)return e.substr(t+4)}).filter(function(e){return e}).every(function(e,t,n){return e===n[0]})));o=d(n);o?(e.data.data?i=e.data.data:(a=h[t].length+1,i={},(t=r.substring(a))&&(i.legacy_result=t)),o.resolve(i)):(t="Result target information missing for message "+e.data.message+". This is likely due to some software components that have not been updated or a software bug. Please upgrade extension and/or chromehost",m.error(t),l("error",{error:t,message:e.data.message}))}else{if(!v.has(r))return m.warn("Unknown message: "+e.data.message),void l("error",{error:"Unknown message: ",message:e.data.message});var i=JSON.parse(JSON.stringify(e.data));delete i.direction,delete i.apiClientId,delete i.requestId,l(i.message=r,i)}return u?(u=!1,s()):void 0}f.logLevel=parseInt(e.data.message.substring(16)),m.trace("Logger set to level "+f.logLevel)}else if(e.data.error){m.error("Got error: "+e.data.error);t=e.data.error.substring(7),i=d(n);if(i?i.reject(new y(i.cmd,t,e.data.data)):(delete(n=JSON.parse(JSON.stringify(e.data))).direction,delete n.apiClientId,delete n.requestId,n.error=t,l("error",n)),u)return u=!1,c(new Error(e.data.error))}}var o,a},window.addEventListener("message",S.eventCallback),setTimeout(function(){T("getversion",null,!1).then(function(e){e="string"==typeof e||e instanceof String?e:JSON.stringify(e,null,2);m.trace("getversion returned successfully with : "+e),C("logLevel",null,!1)}).catch(function(e){m.error(e)})},1e3),setTimeout(function(){!0===u&&(u=!1,c(new Error("Jabra Browser Integration: You need to use this <a href='https://chrome.google.com/webstore/detail/"+(t?"okpeabepajdgiepelmhkfhkjlhhmofma":n)+"'>Extension</a> and then reload this page")))},5e3),S.initialized=!0,S.initializing=!1})},f.isDeviceSelectedForInput=function(e,t){if(!e||!t)throw Error("Call to isDeviceSelectedForInput has argument(s) missing");for(var n=e.getAudioTracks(),r=0,i=n.length;r<i;r++)if(n[r].getCapabilities().deviceId!==t.browserAudioInputId)return!1;return!0},f.mute=function(){C("mute")},f.offHook=function(e){C("offhook",{continueRinger:!!e&&O(e)})},f.onHook=function(e){C("onhook",{continueRinger:!!e&&O(e)})},f.removeEventListener=function(e,n){u(e).map(function(e){var e=v.get(e),t=e.findIndex(function(e){return e===n});0<=t&&e.splice(t,1)})},f.resume=function(){C("resume")},f.ring=function(){C("ring")},f.setActiveDeviceId=function(e){return T("setactivedevice2",{id:E(e)})},f.setBusyLight=function(e){return T("setbusylight",{busy:O(e)})},f.setMmiFocus=function(e,t){return T("setmmifocus",{type:E(e),capture:O(t)})},f.setRemoteMmiLightAction=function(e,t,n){return T("setremotemmilightaction",{type:E(e),color:function(e){{var t;if(""!==e&&("string"==typeof e||e instanceof String))return[(t=parseInt(e,16))>>16&255,t>>8&255,255&t];if("number"==typeof e)return[e>>16&255,e>>8&255,255&e];if(Array.isArray(e)){if(3!=e.length)throw new Error("Illegal argument - wrong dimension of number array (3 expected)");return e}throw new Error("Illegal/missing argument - number array or hex string expected")}}(t),effect:E(n)})},f.shutdown=function(){return S.initialized?(window.removeEventListener("message",S.eventCallback),S.eventCallback=void 0,w.clear(),c=1,S.initialized=!1,v.forEach(function(e,t){}),Promise.resolve()):Promise.reject(new Error("Browser integration not initialized"))},f.trySetDeviceOutput=function(e,t){return e&&t?"function"!=typeof e.setSinkId?Promise.reject(new Error("Your browser does not support required Audio Output Devices API")):e.setSinkId(t.browserAudioOutputId).then(function(){return e.sinkId===t.browserAudioOutputId}):Promise.reject(new Error("Call to trySetDeviceOutput has argument(s) missing"))},f.unmute=function(){C("unmute")},f.unring=function(){C("unring")},Object.defineProperty(f,"__esModule",{value:!0})},"object"==typeof n&&void 0!==t?i(n):"function"==typeof define&&define.amd?define(["exports"],i):i((r=r||self).jabra={})},{}],2:[function(e,n,r){!function(ie,U,s){!function(){!function(e){var t;"object"==typeof r&&void 0!==n?n.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?t=window:void 0!==U?t=U:"undefined"!=typeof self&&(t=self),t.Promise=e())}(function(){var e,t,n;return function r(i,o,a){function s(n,e){if(!o[n]){if(!i[n]){var t="function"==typeof _dereq_&&_dereq_;if(!e&&t)return t(n,!0);if(c)return c(n,!0);e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}t=o[n]={exports:{}};i[n][0].call(t.exports,function(e){var t=i[n][1][e];return s(t||e)},t,t.exports,r,i,o,a)}return o[n].exports}for(var c="function"==typeof _dereq_&&_dereq_,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,n){"use strict";t.exports=function(e){var n=e._SomePromiseArray;function t(e){var e=new n(e),t=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),t}e.any=t,e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,n){"use strict";var r;try{throw new Error}catch(e){r=e}var i=e("./schedule"),o=e("./queue");function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new o(16),this._normalQueue=new o(16),this._haveDrainedQueues=!1;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=i}function s(e){for(;0<e.length();){n=t=r=n=void 0;var t,n=e,r=n.shift();"function"!=typeof r?r._settlePromises():(t=n.shift(),n=n.shift(),r.call(t,n))}}a.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(e,t){t?(ie.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),ie.exit(2)):this.throwLater(e)},a.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.prototype.invokeLater=function(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()},a.prototype.invoke=function(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()},a.prototype.settlePromises=function(e){this._normalQueue._pushOne(e),this._queueTick()},a.prototype._drainQueues=function(){s(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,s(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},t.exports=a,t.exports.firstLineError=r},{"./queue":26,"./schedule":29}],3:[function(e,t,n){"use strict";t.exports=function(i,o,a,s){function n(e,t){this._reject(t)}function c(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(n,n,null,this,e)}function u(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)}function l(e,t){t.promiseRejectionQueued||this._reject(e)}var d=!1;i.prototype.bind=function(e){d||(d=!0,i.prototype._propagateFrom=s.propagateFromFunction(),i.prototype._boundValue=s.boundValueFunction());var t,e=a(e),n=new i(o),r=(n._propagateFrom(this,1),this._target());return n._setBoundTo(e),e instanceof i?(r._then(o,c,void 0,n,t={promiseRejectionQueued:!1,promise:n,target:r,bindingPromise:e}),e._then(u,l,void 0,n,t),n._setOnCancel(e)):n._resolveCallback(r),n},i.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},i.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},i.bind=function(e,t){return i.resolve(t).bind(e)}}},{}],4:[function(e,t,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var i=e("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(e){}return i},t.exports=i},{"./promise":22}],5:[function(e,t,n){"use strict";var r,i=Object.create;i&&(r=i(null),i=i(null),r[" size"]=i[" size"]=0),t.exports=function(r){var n,i=e("./util"),o=i.canEvaluate;i.isIdentifier;function t(e,t){var n;if("function"!=typeof(n=null!=e?e[t]:n))throw e="Object "+i.classString(e)+" has no method '"+i.toString(t)+"'",new r.TypeError(e);return n}function a(e){return t(e,this.pop()).apply(e,this)}function s(e){return e[this]}function c(e){var t=+this;return e[t=t<0?Math.max(0,t+e.length):t]}r.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(a,void 0,void 0,t,void 0)},r.prototype.get=function(e){var t;return t="number"==typeof e?c:o&&null!==(t=n(e))?t:s,this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(c,e,t){"use strict";e.exports=function(e,t,n,r){var i=c("./util"),o=i.tryCatch,a=i.errorObj,s=e._async;e.prototype.break=e.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),s.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(e,t){var n;if(i.isArray(e))for(var r=0;r<e.length;++r)this._doInvokeOnCancel(e[r],t);else void 0!==e&&("function"==typeof e?t||(n=o(e).call(this._boundValue()))===a&&(this._attachExtraTrace(n.e),s.throwLater(n.e)):e._resultCancelled(this))},e.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),s.invoke(this._doInvokeOnCancel,this,e)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(d){var f=e("./util"),p=e("./es5").keys,h=f.tryCatch,y=f.errorObj;return function(c,u,l){return function(e){var t=l._boundValue();e:for(var n=0;n<c.length;++n){var r=c[n];if(r===Error||null!=r&&r.prototype instanceof Error){if(e instanceof r)return h(u).call(t,e)}else if("function"==typeof r){var i=h(r).call(t,e);if(i===y)return i;if(i)return h(u).call(t,e)}else if(f.isObject(e)){for(var o=p(r),a=0;a<o.length;++a){var s=o[a];if(r[s]!=e[s])continue e}return h(u).call(t,e)}}return d}}}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(o){var a=!1,n=[];function s(){this._trace=new s.CapturedTrace(c())}function c(){var e=n.length-1;if(0<=e)return n[e]}return o.prototype._promiseCreated=function(){},o.prototype._pushContext=function(){},o.prototype._popContext=function(){return null},o._peekContext=o.prototype._peekContext=function(){},s.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},s.prototype._popContext=function(){var e,t;return void 0!==this._trace?(t=(e=n.pop())._promiseCreated,e._promiseCreated=null,t):null},s.CapturedTrace=null,s.create=function(){if(a)return new s},s.deactivateLongStackTraces=function(){},s.activateLongStackTraces=function(){var e=o.prototype._pushContext,t=o.prototype._popContext,n=o._peekContext,r=o.prototype._peekContext,i=o.prototype._promiseCreated;s.deactivateLongStackTraces=function(){o.prototype._pushContext=e,o.prototype._popContext=t,o._peekContext=n,o.prototype._peekContext=r,o.prototype._promiseCreated=i,a=!1},a=!0,o.prototype._pushContext=s.prototype._pushContext,o.prototype._popContext=s.prototype._popContext,o._peekContext=o.prototype._peekContext=c,o.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},s}},{}],9:[function(re,e,t){"use strict";e.exports=function(r,i,A,L){var n,o,a,e,t,s=r._async,N=re("./errors").Warning,v=re("./util"),c=re("./es5"),B=v.canAttachTrace,l=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,W=/\((?:timers\.js):\d+:\d+\)/,H=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,u=null,d=null,f=!1,p=!(0==v.env("BLUEBIRD_DEBUG")),h=!(0==v.env("BLUEBIRD_WARNINGS")||!p&&!v.env("BLUEBIRD_WARNINGS")),p=!(0==v.env("BLUEBIRD_LONG_STACK_TRACES")||!p&&!v.env("BLUEBIRD_LONG_STACK_TRACES")),y=0!=v.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(h||!!v.env("BLUEBIRD_W_FORGOTTEN_RETURN"));function g(){for(var e=0;e<t.length;++e)t[e]._notifyUnhandledRejection();m()}function m(){t.length=0}t=[],e=function(e){t.push(e),setTimeout(g,1)},c.defineProperty(r,"_unhandledRejectionCheck",{value:g}),c.defineProperty(r,"_unhandledRejectionClear",{value:m}),r.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},r.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),e(this))},r.prototype._notifyUnhandledRejectionIsHandled=function(){Z("rejectionHandled",n,void 0,this)},r.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},r.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},r.prototype._notifyUnhandledRejection=function(){var e;this._isRejectionUnhandled()&&(e=this._settledValue(),this._setUnhandledRejectionIsNotified(),Z("unhandledRejection",o,e,this))},r.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},r.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},r.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},r.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},r.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},r.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},r.prototype._warn=function(e,t,n){return E(e,t,n||this)},r.onPossiblyUnhandledRejection=function(e){var t=r._getContext();o=v.contextBind(t,e)},r.onUnhandledRejectionHandled=function(e){var t=r._getContext();n=v.contextBind(t,e)};var b=function(){},w=(r.longStackTraces=function(){if(s.haveItemsQueued()&&!D.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");var e,t,n;!D.longStackTraces&&M()&&(e=r.prototype._captureStackTrace,t=r.prototype._attachExtraTrace,n=r.prototype._dereferenceTrace,D.longStackTraces=!0,b=function(){if(s.haveItemsQueued()&&!D.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");r.prototype._captureStackTrace=e,r.prototype._attachExtraTrace=t,r.prototype._dereferenceTrace=n,i.deactivateLongStackTraces(),D.longStackTraces=!1},r.prototype._captureStackTrace=Q,r.prototype._attachExtraTrace=K,r.prototype._dereferenceTrace=X,i.activateLongStackTraces())},r.hasLongStackTraces=function(){return D.longStackTraces&&M()},{unhandledrejection:{before:function(){var e=v.global.onunhandledrejection;return v.global.onunhandledrejection=null,e},after:function(e){v.global.onunhandledrejection=e}},rejectionhandled:{before:function(){var e=v.global.onrejectionhandled;return v.global.onrejectionhandled=null,e},after:function(e){v.global.onrejectionhandled=e}}}),S=function(){function r(e,t){if(!e)return!v.global.dispatchEvent(t);var n;try{return n=e.before(),!v.global.dispatchEvent(t)}finally{e.after(n)}}var e;try{return"function"==typeof CustomEvent?(e=new CustomEvent("CustomEvent"),v.global.dispatchEvent(e),function(e,t){e=e.toLowerCase();var n=new CustomEvent(e,{detail:t,cancelable:!0});return c.defineProperty(n,"promise",{value:t.promise}),c.defineProperty(n,"reason",{value:t.reason}),r(w[e],n)}):"function"==typeof Event?(e=new Event("CustomEvent"),v.global.dispatchEvent(e),function(e,t){e=e.toLowerCase();var n=new Event(e,{cancelable:!0});return n.detail=t,c.defineProperty(n,"promise",{value:t.promise}),c.defineProperty(n,"reason",{value:t.reason}),r(w[e],n)}):((e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),v.global.dispatchEvent(e),function(e,t){e=e.toLowerCase();var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!0,t),r(w[e],n)})}catch(e){}return function(){return!1}}(),k=v.isNode?function(){return ie.emit.apply(ie,arguments)}:v.global?function(e){e="on"+e.toLowerCase(),e=v.global[e];return!!e&&(e.apply(v.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function C(e,t){return{promise:t}}var U={promiseCreated:C,promiseFulfilled:C,promiseRejected:C,promiseResolved:C,promiseCancelled:C,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:C},T=function(e){var t=!1;try{t=k.apply(null,arguments)}catch(e){s.throwLater(e),t=!0}var n=!1;try{n=S(e,U[e].apply(null,arguments))}catch(e){s.throwLater(e),n=!0}return n||t};function P(){return!1}function V(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+v.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function q(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?v.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function G(){return this._onCancelField}function z(e){this._onCancelField=e}function Y(){this._cancellationParent=void 0,this._onCancelField=void 0}function _(e,t){var n;0!=(1&t)&&(n=(this._cancellationParent=e)._branchesRemainingToCancel,e._branchesRemainingToCancel=(n=void 0===n?0:n)+1),0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}r.config=function(e){var t;if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?r.longStackTraces():!e.longStackTraces&&r.hasLongStackTraces()&&b()),"warnings"in e&&(t=e.warnings,D.warnings=!!t,y=D.warnings,v.isObject(t)&&"wForgottenReturn"in t&&(y=!!t.wForgottenReturn)),"cancellation"in e&&e.cancellation&&!D.cancellation){if(s.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");r.prototype._clearCancellationData=Y,r.prototype._propagateFrom=_,r.prototype._onCancel=G,r.prototype._setOnCancel=z,r.prototype._attachCancellationCallback=q,r.prototype._execute=V,O=_,D.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!D.monitoring?(D.monitoring=!0,r.prototype._fireEvent=T):!e.monitoring&&D.monitoring&&(D.monitoring=!1,r.prototype._fireEvent=P)),"asyncHooks"in e&&v.nodeSupportsAsyncResource&&(D.asyncHooks!==(t=!!e.asyncHooks)&&((D.asyncHooks=t)?A:L)()),r},r.prototype._fireEvent=P,r.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},r.prototype._onCancel=function(){},r.prototype._setOnCancel=function(e){},r.prototype._attachCancellationCallback=function(e){},r.prototype._captureStackTrace=function(){},r.prototype._attachExtraTrace=function(){},r.prototype._dereferenceTrace=function(){},r.prototype._clearCancellationData=function(){},r.prototype._propagateFrom=function(e,t){};var O=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)};function J(){var e=this._boundTo;return void 0!==e&&e instanceof r?e.isFulfilled()?e.value():void 0:e}function Q(){this._trace=new F(this._peekContext())}function K(e,t){var n;B(e)&&(void 0!==(n=void 0!==(n=this._trace)&&t?n._parent:n)?n.attachExtraTrace(e):e.__stackCleaned__||(t=R(e),v.notEnumerableProp(e,"stack",t.message+"\n"+t.stack.join("\n")),v.notEnumerableProp(e,"__stackCleaned__",!0)))}function X(){this._trace=void 0}function E(e,t,n){D.warnings&&(e=new N(e),t?n._attachExtraTrace(e):D.longStackTraces&&(t=r._peekContext())?t.attachExtraTrace(e):(n=R(e),e.stack=n.message+"\n"+n.stack.join("\n")),T("warning",e)||$(e,"",!0))}function I(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||u.test(r),o=i&&j(r);i&&!o&&(f&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function R(e){var t=e.stack,n=e.toString(),t="string"==typeof t&&0<t.length?function(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||u.test(r))break}return t=0<n&&"SyntaxError"!=e.name?t.slice(n):t}(e):["    (No stack trace)"];return{message:n,stack:"SyntaxError"==e.name?t:I(t)}}function $(e,t,n){var r;"undefined"!=typeof console&&(r=v.isObject(e)?(r=e.stack,t+d(r,e)):t+String(e),"function"==typeof a?a(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r))}function Z(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){s.throwLater(e)}"unhandledRejection"===e?T(e,n,r)||i||$(n,"Unhandled rejection "):T(e,r)}function ee(e){if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e&&"function"==typeof e.toString?e.toString():v.toString(e);if(/\[object [a-zA-Z0-9$_]+\]/.test(t))try{var t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+function(e){if(e.length<41)return e;return e.substr(0,38)+"..."}(t)+">, no stack trace)"}function M(){return"function"==typeof ne}var j=function(){return!1},te=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function x(e){e=e.match(te);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function F(e){this._parent=e,this._promisesCreated=0;e=this._length=1+(void 0===e?0:e._length);ne(this,F),32<e&&this.uncycle()}v.inherits(F,Error),(i.CapturedTrace=F).prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;for(r=(e=this._length=r)-1;0<=r;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<e;++r){var a=n[t[r].stack];if(void 0!==a&&a!==r){0<a&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;for(var s=0<r?t[r-1]:this,c=(a<e-1?(s._parent=t[a+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1),s._length+1),u=r-2;0<=u;--u)t[u]._length=c,c++;return}}}},F.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=R(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(I(i.stack.split("\n"))),i=i._parent;for(var o=r,a=o[0],s=1;s<o.length;++s){for(var c=o[s],u=a.length-1,l=a[u],d=-1,f=c.length-1;0<=f;--f)if(c[f]===l){d=f;break}for(f=d;0<=f;--f){var p=c[f];if(a[u]!==p)break;a.pop(),u--}a=c}for(var h=r,y=0;y<h.length;++y)(0===h[y].length||y+1<h.length&&h[y][0]===h[y+1][0])&&(h.splice(y,1),y--);v.notEnumerableProp(e,"stack",function(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}(n,r)),v.notEnumerableProp(e,"__stackCleaned__",!0)}};var ne=function(){function e(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():ee(t)}var n,t=/^\s*at\s*/;if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace)return Error.stackTraceLimit+=6,u=t,d=e,n=Error.captureStackTrace,j=function(e){return l.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6};var r,i=new Error;if("string"==typeof i.stack&&0<=i.stack.split("\n")[0].indexOf("stackDetection@"))return u=/@/,d=e,f=!0,function(e){e.stack=(new Error).stack};try{throw new Error}catch(e){r="stack"in e}return"stack"in i||!r||"number"!=typeof Error.stackTraceLimit?(d=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?ee(t):t.toString()},null):(u=t,d=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}(),D=("undefined"!=typeof console&&void 0!==console.warn&&(a=function(e){console.warn(e)},v.isNode&&ie.stderr.isTTY?a=function(e,t){console.warn((t?"[33m":"[31m")+e+"[0m\n")}:v.isNode||"string"!=typeof(new Error).stack||(a=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")})),{warnings:h,longStackTraces:!1,cancellation:!1,monitoring:!1,asyncHooks:!1});return p&&r.longStackTraces(),{asyncHooks:function(){return D.asyncHooks},longStackTraces:function(){return D.longStackTraces},warnings:function(){return D.warnings},cancellation:function(){return D.cancellation},monitoring:function(){return D.monitoring},propagateFromFunction:function(){return O},boundValueFunction:function(){return J},checkForgottenReturns:function(e,t,n,r,i){if(void 0===e&&null!==t&&y&&(void 0===i||!i._returnedNonUndefined())&&0!=(65535&r._bitField)){n&&(n+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),c=I(s),u=c.length-1;0<=u;--u){var l=c[u];if(!W.test(l)){l=l.match(H);l&&(o="at "+l[1]+":"+l[2]+":"+l[3]+" ");break}}if(0<c.length)for(var d=c[0],u=0;u<s.length;++u)if(s[u]===d){0<u&&(a="\n"+s[u-1]);break}}r._warn("a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a,!0,t)}},setBounds:function(e,t){if(M()){for(var n,r,i=(e.stack||"").split("\n"),o=(t.stack||"").split("\n"),a=-1,s=-1,c=0;c<i.length;++c)if(u=x(i[c])){n=u.fileName,a=u.line;break}for(var u,c=0;c<o.length;++c)if(u=x(o[c])){r=u.fileName,s=u.line;break}a<0||s<0||!n||!r||n!==r||s<=a||(j=function(e){return!!l.test(e)||!!((e=x(e))&&e.fileName===n&&a<=e.line&&e.line<=s)})}},warn:E,deprecated:function(e,t){return e+=" is deprecated and will be removed in a future version.",t&&(e+=" Use "+t+" instead."),E(e)},CapturedTrace:F,fireDomEvent:S,fireGlobalEvent:k}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(n){function r(){return this.value}function i(){throw this.reason}n.prototype.return=n.prototype.thenReturn=function(e){return e instanceof n&&e.suppressUnhandledRejections(),this._then(r,void 0,void 0,{value:e},void 0)},n.prototype.throw=n.prototype.thenThrow=function(e){return this._then(i,void 0,void 0,{reason:e},void 0)},n.prototype.catchThrow=function(e){var t;return arguments.length<=1?this._then(void 0,i,void 0,{reason:e},void 0):(t=arguments[1],this.caught(e,function(){throw t}))},n.prototype.catchReturn=function(e){var t;return arguments.length<=1?(e instanceof n&&e.suppressUnhandledRejections(),this._then(void 0,r,void 0,{value:e},void 0)):((t=arguments[1])instanceof n&&t.suppressUnhandledRejections(),this.caught(e,function(){return t}))}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,n){var r=e.reduce,t=e.all;function i(){return t(this)}e.prototype.each=function(e){return r(this,e,n,0)._then(i,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,n,n)},e.each=function(e,t){return r(e,t,n,0)._then(i,void 0,void 0,e,void 0)},e.mapSeries=function(e,t){return r(e,t,n,n)}}},{}],12:[function(e,t,n){"use strict";var r,i,o=e("./es5"),a=o.freeze,e=e("./util"),s=e.inherits,c=e.notEnumerableProp;function u(t,n){function r(e){if(!(this instanceof r))return new r(e);c(this,"message","string"==typeof e?e:n),c(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return s(r,Error),r}var e=u("Warning","warning"),l=u("CancellationError","cancellation error"),d=u("TimeoutError","timeout error"),f=u("AggregateError","aggregate error");try{r=TypeError,i=RangeError}catch(e){r=u("TypeError","type error"),i=u("RangeError","range error")}for(var p="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),h=0;h<p.length;++h)"function"==typeof Array.prototype[p[h]]&&(f.prototype[p[h]]=Array.prototype[p[h]]);o.defineProperty(f.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),f.prototype.isOperational=!0;var y=0;function v(e){if(!(this instanceof v))return new v(e);c(this,"name","OperationalError"),c(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(c(this,"message",e.message),c(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}f.prototype.toString=function(){var e="\n"+Array(4*y+1).join(" ")+"AggregateError of:\n";y++;for(var t=Array(4*y+1).join(" "),n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];e+=(r=i.join("\n"))+"\n"}return y--,e},s(v,Error);var g=Error.__BluebirdErrorTypes__;g||(g=a({CancellationError:l,TimeoutError:d,OperationalError:v,RejectionError:v,AggregateError:f}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:g,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:r,RangeError:i,CancellationError:g.CancellationError,OperationalError:g.OperationalError,TimeoutError:g.TimeoutError,AggregateError:g.AggregateError,Warning:e}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r,i,o,a=function(){"use strict";return void 0===this}();a?t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:a,propertyIsWritable:function(e,t){e=Object.getOwnPropertyDescriptor(e,t);return!(e&&!e.writable&&!e.set)}}:(r={}.hasOwnProperty,i={}.toString,o={}.constructor.prototype,t.exports={isArray:function(e){try{return"[object Array]"===i.call(e)}catch(e){return!1}},keys:t=function(e){var t,n=[];for(t in e)r.call(e,t)&&n.push(t);return n},names:t,defineProperty:function(e,t,n){return e[t]=n.value,e},getDescriptor:function(e,t){return{value:e[t]}},freeze:function(e){return e},getPrototypeOf:function(e){try{return Object(e).constructor.prototype}catch(e){return o}},isES5:a,propertyIsWritable:function(){return!0}})},{}],14:[function(e,t,n){"use strict";t.exports=function(e,r){var i=e.map;e.prototype.filter=function(e,t){return i(this,e,t,r)},e.filter=function(e,t,n){return i(e,t,n,r)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(a,i,o){var s=e("./util"),c=a.CancellationError,u=s.errorObj,l=e("./catch_filter")(o);function d(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function f(e){this.finallyHandler=e}function p(e,t){return null!=e.cancelPromise&&(1<arguments.length?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,1)}function h(){return v.call(this,this.promise._target()._settledValue())}function y(e){if(!p(this,e))return u.e=e,u}function v(e){var t=this.promise,n=this.handler;if(!this.called){this.called=!0;n=this.isFinallyHandler()?n.call(t._boundValue()):n.call(t._boundValue(),e);if(n===o)return n;if(void 0!==n){t._setReturnedNonUndefined();var r,n=i(n,t);if(n instanceof a){if(null!=this.cancelPromise){if(n._isCancelled())return r=new c("late cancellation observer"),t._attachExtraTrace(r),u.e=r,u;n.isPending()&&n._attachCancellationCallback(new f(this))}return n._then(h,y,void 0,this,void 0)}}}return t.isRejected()?(p(this),u.e=e,u):(p(this),e)}return d.prototype.isFinallyHandler=function(){return 0===this.type},f.prototype._resultCancelled=function(){p(this.finallyHandler)},a.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new d(this,t,e),void 0)},a.prototype.lastly=a.prototype.finally=function(e){return this._passThrough(e,0,v,v)},a.prototype.tap=function(e){return this._passThrough(e,1,v)},a.prototype.tapCatch=function(e){var t=arguments.length;if(1===t)return this._passThrough(e,1,void 0,v);for(var n=new Array(t-1),r=0,i=0;i<t-1;++i){var o=arguments[i];if(!s.isObject(o))return a.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+s.classString(o)));n[r++]=o}return n.length=r,this._passThrough(l(n,arguments[i],this),1,void 0,v)},d}},{"./catch_filter":7,"./util":36}],16:[function(r,e,t){"use strict";e.exports=function(a,n,s,c,e,u){var l=r("./errors").TypeError,t=r("./util"),d=t.errorObj,f=t.tryCatch,p=[];function h(e,t,n,r){var i,o;u.cancellation()?(i=new a(s),o=this._finallyPromise=new a(s),this._promise=i.lastly(function(){return o}),i._captureStackTrace(),i._setOnCancel(this)):(this._promise=new a(s))._captureStackTrace(),this._stack=r,this._generatorFunction=e,this._receiver=t,this._generator=void 0,this._yieldHandlers="function"==typeof n?[n].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}t.inherits(h,e),h.prototype._isResolved=function(){return null===this._promise},h.prototype._cleanup=function(){this._promise=this._generator=null,u.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},h.prototype._promiseCancelled=function(){var e;this._isResolved()||(e=void 0!==this._generator.return?(this._promise._pushContext(),f(this._generator.return).call(this._generator,void 0)):(e=new a.CancellationError("generator .return() sentinel"),a.coroutine.returnSentinel=e,this._promise._attachExtraTrace(e),this._promise._pushContext(),f(this._generator.throw).call(this._generator,e)),this._promise._popContext(),this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e))},h.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();e=f(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(e)},h.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();e=f(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(e)},h.prototype._resultCancelled=function(){var e;this._yieldedPromise instanceof a&&(e=this._yieldedPromise,this._yieldedPromise=null,e.cancel())},h.prototype.promise=function(){return this._promise},h.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},h.prototype._continue=function(e){var t,n=this._promise;return e===d?(this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1)):(t=e.value,!0===e.done?(this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(t)):void((e=c(t,this._promise))instanceof a||null!==(e=function(e,t,n){for(var r=0;r<t.length;++r){n._pushContext();var i=f(t[r])(e);if(n._popContext(),i===d)return n._pushContext(),o=a.reject(d.e),n._popContext(),o;var o=c(i,n);if(o instanceof a)return o}return null}(e,this._yieldHandlers,this._promise))?0==(50397184&(n=(e=e._target())._bitField))?(this._yieldedPromise=e)._proxy(this,null):0!=(33554432&n)?a._async.invoke(this._promiseFulfilled,this,e._value()):0!=(16777216&n)?a._async.invoke(this._promiseRejected,this,e._reason()):this._promiseCancelled():this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(t))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))))},a.coroutine=function(r,e){if("function"!=typeof r)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,o=h,a=(new Error).stack;return function(){var e=r.apply(this,arguments),t=new o(void 0,void 0,i,a),n=t.promise();return t._generator=e,t._promiseFulfilled(void 0),n}},a.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+t.classString(e));p.push(e)},a.spawn=function(e){var t;return u.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e?n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n"):(t=(e=new h(e,this)).promise(),e._run(a.spawn),t)}}},{"./errors":12,"./util":36}],17:[function(a,e,t){"use strict";e.exports=function(e,n,t,r,i){var o=a("./util");o.canEvaluate,o.tryCatch,o.errorObj;e.join=function(){var e,t=arguments.length-1,t=(0<t&&"function"==typeof arguments[t]&&(e=arguments[t]),[].slice.call(arguments)),t=(e&&t.pop(),new n(t).promise());return void 0!==e?t.spread(e):t}}},{"./util":36}],18:[function(t,e,n){"use strict";e.exports=function(u,e,o,l,s,d){var c=t("./util"),f=c.tryCatch,p=c.errorObj,h=u._async;function a(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=u._getContext();if(this._callback=c.contextBind(i,t),this._preservedValues=r===s?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0),c.isArray(e))for(var o=0;o<e.length;++o){var a=e[o];a instanceof u&&a.suppressUnhandledRejections()}}function n(e,t,n,r){if("function"!=typeof t)return o("expecting a function but got "+c.classString(t));var i=0;if(void 0!==n){if("object"!=typeof n||null===n)return u.reject(new TypeError("options argument must be an object but it is "+c.classString(n)));if("number"!=typeof n.concurrency)return u.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(n.concurrency)));i=n.concurrency}return new a(e,t,i="number"==typeof i&&isFinite(i)&&1<=i?i:0,r).promise()}c.inherits(a,e),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,t){var n=this._values,r=this.length(),i=this._preservedValues,o=this._limit;if(t<0){if(n[t=-1*t-1]=e,1<=o&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(1<=o&&this._inFlight>=o)return n[t]=e,this._queue.push(t),!1;null!==i&&(i[t]=e);var a=this._promise,s=this._callback,c=a._boundValue(),s=(a._pushContext(),f(s).call(c,e,t,r)),c=a._popContext();if(d.checkForgottenReturns(s,c,null!==i?"Promise.filter":"Promise.map",a),s===p)return this._reject(s.e),!0;if((e=l(s,this._promise))instanceof u){c=(e=e._target())._bitField;if(0==(50397184&c))return 1<=o&&this._inFlight++,(n[t]=e)._proxy(this,-1*(t+1)),!1;if(0==(33554432&c))return 0!=(16777216&c)?this._reject(e._reason()):this._cancel(),!0;s=e._value()}n[t]=s}return r<=++this._totalResolved&&(null!==i?this._filter(n,i):this._resolve(n),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;0<e.length&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},a.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},a.prototype.preservedValues=function(){return this._preservedValues},u.prototype.map=function(e,t){return n(this,e,t,null)},u.map=n}},{"./util":36}],19:[function(t,e,n){"use strict";e.exports=function(i,o,e,a,s){var c=t("./util"),u=c.tryCatch;i.method=function(r){if("function"!=typeof r)throw new i.TypeError("expecting a function but got "+c.classString(r));return function(){var e=new i(o),t=(e._captureStackTrace(),e._pushContext(),u(r).apply(this,arguments)),n=e._popContext();return s.checkForgottenReturns(t,n,"Promise.method",e),e._resolveFromSyncValue(t),e}},i.attempt=i.try=function(e){var t,n,r;return"function"!=typeof e?a("expecting a function but got "+c.classString(e)):((t=new i(o))._captureStackTrace(),t._pushContext(),n=1<arguments.length?(s.deprecated("calling Promise.try with more than 1 argument"),r=arguments[1],n=arguments[2],c.isArray(r)?u(e).apply(n,r):u(e).call(n,r)):u(e)(),r=t._popContext(),s.checkForgottenReturns(n,r,"Promise.try",t),t._resolveFromSyncValue(n),t)},i.prototype._resolveFromSyncValue=function(e){e===c.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";var a=e("./util"),i=a.maybeWrapAsError,s=e("./errors").OperationalError,c=e("./es5");var u=/^(?:name|message|stack|cause)$/;function o(e){var t,n;if((n=e)instanceof Error&&c.getPrototypeOf(n)===Error.prototype){(t=new s(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var r=c.keys(e),i=0;i<r.length;++i){var o=r[i];u.test(o)||(t[o]=e[o])}return t}return a.markAsOriginatingFromRejection(e),e}t.exports=function(n,r){return function(e,t){null!==n&&(e?(e=o(i(e)),n._attachExtraTrace(e),n._reject(e)):r?(e=[].slice.call(arguments,1),n._fulfill(e)):n._fulfill(t),n=null)}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,n){"use strict";e.exports=function(e){var n=t("./util"),r=e._async,i=n.tryCatch,o=n.errorObj;function a(e,t){if(!n.isArray(e))return s.call(this,e,t);t=i(t).apply(this._boundValue(),[null].concat(e));t===o&&r.throwLater(t.e)}function s(e,t){var n=this._boundValue(),t=void 0===e?i(t).call(n,null):i(t).call(n,null,e);t===o&&r.throwLater(t.e)}function c(e,t){e||((n=new Error(e+"")).cause=e,e=n);var n=i(t).call(this._boundValue(),e);n===o&&r.throwLater(n.e)}e.prototype.asCallback=e.prototype.nodeify=function(e,t){var n;return"function"==typeof e&&(n=s,void 0!==t&&Object(t).spread&&(n=a),this._then(n,c,void 0,this,e)),this}}},{"./util":36}],22:[function(x,F,e){"use strict";F.exports=function(){function a(){return new y("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")}function s(){return new I.PromiseInspection(this._target())}function c(e){return I.reject(new y(e))}function u(){}function e(){return{domain:n(),async:null}}function t(){return{domain:n(),async:new r("Bluebird::Promise")}}var o={},d=x("./util"),n=(d.setReflectHandler(s),function(){var e=ie.domain;return void 0===e?null:e}),r=d.isNode&&d.nodeSupportsAsyncResource?x("async_hooks").AsyncResource:null,f=d.isNode?e:function(){return null},i=(d.notEnumerableProp(I,"_getContext",f),x("./es5")),l=x("./async"),p=new l,h=(i.defineProperty(I,"_async",{value:p}),x("./errors")),y=I.TypeError=h.TypeError,v=(I.RangeError=h.RangeError,I.CancellationError=h.CancellationError),g=(I.TimeoutError=h.TimeoutError,I.OperationalError=h.OperationalError,I.RejectionError=h.OperationalError,I.AggregateError=h.AggregateError,function(){}),m={},b={},w=x("./thenables")(I,g),S=x("./promise_array")(I,g,w,c,u),h=x("./context")(I),k=h.create,C=x("./debuggability")(I,h,function(){f=t,d.notEnumerableProp(I,"_getContext",t)},function(){f=e,d.notEnumerableProp(I,"_getContext",e)}),T=(C.CapturedTrace,x("./finally")(I,w,b)),P=x("./catch_filter")(b),_=x("./nodeback"),O=d.errorObj,E=d.tryCatch;function I(e){if(e!==g){var t=this,n=e;if(null==t||t.constructor!==I)throw new y("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof n)throw new y("expecting a function but got "+d.classString(n))}this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function R(e){this.promise._resolveCallback(e)}function M(e){this.promise._rejectCallback(e,!1)}function j(e){var t=new I(g);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}return I.prototype.toString=function(){return"[object Promise]"},I.prototype.caught=I.prototype.catch=function(e){var t=arguments.length;if(1<t){for(var n=new Array(t-1),r=0,i=0;i<t-1;++i){var o=arguments[i];if(!d.isObject(o))return c("Catch statement predicate: expecting an object but got "+d.classString(o));n[r++]=o}if(n.length=r,"function"!=typeof(e=arguments[i]))throw new y("The last argument to .catch() must be a function, got "+d.toString(e));return this.then(void 0,P(n,e,this))}return this.then(void 0,e)},I.prototype.reflect=function(){return this._then(s,s,void 0,this,void 0)},I.prototype.then=function(e,t){var n;return C.warnings()&&0<arguments.length&&"function"!=typeof e&&"function"!=typeof t&&(n=".then() only accepts functions but was passed: "+d.classString(e),1<arguments.length&&(n+=", "+d.classString(t)),this._warn(n)),this._then(e,t,void 0,void 0,void 0)},I.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},I.prototype.spread=function(e){return"function"!=typeof e?c("expecting a function but got "+d.classString(e)):this.all()._then(e,void 0,void 0,m,void 0)},I.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},I.prototype.all=function(){return 0<arguments.length&&this._warn(".all() was passed arguments but it does not take any"),new S(this).promise()},I.prototype.error=function(e){return this.caught(d.originatesFromRejection,e)},I.getNewLibraryCopy=F.exports,I.is=function(e){return e instanceof I},I.fromNode=I.fromCallback=function(e){var t=new I(g),n=(t._captureStackTrace(),1<arguments.length&&!!Object(arguments[1]).multiArgs),e=E(e)(_(t,n));return e===O&&t._rejectCallback(e.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},I.all=function(e){return new S(e).promise()},I.resolve=I.fulfilled=I.cast=function(e){var t=w(e);return t instanceof I||((t=new I(g))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},I.reject=I.rejected=function(e){var t=new I(g);return t._captureStackTrace(),t._rejectCallback(e,!0),t},I.setScheduler=function(e){if("function"!=typeof e)throw new y("expecting a function but got "+d.classString(e));return p.setScheduler(e)},I.prototype._then=function(e,t,n,r,i){var o,a,s,c=void 0!==i,i=c?i:new I(g),u=this._target(),l=u._bitField,c=(c||(i._propagateFrom(this,3),i._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,i)),f());return 0!=(50397184&l)?(s=u._settlePromiseCtx,0!=(33554432&l)?(a=u._rejectionHandler0,o=e):0!=(16777216&l)?(a=u._fulfillmentHandler0,o=t,u._unsetRejectionIsUnhandled()):(s=u._settlePromiseLateCancellationObserver,a=new v("late cancellation observer"),u._attachExtraTrace(a),o=t),p.invoke(s,u,{handler:d.contextBind(c,o),promise:i,receiver:r,value:a})):u._addCallbacks(e,t,i,r,c),i},I.prototype._length=function(){return 65535&this._bitField},I.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},I.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},I.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},I.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},I.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},I.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},I.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},I.prototype._isFinal=function(){return 0<(4194304&this._bitField)},I.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},I.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},I.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},I.prototype._setAsyncGuaranteed=function(){var e;p.hasCustomScheduler()||(e=this._bitField,this._bitField=e|(536870912&e)>>2^134217728)},I.prototype._setNoAsyncGuarantee=function(){this._bitField=-134217729&(536870912|this._bitField)},I.prototype._receiverAt=function(e){e=0===e?this._receiver0:this[4*e-4+3];if(e!==o)return void 0===e&&this._isBound()?this._boundValue():e},I.prototype._promiseAt=function(e){return this[4*e-4+2]},I.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4]},I.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},I.prototype._boundValue=function(){},I.prototype._migrateCallback0=function(e){e._bitField;var t=e._fulfillmentHandler0,n=e._rejectionHandler0,r=e._promise0,e=e._receiverAt(0);this._addCallbacks(t,n,r,e=void 0===e?o:e,null)},I.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),e=e._receiverAt(t);this._addCallbacks(n,r,i,e=void 0===e?o:e,null)},I.prototype._addCallbacks=function(e,t,n,r,i){var o,a=this._length();return 65531<=a&&this._setLength(a=0),0===a?(this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=d.contextBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=d.contextBind(i,t))):(this[2+(o=4*a-4)]=n,this[3+o]=r,"function"==typeof e&&(this[o]=d.contextBind(i,e)),"function"==typeof t&&(this[1+o]=d.contextBind(i,t))),this._setLength(a+1),a},I.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},I.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(a(),!1);var n=w(e,this);if(!(n instanceof I))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r===this)this._reject(a());else{e=r._bitField;if(0==(50397184&e)){var i=this._length();0<i&&r._migrateCallback0(this);for(var o=1;o<i;++o)r._migrateCallbackAt(this,o);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else 0!=(33554432&e)?this._fulfill(r._value()):0!=(16777216&e)?this._reject(r._reason()):(t=new v("late cancellation observer"),r._attachExtraTrace(t),this._reject(t))}}},I.prototype._rejectCallback=function(e,t,n){var r=d.ensureErrorObject(e),i=r===e;i||n||!C.warnings()||(n="a promise was rejected with a non-error: "+d.classString(e),this._warn(n,!0)),this._attachExtraTrace(r,!!t&&i),this._reject(e)},I.prototype._resolveFromExecutor=function(e){var t,n;e!==g&&((t=this)._captureStackTrace(),this._pushContext(),n=!0,e=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)}),n=!1,this._popContext(),void 0!==e&&t._rejectCallback(e,!0))},I.prototype._settlePromiseFromHandler=function(e,t,n,r){var i;0==(65536&r._bitField)&&(r._pushContext(),t===m?n&&"number"==typeof n.length?i=E(e).apply(this._boundValue(),n):(i=O).e=new y("cannot .spread() a non-array: "+d.classString(n)):i=E(e).call(t,n),e=r._popContext(),0==(65536&r._bitField)&&(i===b?r._reject(n):i===O?r._rejectCallback(i.e,!1):(C.checkForgottenReturns(i,e,"",r,this),r._resolveCallback(i))))},I.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},I.prototype._followee=function(){return this._rejectionHandler0},I.prototype._setFollowee=function(e){this._rejectionHandler0=e},I.prototype._settlePromise=function(e,t,n,r){var i=e instanceof I,o=this._bitField,a=0!=(134217728&o);0!=(65536&o)?(i&&e._invokeInternalOnCancel(),n instanceof T&&n.isFinallyHandler()?(n.cancelPromise=e,E(t).call(n,r)===O&&e._reject(O.e)):t===s?e._fulfill(s.call(n)):n instanceof u?n._promiseCancelled(e):i||e instanceof S?e._cancel():n.cancel()):"function"==typeof t?i?(a&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,r,e)):t.call(n,r,e):n instanceof u?n._isResolved()||(0!=(33554432&o)?n._promiseFulfilled(r,e):n._promiseRejected(r,e)):i&&(a&&e._setAsyncGuaranteed(),0!=(33554432&o)?e._fulfill(r):e._reject(r))},I.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,e=e.value;"function"==typeof t?n instanceof I?this._settlePromiseFromHandler(t,r,e,n):t.call(r,e,n):n instanceof I&&n._reject(e)},I.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},I.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},I.prototype._clearCallbackDataAtIndex=function(e){e=4*e-4;this[2+e]=this[3+e]=this[e]=this[1+e]=void 0},I.prototype._fulfill=function(e){var t,n=this._bitField;if(!((117506048&n)>>>16)){if(e===this)return t=a(),this._attachExtraTrace(t),this._reject(t);this._setFulfilled(),this._rejectionHandler0=e,0<(65535&n)&&(0!=(134217728&n)?this._settlePromises():p.settlePromises(this),this._dereferenceTrace())}},I.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return p.fatalError(e,d.isNode);0<(65535&t)?p.settlePromises(this):this._ensurePossibleRejectionHandled()}},I.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},I.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},I.prototype._settlePromises=function(){var e,t=this._bitField,n=65535&t;0<n&&(0!=(16842752&t)?(e=this._fulfillmentHandler0,this._settlePromise0(this._rejectionHandler0,e,t),this._rejectPromises(n,e)):(e=this._rejectionHandler0,this._settlePromise0(this._fulfillmentHandler0,e,t),this._fulfillPromises(n,e)),this._setLength(0)),this._clearCancellationData()},I.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&i.defineProperty(I.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),I.defer=I.pending=function(){return C.deprecated("Promise.defer","new Promise"),{promise:new I(g),resolve:R,reject:M}},d.notEnumerableProp(I,"_makeSelfResolutionError",a),x("./method")(I,g,w,c,C),x("./bind")(I,g,w,C),x("./cancel")(I,S,c,C),x("./direct_resolve")(I),x("./synchronous_inspection")(I),x("./join")(I,S,w,g,p),(I.Promise=I).version="3.7.2",x("./call_get.js")(I),x("./generators.js")(I,c,g,w,u,C),x("./map.js")(I,S,c,w,g,C),x("./nodeify.js")(I),x("./promisify.js")(I,g),x("./props.js")(I,S,w,c),x("./race.js")(I,g,w,c),x("./reduce.js")(I,S,c,w,g,C),x("./settle.js")(I,S,C),x("./some.js")(I,S,c),x("./timers.js")(I,g,C),x("./using.js")(I,c,w,k,g,C),x("./any.js")(I),x("./each.js")(I,g),x("./filter.js")(I,g),d.toFastProperties(I),d.toFastProperties(I.prototype),j({a:1}),j({b:2}),j({c:3}),j(1),j(function(){}),j(void 0),j(!1),j(new I(g)),C.setBounds(l.firstLineError,d.lastLineError),I}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36,async_hooks:void 0}],23:[function(r,e,t){"use strict";e.exports=function(s,n,c,o,e){var a=r("./util");a.isArray;function t(e){var t=this._promise=new s(n);e instanceof s&&(t._propagateFrom(e,3),e.suppressUnhandledRejections()),t._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return a.inherits(t,e),t.prototype.length=function(){return this._length},t.prototype.promise=function(){return this._promise},t.prototype._init=function e(t,n){if((r=c(this._values,this._promise))instanceof s){var r,i=(r=r._target())._bitField;if(this._values=r,0==(50397184&i))return this._promise._setAsyncGuaranteed(),r._then(e,this._reject,void 0,this,n);if(0==(33554432&i))return 0!=(16777216&i)?this._reject(r._reason()):this._cancel();r=r._value()}null===(r=a.asArray(r))?(i=o("expecting an array or an iterable object but got "+a.classString(r)).reason(),this._promise._rejectCallback(i,!1)):0===r.length?-5===n?this._resolveEmptyArray():this._resolve(function(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}(n)):this._iterate(r)},t.prototype._iterate=function(e){for(var t=this.getActualLength(e.length),n=(this._length=t,this._values=this.shouldCopyValues()?new Array(t):this._values,this._promise),r=!1,i=null,o=0;o<t;++o){var a=c(e[o],n),i=a instanceof s?(a=a._target())._bitField:null;r?null!==i&&a.suppressUnhandledRejections():null!==i?0==(50397184&i)?(a._proxy(this,o),this._values[o]=a):r=0!=(33554432&i)?this._promiseFulfilled(a._value(),o):0!=(16777216&i)?this._promiseRejected(a._reason(),o):this._promiseCancelled(o):r=this._promiseFulfilled(a,o)}r||n._setAsyncGuaranteed()},t.prototype._isResolved=function(){return null===this._values},t.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},t.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},t.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},t.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},t.prototype._promiseCancelled=function(){return this._cancel(),!0},t.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},t.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof s)e.cancel();else for(var t=0;t<e.length;++t)e[t]instanceof s&&e[t].cancel()}},t.prototype.shouldCopyValues=function(){return!0},t.prototype.getActualLength=function(e){return e},t}},{"./util":36}],24:[function(i,e,t){"use strict";e.exports=function(u,l){var p={},m=i("./util"),d=i("./nodeback"),f=m.withAppended,h=m.maybeWrapAsError,e=m.canEvaluate,b=i("./errors").TypeError,w={__isPromisified__:!0},t=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),S=function(e){return m.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e};function r(e){return!t.test(e)}function k(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function y(e,t,n,r){for(var i,o=m.inheritedDataKeys(e),a=[],s=0;s<o.length;++s){var c=o[s],u=e[c],l=r===S||S(c,u,e);"function"!=typeof u||k(u)||(i=e,(i=m.getDataPropertyOrDefault(i,c+t,w))&&k(i))||!r(c,u,e,l)||a.push(c,u)}for(var d=a,f=t,p=n,h=0;h<d.length;h+=2){var y=d[h];if(p.test(y))for(var v=y.replace(p,""),g=0;g<d.length;g+=2)if(d[g]===v)throw new b("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",f))}return a}var n;var v=e?n:function(i,o,e,t,n,a){var s=function(){return this}(),c=i;function r(){var e=o,t=(o===p&&(e=this),new u(l)),n=(t._captureStackTrace(),"string"==typeof c&&this!==s?this[c]:i),r=d(t,a);try{n.apply(e,f(arguments,r))}catch(e){t._rejectCallback(h(e),!0,!0)}return t._isFateSealed()||t._setAsyncGuaranteed(),t}return"string"==typeof c&&(i=t),m.notEnumerableProp(r,"__isPromisified__",!0),r};function g(e,t,n,r,i){for(var o=new RegExp(t.replace(/([$])/,"\\$")+"$"),a=y(e,t,o,n),s=0,c=a.length;s<c;s+=2){var u,l=a[s],d=a[s+1],f=l+t;r===v?e[f]=v(l,p,l,d,t,i):(u=r(d,function(){return v(l,p,l,d,t,i)}),m.notEnumerableProp(u,"__isPromisified__",!0),e[f]=u)}return m.toFastProperties(e),e}u.promisify=function(e,t){if("function"!=typeof e)throw new b("expecting a function but got "+m.classString(e));var n;return k(e)?e:(n=void 0===(t=Object(t)).context?p:t.context,t=!!t.multiArgs,n=v(e,n,void 0,e,null,t),m.copyDescriptors(e,n,r),n)},u.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new b("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(t=Object(t)).multiArgs,r=t.suffix,i=t.filter,o=("function"!=typeof i&&(i=S),t.promisifier);if("function"!=typeof o&&(o=v),!m.isIdentifier(r="string"!=typeof r?"Async":r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=m.inheritedDataKeys(e),s=0;s<a.length;++s){var c=e[a[s]];"constructor"!==a[s]&&m.isClass(c)&&(g(c.prototype,r,i,o,n),g(c,r,i,o,n))}return g(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(h,e,t){"use strict";e.exports=function(n,e,r,i){var s,o,a,t=h("./util"),c=t.isObject,u=h("./es5"),l=("function"==typeof Map&&(s=Map),a=0,function(e){o=e.size,a=0;var t=new Array(2*e.size);return e.forEach(d,t),t});function d(e,t){this[a]=e,this[a+o]=t,a++}function f(e){var t=!1;if(void 0!==s&&e instanceof s)i=l(e),t=!0;else for(var n=u.keys(e),r=n.length,i=new Array(2*r),o=0;o<r;++o){var a=n[o];i[o]=e[a],i[o+r]=a}this.constructor$(i),this._isMap=t,this._init$(void 0,t?-6:-3)}function p(e){var t,e=r(e);return c(e)?(t=e instanceof n?e._then(n.props,void 0,void 0,void 0,void 0):new f(e).promise(),e instanceof n&&t._propagateFrom(e,2),t):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}t.inherits(f,e),f.prototype._init=function(){},f.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){if(this._isMap)n=function(e){for(var t=new s,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t}(this._values);else for(var n={},r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i];return this._resolve(n),!0}return!1},f.prototype.shouldCopyValues=function(){return!1},f.prototype.getActualLength=function(e){return e>>1},n.prototype.props=function(){return p(this)},n.props=p}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length(),n=(this._checkCapacity(t+1),this._front+t&this._capacity-1);this[n]=e,this._length=t+1},r.prototype.push=function(e,t,n){var r,i,o=this.length()+3;this._willBeOverCapacity(o)?(this._pushOne(e),this._pushOne(t),this._pushOne(n)):(r=this._front+o-3,this._checkCapacity(o),i=this._capacity-1,this[r&i]=e,this[1+r&i]=t,this[2+r&i]=n,this._length=o)},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;for(var e=this._front+this._length&t-1,n=this,r=0,i=this,o=t,a=e,s=0;s<a;++s)i[s+o]=n[s+r],n[s+r]=void 0},t.exports=r},{}],27:[function(e,t,n){"use strict";t.exports=function(u,l,d,f){function p(t){return t.then(function(e){return n(e,t)})}var h=e("./util");function n(e,t){var n=d(e);if(n instanceof u)return p(n);if(null===(e=h.asArray(e)))return f("expecting an array or an iterable object but got "+h.classString(e));for(var r=new u(l),i=(void 0!==t&&r._propagateFrom(t,3),r._fulfill),o=r._reject,a=0,s=e.length;a<s;++a){var c=e[a];(void 0!==c||a in e)&&u.cast(c)._then(i,o,void 0,r,null)}return r}u.race=function(e){return n(e,void 0)},u.prototype.race=function(){return n(this,void 0)}}},{"./util":36}],28:[function(p,e,t){"use strict";e.exports=function(s,e,i,t,o,a){var c=p("./util"),u=c.tryCatch;function l(e,t,n,r){this.constructor$(e);e=s._getContext();this._fn=c.contextBind(e,t),void 0!==n&&(n=s.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=r===o?Array(this._length):0===r?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function d(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function n(e,t,n,r){return"function"!=typeof t?i("expecting a function but got "+c.classString(t)):new l(e,t,n,r).promise()}function f(e){this.accum=e,this.array._gotAccum(e);e=t(this.value,this.array._promise);return e instanceof s?(this.array._currentCancellable=e)._then(r,void 0,void 0,this,void 0):r.call(this,e)}function r(e){var t=this.array,n=t._promise,r=u(t._fn),e=(n._pushContext(),(r=void 0!==t._eachValues?r.call(n._boundValue(),e,this.index,this.length):r.call(n._boundValue(),this.accum,e,this.index,this.length))instanceof s&&(t._currentCancellable=r),n._popContext());return a.checkForgottenReturns(r,e,void 0!==t._eachValues?"Promise.each":"Promise.reduce",n),r}c.inherits(l,e),l.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},l.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},l.prototype.shouldCopyValues=function(){return!1},l.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},l.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof s&&this._currentCancellable.cancel(),this._initialValue instanceof s&&this._initialValue.cancel())},l.prototype._iterate=function(e){var t=(this._values=e).length,n=void 0!==this._initialValue?(a=this._initialValue,0):(a=s.resolve(e[0]),1);this._currentCancellable=a;for(var r=n;r<t;++r){var i=e[r];i instanceof s&&i.suppressUnhandledRejections()}if(!a.isRejected())for(;n<t;++n){var o={accum:null,value:e[n],index:n,length:t,array:this},a=a._then(f,void 0,void 0,o,void 0);0==(127&n)&&a._setNoAsyncGuarantee()}(a=void 0!==this._eachValues?a._then(this._eachComplete,void 0,void 0,this,void 0):a)._then(d,d,void 0,a,this)},s.prototype.reduce=function(e,t){return n(this,e,t,null)},s.reduce=n}},{"./util":36}],29:[function(e,t,n){"use strict";var r,i,o,e=e("./util"),a=e.getNativePromise();e=e.isNode&&"undefined"==typeof MutationObserver?(r=U.setImmediate,i=ie.nextTick,e.isRecentNode?function(e){r.call(U,e)}:function(e){i.call(ie,e)}):"function"==typeof a&&"function"==typeof a.resolve?(o=a.resolve(),function(e){o.then(e)}):"undefined"!=typeof MutationObserver&&("undefined"==typeof window||!window.navigator||!window.navigator.standalone&&!window.cordova)&&"classList"in document.documentElement?function(){var n=document.createElement("div"),r={attributes:!0},i=!1,o=document.createElement("div");new MutationObserver(function(){n.classList.toggle("foo"),i=!1}).observe(o,r);return function(e){var t=new MutationObserver(function(){t.disconnect(),e()});t.observe(n,r),i||(i=!0,o.classList.toggle("foo"))}}():void 0!==s?function(e){s(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},t.exports=e},{"./util":36}],30:[function(o,e,t){"use strict";e.exports=function(e,t,n){var r=e.PromiseInspection;function i(e){this.constructor$(e)}o("./util").inherits(i,t),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new r;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new r;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},e.settle=function(e){return n.deprecated(".settle()",".reflect()"),new i(e).promise()},e.allSettled=function(e){return new i(e).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(l,e,t){"use strict";e.exports=function(e,t,r){var n=l("./util"),i=l("./errors").RangeError,o=l("./errors").AggregateError,a=n.isArray,s={};function c(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function u(e,t){var n;return(0|t)!==t||t<0?r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n"):(n=(e=new c(e)).promise(),e.setHowMany(t),e.init(),n)}n.inherits(c,t),c.prototype._init=function(){var e;this._initialized&&(0===this._howMany?this._resolve([]):(this._init$(void 0,-5),e=a(this._values),!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))))},c.prototype.init=function(){this._initialized=!0,this._init()},c.prototype.setUnwrap=function(){this._unwrap=!0},c.prototype.howMany=function(){return this._howMany},c.prototype.setHowMany=function(e){this._howMany=e},c.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},c.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},c.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(s),this._checkOutcome())},c.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new o,t=this.length();t<this._values.length;++t)this._values[t]!==s&&e.push(this._values[t]);return 0<e.length?this._reject(e):this._cancel(),!0}return!1},c.prototype._fulfilled=function(){return this._totalResolved},c.prototype._rejected=function(){return this._values.length-this.length()},c.prototype._addRejected=function(e){this._values.push(e)},c.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},c.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},c.prototype._getRangeError=function(e){e="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new i(e)},c.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=u,e.prototype.some=function(e){return u(this,e)},e._SomePromiseArray=c}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(this.isFulfilled())return this._settledValue();throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n")},r=t.prototype.error=t.prototype.reason=function(){if(this.isRejected())return this._settledValue();throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n")},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(s,c){var u=e("./util"),l=u.errorObj,d=u.isObject;var f={}.hasOwnProperty;return function(e,t){if(d(e)){if(e instanceof s)return e;var n,r,i,o,a=function(e){try{return e.then}catch(e){return l.e=e,l}}(e);if(a===l)return t&&t._pushContext(),n=s.reject(a.e),t&&t._popContext(),n;if("function"==typeof a)return function(e){try{return f.call(e,"_promise0")}catch(e){}}(e)?(n=new s(c),e._then(n._fulfill,n._reject,void 0,n,null),n):(n=e,a=a,t=t,r=new s(c),i=r,t&&t._pushContext(),r._captureStackTrace(),t&&t._popContext(),o=!0,t=u.tryCatch(a).call(n,function(e){r&&(r._resolveCallback(e),r=null)},function(e){r&&(r._rejectCallback(e,o,!0),r=null)}),o=!1,r&&t===l&&(r._rejectCallback(t.e,!0,!0),r=null),i)}return e}}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(r,i,a){var s=e("./util"),c=r.TimeoutError;function u(e){this.handle=e}u.prototype._resultCancelled=function(){clearTimeout(this.handle)};function o(e){return t(+this).thenReturn(e)}var t=r.delay=function(e,t){var n;return void 0!==t?(n=r.resolve(t)._then(o,null,null,e,void 0),a.cancellation()&&t instanceof r&&n._setOnCancel(t)):(n=new r(i),t=setTimeout(function(){n._fulfill()},+e),a.cancellation()&&n._setOnCancel(new u(t)),n._captureStackTrace()),n._setAsyncGuaranteed(),n};r.prototype.delay=function(e){return t(e,this)};function n(e){return clearTimeout(this.handle),e}function l(e){throw clearTimeout(this.handle),e}r.prototype.timeout=function(e,r){e=+e;var i,o,e=new u(setTimeout(function(){var e,t,n;i.isPending()&&(e=i,n=o,t="string"!=typeof(t=r)?t instanceof Error?t:new c("operation timed out"):new c(t),s.markAsOriginatingFromRejection(t),e._attachExtraTrace(t),e._reject(t),null!=n&&n.cancel())},e));return a.cancellation()?(o=this.then(),(i=o._then(n,l,void 0,e,void 0))._setOnCancel(e)):i=this._then(n,l,void 0,e,void 0),i}}},{"./util":36}],35:[function(a,e,t){"use strict";e.exports=function(d,f,p,t,e,h){var y=a("./util"),n=a("./errors").TypeError,r=a("./util").inherits,v=y.errorObj,g=y.tryCatch,i={};function c(e){setTimeout(function(){throw e},0)}function m(r,i){var o=0,a=r.length,s=new d(e);return function e(){if(a<=o)return s._fulfill();n=r[o++],(t=p(n))!==n&&"function"==typeof n._isDisposable&&"function"==typeof n._getDisposer&&n._isDisposable()&&t._setDisposable(n._getDisposer());var t,n=t;if(n instanceof d&&n._isDisposable()){try{n=p(n._getDisposer().tryDispose(i),r.promise)}catch(e){return c(e)}if(n instanceof d)return n._then(e,c,null,null,null)}e()}(),s}function b(e,t,n){this._data=e,this._promise=t,this._context=n}function o(e,t,n){this.constructor$(e,t,n)}function w(e){return b.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function S(e){this.length=e,this.promise=null,this[e-1]=null}b.prototype.data=function(){return this._data},b.prototype.promise=function(){return this._promise},b.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():i},b.prototype.tryDispose=function(e){var t=this.resource(),n=this._context,t=(void 0!==n&&n._pushContext(),t!==i?this.doDispose(t,e):null);return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,t},b.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},r(o,b),o.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},S.prototype._resultCancelled=function(){for(var e=this.length,t=0;t<e;++t){var n=this[t];n instanceof d&&n.cancel()}},d.using=function(){var e=arguments.length;if(e<2)return f("you must pass at least 2 arguments to Promise.using");var t,o=arguments[e-1];if("function"!=typeof o)return f("expecting a function but got "+y.classString(o));for(var a=!0,n=(2===e&&Array.isArray(arguments[0])?(e=(t=arguments[0]).length,a=!1):(t=arguments,e--),new S(e)),r=0;r<e;++r){var i,s=t[r];b.isDisposer(s)?(s=(i=s).promise())._setDisposable(i):(i=p(s))instanceof d&&(s=i._then(w,null,null,{resources:n,index:r},void 0)),n[r]=s}for(var c=new Array(n.length),r=0;r<c.length;++r)c[r]=d.resolve(n[r]).reflect();var u=d.all(c).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return v.e=n.error(),v;if(!n.isFulfilled())return void u.cancel();e[t]=n.value()}l._pushContext(),o=g(o);var r=a?o.apply(void 0,e):o(e),i=l._popContext();return h.checkForgottenReturns(r,i,"Promise.using",l),r}),l=u.lastly(function(){var e=new d.PromiseInspection(u);return m(n,e)});return(n.promise=l)._setOnCancel(n),l},d.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},d.prototype._isDisposable=function(){return 0<(131072&this._bitField)},d.prototype._getDisposer=function(){return this._disposer},d.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},d.prototype.disposer=function(e){if("function"==typeof e)return new o(e,this,t());throw new n}}},{"./errors":12,"./util":36}],36:[function(e,t,A){"use strict";var u=e("./es5"),n="undefined"==typeof navigator,r={e:{}},i,o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==U?U:void 0!==this?this:null;function a(){try{var e=i;return i=null,e.apply(this,arguments)}catch(e){return r.e=e,r}}function s(e){return i=e,a}var c=function(t,n){var r={}.hasOwnProperty;function e(){for(var e in this.constructor=t,(this.constructor$=n).prototype)r.call(n.prototype,e)&&"$"!==e.charAt(e.length-1)&&(this[e+"$"]=n.prototype[e])}return e.prototype=n.prototype,t.prototype=new e,t.prototype};function l(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function d(e){return"function"==typeof e||"object"==typeof e&&null!==e}function f(e){return l(e)?new Error(T(e)):e}function p(e,t){for(var n=e.length,r=new Array(n+1),i=0;i<n;++i)r[i]=e[i];return r[i]=t,r}function h(e,t,n){var r;return u.isES5?null!=(r=Object.getOwnPropertyDescriptor(e,t))?null==r.get&&null==r.set?r.value:n:void 0:{}.hasOwnProperty.call(e,t)?e[t]:void 0}function y(e,t,n){return l(e)||u.defineProperty(e,t,{value:n,configurable:!0,enumerable:!1,writable:!0}),e}function v(e){throw e}var g=function(){function s(e){for(var t=0;t<o.length;++t)if(o[t]===e)return 1}var c,i,o=[Array.prototype,Object.prototype,Function.prototype];return u.isES5?(c=Object.getOwnPropertyNames,function(e){for(var t,n=[],r=Object.create(null);null!=e&&!s(e);){try{t=c(e)}catch(e){return n}for(var i=0;i<t.length;++i){var o,a=t[i];r[a]||(r[a]=!0,null!=(o=Object.getOwnPropertyDescriptor(e,a))&&null==o.get&&null==o.set&&n.push(a))}e=u.getPrototypeOf(e)}return n}):(i={}.hasOwnProperty,function(e){if(s(e))return[];var t=[];e:for(var n in e){if(!i.call(e,n))for(var r=0;r<o.length;++r)if(i.call(o[r],n))continue e;t.push(n)}return t})}(),m=/this\s*\.\s*\S+\s*=/;function b(e){try{if("function"==typeof e){var t=u.names(e.prototype),n=u.isES5&&1<t.length,r=0<t.length&&!(1===t.length&&"constructor"===t[0]),i=m.test(e+"")&&0<u.names(e).length;if(n||r||i)return!0}return!1}catch(e){return!1}}function w(e){function t(){}t.prototype=e;var n=new t;function r(){n.foo}return r(),r(),e}var S=/^[a-z$_][a-z$_0-9]*$/i;function k(e){return S.test(e)}function C(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function T(e){try{return e+""}catch(e){return"[no string representation]"}}function P(e){return e instanceof Error||null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function _(e){try{y(e,"isOperational",!0)}catch(e){}}function O(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function E(e){return P(e)&&u.propertyIsWritable(e,"stack")}var I="stack"in new Error?function(e){return E(e)?e:new Error(T(e))}:function(e){if(E(e))return e;try{throw new Error(T(e))}catch(e){return e}};function R(e){return{}.toString.call(e)}function L(e,t,n){for(var r=u.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{u.defineProperty(t,o,u.getDescriptor(e,o))}catch(e){}}}var M=function(e){return u.isArray(e)?e:null},j,M,N=("undefined"!=typeof Symbol&&Symbol.iterator&&(j="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n},M=function(e){return u.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?j(e):null}),void 0!==ie&&"[object process]"===R(ie).toLowerCase()),x=void 0!==ie&&void 0!==ie.env,F;function B(e){return x?ie.env[e]:void 0}function W(){if("function"==typeof Promise)try{if("[object Promise]"===R(new Promise(function(){})))return Promise}catch(e){}}function H(e,t){var n,r;return null!==e&&"function"==typeof t&&t!==F&&(null!==e.domain&&(t=e.domain.bind(t)),null!==(n=e.async)&&(r=t,t=function(){var e=new Array(2).concat([].slice.call(arguments));return e[0]=r,e[1]=this,n.runInAsyncScope.apply(n,e)})),t}var D={setReflectHandler:function(e){F=e},isClass:b,isIdentifier:k,inheritedDataKeys:g,getDataPropertyOrDefault:h,thrower:v,isArray:u.isArray,asArray:M,notEnumerableProp:y,isPrimitive:l,isObject:d,isError:P,canEvaluate:n,errorObj:r,tryCatch:s,inherits:c,withAppended:p,maybeWrapAsError:f,toFastProperties:w,filledRange:C,toString:T,canAttachTrace:E,ensureErrorObject:I,originatesFromRejection:O,markAsOriginatingFromRejection:_,classString:R,copyDescriptors:L,isNode:N,hasEnvVariables:x,env:B,global:o,getNativePromise:W,contextBind:H};D.isRecentNode=D.isNode&&function(){var e;return ie.versions&&ie.versions.node?e=ie.versions.node.split(".").map(Number):ie.version&&(e=ie.version.split(".").map(Number)),0===e[0]&&10<e[1]||0<e[0]}(),D.nodeSupportsAsyncResource=D.isNode&&function(){var t=!1;try{t="function"==typeof e("async_hooks").AsyncResource.prototype.runInAsyncScope}catch(e){t=!1}return t}(),D.isNode&&D.toFastProperties(ie);try{throw new Error}catch(e){D.lastLineError=e}t.exports=D},{"./es5":13,async_hooks:void 0}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}.call(this)}.call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{_process:29,timers:30}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PreCallTest=void 0;var r=function(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e},i=e("./turnConnection"),o=e("./tests/rttTest"),a=e("./tests/throughputTest"),s=e("./tests/lossTest"),c=e("./utility/resultsHandler"),u=e("./utility/onlineCheck"),l=e("./utility/stats/detectbrowser"),d=e("./mlPipeline/mlPipeline"),f=e("./mlPipeline/notification");function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=e("bluebird"),y="rtt",v="loss",g="throughput",e=(r(m,[{key:"start",value:function(e,t,n){this.browserInfo.browserName!==l.Constants.browserName.msie?(this.iceServers=e,this.callback=n,this.active?this.callback&&this.callback(null,"Not started: already in progress"):0<this.callsInProgress?this.callback&&this.callback(null,"Not started: call in progress"):e?(this.turnTestCounter=0,this.resultsHandler=new c.ResultsHandler,t&&(this.resultsHandler.setProvider(t.provider),this.resultsHandler.setisRunManually(t.isRunManually),this.resultsHandler.setrunByUser(t.runByUser),this.resultsHandler.setEnableMLNotification(t.enableMLNotification)),n={type:"browser",os:this.browserInfo.os,osVersion:this.browserInfo.osVersion,buildName:this.browserInfo.browserName,buildVersion:this.browserInfo.browserVersion,userAgent:this.browserInfo.userAgent},this.resultsHandler.add("endpointInfo",n),this.onlineCheck.start(),this.active=!0,this._start()):this.callback&&this.callback(null,"Not started: no ICE servers given")):this.callback&&this.callback(null,"Not started: disabled for IE")}},{key:"_start",value:function(){var r=this;this.active&&(this.turnConnection=new i.TurnConnection(this.browserInfo),this.turnConnection.connect(this.iceServers).then(function(){r.active?(r.resultsHandler&&r.resultsHandler.setStatusSuccess(),r.startTurnTests().then(function(){r.stop()},function(e){r.stop()})):r.stop()},function(e){var t=e.continueFlag;if(r.resultsHandler&&r.resultsHandler.failure(e),t)!r.resultsHandler||(r.resultsHandler.setStatusFailed(),10<=r.resultsHandler.getFailureNumber())?r.stop():(r.turnConnection.disconnect(),setTimeout(function(){r._start()},0));else{r.turnConnection.disconnect(),r.active=!1;var n="";try{n=e.stack}catch(t){n=e.toString()}n&&""!==n||(n=e.toString()),r.resultsHandler&&r.resultsHandler.setStatusFailed(),r.callback(null,n)}}))}},{key:"stop",value:function(){var e,t=this;this.browserInfo.browserName!==l.Constants.browserName.msie&&this.active&&(this.active=!1,this.activeTurnTest&&this.activeTurnTest.forceStop(),e=this.onlineCheck.stop(),this.resultsHandler&&this.resultsHandler.add("onlineStatus",e),this.turnConnection.getIceResults().then(function(e){t.resultsHandler&&t.resultsHandler.add("ice",e),t.turnConnection.disconnect(),t.sendResults()},function(e){t.resultsHandler&&t.resultsHandler.failure(e),t.turnConnection.disconnect(),t.sendResults()}))}},{key:"sendResults",value:function(){if(this.resultsHandler){var e=this.resultsHandler.getResults();if(this.callback){if(this.resultsHandler.enableMLNotification){var t=null;try{t=this.MLPipeline.run({throughput:e.tests.throughput.average,rtt:e.tests.rtt.median,lossFraction:e.tests.throughput.fractionLostBytes,jitter:e.tests.rtt.variance,localIP:e.tests.ice.localIP})}catch(e){(t=new f.Notification).setErrorMessage="ML Pipeline execution error:"+e.message,t=t.get()}e.mlNotification=t}this.resultsHandler=null,this.callback(e,null)}}else this.callback&&this.callback(null,"No results present")}},{key:"callStarts",value:function(){this.callsInProgress+=1,this.resultsHandler&&this.resultsHandler.setStatusStopped(),this.stop()}},{key:"callFinished",value:function(){--this.callsInProgress}},{key:"getId",value:function(){return this.resultsHandler?this.resultsHandler.getId():null}},{key:"crashDisconnect",value:function(){try{this.turnConnection.disconnect()}catch(e){}}},{key:"startTurnTests",value:function(){var t=this;if(this.turnTestCounter>=this.turnTests.length)return new h(function(e,t){e()});var n=this.turnTests[this.turnTestCounter],r=null;switch(n){case y:r=new o.RttTest(this.turnConnection);break;case v:r=new s.LossTest(this.turnConnection);break;case g:r=new a.ThroughputTest(this.turnConnection,this.rtt,this.fractionLostBytes);break;default:return new h(function(e,t){t(new Error("Unknown test: "+n))})}return this.activeTurnTest=r,this.active?r.start().then(function(){return t.handleTestResults(n,r.getResults()),t.turnTestCounter+=1,t.activeTurnTest=null,t.startTurnTests()},function(e){return t.handleTestResults(n,r.getResults(),e),t.turnTestCounter+=1,t.activeTurnTest=null,t.startTurnTests()}):new h(function(e,t){t(new Error("Test trying to start while testing is not active"))})}},{key:"handleTestResults",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;null==n&&e==y?this.rtt=t.median:null==n&&e==v&&(this.fractionLostBytes=t.fractionLostBytes),this.resultsHandler&&this.resultsHandler.add(e,t)}}]),m);function m(){if(!(this instanceof m))throw new TypeError("Cannot call a class as a function");this.browserInfo=(0,l.detect)(),this.onlineCheck=new u.OnlineCheck,this.callsInProgress=0,this.turnTests=[y,v,g],this.active=!1,this.rtt=null,this.fractionLostBytes=-1,this.resultsHandler=null,this.MLPipeline=new d.MLPipeline}n.PreCallTest=e},{"./mlPipeline/mlPipeline":10,"./mlPipeline/notification":12,"./tests/lossTest":15,"./tests/rttTest":16,"./tests/throughputTest":17,"./turnConnection":19,"./utility/onlineCheck":21,"./utility/resultsHandler":24,"./utility/stats/detectbrowser":25,bluebird:2}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.config={WINDOW_SIZE:4,MIN_WINDOW_SIZE:4,SCT_METRICS_LIST:["throughput","rtt","jitter","lossFraction"],TIME_INTERVAL:36e5,notificationStatusMessage:{Ready:"Ready",Default:"Wait for more data",Error:"Wait for more data"},THROUGHPUT_MODEL:{EXCELLENT_INTERVAL:[1e3,1/0],GOOD_INTERVAL:[300,1e3],FAIR_INTERVAL:[150,300],POOR_INTERVAL:[24,150],BAD_INTERVAL:[0,24]},RTT_MODEL:{GOOD_INTERVAL:[0,150],OK_INTERVAL:[150,300],BAD_INTERVAL:[300,1/0]},LOSS_FRACTION_MODEL:{GOOD_INTERVAL:[0,.05],OK_INTERVAL:[.05,.1],BAD_INTERVAL:[.1,1]},JITTER_MODEL:{GOOD_INTERVAL:[0,40],OK_INTERVAL:[40,100],BAD_INTERVAL:[100,1/0]},DATA_COLLECTOR_NETWORK_PROPERTIES:["localID","networkType","localIP","status","siteID","deviceID","runManually","isp","city","country"],NOTIFICATION_NETWORK_PROPERTIES:["localIP","networkType","deviceID","isp","city","country"]}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.InvalidTimestampError=n.SlidingWindow=n.DataCollector=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e},d=e("./config.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function t(e){f(this,t);e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.name="InvalidTimestampError",e}var e=t,n=Error;if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);return e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n),t}(),p=(r(s,[{key:"setWindowSize",value:function(e){this.windowSize=e}},{key:"getWindow",value:function(){return this.newData=!1,this.window}},{key:"hasNewData",value:function(){return this.newData}},{key:"checkWindow",value:function(){return this.validWindow}},{key:"clear",value:function(){this.window=[],this.counters.clear(),this.newData=!1,this.validWindow=!1}},{key:"calcMajority",value:function(){var t=this;if(0===this.counters.size)return null;this.newData=!1;var n=Math.max.apply(Math,o(this.counters.values())),e=[].concat(o(this.counters.keys())).filter(function(e){return t.counters.get(e)===n});return 1<e.length?this._calcAverageFloor(this.window):e[0]}},{key:"add",value:function(e,t){return null!==this.latestTimeBoundary&&e<this.latestTimeBoundary-this.minTimeInterval/5?(this.newData=!1,new a("Invalid timestamp: "+e+". \n        The timestamp is earlier than the time boundary: "+this.latestTimeBoundary+".")):(this.latestTimeBoundary=this._getTimeBoundary(e),this._add(t),null)}},{key:"_add",value:function(e){this.window.push(e);var t;this.counters.has(e)?(t=this.counters.get(e),this.counters.set(e,t+1)):this.counters.set(e,1),this.window.length>this.windowSize&&(t=this.window.shift(),e=this.counters.get(t),this.counters.set(t,e-1)),this.window.length>=this.minWindowSize?this.validWindow=!0:this.validWindow=!1,this.newData=!0}},{key:"_getTimeBucket",value:function(e){e-=e%this.minTimeInterval;return[e,e+this.minTimeInterval]}},{key:"_getTimeBoundary",value:function(e){return this._getTimeBucket(e)[1]}},{key:"_calcAverageFloor",value:function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];var r=t/e.length;return Math.floor(r)}}]),s),e=(r(h,[{key:"setNewNetworkContext",value:function(e){this.newNetworkContext=e}},{key:"getSlidingWindows",value:function(){var e={},t=!0,n=!1,r=void 0;try{for(var i,o=this.sctMetricsList[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;e[a]=this.slidingWindows[a].getWindow()}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e}},{key:"getNetworkContext",value:function(){return this.networkContext}},{key:"checkWindows",value:function(){var e=!0,t=!0,n=!1,r=void 0;try{for(var i,o=this.sctMetricsList[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.slidingWindows[a].hasNewData()&&this.slidingWindows[a].checkWindow()||(e=!1)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e}},{key:"checkNetworkContext",value:function(){return this.newNetworkContext}},{key:"calcSlidingWindowsMajority",value:function(){return{throughput:this.slidingWindows.throughput.calcMajority(),rtt:this.slidingWindows.rtt.calcMajority(),lossFraction:this.slidingWindows.lossFraction.calcMajority(),jitter:this.slidingWindows.jitter.calcMajority()}}},{key:"add",value:function(e){try{this._updateNetworkContext(e)}catch(e){return new Error("Unable to update network context.")}var t=e.timestamp;if(!0===this.newNetworkContext){var n=!0,r=!1,i=void 0;try{for(var o,a=this.sctMetricsList[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;this.slidingWindows[s].clear()}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}if(!("throughputRating"in e))return new Error("Missing throughput rating.");if(!("rttRating"in e))return new Error("Missing rtt rating.");if(!("lossFractionRating"in e))return new Error("Missing loss fraction rating.");if(!("jitterRating"in e))return new Error("Missing jitter rating.");r=null;try{r=this.slidingWindows.throughput.add(t,e.throughputRating)}catch(e){return e}try{r=this.slidingWindows.rtt.add(t,e.rttRating)}catch(e){return e}try{r=this.slidingWindows.lossFraction.add(t,e.lossFractionRating)}catch(e){return e}try{r=this.slidingWindows.jitter.add(t,e.jitterRating)}catch(e){return e}return null!=r?r:null}},{key:"_updateNetworkContext",value:function(e){e.hasOwnProperty("localIP")&&this.networkContext.localIP!==e.localIP?this.newNetworkContext=!0:this.newNetworkContext=!1;var t=!0,n=!1,r=void 0;try{for(var i,o=d.config.DATA_COLLECTOR_NETWORK_PROPERTIES[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a in e&&(this.networkContext[a]=e[a])}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}}]),h);function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(f(this,h),this.newNetworkContext=!1,this.networkContext={},this.sctMetricsList=d.config.SCT_METRICS_LIST,this.slidingWindows={},this.timeInterval=null!==e?e:d.config.TIME_INTERVAL,!0),n=!1,r=void 0;try{for(var i,o=this.sctMetricsList[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.slidingWindows[a]=new p(d.config.WINDOW_SIZE,this.timeInterval,d.config.MIN_WINDOW_SIZE)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var s=!0,n=!1,r=void 0;try{for(var c,u=d.config.DATA_COLLECTOR_NETWORK_PROPERTIES[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var l=c.value;this.networkContext[l]=null}}catch(e){n=!0,r=e}finally{try{!s&&u.return&&u.return()}finally{if(n)throw r}}}function s(e,t,n){f(this,s),this.counters=new Map,this.latestTimeBoundary=null,this.minTimeInterval=t,this.minWindowSize=n,this.newData=!1,this.windowSize=e,this.window=[],this.validWindow=!1}n.DataCollector=e,n.SlidingWindow=p,n.InvalidTimestampError=a},{"./config.js":4}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.throughputQuality=n.Quality=n.SimpleThroughputQualityRater=n.SimpleQualityRater=n.DataPreprocessor=void 0;var r=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e},i=e("./config.js");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s={GOOD:3,OK:2,BAD:1,toString:function(e){return e==this.GOOD?"GOOD":e==this.BAD?"BAD":e==this.OK?"OK":void 0}},c={EXCELLENT:5,GOOD:4,FAIR:3,POOR:2,BAD:1,toString:function(e){return e==this.GOOD?"GOOD":e==this.BAD?"BAD":e==this.POOR?"POOR":e==this.EXCELLENT?"EXCELLENT":e==this.FAIR?"FAIR":void 0}},u=(Object.freeze(s),Object.freeze(c),r(f,[{key:"classifyQuality",value:function(e){return null===e?-1:e>=this.goodInterval[0]&&e<this.goodInterval[1]?s.GOOD:e>=this.okInterval[0]&&e<this.okInterval[1]?s.OK:e>=this.badInterval[0]&&e<=this.badInterval[1]?s.BAD:-1}}]),f),l=function(){function o(e,t,n,r,i){a(this,o);t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t,null,i));return t.excellentInterval=e,t.fairInterval=n,t.poorInterval=r,t}var e=o,t=u;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),r(o,[{key:"classifyQuality",value:function(e){return null===e?-1:e>=this.excellentInterval[0]&&e<=this.excellentInterval[1]?c.EXCELLENT:e>=this.goodInterval[0]&&e<this.goodInterval[1]?c.GOOD:e>=this.fairInterval[0]&&e<this.fairInterval[1]?c.FAIR:e>=this.poorInterval[0]&&e<this.poorInterval[1]?c.POOR:e>=this.badInterval[0]&&e<this.badInterval[1]?c.BAD:-1}}]),o}();function d(){a(this,d),this.throughputRater=new l(i.config.THROUGHPUT_MODEL.EXCELLENT_INTERVAL,i.config.THROUGHPUT_MODEL.GOOD_INTERVAL,i.config.THROUGHPUT_MODEL.FAIR_INTERVAL,i.config.THROUGHPUT_MODEL.POOR_INTERVAL,i.config.THROUGHPUT_MODEL.BAD_INTERVAL),this.rttRater=new u(i.config.RTT_MODEL.GOOD_INTERVAL,i.config.RTT_MODEL.OK_INTERVAL,i.config.RTT_MODEL.BAD_INTERVAL),this.lossFractionRater=new u(i.config.LOSS_FRACTION_MODEL.GOOD_INTERVAL,i.config.LOSS_FRACTION_MODEL.OK_INTERVAL,i.config.LOSS_FRACTION_MODEL.BAD_INTERVAL),this.jitterRater=new u(i.config.JITTER_MODEL.GOOD_INTERVAL,i.config.JITTER_MODEL.OK_INTERVAL,i.config.JITTER_MODEL.BAD_INTERVAL)}function f(e,t,n){a(this,f),this.goodInterval=e,this.okInterval=t,this.badInterval=n}r(d,[{key:"classifyThroughputQuality",value:function(e){return this.throughputRater.classifyQuality(e)}},{key:"classifyRTTQuality",value:function(e){return this.rttRater.classifyQuality(e)}},{key:"classifyLossFractionQuality",value:function(e){return this.lossFractionRater.classifyQuality(e)}},{key:"classifyJitterQuality",value:function(e){return this.jitterRater.classifyQuality(e)}},{key:"process",value:function(e){try{e.throughputRating=this.classifyThroughputQuality(e.throughput)}catch(e){return new Error("Unable to process Throughput measurement.")}try{e.rttRating=this.classifyRTTQuality(e.rtt)}catch(e){return new Error("Unable to process RTT measurement.")}try{e.lossFractionRating=this.classifyLossFractionQuality(e.lossFraction)}catch(e){return new Error("Unable to process Loss Fraction measurement.")}try{e.jitterRating=this.classifyJitterQuality(e.jitter)}catch(e){return new Error("Unable to process Jitter measurement.")}return null}}]),n.DataPreprocessor=d,n.SimpleQualityRater=u,n.SimpleThroughputQualityRater=l,n.Quality=s,n.throughputQuality=c},{"./config.js":4}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DataValidator=n.DataPreparer=n.DataCleaner=void 0;var r=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e},i=e("./errors.js");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r(d,null,[{key:"validateMeasurement",value:function(e){return!("number"!=typeof e&&"bigint"!=typeof e||isNaN(e)||e<0)}},{key:"validateThroughput",value:function(e){return d.validateMeasurement(e)}},{key:"validateRTT",value:function(e){return d.validateMeasurement(e)}},{key:"validateLossFraction",value:function(e){return!("number"!=typeof e&&"bigint"!=typeof e||isNaN(e)||e<-1||1<e)}},{key:"validateJitter",value:function(e){return d.validateMeasurement(e)}}]);var s=d,c=(r(l,null,[{key:"cleanLossFraction",value:function(e){return e<0&-.001<=e?0:e<-.001?Math.abs(e):e}},{key:"cleanJitter",value:function(e){return Math.min(e,2e3)}}]),l),e=(r(u,null,[{key:"prepare",value:function(e){return"throughput"in e&&s.validateThroughput(e.throughput)?"rtt"in e&&s.validateRTT(e.rtt)?"lossFraction"in e&&s.validateLossFraction(e.lossFraction)?"jitter"in e&&s.validateJitter(e.jitter)?(e.lossFraction=c.cleanLossFraction(e.lossFraction),e.jitter=c.cleanJitter(e.jitter),null):new i.InvalidJitterMeasurement("Invalid jitter measurement."):new i.InvalidLossFractionMeasurement("Invalid loss fraction measurement."):new i.InvalidRTTMeasurement("Invalid rtt measurement."):new i.InvalidThroughputMeasurement("Invalid throughput measurement.")}}]),u);function u(){a(this,u)}function l(){a(this,l)}function d(){a(this,d)}n.DataCleaner=c,n.DataPreparer=e,n.DataValidator=s},{"./errors.js":9}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkQualityElement=n.NetworkQuality=n.DecisionMaker=void 0;var r=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e},i=e("./res/sctMessages.js"),o=e("./dataPreprocessor.js");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r(f,[{key:"get",value:function(){return{code:this.code,text:this.text}}}],[{key:"fromJSON",value:function(e){return new f(e.code,e.text)}}]);var c=f,u=(r(d,[{key:"get",value:function(){return{connectivity:null!==this.connectivity?this.connectivity.get():null,status:null!==this.status?this.status.get():null,summary:null!==this.summary?this.summary.get():null,notification:null!==this.notification?this.notification.get():null,sctCode:this.sctCode}}}],[{key:"fromJSON",value:function(e){return new d({connectivity:c.fromJSON(e.connectivity),status:c.fromJSON(e.status),summary:c.fromJSON(e.summary),notification:c.fromJSON(e.notification),sctCode:e.sctCode})}}]),d),e=(r(l,null,[{key:"getJRLTCode",value:function(e,t,n,r){return[e,t,n,r].join("")}},{key:"getNetworkQuality",value:function(e,t,n,r){e=this.getJRLTCode(e,t,n,r);return e in i.TABLE_OF_MESSAGES?[u.fromJSON(i.TABLE_OF_MESSAGES[e]).get(),null]:[null,Error("Invalid notificaton code: "+e)]}},{key:"updateNotification",value:function(e,t,n){var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=e,r=t,i=[],o=!0,e=!1,t=void 0;try{for(var a,s=n[Symbol.iterator]();!(o=(a=s.next()).done)&&(i.push(a.value),!r||i.length!==r);o=!0);}catch(n){e=!0,t=n}finally{try{!o&&s.return&&s.return()}finally{if(e)throw t}}return i}throw new TypeError("Invalid attempt to destructure non-iterable instance")}(this.getNetworkQuality(t.jitter,t.rtt,t.lossFraction,t.throughput),2),i=r[0],r=r[1];return r?e.setErrorMessage(r.message):(e.jrltCode=this.getJRLTCode(t.jitter,t.rtt,t.lossFraction,t.throughput),e.queue={throughput:o.throughputQuality.toString(t.throughput),rtt:o.Quality.toString(t.rtt),lossFraction:o.Quality.toString(t.lossFraction),jitter:o.Quality.toString(t.jitter)},e.updateNetworkContext(n),e.setNetworkQuality(i)),e}}]),l);function l(){s(this,l)}function d(e){var t=e.connectivity,t=void 0===t?null:t,n=e.status,n=void 0===n?null:n,r=e.summary,r=void 0===r?null:r,i=e.notification,i=void 0===i?null:i,e=e.sctCode,e=void 0===e?null:e;s(this,d),this.connectivity=t,this.status=n,this.summary=r,this.notification=i,this.sctCode=e}function f(e,t){s(this,f),this.code=e,this.text=t}n.DecisionMaker=e,n.NetworkQuality=u,n.NetworkQualityElement=c},{"./dataPreprocessor.js":6,"./res/sctMessages.js":14}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});o(p,Error);var a=p,s=(o(f,Error),f),c=(o(d,Error),d),u=(o(l,Error),l);function l(e){r(this,l);e=i(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e));return e.name="InvalidJitterMeasurement",e}function d(e){r(this,d);e=i(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,e));return e.name="InvalidLossFractionMeasurement",e}function f(e){r(this,f);e=i(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e));return e.name="InvalidRTTMeasurement",e}function p(e){r(this,p);e=i(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,e));return e.name="InvalidThroughputMeasurement",e}n.InvalidThroughputMeasurement=a,n.InvalidRTTMeasurement=s,n.InvalidLossFractionMeasurement=c,n.InvalidJitterMeasurement=u},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MLPipeline=void 0;var r=function(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e},i=e("./dataCollector.js"),o=e("./dataValidation.js"),a=e("./dataPreprocessor.js"),s=e("./decisionMaker.js"),g=e("./notification.js"),c=e("./model.js"),u=e("./notifier.js");function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}r(d,[{key:"run",value:function(e){return this._run(e).get()}},{key:"_run",value:function(e){var t=e.timestamp,t=void 0===t?Date.now():t,n=e.runManually,r=e.status,i=e.appID,o=e.throughput,a=e.rtt,s=e.lossFraction,c=e.jitter,u=e.localID,l=e.localIP,d=e.networkType,f=e.siteID,p=e.deviceID,h=e.isp,y=e.city,v=e.country,n={runManually:void 0===n?null:n,status:void 0===r?null:r,appID:void 0===i?null:i,timestamp:t,throughput:void 0===o?null:o,rtt:void 0===a?null:a,lossFraction:void 0===s?null:s,jitter:void 0===c?null:c,localID:void 0===u?null:u,localIP:void 0===l?null:l,networkType:void 0===d?null:d,siteID:void 0===f?null:f,deviceID:void 0===p?null:p,isp:void 0===h?null:h,city:void 0===y?null:y,country:void 0===v?null:v},r=new g.Notification,i=(r.updateNetworkContext(n),null);try{i=this.DataPreparer.prepare(n)}catch(e){t="Data Preparer: "+e.message;return r.setErrorMessage(t),r}if(null!=i)o="Data Preparer: "+i.message,r.setErrorMessage(o);else{i=null;try{i=this.DataPreprocessor.process(n)}catch(e){a="Data Preprocessor: "+e.message;return r.setErrorMessage(a),r}if(null!=i)s="Data Preprocessor: "+i.message,r.setErrorMessage(s);else{i=null;try{i=this.dataCollector.add(n)}catch(e){c="Data Collector: "+e.message;return r.setErrorMessage(c),r}if(null!=i)u="Data Collector: "+i.message,r.setErrorMessage(u);else if(this.dataCollector.checkNetworkContext()&&r.setNewNetworkContext(),this.dataCollector.checkWindows()){l=null,i=null;try{l=this.model.predict(this.dataCollector)}catch(e){d="Model: "+e.message;return r.setErrorMessage(d),r}try{this.decisionMaker.updateNotification(r,l,this.dataCollector.getNetworkContext())}catch(e){f="Decision Maker: "+e.message;return r.setErrorMessage(f),r}try{this.notifier.enable(r)}catch(e){p="Notifier: "+e.message;r.setErrorMessage(p)}}else r.setErrorMessage("Data Collector: Invalid Sliding Window. Throughput:["+this.dataCollector.slidingWindows.throughput.window+"], RTT:["+this.dataCollector.slidingWindows.rtt.window+"], LossFraction:["+this.dataCollector.slidingWindows.lossFraction.window+"], Jitter:["+this.dataCollector.slidingWindows.jitter.window+"]")}}return r}}]);e=d;function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");this.dataCollector=new i.DataCollector,this.DataPreparer=o.DataPreparer,this.DataPreprocessor=new a.DataPreprocessor,this.decisionMaker=s.DecisionMaker,this.model=c.Model,this.notifier=u.Notifier}n.MLPipeline=e},{"./dataCollector.js":5,"./dataPreprocessor.js":6,"./dataValidation.js":7,"./decisionMaker.js":8,"./model.js":11,"./notification.js":12,"./notifier.js":13}],11:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(i,null,[{key:"predict",value:function(e){return e.calcSlidingWindowsMajority()}}]),n.Model=i},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Notification=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e},s=e("./config.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}r(o,[{key:"setErrorMessage",value:function(e){this.errorMessage=e,this.setErrorStatus(),this.suppress()}},{key:"setErrorStatus",value:function(){this.statusMessage=s.config.notificationStatusMessage.Error}},{key:"setReadyStatus",value:function(){this.statusMessage=s.config.notificationStatusMessage.Ready}},{key:"setNewNetworkContext",value:function(){this.newNetworkContext=!0}},{key:"setNetworkQuality",value:function(e){if(null===e)return this.setErrorMessage("Invalid NetworkQuality object"),new Error("Invalid NetworkQuality object");this.setNotification(e.notification),this.connectivity=e.connectivity,this.status=e.status,this.summary=e.summary,this.notificationCode=e.sctCode}},{key:"setNotification",value:function(e){null!==e&&("text"in e&&"string"==typeof e.text?this.enable():this.setErrorMessage("Invalid notification text")),this.notification=e}},{key:"clearErrorMessage",value:function(){this.errorMessage=null,this.enable()}},{key:"clear",value:function(){this.clearNotification=!0}},{key:"enable",value:function(){this.sendFlag=!0,this.clearNotification=!1,this.setReadyStatus()}},{key:"suppress",value:function(){this.sendFlag=!1}},{key:"updateNetworkContext",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=s.config.NOTIFICATION_NETWORK_PROPERTIES[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a in e&&null!==e[a]&&(this.networkContext[a]=e[a])}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"get",value:function(){var n={};return Object.entries(this).forEach(function(e){var e=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=e,r=t,i=[],o=!0,e=!1,t=void 0;try{for(var a,s=n[Symbol.iterator]();!(o=(a=s.next()).done)&&(i.push(a.value),!r||i.length!==r);o=!0);}catch(n){e=!0,t=n}finally{try{!o&&s.return&&s.return()}finally{if(e)throw t}}return i}throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e,2),t=e[0],e=e[1];null!==e&&(n[t]=e)}),n}}]);e=o;function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now(),t=this,n=o;if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");this.timestamp=e,this.statusMessage=s.config.notificationStatusMessage.Default,this.notification=null,this.notificationCode=null,this.networkContext={},this.newNetworkContext=!1,this.queue=null,this.errorMessage=null,this.jrltCode=null,this.connectivity=null,this.status=null,this.summary=null,this.sendFlag=!1,this.clearNotification=!1}n.Notification=e},{"./config.js":4}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Notifier=void 0;var r=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e},i=e("./notification.js");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.oldNotificationStatus=0}r(a,null,[{key:"enable",value:function(e){if(!(e instanceof i.Notification)||null===e)return new Error("Invalid Notification.");e.status&&null!==e.status?(1!==e.status.code&&1===this.oldNotificationStatus?(e.enable(),e.clear()):1!==e.status.code||e.status.code===this.oldNotificationStatus?e.suppress():e.enable(),this.oldNotificationStatus=e.status.code):e.suppress()}}]),n.Notifier=a},{"./notification.js":12}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.TABLE_OF_MESSAGES={"0001":{connectivity:{code:1,text:"no connectivity"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be really terrible"},sctCode:1110100},"0002":{connectivity:{code:2,text:"no media device"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be really terrible"},sctCode:2110100},1111:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1112:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1113:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1114:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1115:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1121:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1122:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},1123:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},1124:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},1125:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},1131:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1132:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},1133:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},1134:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},1135:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},1211:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1212:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},1213:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},1214:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},1215:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},1221:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},1222:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},1223:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},1224:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},1225:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},1231:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},1232:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},1233:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},1234:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},1235:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},1311:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},1312:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},1313:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},1314:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},1315:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},1321:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},1322:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},1323:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},1324:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},1325:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},1331:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},1332:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:70,text:"Connection is Good, Poor bandwidth (audio-only and thumbnail video). "},notification:{code:700,text:"With current bandwidth you can have audio-only and thumbnail video"},sctCode:3270700},1333:{connectivity:{code:3,text:"success"},status:{code:3,text:"fair"},summary:{code:75,text:"Connection is Good, Fair bandwidth (good audio, poor video). "},notification:{code:750,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing"},sctCode:3375750},1334:{connectivity:{code:3,text:"success"},status:{code:4,text:"good"},summary:{code:90,text:"Connection and bandwidth are both good "},notification:{code:900,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality"},sctCode:3490900},1335:{connectivity:{code:3,text:"success"},status:{code:5,text:"excellent"},summary:{code:95,text:"Excellent network"},notification:{code:950,text:"You are in a good network condition"},sctCode:3595950},2111:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2112:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2113:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2114:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2115:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2121:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2122:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},2123:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},2124:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},2125:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},2131:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2132:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},2133:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},2134:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},2135:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},2211:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2212:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},2213:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},2214:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},2215:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},2221:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},2222:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},2223:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},2224:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},2225:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},2231:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},2232:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},2233:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},2234:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},2235:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},2311:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},2312:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},2313:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},2314:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},2315:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},2321:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},2322:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},2323:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},2324:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},2325:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},2331:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},2332:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:70,text:"Connection is Good, Poor bandwidth (audio-only and thumbnail video). "},notification:{code:700,text:"With current bandwidth you can have audio-only and thumbnail video"},sctCode:3270700},2333:{connectivity:{code:3,text:"success"},status:{code:3,text:"fair"},summary:{code:75,text:"Connection is Good, Fair bandwidth (good audio, poor video). "},notification:{code:750,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing"},sctCode:3375750},2334:{connectivity:{code:3,text:"success"},status:{code:4,text:"good"},summary:{code:90,text:"Connection and bandwidth are both good "},notification:{code:900,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality"},sctCode:3490900},2335:{connectivity:{code:3,text:"success"},status:{code:5,text:"excellent"},summary:{code:95,text:"Excellent network"},notification:{code:950,text:"You are in a good network condition"},sctCode:3595950},3111:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3112:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3113:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3114:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3115:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3121:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3122:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},3123:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},3124:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},3125:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},3131:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3132:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},3133:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},3134:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},3135:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:30,text:"High latency"},notification:{code:300,text:"Your round trip time seems to be too high for good quality calls, but it might be because you are located far from our test servers"},sctCode:3130300},3211:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3212:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},3213:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},3214:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},3215:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},3221:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},3222:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},3223:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},3224:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},3225:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},3231:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},3232:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},3233:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},3234:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},3235:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},3311:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:10,text:"Bad connection"},notification:{code:100,text:"We expect your call quality to be very poor"},sctCode:3110100},3312:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},3313:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},3314:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},3315:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:20,text:"High packet loss"},notification:{code:200,text:"You have poor network conditions (lossy network)"},sctCode:3120200},3321:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},3322:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:50,text:"Connection is Fair with minor issues, Poor bandwidth (audio-only and thumbnail video)."},notification:{code:500,text:"With current bandwidth you can have audio-only and thumbnail video. Your network is unstable and you might experience minor issues"},sctCode:3250500},3323:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:55,text:"Connection is Fair with minor issues,  Fair bandwidth (good audio, poor video)."},notification:{code:550,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing. Your network is unstable and you might experience minor issues"},sctCode:3255550},3324:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:60,text:"Connection is Fair with minor issues, Good bandwidth (good audio and fair video)"},notification:{code:600,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality. Your network is unstable and you might experience minor issues"},sctCode:3260600},3325:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:65,text:"Connection is Fair with minor issues (bandwidth excellent)"},notification:{code:650,text:"Your network is unstable and you might experience minor issues"},sctCode:3265650},3331:{connectivity:{code:3,text:"success"},status:{code:1,text:"bad"},summary:{code:40,text:"Insufficient bandwidth "},notification:{code:400,text:"Your bandwidth is insufficient for both audio and video calls"},sctCode:3140400},3332:{connectivity:{code:3,text:"success"},status:{code:2,text:"poor"},summary:{code:70,text:"Connection is Good, Poor bandwidth (audio-only and thumbnail video). "},notification:{code:700,text:"With current bandwidth you can have audio-only and thumbnail video"},sctCode:3270700},3333:{connectivity:{code:3,text:"success"},status:{code:3,text:"fair"},summary:{code:75,text:"Connection is Good, Fair bandwidth (good audio, poor video). "},notification:{code:750,text:"Current bandwidth is enough for good audio quality, but poor video quality or screen sharing"},sctCode:3375750},3334:{connectivity:{code:3,text:"success"},status:{code:4,text:"good"},summary:{code:90,text:"Connection and bandwidth are both good "},notification:{code:900,text:"Your bandwidth is enough for good audio and fair video quality, but not enough for screen sharing quality"},sctCode:3490900},3335:{connectivity:{code:3,text:"success"},status:{code:5,text:"excellent"},summary:{code:95,text:"Excellent network"},notification:{code:950,text:"You are in a good network condition"},sctCode:3595950}}},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LossTest=void 0;function i(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);return void 0===r?null===(e=Object.getPrototypeOf(e))?void 0:i(e,t,n):"value"in r?r.value:void 0!==(e=r.get)?e.call(n):void 0}var r=function(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),a=e("../utility/messageMaker"),s=e("./turnTest");function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function t(e){if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))).sentBytes=0,e.receivedBytes=0,e.chunkSize=1024,e.messageMaker=new a.MessageMaker(e.chunkSize),e.duration=3e3,e.sendTimer=null,e.lastMessage=null,e.numBufferFill=0,e;throw new TypeError("Cannot call a class as a function")}var e=t,n=s.TurnTest;if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);return e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n),r(t,[{key:"initiate",value:function(){var e;window&&window.csioReactNative?this.handleError(new Error("Not running loss test for react-native")):(e=o.getCurrent(),this.results.startTimestamp=e,this.startSend())}},{key:"handleMessage",value:function(e){var t=this;this.isActive()&&(this.lastMessage=e,this.receivedBytes+=e.length,this.sendTimer||(this.sendTimer=setTimeout(function(){t.stop(),t.finished()},this.duration)))}},{key:"handleError",value:function(e){this.stop(),this.failed(e)}},{key:"fillBuffer",value:function(){for(var e=0;this.isActive()&&!(e>this.bufferFullThreshold);){var t=this.messageMaker.make(this.sentBytes);this.sentBytes+=t.length,e+=t.length,setTimeout(this.send(t),8)}e=0,this.numBufferFill++,2<=this.numBufferFill||this.startSend()}},{key:"startSend",value:function(){this.isActive()&&(this.bufferFullThreshold=1e3*this.chunkSize/8,this.sendChannel=this.connection.sendChannel,setTimeout(this.fillBuffer.bind(this),250))}},{key:"fillResults",value:function(){this.results.endTimestamp=o.getCurrent(),this.results.maxDuration=this.duration,this.results.forceStopped=this.forceStopped,this.results.sentBytes=this.sentBytes,this.results.bytesReceived=this.receivedBytes;var e,t=null;try{t=JSON.parse(this.lastMessage)}catch(t){return}t?(e=t.sentBytes+this.lastMessage.length,this.results.bytesSent=e,this.results.fractionLostBytes=1-this.receivedBytes/e):(this.results.bytesSent=-1,this.results.fractionLostBytes=-1)}},{key:"stop",value:function(){this.isActive()&&(clearTimeout(this.sendTimer),this.sendTimer=null,i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();n.LossTest=e},{"../utility/messageMaker":20,"../utility/timestamps":28,"./turnTest":18}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RttTest=void 0;function i(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);return void 0===r?null===(e=Object.getPrototypeOf(e))?void 0:i(e,t,n):"value"in r?r.value:void 0!==(e=r.get)?e.call(n):void 0}var r=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),a=e("./turnTest");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function t(e){if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))).sendTimer=null,e.countSent=0,e.rtts=[],e;throw new TypeError("Cannot call a class as a function")}var e=t,n=a.TurnTest;if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);return e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n),r(t,[{key:"initiate",value:function(){this.results.startTimestamp=o.getCurrent(),this.sendPing()}},{key:"handleMessage",value:function(e){this.isActive()&&(e=parseInt(e,10),e=this.calculateRtt(e),this.rtts.push(e),this.countSent<10?this.sendPing():this.calculateMetrics())}},{key:"handleError",value:function(e){this.fillResults(),this.failed(e)}},{key:"sendPing",value:function(){var e;this.isActive()&&(e=o.getCurrent(),this.send(e.toString()),this.countSent+=1,this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.countSent<10?this.sendTimer=setTimeout(this.sendPing.bind(this),100):this.sendTimer=setTimeout(this.calculateMetrics.bind(this),500))}},{key:"calculateRtt",value:function(e){return o.getCurrent()-e}},{key:"calculateMetrics",value:function(){this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.fillResults(),this.finished()}},{key:"fillResults",value:function(){this.results.sentMessages=this.countSent,this.results.unAckedMessages=this.countSent-this.rtts.length,this.results.maxMessages=10,this.results.forceStopped=this.forceStopped,this.results.median=this.median(),this.results.average=this.average(),this.results.variance=this.std(),this.results.endTimestamp=o.getCurrent()}},{key:"median",value:function(){if(0==this.rtts.length)return 500;this.rtts.sort();var e=Math.floor(this.rtts.length/2);return this.rtts[e]}},{key:"average",value:function(){if(0==this.rtts.length)return 500;for(var e=0,t=0;t<this.rtts.length;t++)e+=this.rtts[t];return e/this.rtts.length}},{key:"variance",value:function(){if(0==this.rtts.length)return 500;for(var e=0,t=this.average(),n=0;n<this.rtts.length;n++){var r=this.rtts[n];e+=Math.pow(r-t,2)}return e/=this.rtts.length}},{key:"std",value:function(){var e=this.variance();return e<=0?0:Math.sqrt(e)}},{key:"stop",value:function(){this.isActive()&&(i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();n.RttTest=e},{"../utility/timestamps":28,"./turnTest":18}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ThroughputTest=void 0;function i(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);return void 0===r?null===(e=Object.getPrototypeOf(e))?void 0:i(e,t,n):"value"in r?r.value:void 0!==(e=r.get)?e.call(n):void 0}var o=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),s=e("../utility/messageMaker"),c=e("./turnTest");function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function r(e,t,n){if(this instanceof r)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e))).sentBytes=0,e.receivedBytes=0,e.secondHalfBytes=0,e.secondHalfStart=null,e.bufferEmpty=1,e.chunkSize=1200,e.messageMaker=new s.MessageMaker(e.chunkSize),e.duration=5e3,null!=t&&(e.duration=Math.max(Math.min(50*t,1e4),1e3)),e.sendTimer=null,e.intervals=[],e.intervalStart=0,e.intervalLength=100,e.intervalBytes=0,e.loss=n,e.lastReceivedTimestamp=0,e;throw new TypeError("Cannot call a class as a function")}var e=r,t=c.TurnTest;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),o(r,[{key:"initiate",value:function(){window&&window.csioReactNative?this.handleError(new Error("Not running throughput test for react-native")):this.startSend()}},{key:"handleMessage",value:function(e){var t=this;if(this.isActive()){this.lastMessage=e,this.receivedBytes+=e.length;var n=a.getCurrent();if(this.lastReceivedTimestamp=n,this.sendTimer||(this.results.startTimestamp=n,this.sendTimer=setTimeout(function(){t.stop(),t.finished()},this.duration)),0==this.intervalStart&&(this.intervalStart=n),this.intervalBytes+=e.length,n-this.intervalStart>=this.intervalLength){var r=n-this.intervalStart,r=this.averageThroughput(this.intervalBytes,r),i=null;try{i=n-JSON.parse(this.lastMessage).timestamp}catch(e){}this.intervals.push({startTimestamp:this.intervalStart,endTimestamp:n,bytesReceived:this.intervalBytes,average:r,rtt:i}),this.intervalStart=n,this.intervalBytes=0}this.results.startTimestamp&&n-this.results.startTimestamp>this.duration/2&&(this.secondHalfStart||(this.secondHalfStart=n),this.secondHalfBytes+=e.length)}}},{key:"handleError",value:function(e){this.stop(),this.failed(e)}},{key:"averageThroughput",value:function(e,t){return 0===t?0:e/(t/1e3)*8/1024}},{key:"bufferListener",value:function(){this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this)),this.fillBuffer()}},{key:"fillBuffer",value:function(){for(0==this.sendChannel.bufferedAmount&&(this.bufferEmpty+=1);this.isActive()&&!(1e6<this.sentBytes);){if(this.sendChannel.bufferedAmount>this.bufferFullThreshold)return void(this.usePolling?setTimeout(this.fillBuffer.bind(this),250):this.sendChannel.addEventListener("bufferedamountlow",this.bufferListener.bind(this)));var e=this.messageMaker.make(this.sentBytes);this.sentBytes+=e.length,this.send(e)}this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this))}},{key:"startSend",value:function(){this.isActive()&&(this.bufferFullThreshold=1e3*this.chunkSize,this.sendChannel=this.connection.sendChannel,this.usePolling=!0,"number"==typeof this.sendChannel.bufferedAmountLowThreshold&&(this.usePolling=!1,this.sendChannel.bufferedAmountLowThreshold=this.bufferFullThreshold/10),setTimeout(this.fillBuffer.bind(this),0))}},{key:"fillResults",value:function(){this.results.endTimestamp=this.lastReceivedTimestamp,this.results.maxDuration=this.duration,this.results.forceStopped=this.forceStopped,this.results.bufferEmpty=this.bufferEmpty,this.results.intervals=this.intervals,this.results.bytesPrepared=this.sentBytes,this.results.bytesReceived=this.receivedBytes,this.results.startTimestamp||(this.results.startTimestamp=this.results.endTimestamp);var e=0,t=(this.secondHalfStart&&(t=this.results.endTimestamp-this.secondHalfStart,e=this.averageThroughput(this.secondHalfBytes,t)),this.results.endTimestamp-this.results.startTimestamp),t=this.averageThroughput(this.receivedBytes,t);this.results.average=e=e<t?t:e,this.results.fractionLostBytes=this.loss}},{key:"stop",value:function(){this.isActive()&&(clearTimeout(this.sendTimer),this.sendTimer=null,i(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"stop",this).call(this),this.fillResults())}}]),r}();n.ThroughputTest=e},{"../utility/messageMaker":20,"../utility/timestamps":28,"./turnTest":18}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=e("bluebird"),e=(r(a,[{key:"getResults",value:function(){return this.results}},{key:"start",value:function(){var n=this,e=new o(function(e,t){n.resolveCb=e,n.rejectCb=t});return this.connection.setMessageCallback(this.handleMessage.bind(this)),this.connection.setErrorCallback(this.handleError.bind(this)),this.active=!0,this.forceStopped=!1,this.initiate(),e}},{key:"stop",value:function(){this.active=!1}},{key:"forceStop",value:function(){this.forceStopped=!0,this.stop(),this.finished()}},{key:"isActive",value:function(){return this.active}},{key:"initiate",value:function(){}},{key:"handleMessage",value:function(e){}},{key:"handleError",value:function(e){}},{key:"send",value:function(e){this.connection.send(e)}},{key:"finished",value:function(){this.active=!1,this.resolveCb&&(this.resolveCb(),this.resolveCb=null)}},{key:"failed",value:function(e){this.active=!1,this.rejectCb&&(this.rejectCb(e),this.rejectCb=null)}}]),a);function a(e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.connection=e,this.active=!1,this.results={}}n.TurnTest=e},{bluebird:2}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TurnConnection=void 0;var r=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e},i=e("./utility/parsedIceCandidate"),o=e("./utility/stats/getstatshandler"),a=e("./utility/stats/detectbrowser");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=e("bluebird"),e=(r(u,[{key:"reset",value:function(){this.disconnect(),this.iceServers=null,this.pctpc1=null,this.pctpc2=null,this.sendChannel=null,this.messageCallback=null,this.errorCallback=null,this.parsedIceResults={},this.resolveCb=null,this.rejectCb=null,this.localIpAddressInfo=[],this.localIpAddresses=[],this.localIp=null,this.localIpType=null,this.numberOfLocalIp=0}},{key:"setMessageCallback",value:function(e){this.messageCallback=e}},{key:"setErrorCallback",value:function(e){this.errorCallback=e}},{key:"send",value:function(e){if(this.sendChannel&&"open"===this.sendChannel.readyState)try{this.sendChannel.send(e)}catch(e){this.raiseSendError(new Error("Send channel Error"))}else this.raiseSendError(new Error("No send channel"))}},{key:"raiseSendError",value:function(e){this.errorCallback&&this.errorCallback(e)}},{key:"assignEvent",value:function(e,t,n){e.addEventListener?e.addEventListener(t,n.bind(this),!1):e.attachEvent&&e.attachEvent(t="on"+t,n.bind(this))}},{key:"connect",value:function(e){var t,n=this,r=(this.reset(),new c(function(e,t){n.resolveCb=e,n.rejectCb=t})),e=(this.iceServers=e,null);try{if(RTCPeerConnection?e=RTCPeerConnection:webkitRTCPeerConnection?e=webkitRTCPeerConnection:mozRTCPeerConnection?e=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(e=window.RTCPeerConnection),!e)return(t=new Error("RTCPeerConnection not found")).continueFlag=!1,this.rejectCb(t),r}catch(t){return t.continueFlag=!1,this.rejectCb(t),r}var i={iceTransportPolicy:"all",iceServers:this.iceServers};try{this.pctpc1=new e(i),this.pctpc2=new e(i)}catch(t){return this.rejectDisconnect(!1,new Error("Error creating PCs")),r}this.connectionTimer=setTimeout(function(){delete n.connectionTimer,n.rejectDisconnect(!1,new Error("Connection timeout"))},3e4);try{this.sendChannel=this.pctpc1.createDataChannel("precalltest",{ordered:!1,maxRetransmits:0}),this.sendChannel.binaryType="arraybuffer",this.assignEvent(this.sendChannel,"error",function(e){n.raiseSendError(new Error("Datachannel error")),n.rejectDisconnect(!0,new Error("Datachannel error"))}),this.assignEvent(this.pctpc2,"datachannel",function(e){e=e.channel;n.assignEvent(e,"open",function(e){n.resolveCb&&(n.resolveCb(),n.resolveCb=null)}),n.assignEvent(e,"close",function(e){n&&n.disconnect&&n.disconnect()}),n.assignEvent(e,"message",function(e){n.messageCallback&&n.messageCallback(e.data)}),n.assignEvent(e,"error",function(e){n.errorCallback&&n.errorCallback(e),n.rejectDisconnect(!0,new Error("receiveChannel error"))})})}catch(t){return this.rejectDisconnect(!1,new Error("Error adding datachannel")),r}try{this.assignEvent(this.pctpc1,"icecandidate",function(e){n.onIceCandidate(n.pctpc1,e)}),this.assignEvent(this.pctpc1,"iceconnectionstatechange",function(e){n.onIceStateChange(n.pctpc1,e)}),this.assignEvent(this.pctpc2,"icecandidate",function(e){n.onIceCandidate(n.pctpc2,e)}),this.assignEvent(this.pctpc2,"iceconnectionstatechange",function(e){n.onIceStateChange(n.pctpc2,e)}),this.pctpc1.createOffer().then(function(e,t){n.onCreateOfferSuccess(e)},function(e){n.onCreateOfferError(n.pctpc1,e)})}catch(t){this.rejectDisconnect(!1,new Error("Error starting connection"))}return r}},{key:"rejectDisconnect",value:function(e,t){this.disconnect(),this.rejectCb&&(t.continueFlag=e,this.rejectCb(t)),this.resolveCb=null,this.rejectCb=null}},{key:"disconnect",value:function(){if(clearTimeout(this.connectionTimer),clearTimeout(this.iceTimer),this.sendChannel)try{this.sendChannel.close()}catch(e){}if(this.pctpc1)try{this.pctpc1.close()}catch(e){}if(this.pctpc1=null,this.pctpc2)try{this.pctpc2.close()}catch(e){}this.pctpc2=null}},{key:"getName",value:function(e){return e===this.pctpc1?"pctpc1":"pctpc2"}},{key:"getOtherPc",value:function(e){return e===this.pctpc1?this.pctpc2:this.pctpc1}},{key:"onCreateOfferError",value:function(e,t){this.rejectDisconnect(!1,new Error("Failed to create offer"))}},{key:"onCreateAnswerError",value:function(e,t){this.rejectDisconnect(!1,new Error("Failed to create answer"))}},{key:"onCreateOfferSuccess",value:function(e){var t=this;try{this.pctpc1.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc1)},function(e){t.onSetSessionDescriptionError(t.pctpc1,e)}),this.pctpc2.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc2)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc2,e)}),this.pctpc2.createAnswer().then(function(e){t.onCreateAnswerSuccess(e)},function(e){t.onCreateAnswerError(t.pctpc2,e)})}catch(e){this.rejectDisconnect(!1,new Error("Error processing offer"))}}},{key:"onSetLocalSuccess",value:function(e){}},{key:"onSetRemoteSuccess",value:function(e){}},{key:"onSetSessionDescriptionError",value:function(e,t){this.rejectDisconnect(!1,new Error("Failed to set session description"))}},{key:"onSetRemoteSessionDescriptionError",value:function(e,t){this.rejectDisconnect(!1,new Error("Failed to set session description"))}},{key:"onCreateAnswerSuccess",value:function(e){var t=this;try{this.pctpc2.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc2)},function(e){t.onSetSessionDescriptionError(t.pctpc2,e)}),this.pctpc1.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc1)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc1,e)})}catch(e){this.rejectDisconnect(!1,new Error("Error processing answer"))}}},{key:"onIceCandidate",value:function(t,e){var n,r=this;try{e.candidate&&e.candidate.candidate&&(n=new i.ParsedIceCandidate(e.candidate),t==this.pctpc1&&this.statshandler.codeBase==a.Constants.codeBaseType.chrome&&(n.isRelay()&&(n.isTypeTransportUdp()&&(this.parsedIceResults.relayUdpGathered=!0),n.isTypeTransportTcp()&&(this.parsedIceResults.relayTcpGathered=!0),n.isTypeTransportTls()&&(this.parsedIceResults.relayTlsGathered=!0)),n.isServerReflexive()&&(this.parsedIceResults.srflxGathered=!0)),n.isRelay()?this.getOtherPc(t).addIceCandidate(e.candidate).then(function(){r.onAddIceCandidateSuccess(t)},function(e){r.onAddIceCandidateError(t,e,n.isRelay())}):(this.localIpAddresses.includes(n.getIpAddress())||(this.localIpAddresses.push(n.getIpAddress()),this.localIpAddressInfo.push({ip:n.getIpAddress(),candidateType:n.getType(),networkType:"unknown"}),n.isPublicIp()&&this.numberOfLocalIp++),n.isPublicIp()&&null===this.localIp&&(this.localIp=n.getIpAddress(),this.localIpType=n.getType())))}catch(e){this.rejectDisconnect(!1,e)}}},{key:"onAddIceCandidateSuccess",value:function(e){}},{key:"onAddIceCandidateError",value:function(e,t,n){n&&this.rejectDisconnect(!1,new Error("failed to add ICE Candidate"))}},{key:"onIceStateChange",value:function(e,t){var n=this;try{var r="(?)";"failed"===(r=e?e.iceConnectionState:r)&&this.rejectDisconnect(!0,new Error("ICE failure")),"checking"!==r||this.iceTimer||(this.iceTimer=setTimeout(function(){delete n.iceTimer,n.rejectDisconnect(!0,new Error("ICE timeout"))},1e4)),"completed"!==r&&"connected"!==r||(clearTimeout(this.iceTimer),delete this.iceTimer)}catch(e){this.rejectDisconnect(!1,new Error("Error processing ICE state change"))}}},{key:"getIceResults",value:function(){var S=this;return new c(function(b,t){for(var e=JSON.parse(JSON.stringify(S.iceServers)),n=0;n<e.length;n++){var r=e[n];e.hasOwnProperty(r)||delete r.credential}var i,w={turnIpAddress:"",turnIpVersion:"",turnTransport:"",iceServers:e,ipv6Supported:!1,ipv4Supported:!1,relayTlsGathered:!1,relayTcpGathered:!1,relayUdpGathered:!1,srflxGathered:!1,relayTlsSuccess:!1,relayTcpSuccess:!1,relayUdpSuccess:!1,srflxSuccess:!1,localIpAddressInfo:[],localIP:"",numberOfLocalIPs:0,localIPType:"",localIPNetworkType:""};for(i in S.parsedIceResults)S.parsedIceResults.hasOwnProperty(i)&&(w[i]=S.parsedIceResults[i]);S.pctpc1?S.statshandler.getIceCandidates(S.pctpc1).then(function(e){w.localIP=S.localIp,w.localIPType=S.localIpType,w.numberOfLocalIPs=S.numberOfLocalIp;for(var t=0;t<S.localIpAddressInfo.length;t++){for(var n=S.localIpAddressInfo[t],r=0;r<e.localCandidates.length;r++){var i=e.localCandidates[r];(i.ip||i.address||i.ipAddress)===n.ip&&"unknown"!==i.networkType&&(n.networkType=i.networkType)}w.localIpAddressInfo.push(n)}for(var o=0;o<e.iceCandidatePairs.length;o++){var a=e.iceCandidatePairs[o],s="string"==typeof a.googActiveConnection?"true"===a.googActiveConnection:a.googActiveConnection,c="string"==typeof a.selected?"true"===a.selected:a.selected;if(s||c)for(var u=0;u<e.localCandidates.length;u++){var l,d=e.localCandidates[u],f=null,f=d.ip||d.address||d.ipAddress;d.id==a.localCandidateId&&(w.turnIpAddress=f,w.turnNetworkType=d.networkType,w.localIPNetworkType=d.networkType,l=-1!==f.indexOf(":"),w.turnIpVersion=l?"ipv6":"ipv4",w.turnTransport=d.mozLocalTransport),"relay"!==d.candidateType&&"relayed"!==d.candidateType||("udp"===d.mozLocalTransport&&(w.relayUdpSuccess=!0),"tcp"===d.mozLocalTransport&&(w.relayTcpSuccess=!0),"tls"===d.mozLocalTransport&&(w.relayTlsSuccess=!0)),f&&(-1!==f.indexOf(":")?w.ipv6Supported=!0:w.ipv4Supported=!0)}}for(var p=0;p<e.localCandidates.length;p++){var h=e.localCandidates[p];"relay"!==h.candidateType&&"relayed"!==h.candidateType||("udp"===h.mozLocalTransport&&(w.relayUdpGathered=!0),"tcp"===h.mozLocalTransport&&(w.relayTcpGathered=!0),"tls"===h.mozLocalTransport&&(w.relayTlsGathered=!0)),"srflx"!==h.candidateType&&"serverreflexive"!==h.candidateType||(w.srflxGathered=!0)}for(var y=0;y<e.iceCandidatePairs.length;y++){var v=e.iceCandidatePairs[y];if("succeeded"===v.state)for(var g=0;g<e.localCandidates.length;g++){var m=e.localCandidates[g];m.id==v.localCandidateId&&("relay"!==m.candidateType&&"relayed"!==m.candidateType||("udp"===m.mozLocalTransport&&(w.relayUdpSuccess=!0),"tcp"===m.mozLocalTransport&&(w.relayTcpSuccess=!0),"tls"===m.mozLocalTransport&&(w.relayTlsSuccess=!0)),"srflx"!==m.candidateType&&"serverreflexive"!==m.candidateType||(w.srflxSuccess=!0))}}b(w)},function(e){t(e)}):t(new Error("PC not available for stats"))},function(e){reject(e)})}}]),u);function u(e){if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");this.reset(),this.statshandler=new o.GetStatsHandler(e)}n.TurnConnection=e},{"./utility/parsedIceCandidate":22,"./utility/stats/detectbrowser":25,"./utility/stats/getstatshandler":26,bluebird:2}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.randomAsciiString=n.MessageMaker=void 0;var r=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e},i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps"));function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(35+58*Math.random());return t}function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1200,t=this,n=s;if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");this.message={timestamp:"",sentBytes:1e4,padding:""};t=a(e-i.getCurrent().toString().length-JSON.stringify(this.message).length);this.message.padding=t}r(s,[{key:"make",value:function(e){return this.message.timestamp=i.getCurrent(),this.message.sentBytes=e,JSON.stringify(this.message)}}]),n.MessageMaker=s,n.randomAsciiString=a},{"../utility/timestamps":28}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OnlineCheck=void 0;var r=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e},i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./timestamps"));function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.active=!1}r(a,[{key:"start",value:function(){var e=this;this.active=!0,this.onlineCheck=[],window&&window.addEventListener&&"function"==typeof window.addEventListener&&(window.addEventListener("offline",function(){e.addEntry()}),window.addEventListener("online",function(){e.addEntry()}),this.addEntry())}},{key:"addEntry",value:function(){var e,t;this.active&&(e=i.getCurrent(),navigator&&navigator.onLine&&(t=navigator.onLine,this.onlineCheck.push({timestamp:e,online:t})))}},{key:"stop",value:function(){var e=this;return this.active=!1,window&&window.removeEventListener&&"function"==typeof window.removeEventListener&&(window.removeEventListener("offline",function(){e.addEntry()}),window.removeEventListener("online",function(){e.addEntry()})),this.onlineCheck}}]),n.OnlineCheck=a},{"./timestamps":28}],22:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.iceCandidateStr=e.candidate,this.parse()}Object.defineProperty(n,"__esModule",{value:!0}),function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(i,[{key:"parse",value:function(){var e=this.iceCandidateStr.split(" ");e.length<8||(this.protocol="1"===e[1]?"rtp":"rtcp",this.transport=e[2],this.typeTransport=this.extractTypeTransport(e[3]),this.ipv6=-1!==e[4].indexOf(":"),this.ipAddress=e[4],this.port=e[5],this.type=e[7])}},{key:"extractTypeTransport",value:function(e){var t="None",e=e>>24;if("rtp"===this.protocol&&0<=e&&e<=2)switch(e){case 0:t="TLS";break;case 1:t="TCP";break;case 2:t="UDP"}return t}},{key:"getString",value:function(){return this.iceCandidateStr}},{key:"getType",value:function(){return this.type}},{key:"isHost",value:function(){return"host"===this.type.toLowerCase()}},{key:"isServerReflexive",value:function(){return"srflx"===this.type.toLowerCase()}},{key:"isPeerReflexive",value:function(){return"prflx"===this.type.toLowerCase()}},{key:"isRelay",value:function(){return"relay"===this.type.toLowerCase()||"relayed"===this.type.toLowerCase()}},{key:"isPublicIp",value:function(){return"srflx"===this.type.toLowerCase()||"prflx"===this.type.toLowerCase()}},{key:"getTypeTransport",value:function(){return this.typeTransport}},{key:"isTypeTransportUdp",value:function(){return"UDP"===this.typeTransport}},{key:"isTypeTransportTcp",value:function(){return"TCP"===this.typeTransport}},{key:"isTypeTransportTls",value:function(){return"TLS"===this.typeTransport}},{key:"getTransport",value:function(){return this.transport}},{key:"isUdp",value:function(){return"udp"===this.transport.toLowerCase()}},{key:"isTcp",value:function(){return"tcp"===this.transport.toLowerCase()}},{key:"getProtocol",value:function(){return this.protocol}},{key:"isRtp",value:function(){return"rtp"===this.protocol}},{key:"isRtcp",value:function(){return"rtcp"===this.protocol}},{key:"isIpv6",value:function(){return this.ipv6}},{key:"getIpAddress",value:function(){return this.ipAddress}},{key:"getPort",value:function(){return this.port}}]),n.ParsedIceCandidate=i},{}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PCTNotificationService=void 0;function c(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=e,r=t,i=[],o=!0,e=!1,t=void 0;try{for(var a,s=n[Symbol.iterator]();!(o=(a=s.next()).done)&&(i.push(a.value),!r||i.length!==r);o=!0);}catch(n){e=!0,t=n}finally{try{!o&&s.return&&s.return()}finally{if(e)throw t}}return i}throw new TypeError("Invalid attempt to destructure non-iterable instance")}var r=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e},u=e("../mlPipeline/dataPreprocessor.js"),i=e("../mlPipeline/decisionMaker.js"),o=e("../mlPipeline/dataValidation.js");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}r(s,[{key:"makeNotification",value:function(e,t){var n={};return null===e?null:(n.jrltCode=t,"sctCode"in e&&(n.notificationCode=e.sctCode),"notification"in e&&(n.notification=e.notification.text,n.notificationTextCode=e.notification.code),"connectivity"in e&&(n.connectivity=e.connectivity),"status"in e&&(n.status=e.status),"summary"in e&&(n.summary=e.summary),n)}},{key:"getNotificationSummary",value:function(e,t){var n,r,i,o,a,s;return"success"!==t?null:this.getInternetConnectivityStatus(e.onlineStatus)?this.getMediaConnectivityStatus(e.ice,e.throughput)?(t=e.throughput.average,n=e.rtt.median,r=e.throughput.fractionLostBytes,e=e.rtt.variance,s=a=o=i=null,this.dataValidator.validateThroughput(t)&&(i=t),this.dataValidator.validateRTT(n)&&(o=n),this.dataValidator.validateLossFraction(r)&&(a=this.dataCleaner.cleanLossFraction(r)),this.dataValidator.validateJitter(e)&&(s=this.dataCleaner.cleanJitter(e)),t=this.dataPreprocessor.classifyThroughputQuality(i),n=this.dataPreprocessor.classifyRTTQuality(o),r=this.dataPreprocessor.classifyLossFractionQuality(a),e=this.dataPreprocessor.classifyJitterQuality(s),-1===t&&(t=t.BAD),-1===n&&(n=u.Quality.BAD),-1===r&&(r=u.Quality.BAD),-1===e&&(e=u.Quality.BAD),i=this.decisionMaker.getJRLTCode(e,n,r,t),o=this.decisionMaker.getNetworkQuality(e,n,r,t),s=(a=c(o,2))[0],a[1]?null:this.makeNotification(s,i)):(e=this.decisionMaker.getNetworkQuality(0,0,0,2),r=(n=c(e,2))[0],n[1]?null:this.makeNotification(r,this.decisionMaker.getJRLTCode(0,0,0,2))):(t=this.decisionMaker.getNetworkQuality(0,0,0,1),a=(o=c(t,2))[0],o[1]?null:this.makeNotification(a,this.decisionMaker.getJRLTCode(0,0,0,1)))}},{key:"getInternetConnectivityStatus",value:function(e){for(var t=0,n=!1,r=0;r<e.length;++r)e[r].timestamp>t&&(t=e[r].timeStamp,n=e[r].online);return n}},{key:"getMediaConnectivityStatus",value:function(e,t){return!(!e||!t)&&(e.relayTcpSuccess||e.relayTlsSuccess||e.relayUdpSuccess||0<t.average)}}]);e=s;function s(){if(!(this instanceof s))throw new TypeError("Cannot call a class as a function");this.dataCleaner=o.DataCleaner,this.dataValidator=o.DataValidator,this.dataPreprocessor=new u.DataPreprocessor,this.decisionMaker=i.DecisionMaker}n.PCTNotificationService=e},{"../mlPipeline/dataPreprocessor.js":6,"../mlPipeline/dataValidation.js":7,"../mlPipeline/decisionMaker.js":8}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResultsHandler=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./timestamps")),a=e("./messageMaker"),s=e("./pctnotificationservice");function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u="success",l="stopped",d="failed",e=(i(f,[{key:"setStatusStopped",value:function(){this.status!==d&&(this.status=l)}},{key:"setStatusFailed",value:function(){this.status=d}},{key:"setStatusSuccess",value:function(){this.status!==l&&(this.status=u)}},{key:"setProvider",value:function(e){e&&(this.provider=e)}},{key:"setisRunManually",value:function(e){this.isRunManually=e}},{key:"setrunByUser",value:function(e){this.runByUser=e}},{key:"setEnableMLNotification",value:function(e){this.enableMLNotification=e}},{key:"getResults",value:function(){var e={id:this.id,version:this.version,status:this.status,startTimestamp:this.start,endTimestamp:o.getCurrent(),failures:this.failures,tests:this.results,provider:this.provider,runManually:this.isRunManually,runByUser:this.runByUser};return e.notification=this.pctNotificationService.getNotificationSummary(e.tests,e.status),e.notification&&(e.notification.timestamp=o.getCurrent()),e}},{key:"getFailureNumber",value:function(){return this.failures.length}},{key:"getId",value:function(){return this.id}},{key:"add",value:function(e,t){(this.results[e]=t).hasOwnProperty("forceStopped")&&1==t.forceStopped&&this.setStatusStopped()}},{key:"failure",value:function(e){"object"===(void 0===e?"undefined":r(e))&&(e=e.toString());e={timestamp:o.getCurrent(),reason:e};this.failures.push(e)}}]),f);function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this.start=o.getCurrent(),this.id=Math.trunc(this.start)+"-"+(0,a.randomAsciiString)(20),this.version="1.8.9",this.failures=[],this.results={},this.status=u,this.provider="callstats",this.enableMLNotification=!1,this.pctNotificationService=new s.PCTNotificationService,this.isRunManually=!1,this.runByUser=!1}n.ResultsHandler=e},{"./messageMaker":20,"./pctnotificationservice":23,"./timestamps":28}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.detect=function(){var e=p.browserName.chrome,t=null,n=null,r=null,i=null,o=p.codeBaseType.chrome;if(window&&(!window.navigator||!window.navigator.userAgent||window.csioReactNative))return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{browserName:e,codeBase:o,os:t,osVersion:n,userAgent:r};var a=(r=navigator.userAgent).toLowerCase(),s=void 0,c=void 0,i=void((i=navigator.appVersion)&&(s=i.toLowerCase(),c=""+parseFloat(s))),u="version";-1!==(i=a.indexOf("opera"))?(e=p.browserName.opera,c=a.substring(i+6),-1!==(i=a.indexOf(u))&&(c=a.substring(i+8)),o=p.codeBaseType.chrome):-1!==(i=a.indexOf("opr"))?(e=p.browserName.opera,c=a.substring(i+4),-1!==(i=a.indexOf(u))&&(c=a.substring(i+8)),o=p.codeBaseType.chrome):-1!==(i=a.indexOf("msie"))?(e=p.browserName.msie,c=a.substring(i+5),o=p.codeBaseType.chrome):-1!==(i=a.indexOf("edge"))?(e=p.browserName.edge,c=a.substring(i+5),o=p.codeBaseType.edge):-1!==(i=a.indexOf("edg"))?(e=p.browserName.edge,c=a.substring(i+4),o=p.codeBaseType.chrome):-1!==(i=a.indexOf("chrome"))?(e=p.browserName.chrome,c=a.substring(i+7),o=p.codeBaseType.chrome):-1!==(i=a.indexOf("safari"))?(e=p.browserName.safari,c=a.substring(i+7),-1!==(i=a.indexOf(u))&&(c=a.substring(i+8))&&(u=c.split(" "))&&0<u.length&&(c=u[0]),o=p.codeBaseType.chrome):-1!==(i=a.indexOf("firefox"))?(e=p.browserName.firefox,c=a.substring(i+8),o=p.codeBaseType.firefox):-1!==(i=a.indexOf("trident"))&&(e=p.browserName.msie,i=a.indexOf("rv"),c=a.substring(i+3,i+7),o=p.codeBaseType.chrome);var l=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],d=void 0,f=void 0;for(d in l)if(l.hasOwnProperty(d)&&(f=l[d]).r.test(a)){t=f.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=p.osName.windows),t){case p.osName.mac:(n=/mac os x (1[\.\_\d]+)/.exec(a))&&(n=n[1]);break;case p.osName.android:(n=/android ([\.\_\d]+)/.exec(a))&&(n=n[1]);break;case p.osName.ios:s&&(n=/os (\d+)_(\d+)_?(\d+)?/.exec(s))&&(n=n[1]+"."+n[2]+"."+(0|n[3]))}u=c.split(" "),i=c;return u&&0<u.length&&(i=u[0]),{browserName:e,browserVersion:i,os:t,osVersion:n,codeBase:o,userAgent:r}};var p=n.Constants={codeBaseType:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},browserName:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari"},osName:{windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"}}},{}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GetStatsHandler=void 0;var r=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e},s=e("./detectbrowser"),i=e("./statsadapter");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=e("bluebird"),e=(r(c,[{key:"getIceCandidates",value:function(n){var r=this;return new a(function(t,e){r.csioGetStats(r.iceCandidatesHandler.bind(r),n,function(e){t(e)})})}},{key:"iceCandidatesHandler",value:function(e,t){t(this.adapter.getIceCandidates(e))}},{key:"csioGetStats",value:function(e,t,n){var r=s.Constants.codeBaseType.firefox,i=s.Constants.codeBaseType.chrome,o=s.Constants.codeBaseType.edge,a=s.Constants.browserName.safari;t&&(this.codeBase===r?this.getStatsFirefox(e,t,n):this.browserName===a?this.getStatsSafari(e,t,n):this.codeBase===i?this.getStatsChrome(e,t,n):this.codeBase===o&&this.getStatsEdge(e,t,n))}},{key:"getStatsFirefox",value:function(t,n,r){var i=this;if(i.isPromiseBased)try{n.getStats().then(function(e){t(e,r)}).catch(function(e){i.isPromiseBased=!1,n.getStats(null,function(e){t(e,r)},function(){})})}catch(e){i.isPromiseBased=!1,n.getStats(null,function(e){t(e,r)},function(){})}else n.getStats(null,function(e){t(e,r)},function(){})}},{key:"getStatsChrome",value:function(t,n,r){var i=this;if(window&&window.csioReactNative)n.getStats(null,function(e){t(e,r)},function(e){});else if(i.isPromiseBased)try{n.getStats().then(function(e){t(e,r)}).catch(function(e){i.isPromiseBased=!1,n.getStats(function(e){t(e,r)})})}catch(e){i.isPromiseBased=!1,n.getStats(function(e){t(e,r)})}else n.getStats(function(e){t(e,r)})}},{key:"getStatsEdge",value:function(t,e,n){e.getStats().then(function(e){t(e,n)}).catch(function(e){})}},{key:"getStatsSafari",value:function(t,e,n){e.getStats().then(function(e){t(e,n)}).catch(function(e){})}}]),c);function c(e){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.codeBase=e.codeBase,this.browserName=e.browserName,this.adapter=new i.StatsAdapter(this.codeBase,this.browserName),this.isPromiseBased=!0}n.GetStatsHandler=e},{"./detectbrowser":25,"./statsadapter":27,bluebird:2}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAdapter=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e},a=e("./detectbrowser");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}r(o,[{key:"getIceCandidates",value:function(e){return e?(e=this.extractRawStats(e),this.processRawStatsForIceInfo(e)):{localCandidates:[],remoteCandidates:[],iceCandidatePairs:[]}}},{key:"extractRawStats",value:function(e){var t=[],n=void 0,r=a.Constants.codeBaseType.firefox,i=a.Constants.codeBaseType.chrome,o=a.Constants.browserName.safari;if(this.codeBase===r&&this.browser!==o)e.forEach(function(e){t.push(e)});else if(this.codeBase===i&&this.browser!==o)e&&e.result?t=e.result():e&&e.forEach&&(t=[],e.forEach(function(e){t.push(e)}));else for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(e){for(var o=0;o<e.length;++o){var a,s,c=this.getParsedStats(e[o]),c=this.statsClassifier(c);c.candidatePair?r.push(c.candidatePair):c.transportStats?"transport"===c.transportStats.type?i=c.transportStats.selectedCandidatePairId:r.push(c.transportStats):c.localCandidate?("relay"!=(a=c.localCandidate).candidateType&&"relayed"!=a.candidateType||(a.mozLocalTransport||(s=a.priority>>24,a.mozLocalTransport=this.formatRelayType(s)),a.mozLocalTransport=a.mozLocalTransport.toLowerCase()),t.push(a)):c.remoteCandidate&&n.push(c.remoteCandidate)}if(i)for(var u=0;u<r.length;++u)r[u].id===i&&(r[u].googActiveConnection="true")}return{localCandidates:t,remoteCandidates:n,iceCandidatePairs:r}}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names)for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);else Object.assign(t,e);if(t.values){for(var i=0;i<t.values.length;i++){var o=t.values[i];Object.assign(t,o)}delete t.values}return t}},{key:"statsClassifier",value:function(o){function e(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;r++){var i=t[r];if(o.type===i)return!0}return!1}var t={},n=e("inbound-rtp","inboundrtp"),r="true"===o.isRemote||!0===o.isRemote;return n||e("outbound-rtp","outboundrtp")?(t.tracks={},t.tracks.data=o,t.tracks.ssrc=o.ssrc,t.tracks.streamType=n?"inbound":"outbound",t.tracks.reportType="local",void 0!==o.isRemote&&(t.tracks.reportType=r?"remote":"local")):e("candidatepair")&&o.selected?t.transportStats=o:e("localcandidate","local-candidate")?t.localCandidate=o:e("remotecandidate","remote-candidate")?t.remoteCandidate=o:e("transport","googCandidatePair")?t.transportStats=o:e("VideoBwe")?t.bwe=o:e("track")?t.trackStats=o:e("candidate-pair")?t.candidatePair=o:e("codec")?t.codec=o:e("ssrc")&&(t.tracks={},t.tracks.data=o,t.tracks.ssrc=o.ssrc,t.tracks.reportType="local",t.tracks.streamType=o.bytesSent?"outbound":"inbound"),t}},{key:"formatRelayType",value:function(e){var t="none";switch(e){case 0:t="tls";break;case 1:t="tcp";break;case 2:t="udp"}return t}}]);e=o;function o(e,t){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.codeBase=e,this.browser=t}n.StatsAdapter=e},{"./detectbrowser":25}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrent=function(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}},{}],29:[function(e,t,n){var r,i,t=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return(r=setTimeout)(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}var c,u=[],l=!1,d=-1;function f(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!l){for(var e=s(f),t=(l=!0,u.length);t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,!function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return(i=clearTimeout)(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function y(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new h(e,t)),1!==u.length||l||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=y,t.addListener=y,t.once=y,t.off=y,t.removeListener=y,t.removeAllListeners=y,t.emit=y,t.prependListener=y,t.prependOnceListener=y,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],30:[function(c,e,u){!function(n,s){!function(){var r=c("process/browser.js").nextTick,e=Function.prototype.apply,i=Array.prototype.slice,o={},a=0;function t(e,t){this._id=e,this._clearFn=t}u.setTimeout=function(){return new t(e.call(setTimeout,window,arguments),clearTimeout)},u.setInterval=function(){return new t(e.call(setInterval,window,arguments),clearInterval)},u.clearTimeout=u.clearInterval=function(e){e.close()},t.prototype.unref=t.prototype.ref=function(){},t.prototype.close=function(){this._clearFn.call(window,this._id)},u.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},u.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},u._unrefActive=u.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},u.setImmediate="function"==typeof n?n:function(e){var t=a++,n=!(arguments.length<2)&&i.call(arguments,1);return o[t]=!0,r(function(){o[t]&&(n?e.apply(null,n):e.call(null),u.clearImmediate(t))}),t},u.clearImmediate="function"==typeof s?s:function(e){delete o[e]}}.call(this)}.call(this,c("timers").setImmediate,c("timers").clearImmediate)},{"process/browser.js":29,timers:30}],31:[function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.Battery=void 0;var r=function(){function e(){var t=this;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.batteryManager=null,"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(e){t.batteryManager=e})}var t,n,r;return t=e,(n=[{key:"getLevel",value:function(){return this.batteryManager?this.batteryManager.level:-1}},{key:"getCharging",value:function(){return this.batteryManager?this.batteryManager.charging:null}}])&&i(t.prototype,n),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.Battery=r},{}],32:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.detect=function(){var e=p.browserName.chrome,t=null,n=null,r=null,i=null,o=p.codeBaseType.chrome;if(!window.navigator.userAgent||window.csioReactNative)return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{browserName:e,codeBase:o,os:t,osVersion:n,userAgent:r,browserVersion:null};var a,s,c=(r=navigator.userAgent).toLowerCase();(i=navigator.appVersion)&&(a=i.toLowerCase(),s=""+parseFloat(a));i="version";-1!==(f=c.indexOf("opera"))?(e=p.browserName.opera,s=c.substring(f+6),-1!==(f=c.indexOf(i))&&(s=c.substring(f+8)),o=p.codeBaseType.chrome):-1!==(f=c.indexOf("opr"))?(e=p.browserName.opera,s=c.substring(f+4),-1!==(f=c.indexOf(i))&&(s=c.substring(f+8)),o=p.codeBaseType.chrome):-1!==(f=c.indexOf("msie"))?(e=p.browserName.msie,s=c.substring(f+5),o=p.codeBaseType.chrome):-1!==(f=c.indexOf("edge"))?(e=p.browserName.edge,s=c.substring(f+5),o=p.codeBaseType.edge):-1!==(f=c.indexOf("edg"))?(e=p.browserName.edge,s=c.substring(f+4),o=p.codeBaseType.chrome):-1!==(f=c.indexOf("chrome"))?(e=p.browserName.chrome,s=c.substring(f+7),o=p.codeBaseType.chrome):-1!==(f=c.indexOf("safari"))?(e=p.browserName.safari,s=c.substring(f+7),-1!==(f=c.indexOf(i))&&(s=c.substring(f+8))&&(i=s.split(" "))&&0<i.length&&(s=i[0]),o=p.codeBaseType.chrome):-1!==(f=c.indexOf("firefox"))?(e=p.browserName.firefox,s=c.substring(f+8),o=p.codeBaseType.firefox):-1!==(f=c.indexOf("trident"))&&(e=p.browserName.msie,f=c.indexOf("rv"),s=c.substring(f+3,f+7),o=p.codeBaseType.chrome);var u,l,d=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}];for(u in d)if(d.hasOwnProperty(u)&&(l=d[u]).r.test(c)){t=l.s;break}t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=p.osName.windows);switch(t){case p.osName.mac:n=(n=/mac os x (1[\.\_\d]+)/.exec(c))&&n[1];break;case p.osName.android:n=(n=/android ([\.\_\d]+)/.exec(c))&&n[1];break;case p.osName.ios:a&&(n=(n=/os (\d+)_(\d+)_?(\d+)?/.exec(a))&&n[1]+"."+n[2]+"."+(0|n[3]))}var i=s.split(" "),f=s;i&&0<i.length&&(f=i[0]);return{browserName:e,browserVersion:f,os:t,osVersion:n,codeBase:o,userAgent:r}};var p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}},{"../config/constants":50}],33:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Devices=void 0;var i=r(e("../config/constants")),o=e("../utility/registry"),s=r(e("../utility/csiologger")),c=r(e("../utility/utils"));function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.conferenceId=e,this.pc=t,this.devices=null,this.emb=o.Registry.getEventMessageBuilder()}var e,t,r;return e=n,(t=[{key:"collectConnected",value:function(){var t,n=this;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(t=this,navigator.mediaDevices.enumerateDevices().then(function(e){e=c.normalizeMediaDeviceList(e);t.sendConnected(e),setTimeout(n.collectConnected.bind(t),1e4)}).catch(function(e){setTimeout(n.collectConnected.bind(t),1e4)}))}},{key:"sendConnected",value:function(e){this.devices&&this.compare(e)||(this.devices=e,this.send())}},{key:"compare",value:function(e){return self.devices.sort().toString()===e.sort().toString()}},{key:"send",value:function(){var e={mediaDeviceList:this.devices};s.log("sending connectedDevice",i.internalFabricEvent.connectedDeviceList,e),this.emb.make(i.internalFabricEvent.connectedDeviceList,this.conferenceId,this.pc,e)}}])&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();n.Devices=e},{"../config/constants":50,"../utility/csiologger":119,"../utility/registry":128,"../utility/utils":134}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.get=function(e){try{if(window&&window.localStorage)return window.localStorage.getItem(e)}catch(e){}return null},n.remove=function(e){try{window&&window.localStorage&&window.localStorage.removeItem(e)}catch(e){}},n.store=function(e,t){if(t)try{window&&window.localStorage&&window.localStorage.setItem(e,t)}catch(e){}}},{}],35:[function(e,t,n){"use strict";function r(e,t){if(t)try{window&&window.sessionStorage&&window.sessionStorage.setItem(e,t)}catch(e){}}function i(e){try{if(window&&window.sessionStorage)return window.sessionStorage.getItem(e)}catch(e){}return null}Object.defineProperty(n,"__esModule",{value:!0}),n.get=i,n.getUcId=function(e){if(e){var t=JSON.parse(i("csio_ucid_data"));if(t&&t[e])return t[e].ucID}return null},n.remove=function(e){try{window&&window.sessionStorage&&window.sessionStorage.removeItem(e)}catch(e){}},n.store=r,n.storeUcId=function(e,t){var n;e&&((n=(n=JSON.parse(i("csio_ucid_data")))||{})[e]||(n[e]={}),n[e].ucID=t,r("csio_ucid_data",JSON.stringify(n)))}},{}],36:[function(S,k,e){!function(w){!function(){"use strict";var l=r(S("./config/constants")),e=r(S("./config/settings")),d=S("./config/callstatserrors"),f=S("./fsm/mainfsm"),p=S("./utility/registry"),h=r(S("./utility/csiologger")),t=r(S("./utility/onerroreventlistner")),n=r(S("./utility/utils")),i=r(S("./browserapi/localstorage")),o=S("./services/authenticator");function a(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(a=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};t=a(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){var n={};return n.status=e,t&&(n.message=t),n}function v(e,t,n){n=2<arguments.length&&void 0!==n?n:"";return"".concat(e,": ").concat(t," ").concat(n)}function g(e){var t;if(null!==e)return(t=p.Registry.getEndpoint().getCodeBase())===l.codeBaseType.firefox?"undefined"!=typeof mozRTCPeerConnection&&e instanceof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection&&e instanceof RTCPeerConnection:t===l.codeBaseType.edge||"function"==typeof e||(t=null,RTCPeerConnection?t=RTCPeerConnection:webkitRTCPeerConnection?t=webkitRTCPeerConnection:mozRTCPeerConnection?t=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(t=window.RTCPeerConnection),null!==t&&e instanceof t||void 0!==e.createOffer)}t.setErrorEventListener(),n.assignPollyfill(),n.isIntegerPollyfill();var m=null,u=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");m=new f.MainFSM}var t,n,r;return t=e,(n=[{key:"initialize",value:function(e,t,n,r,i,o){var a;if(!e||!n||!t)return a=v("initialize",d.csErrorStrings.argumentError),h.error(a),h.sendLog(l.logEvents.error,a),y(l.callstatsAPIReturnStatus.failure,a);if((r&&"function"!=typeof r&&(a=v("initialize",d.csErrorStrings.argumentError),h.warn(a),h.sendLog(l.logEvents.warn,a),r=null),i&&"function"!=typeof i&&(a=v("initialize",d.csErrorStrings.argumentError),h.warn(a),h.sendLog(l.logEvents.warn,a),i=null),"function"!=typeof t)&&!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle||window.csioReactNative))return a=v("initialize",d.csErrorStrings.cryptoError),h.error(a),h.sendLog(l.logEvents.error,a),r&&r(d.csError.tokenGenerationError,d.csErrorStrings.cryptoError),y(l.callstatsAPIReturnStatus.failure,a);try{m.fire(f.MainEvents.onInitialize,e,n,t,r,i,o),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"initialize: Error",error:e.message+":"+e.stack}),h.error("initialize: Error",e),h.sendLog(l.logEvents.error,"initialize: Error")}return y(l.callstatsAPIReturnStatus.success)}},{key:"addNewFabric",value:function(e,t,n,r,i,o){var a=null,s=l.endpointType.peer,c=l.transmissionDirection.sendrecv;if(void 0===t)return u=v("addNewFabric",d.csErrorStrings.argumentError),h.error(u),h.sendLog(l.logEvents.error,u),y(l.callstatsAPIReturnStatus.failure,u);if(void 0===r)return u=v("addNewFabric",d.csErrorStrings.argumentError),h.error(u),h.sendLog(l.logEvents.error,u),y(l.callstatsAPIReturnStatus.failure,u);if(r=r||l.tmpConferenceId,!e||!n)return u=v("addNewFabric",d.csErrorStrings.argumentError),h.error(u),h.sendLog(l.logEvents.error,u),y(l.callstatsAPIReturnStatus.failure,u);if(o&&"function"==typeof o&&(a=o),i&&"function"==typeof i&&(a=i),i&&"function"!=typeof i){if(i.remoteEndpointType){if(!l.endpointType.hasOwnProperty(i.remoteEndpointType))return u=v("addNewFabric",d.csErrorStrings.invalidEndPointType,i.remoteEndpointType),h.error(u),h.sendLog(l.logEvents.error,u),y(l.callstatsAPIReturnStatus.failure,u);s=i.remoteEndpointType}if(i.fabricTransmissionDirection){if(!l.transmissionDirection.hasOwnProperty(i.fabricTransmissionDirection))return o=v("addNewFabric",d.csErrorStrings.invalidTransmissionDirection,i.fabricTransmissionDirection),h.error(o),h.sendLog(l.logEvents.error,o),y(l.callstatsAPIReturnStatus.failure,o);c=i.fabricTransmissionDirection}}if(!l.fabricUsage.hasOwnProperty(n)||n instanceof Function)return u=v("addNewFabric",d.csErrorStrings.fabricUsageInvalid,n),h.error(u),h.sendLog(l.logEvents.error,u),y(l.callstatsAPIReturnStatus.failure,u);if(!g(e))return o=v("addNewFabric",d.csErrorStrings.pcInvalid),h.error(o),h.sendLog(l.logEvents.error,o),y(l.callstatsAPIReturnStatus.failure,o);var u,i=p.Registry.getConferenceManager().get(r);if(i&&i.getPeerConnectionManager().getPcHandler(e))return y(l.callstatsAPIReturnStatus.success);if(!p.Registry.getCredentials().getAppId()||!p.Registry.getCredentials().getUserId())return u=v("addNewFabric",d.csErrorStrings.notInitialized),h.error(u),h.sendLog(l.logEvents.error,u),y(l.callstatsAPIReturnStatus.failure,u);try{m.fire(f.MainEvents.onAddNewFabric,e,t,n,r,s,c,a),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"addNewFabric: Error",error:e.message+":"+e.stack}),h.error("addNewFabric: Error",e),h.sendLog(l.logEvents.error,"addNewFabric Error")}return y(l.callstatsAPIReturnStatus.success)}},{key:"sendFabricEvent",value:function(e,t,n,r){if(h.log("sendFabricEvent ",t),n=n||l.tmpConferenceId,!e||!t)return o=v("sendFabricEvent",d.csErrorStrings.argumentError),h.error(o),y(l.callstatsAPIReturnStatus.failure,o);if(t===l.fabricEvent.fabricSetupFailed)return o=v("sendFabricEvent",d.csErrorStrings.fabricEventUnsupported,t),h.error(o),h.sendLog(l.logEvents.error,o),y(l.callstatsAPIReturnStatus.failure,o);if(!l.fabricEvent.hasOwnProperty(t)&&!l.internalFabricEvent.hasOwnProperty(t))return o=v("sendFabricEvent",d.csErrorStrings.fabricEventInvalid,t),h.error(o),h.sendLog(l.logEvents.error,o),y(l.callstatsAPIReturnStatus.failure,o);if(!(t!==l.fabricEvent.activeDeviceList||r&&r.deviceList))return o=v("sendFabricEvent ",d.csErrorStrings.argumentError),h.error(o),h.sendLog(l.logEvents.error,o),y(l.callstatsAPIReturnStatus.failure,o);var i,o=p.Registry.getConferenceManager().get(n);if(!p.Registry.getCredentials().getAppId()||!p.Registry.getCredentials().getUserId()||!o)return i=v("sendFabricEvent ",d.csErrorStrings.notInitialized),h.error(i),h.sendLog(l.logEvents.error,i),y(l.callstatsAPIReturnStatus.failure,i);if(!o.getPeerConnectionManager().getPcHandler(e))return i=v("sendFabricEvent ",d.csErrorStrings.pcInvalid),h.error(i),h.sendLog(l.logEvents.error,i),y(l.callstatsAPIReturnStatus.failure,i);try{m.fire(f.MainEvents.onSendFabricEvent,e,t,n,r),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"sendFabricEvent: Error",error:e.message+":"+e.stack}),h.error("sendFabricEvent: Error",e),h.sendLog(l.logEvents.error,"sendFabricEvent error")}return y(l.callstatsAPIReturnStatus.success)}},{key:"sendCustomEvent",value:function(e,t,n){var r;if(!t||!n)return console.log("sendCustomEvent invalid conferenceId or eventData"),r=v("sendCustomEvent",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);if("object"!==s(n))return console.log("sendCustomEvent invalid eventList"),r=v("sendCustomEvent",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);if(0===n.length)return console.log("sendCustomEvent invalid eventList"),r=v("sendCustomEvent",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);try{m.fire(f.MainEvents.onSendCustomEvent,e,t,n),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"sendCustomEvent: Error",error:e.message+":"+e.stack}),h.error("sendCustomEvent: Error",e)}return y(l.callstatsAPIReturnStatus.success)}},{key:"sendCustomStats",value:function(e,t,n){var r;if(!t||!n)return console.log("sendCustomStats invalid conferenceId or stats"),r=v("sendCustomStats",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);try{m.fire(f.MainEvents.onSendCustomStats,e,t,n),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"sendCustomStats: Error",error:e.message+":"+e.stack}),h.error("sendCustomStats: Error",e)}return y(l.callstatsAPIReturnStatus.success)}},{key:"sendCallDetails",value:function(e,t,n){var r;if(h.log("sendCallDetails "),t=t||l.tmpConferenceId,!e||!n)return console.log("sendCallDetails invalid pc eventData"),r=v("sendCallDetails",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);if(n.callType||(n.callType=l.callType.unknown),!n.role)return console.log("sendCallDetails invalid pc eventData"),r=v("sendCallDetails",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);if(n.callType&&!l.callType.hasOwnProperty(n.callType))return console.log("sendCallDetails invalid eventData",n),r=v("sendCallDetails",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);if(n.role&&!l.roles.hasOwnProperty(n.role))return console.log("sendCallDetails invalid eventData",n),r=v("sendCallDetails",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);try{m.fire(f.MainEvents.onSendCallDetails,e,t,n),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"sendCallDetails: Error",error:e.message+":"+e.stack}),h.error("sendCallDetails: Error",e),h.sendLog(l.logEvents.error,"sendCallDetails Error")}return y(l.callstatsAPIReturnStatus.success)}},{key:"sendUserFeedback",value:function(e,t,n){var r;if(!t||!e)return r=v("sendUserFeedback",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),n&&"function"==typeof n&&n(l.callstatsAPIReturnStatus.failure,r),y(l.callstatsAPIReturnStatus.failure,r);if("object"!==s(t))return r=v("sendUserFeedback",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),n&&"function"==typeof n&&n(l.callstatsAPIReturnStatus.failure,r),y(l.callstatsAPIReturnStatus.failure,r);if(0===Object.keys(t).length)return r=v("sendUserFeedback",d.csErrorStrings.argumentError),h.error(r),h.sendLog(l.logEvents.error,r),n&&"function"==typeof n&&n(l.callstatsAPIReturnStatus.failure,r),y(l.callstatsAPIReturnStatus.failure,r);try{m.fire(f.MainEvents.onSendUserFeedback,e,t,n),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"sendUserFeedback: Error",error:e.message+":"+e.stack}),h.error("sendUserFeedback: Error",e)}return n&&"function"==typeof n&&n(l.callstatsAPIReturnStatus.success,"userFeedback Event sent successfully"),y(l.callstatsAPIReturnStatus.success)}},{key:"associateMstWithUserID",value:function(e,t,n,r,i,o){if(n=n||l.tmpConferenceId,!e||!r||!i)return s=v("associateMstWithUserID",d.csErrorStrings.argumentError),h.error(s),h.sendLog(l.logEvents.error,s),y(l.callstatsAPIReturnStatus.failure,s);if(!g(e))return s=v("associateMstWithUserID",d.csErrorStrings.pcInvalid),h.error(s),h.sendLog(l.logEvents.error,s),y(l.callstatsAPIReturnStatus.failure,s);var a,s=p.Registry.getConferenceManager().get(n);if(!s)return a=v("associateMstWithUserID",d.csErrorStrings.confereneDoesNotExist),h.error(a),h.sendLog(l.logEvents.error,a),y(l.callstatsAPIReturnStatus.failure,a);if(!s.getPeerConnectionManager().getPcHandler(e))return a=v("associateMstWithUserID",d.csErrorStrings.pcInvalid),h.error(a),h.sendLog(l.logEvents.error,a),y(l.callstatsAPIReturnStatus.failure,a);o&&"string"!=typeof o&&(h.error("associateMstWithUserID: Invalid videoTag"),h.sendLog(l.logEvents.error,"associateMstWithUserID: Invalid videoTag"),o=null);try{m.fire(f.MainEvents.onAssociateMstWithUserID,e,t,n,r,i,o),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"associateMstWithUserID: Error",error:e.message+":"+e.stack}),h.error("associateMstWithUserID: Error",e)}return y(l.callstatsAPIReturnStatus.success)}},{key:"reportError",value:function(e,t,n,r,i,o){var a;if(t=t||l.tmpConferenceId,void 0===e||!n)return a=v("reportError",d.csErrorStrings.argumentError),h.error(a),h.sendLog(l.logEvents.error,a),y(l.callstatsAPIReturnStatus.failure,a);if(!l.webRTCFunctions.hasOwnProperty(n))return a=v("reportError",d.csErrorStrings.webRTCFunctionsInvalid,n),h.error(a),h.sendLog(l.logEvents.error,a),y(l.callstatsAPIReturnStatus.failure,a);if(void 0===r&&(h.warn("reportError: Missing DOM error parameter"),h.sendLog(l.logEvents.warn,"reportError - missing dom")),!p.Registry.getCredentials().getAppId()||!p.Registry.getCredentials().getUserId())return a=v("reportError",d.csErrorStrings.notInitialized),h.error(a),h.sendLog(l.logEvents.error,a),y(l.callstatsAPIReturnStatus.failure,a);try{m.fire(f.MainEvents.onReportError,e,t,n,r,i,o),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"reportError: Error",error:e.message+":"+e.stack}),h.error("reportError: Error",e),h.sendLog(l.logEvents.error,"reportError Error")}return y(l.callstatsAPIReturnStatus.success)}},{key:"setProxyConfig",value:function(e){var t;if(window&&!window.csioproxy)return t=v("setProxyConfig",d.csErrorStrings.setProxyConfigInvokeError),h.error(t),h.sendLog(l.logEvents.error,t),y(l.callstatsAPIReturnStatus.failure,t);if(!e)return t=v("setProxyConfig",d.csErrorStrings.argumentError),h.error(t),h.sendLog(l.logEvents.error,t),y(l.callstatsAPIReturnStatus.failure,t);try{m.fire(f.MainEvents.onSetProxyConfig,e),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"setProxyConfig: Error",error:e.message+":"+e.stack}),h.error("setProxyConfig: Error",e)}return y(l.callstatsAPIReturnStatus.success)}},{key:"resetWifiStatsHandler",value:function(){try{m.fire(f.MainEvents.onResetWifiStatsHandler),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"resetWifiStatsHandler: Error",error:e.message+":"+e.stack}),h.error("resetWifiStatsHandler: Error",e)}return y(l.callstatsAPIReturnStatus.success)}},{key:"attachWifiStatsHandler",value:function(e){var t;if(!e)return t=v("attachWifiStatsHandler",d.csErrorStrings.argumentError),h.error(t),h.sendLog(l.logEvents.error,t),y(l.callstatsAPIReturnStatus.failure,t);if("function"!=typeof e)return t=v("attachWifiStatsHandler",d.csErrorStrings.argumentError),h.error(t),h.sendLog(l.logEvents.error,t),y(l.callstatsAPIReturnStatus.failure,t);try{m.fire(f.MainEvents.onAttachWifiStatsHandler,e),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"attachWifiStatsHandler: Error",error:e.message+":"+e.stack}),h.error("attachWifiStatsHandler: Error",e)}return y(l.callstatsAPIReturnStatus.success)}},{key:"setIdentifiers",value:function(e,t){var n;if(!e)return n=v("setIdentifiers",d.csErrorStrings.argumentError),h.error(n),h.sendLog(l.logEvents.error,n),y(l.callstatsAPIReturnStatus.failure,n);try{m.fire(f.MainEvents.onSetIdentifiers,e,t),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"setIdentifiers: Error",error:e.message+":"+e.stack}),h.error("setIdentifiers: Error",e)}return y(l.callstatsAPIReturnStatus.success)}},{key:"getTurnCredentials",value:function(r,i){return r&&i?new Promise(function(e,t){var n=new o.Authenticator;n.setGenerateTurnCredentials(!0),n.initiate(r,i,"turnUser").then(function(){n.getTaasEnabled()?e(n.getTurnServers()):t(new Error("getTurnCredentials: Invalid API Access"))},function(e){t(e)})}):new Promise(function(e,t){t(new Error("getTurnCredentials: Empty credentials"))})}},{key:"makePrecallTest",value:function(e,t,n){var r;if(!p.Registry.getAuthenticator().getToken()||!p.Registry.getCredentials().getAppId())return r=v("makePrecallTest",d.csErrorStrings.notInitialized),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);if(!p.Registry.getAuthenticator().getIceServers())return r=v("makePrecallTest",d.csErrorStrings.notInitialized),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);if(!p.Registry.getCredentials().getCollectSDP())return r=v("makePrecallTest",d.csErrorStrings.apiaccesserror),h.error(r),h.sendLog(l.logEvents.error,r),y(l.callstatsAPIReturnStatus.failure,r);try{m.fire(f.MainEvents.onMakePrecallTest,e,t,n),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"makePrecallTest: Error",error:e.message+":"+e.stack}),h.error("makePrecallTest: Error",e),h.sendLog(l.logEvents.error,"makePrecallTest Error")}return y(l.callstatsAPIReturnStatus.success)}},{key:"stopPrecallTests",value:function(){p.Registry.getPCTRunnerService().stop()}},{key:"startPrecallTests",value:function(e,t){var n;if(!p.Registry.getAuthenticator().getToken()||!p.Registry.getCredentials().getAppId())return n=v("startPrecallTests",d.csErrorStrings.notInitialized),h.error(n),h.sendLog(l.logEvents.error,n),y(l.callstatsAPIReturnStatus.failure,n);if(!p.Registry.getAuthenticator().getIceServers())return n=v("startPrecallTests",d.csErrorStrings.notInitialized),h.error(n),h.sendLog(l.logEvents.error,n),y(l.callstatsAPIReturnStatus.failure,n);if(!p.Registry.getCredentials().getCollectSDP())return n=v("startPrecallTests",d.csErrorStrings.apiaccesserror),h.error(n),h.sendLog(l.logEvents.error,n),y(l.callstatsAPIReturnStatus.failure,n);if(!e)return n=v("startPrecallTests",d.csErrorStrings.argumentError),h.error(n),h.sendLog(l.logEvents.error,n),y(l.callstatsAPIReturnStatus.failure,n);try{m.fire(f.MainEvents.onStartPrecallTests,e,36e5),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"startPrecallTests: Error",error:e.message+":"+e.stack}),h.error("startPrecallTests: Error",e),h.sendLog(l.logEvents.error,"startPrecallTests Error")}return y(l.callstatsAPIReturnStatus.success)}},{key:"getSctResults",value:function(){var e=i.get("csioPctResultsArray");if(e)try{return JSON.parse(e)[p.Registry.getCredentials().getAppId()]}catch(e){h.error("SCT Results parse error")}return null}},{key:"on",value:function(e,t){var n;if(!t||"function"!=typeof t)return n=v("on",d.csErrorStrings.argumentError),h.error(n),h.sendLog(l.logEvents.error,n),y(l.callstatsAPIReturnStatus.failure,n);if(!e||!l.callbackFunctions.hasOwnProperty(e))return n=v("on",d.csErrorStrings.argumentError),h.error(n),h.sendLog(l.logEvents.error,n),y(l.callstatsAPIReturnStatus.failure,n);try{m.fire(f.MainEvents.onOn,e,t),m.run()}catch(e){p.Registry.getGenericEventHandler().sendEvent(l.logEvents.error,{msg:"on: Error",error:e.message+":"+e.stack}),h.error("on: Error",e)}return y(l.callstatsAPIReturnStatus.success)}},{key:"fabricUsage",get:function(){return this.constructor.fabricUsage}},{key:"fabricEvent",get:function(){return this.constructor.fabricEvent}},{key:"webRTCFunctions",get:function(){return this.constructor.webRTCFunctions}},{key:"csError",get:function(){return this.constructor.csError}},{key:"qualityRating",get:function(){return this.constructor.qualityRating}},{key:"callStatsAPIReturnStatus",get:function(){return this.constructor.callStatsAPIReturnStatus}},{key:"version",get:function(){return this.constructor.version}},{key:"userIDType",get:function(){return this.constructor.userIDType}},{key:"transmissionDirection",get:function(){return this.constructor.transmissionDirection}},{key:"endpointType",get:function(){return this.constructor.endpointType}},{key:"callType",get:function(){return this.constructor.callType}},{key:"roles",get:function(){return this.constructor.roles}}])&&c(t.prototype,n),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function b(){return new u}u.fabricUsage=l.fabricUsage,u.fabricEvent=l.fabricEvent,u.webRTCFunctions=l.webRTCFunctions,u.csError=d.csError,u.qualityRating=l.qualityRating,u.callStatsAPIReturnStatus=l.callstatsAPIReturnStatus,u.version=e.version,u.userIDType=l.userIdType,u.endpointType=l.endpointType,u.transmissionDirection=l.transmissionDirection,u.callType=l.callType,u.roles=l.roles,"function"==typeof define&&define.amd?define("callstats",[],b):w.callstats=b,k.exports=b}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browserapi/localstorage":34,"./config/callstatserrors":49,"./config/constants":50,"./config/settings":51,"./fsm/mainfsm":52,"./services/authenticator":60,"./utility/csiologger":119,"./utility/onerroreventlistner":126,"./utility/registry":128,"./utility/utils":134}],37:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../utility/csiologger"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.queue=[],this.priority=[]}var t,n,r;return t=e,(n=[{key:"add",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];1e6<this.length()?i.error("Maximum cached items reached, dropping."):(t?this.priority:this.queue).push(e)}},{key:"pop",value:function(){return(0<this.priority.length?this.priority:this.queue).shift()}},{key:"peak",value:function(){return 0<this.priority.length?this.priority[0]:0<this.queue.length?this.queue[0]:null}},{key:"length",value:function(){return this.queue.length+this.priority.length}},{key:"updateConferenceId",value:function(e){for(var t=0;t<this.queue.length;++t)this.queue[t].updateConferenceId(e);for(var n=0;n<this.priority.length;++n)this.priority[n].updateConferenceId(e)}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.Cache=e},{"../utility/csiologger":119}],38:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Component=void 0;var i=e("./port"),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../utility/csiologger"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Unknown",t=this,n=r;if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");this.name=e,this.ports=new Map}var e,t,n;return e=r,(t=[{key:"bindPort",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this;this.ports.has(e)?o.warn("Port ("+e+") for "+this.name+" already exists."):this.ports.set(e,new i.Port(t,n))}},{key:"declarePort",value:function(e){this.ports.has(e)?o.warn("Port ("+e+") for "+this.name+" already exists."):this.ports.set(e,null)}},{key:"getPort",value:function(e){return this.ports.get(e)}},{key:"isConnected",value:function(e){return!!this.ports.has(e)&&null!==this.ports.get(e)}},{key:"connect",value:function(e,t){this.ports.has(e)?this.ports.set(e,t):o.warn("Port ("+e+") for "+this.name+" does not exists.")}},{key:"transmit",value:function(e){var t=this.ports.get(e);if(void 0===t)o.warn("Port ("+e+") for "+this.name+" does not exists.");else if(null===t)o.warn("Port ("+e+") for "+this.name+" is not connected.");else{for(var n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.transmit(r)}}},{key:"request",value:function(e){var t=this.ports.get(e);if(void 0===t)return o.warn("Port ("+e+") for "+this.name+" does not exists."),null;if(null===t)return o.warn("Port ("+e+") for "+this.name+" is not connected."),null;for(var n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.request(r)}}])&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}();n.Component=e},{"../utility/csiologger":119,"./port":41}],39:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.PCTAggregator=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.pctMeasurements=[],this.pctMeasurementsMap=new Map}var t,n,r;return t=e,(n=[{key:"getPCTMeasurements",value:function(){return this.pctMeasurements}},{key:"addPCTMeasurement",value:function(e){this.pctMeasurements.length>=i.pctSampleSize&&this.pctMeasurements.shift(),this.pctMeasurements.push(e);var t=e.getProvider();this.pctMeasurementsMap.has(t)||this.pctMeasurementsMap.set(t,[]),this.pctMeasurementsMap.get(t).push(e)}},{key:"clearPCTMeasurements",value:function(){this.pctMeasurements=[],this.pctMeasurementsMap=new Map}},{key:"doStats",value:function(e){var t={};return t.min=this.findMin(e),t.max=this.findMax(e),t.mean=this.calculateAverage(e),t.median=this.calculateMedian(e),t.stddev=this.calculateStandardDeviation(e,t.mean),t}},{key:"findMax",value:function(e){return e&&e.length?Math.max.apply(null,e):null}},{key:"findMin",value:function(e){return e&&e.length?Math.min.apply(null,e):null}},{key:"calculateAverage",value:function(e){return e&&e.length?e.reduce(function(e,t){return e+t},0)/e.length:0}},{key:"calculateMedian",value:function(e){var t;return e&&e.length?(e=e.slice(0).sort(function(e,t){return e-t}),t=Math.floor(e.length/2),e.length%2==0?(e[t]+e[t-1])/2:e[t]):0}},{key:"calculateStandardDeviation",value:function(e,t){var n;return e&&e.length?(n=e.map(function(e){e-=t;return e*e}).reduce(function(e,t){return e+t},0),Math.sqrt(n/(e.length-1))):0}},{key:"setAcceptability",value:function(e){var t=[];return t.push(e.throughput.median<30),t.push(.05<e.loss.median),t.push(400<e.rtt.median),e.acceptable=!t.reduce(function(e,t){return e||t},!1),e}},{key:"doInternalMeasurement",value:function(e){var t={},n=[],r=[],i=[],o=[];if(e)for(var a=0;a<e.length;a++)n.push(e[a].getRttMedian()),o.push(e[a].getRttVariance()),r.push(e[a].getThroughput()),i.push(e[a].getFractionLost());return t.rtt=this.doStats(n),t.loss=this.doStats(i),t.jitter=this.doStats(o),t.throughput=this.doStats(r),t}},{key:"scoreRtt",value:function(e){var t,n=0;return e&&e.rtt&&(n=(t=e.rtt.max)<350?n+1:n,n=t<250?n+2:n,n=t<150?n+3:n,n=t<100?n+5:n,n=(t=e.rtt.median)<200?n+1:n,n=t<150?n+3:n,n=t<100?n+5:n),n}},{key:"scoreLosses",value:function(e){var t,n=15;return e&&e.loss?(n=.04<=(t=e.loss.max)?n-3:n,n=.025<=t?n-1:n,n=.01<=t?n-1:n,n=.04<=(t=e.loss.median)?n-5:n,n=.025<=t?n-3:n,.005<=t?n-2:n):0}},{key:"scoreThroughPut",value:function(e){var t,n=0;return e&&e.throughput&&(n=5e3<(t=e.throughput.median)?n+5:n,n=2e3<t?n+2:n,n=200<t?n+1:n,n=(t=e.throughput.min)<100?n-3:n,n=t<1e3?n-2:n,n=0<(n=t<2e3?n-1:n)?n:0),n}},{key:"aggregate",value:function(){var r=this,i=[];return r.pctMeasurementsMap.forEach(function(e,t){var n={},t=(n.provider=t,r.doInternalMeasurement(e));n.rtt=t.rtt,n.jitter=t.jitter,n.loss=t.loss,n.throughput=t.throughput,(n=r.setAcceptability(n)).rttScore=r.scoreRtt(),n.lossesScore=r.scoreLosses(),n.throughputScore=r.scoreThroughPut(),i.push(n)}),i}},{key:"getAggregate",value:function(e){var t=[];if(e)for(var n=0;n<e.length;n++){var r={},i=e[n];r.provider=i.provider,r.roundTripTime=i.rtt.median,r.jitter=i.jitter.median,r.fractionLost=i.loss.median,r.throughput=i.throughput.median,t.push(r)}return t}},{key:"getSummary",value:function(e){var t=[];if(e)for(var n=0;n<e.length;n++){var r={};r.provider=e[n].provider,r.acceptable=e[n].acceptable,t.push(r)}return t}},{key:"getRanking",value:function(){var e=this.aggregate().sort(function(e,t){return e.acceptable||t.acceptable?e.acceptable&&!t.acceptable?-1:t.acceptable&&!e.acceptable?1:(e=e.rttScore+e.lossesScore+e.throughputScore,t.rttScore+t.lossesScore+t.throughputScore-e):0}),t=this.getAggregate(e),e=this.getSummary(e),n={};return n.aggregatedStats=t,n.providerRanking=e,n}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.PCTAggregator=e},{"../config/constants":50}],40:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.PCTMeasurement=void 0;var i=function(){function a(e,t,n,r,i,o){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.throughput=e,this.rttMedian=t,this.rttVariance=n,this.fractionLost=r,this.provider=i,this.timestamp=o}var e,t,n;return e=a,(t=[{key:"getThroughput",value:function(){return this.throughput}},{key:"getRttMedian",value:function(){return this.rttMedian}},{key:"getRttVariance",value:function(){return this.rttVariance}},{key:"getFractionLost",value:function(){return this.fractionLost}},{key:"getTimestamp",value:function(){return this.timestamp}},{key:"getProvider",value:function(){return this.provider}}])&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}();n.PCTMeasurement=i},{}],41:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.Port=void 0;var i=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=this,r=i;if(!(n instanceof r))throw new TypeError("Cannot call a class as a function");this.target=e,this.object=t}var e,t,n;return e=i,(t=[{key:"transmit",value:function(e){this.target.apply(this.object,e)}},{key:"request",value:function(e){return this.target.apply(this.object,e)}}])&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();n.Port=i},{}],42:[function(e,t,n){"use strict";function o(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function i(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1})}Object.defineProperty(n,"__esModule",{value:!0}),n.Queue=void 0;var c=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;a(this,n),this.value=e,this.next=t}return s(n,[{key:"setNext",value:function(){this.next=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0}}]),n}(),u=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;a(this,r),this.capacity=e,this.root=t,this.tail=n,this.currentLength=0}return s(r,[{key:"size",value:function(){return this.currentLength}},{key:"isEmpty",value:function(){return this.currentLength<1}},{key:"isOverflow",value:function(){return this.size()>this.capacity}},{key:"push",value:function(){var e=this.tail,e=(this.tail=new c(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0),this.isEmpty()?this.root=this.tail:e.setNext(this.tail),this.currentLength+=1,void 0);return e=this.isOverflow()?this.pop():e}},{key:"pop",value:function(){var e;if(!this.isEmpty())return e=this.root.value,this.root=this.root.next,--this.currentLength,e}},{key:"getFront",value:function(){return this.root}},{key:"getBack",value:function(){return this.tail}},{key:"clear",value:function(){this.root=void 0,this.tail=void 0,this.currentLength=0}},{key:"toArray",value:function(){for(var e=i({},this.root),t=[];e;){var n=e,r=n.value,e=n.next;t.push(r)}return t}}]),r}();n.Queue=u},{}],43:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.SizedBalancedTree=void 0;var i=e("./sizedbalancedtreenode"),o=r(e("../config/constants")),s=e("../collections/queue"),c=r(e("../statspipeline/validator"));function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o.maxSBTTreeSize,t=this,n=r;if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");this.comparator=this.comparatorAsc,this.root=void 0,this.sizedQueue=new s.Queue(e)}var e,t,n;return e=r,(t=[{key:"comparatorAsc",value:function(e,t){return e<t?-1:t<e?1:0}},{key:"getSize",value:function(){return this.size(this.root)}},{key:"select",value:function(){var e=this.getKey(this.root,0<arguments.length&&void 0!==arguments[0]?arguments[0]:0);return e&&e.key}},{key:"getMin",value:function(){var e=this.selectFirst(this.root);return e&&e.key}},{key:"getMax",value:function(){var e=this.selectLast(this.root);return e&&e.key}},{key:"add",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=(this.root=this.addKey(this.root,e),this.sizedQueue.push(e));c.isNumber(e)&&(this.root=this.removeKey(this.root,e))}},{key:"delete",value:function(){this.root=this.removeKey(this.root,0<arguments.length&&void 0!==arguments[0]?arguments[0]:null),this.sizedQueue.pop()}},{key:"addKey",value:function(e,t){var n;return e?(n=this.comparator(t,e.key),e.size=this.size(e)+1,n<0?e.left=this.addKey(e.left,t):e.right=this.addKey(e.right,t),this.maintain(e,t>=e.key)):new i.SizedBalancedTreeNode(t)}},{key:"removeKey",value:function(e,t){if(e){var n=this.comparator(t,e.key);if(n<0)e.left=this.removeKey(e.left,t);else if(0<n)e.right=this.removeKey(e.right,t);else{if(!e.left)return e.right;if(!e.right)return e.left;n=this.selectFirst(e.right),t=e.key;e.key=n.key,e.value=n.value,n.key=t,e.right=this.removeKey(e.right,t)}return(e=this.maintain(e)).size=this.size(e.left)+this.size(e.right)+1,e}}},{key:"maintain",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e){if(t){if(!(e.right&&this.size(e.right.right)>this.size(e.left))){if(!(e.right&&this.size(e.right.left)>this.size(e.left)))return e;e.right=this.rotateRight(e.right)}e=this.rotateLeft(e)}else{if(!(e.left&&this.size(e.left.left)>this.size(e.right))){if(!(e.left&&this.size(e.left.right)>this.size(e.right)))return e;e.left=this.rotateLeft(e.left)}e=this.rotateRight(e)}return e.left=this.maintain(e.left,!1),e.right=this.maintain(e.right,!0),e=this.maintain(e,!1),e=this.maintain(e,!0)}}},{key:"size",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return e?e.size:0}},{key:"height",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return t?(e=this.height(t.left),t=this.height(t.right),Math.max(e,t)+1):0}},{key:"rotateLeft",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;if(t)return e=t.right,t.right=e.left,e.left=t,e.size=this.size(t),t.size=this.size(t.left)+this.size(t.right)+1,e}},{key:"rotateRight",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;if(t)return e=t.left,t.left=e.right,e.right=t,e.size=this.size(t),t.size=this.size(t.left)+this.size(t.right)+1,e}},{key:"getKey",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(e)return t===this.size(e.left)+1?e:t<=this.size(e.left)?this.getKey(e.left,t):this.getKey(e.right,t-1-this.size(e.left))}},{key:"selectLast",value:function(e){if(e){for(;e.right;)e=e.right;return e}}},{key:"selectFirst",value:function(e){if(e){for(;e.left;)e=e.left;return e}}},{key:"traverse",value:function(){this.print(this.root," ",!1)}},{key:"print",value:function(e,t,n){var r;e&&(r=n?"└──":"├──",console.log("".concat(t).concat(r),e.key),r=t+(n?"    ":"│   "),e.left&&this.print(e.left,r,!1),e.right&&this.print(e.right,r,!0))}}])&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}();n.SizedBalancedTree=e},{"../collections/queue":42,"../config/constants":50,"../statspipeline/validator":114,"./sizedbalancedtreenode":44}],44:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(n,"__esModule",{value:!0}),n.SizedBalancedTreeNode=void 0,n.SizedBalancedTreeNode=i(function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=this,a=e;if(!(o instanceof a))throw new TypeError("Cannot call a class as a function");this.key=t,this.left=n,this.right=r,this.size=i})},{}],45:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.SlidingWindow=void 0;var i=e("./switem"),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../utility/timestamps"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.items=[],this.plugins=[],this.postProcesses=[],this.preProcesses=[],this.timeoutInMs=t,this.maxItemsNum=e,this.minItemsNum=0}var e,t,r;return e=n,(t=[{key:"setMaxItemsNum",value:function(e){this.maxItemsNum=e}},{key:"setTimeoutInMs",value:function(e){this.timeoutInMs=e}},{key:"setMinItemsNum",value:function(e){this.minItemsNum=e}},{key:"refresh",value:function(){var e=o.getCurrent();if(!(this.items.length<=this.minItemsNum)){for(;0<this.maxItemsNum&&this.maxItemsNum<=this.items.length;)this.remove();this.timeoutInMs&&this.timeoutInMs<e-this.items[0].getCreated()&&(this.remove(),this.refresh())}}},{key:"getLength",value:function(){return this.items.length}},{key:"add",value:function(e){this.refresh(),this.items.push(new i.SWItem(e));for(var t=0;t<this.preProcesses.length;t++)(0,this.preProcesses[t])(e);for(var n=0;n<this.plugins.length;n++)this.plugins[n].add(e);for(var r=0;r<this.postProcesses.length;r++)(0,this.postProcesses[r])(e)}},{key:"remove",value:function(){for(var e=this.items.shift(),t=0;t<this.plugins.length;t++)this.plugins[t].remove(e.value)}},{key:"peek",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this.items.length<=e?null:this.items[this.items.length-e-1].getValue()}},{key:"attach",value:function(e){this.plugins.push(e)}},{key:"addPreProcess",value:function(e){this.preProcesses.push(e)}},{key:"addPostProcess",value:function(e){this.postProcesses.push(e)}},{key:"detach",value:function(t){this.plugins=this.plugins.filter(function(e){return e!==t})}}])&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();n.SlidingWindow=e},{"../utility/timestamps":132,"./switem":46}],46:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.SWItem=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../utility/timestamps"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.value=e,this.created=i.getCurrent()}var e,n,r;return e=t,(n=[{key:"getValue",value:function(){return this.value}},{key:"getCreated",value:function(){return this.created}},{key:"toString",value:function(){return""}}])&&o(e.prototype,n),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();n.SWItem=e},{"../utility/timestamps":132}],47:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Conference=void 0;var i=e("../peerconnection/peerconnectionmanager"),o=r(e("../config/settings")),s=e("../utility/registry"),c=r(e("../browserapi/sessionstorage")),u=r(e("../config/constants"));function l(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(l=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.conferenceId=e,this.startTime,this.peerConnectionManager=new i.PeerConnectionManager,this.credentials=t,this.ucId=null,this.url=null,this.userJoinedSent=!1}var e,t,r;return e=n,(t=[{key:"getCredentials",value:function(){return this.credentials}},{key:"getUcId",value:function(){return this.ucId}},{key:"setUcId",value:function(e){this.ucId=e,this.url=o.dashboardUrl+"apps/"+s.Registry.getCredentials().getAppId()+"/conferences/"+encodeURIComponent(this.conferenceId)+"/"+e+"/general",c.storeUcId(this.conferenceId,e)}},{key:"resetUcId",value:function(){this.ucId=null}},{key:"getPeerConnectionManager",value:function(){return this.peerConnectionManager}},{key:"getUrl",value:function(){return this.url}},{key:"updateConferenceId",value:function(e){this.conferenceId=e,this.peerConnectionManager.updateConferenceId(e)}},{key:"updateState",value:function(){this.peerConnectionManager.getPeerConnectionStatus()===u.fabricState.terminated&&(this.setUserJoinedSent(!1),o.collectHeadsetStats&&s.Registry.getJabraService().stopJabraMonitoring())}},{key:"isUserJoinedSent",value:function(){return this.userJoinedSent}},{key:"setUserJoinedSent",value:function(e){this.userJoinedSent=e}},{key:"close",value:function(e){}}])&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();n.Conference=e},{"../browserapi/sessionstorage":35,"../config/constants":50,"../config/settings":51,"../peerconnection/peerconnectionmanager":58,"../utility/registry":128}],48:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.ConferenceManager=void 0;var i=e("./conference"),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.conferenceMap=new Map}var t,n,r;return t=e,(n=[{key:"add",value:function(e,t){this.get(e)||(t=new i.Conference(e,t),this.conferenceMap.set(e,t))}},{key:"get",value:function(e){return this.conferenceMap.get(e)}},{key:"getConferenceForPc",value:function(r){var i=null;return r&&this.conferenceMap.forEach(function(e,t){var n=e.getPeerConnectionManager().getPcHandler(r);n&&n.getConferenceId()===t&&(i=e)}),i}},{key:"getConferenceForPcHash",value:function(r){var i=null;return r&&this.conferenceMap.forEach(function(e,t){var n=e.getPeerConnectionManager().getPcHandlerByHash(r);n&&n.getConferenceId()===t&&(i=e)}),i}},{key:"updateConferenceId",value:function(e){var t=o.tmpConferenceId,n=this.get(t);n&&(n.updateConferenceId(e),this.conferenceMap.set(e,n),this.conferenceMap.delete(t))}},{key:"getConferenceIds",value:function(){var n=[];return this.conferenceMap.forEach(function(e,t){n.push(t)}),n}}])&&c(t.prototype,n),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.ConferenceManager=e},{"../config/constants":50,"./conference":47}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.internalErrors=n.csErrorStrings=n.csErrorReason=n.csError=n.authErrorActions=void 0;n.csError={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK",authOngoing:"authOngoing",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction"},n.csErrorStrings={argumentError:"Argument missing/invalid",cryptoError:"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API",fabricEventUnsupported:"Unsupported fabricEvent",fabricEventInvalid:"Invalid fabricEvents value",fabricUsageInvalid:"Invalid fabricUsage value",notInitialized:"SDK is not initialized or no Fabrics added",pcInvalid:"Invalid PeerConnection object passed",confereneDoesNotExist:"conferenceId does not exist",webRTCFunctionsInvalid:"Invalid webRTC functionName value",setProxyConfigInvokeError:"cannot be called if window.csioproxy is false",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction",apiaccesserror:"API access Error"},n.csErrorReason={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},n.internalErrors={authOngoing:"authOngoing"};n.authErrorActions={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2}},{}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.wsConnectionState=n.webRTCFunctions=n.userIdType=n.urlType=n.transmissionDirection=n.tmpConferenceId=n.throughputThreshold=n.streamType=n.statsDestination=n.rttThreshold=n.roles=n.reportType=n.qualityRating=n.qualityDisruptionTypes=n.precalltestEvents=n.pctSampleSize=n.osName=n.oneWayMediaTypes=n.mediaType=n.mediaDisruptionCallbackType=n.maxSBTTreeSize=n.logEvents=n.limitationType=n.internalFabricEvent=n.fractionalLossThreshold=n.fabricUsage=n.fabricStateChangeType=n.fabricState=n.fabricEvent=n.endpointType=n.echoDetectionLabel=n.eModelThreshold=n.customEvents=n.currOverPrevFrameRateThreshold=n.csCallBackMessages=n.codeBaseType=n.circuitBreakerDisruptionType=n.callstatsChannels=n.callstatsAPIReturnStatus=n.callbackFunctions=n.callType=n.callFailureReasons=n.browserName=n.avQualityRatings=n.adaptiveStatsThresholds=n.adaptiveStatsIntervalsInMs=void 0;n.logEvents={stateMachine:"stateMachine",log:"log",timing:"timing",error:"error",getStatsError:"getStatsError",restResponseError:"restResponseError",warn:"warn"},n.fabricEvent={fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog",callDetails:"callDetails",callUnAnswered:"callUnAnswered"},n.callType={unknown:"unknown",inbound:"inbound",outbound:"outbound",monitoring:"monitoring"},n.roles={agent:"agent",participant:"participant"},n.internalFabricEvent={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",userAlive:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStart:"mediaPlaybackStart",mediaPlaybackSuspended:"mediaPlaybackSuspended",mediaPlaybackStalled:"mediaPlaybackStalled",oneWayMedia:"oneWayMedia",oneWayMediaStart:"oneWayMediaStart",oneWayMediaStop:"oneWayMediaStop",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDeviceList:"connectedDeviceList",sdpSubmission:"sdpSubmissionEvent",sendingThroughputObservations:"sendingThroughputObservations",limitationObservations:"limitationObservations",userDetails:"userDetails",circuitBreaker:"circuitBreaker"},n.callstatsChannels={sdpSubmission:"sdpSubmissionEvent",processedStats:"processedStats",callstatsEvent:"callStatsEvent",userFeedback:"userFeedbackEvent",preCallTest:"preCallTest",senderConfiguration:"senderConfiguration"},n.urlType={events:"events",stats:"stats"},n.precalltestEvents={results:"preCallTestResults",associate:"preCallTestAssociate",notification:"preCallTestNotification"},n.customEvents={event:"customEvent",stats:"customStats",conferenceSummary:"conferenceSummary"},n.callstatsAPIReturnStatus={success:"success",failure:"failure"},n.fabricUsage={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},n.userIdType={local:"local",remote:"remote"},n.qualityRating={excellent:5,good:4,fair:3,poor:2,bad:1},n.reportType={local:"local",remote:"remote"},n.avQualityRatings={excellent:"excellent",fair:"fair",bad:"bad",unknown:"unknown"},n.fabricState={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",hold:"hold",checkingDisrupted:"checkingDisrupted",terminated:"terminated"},n.webRTCFunctions={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},n.callFailureReasons={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog",invalidWebRTCFunctionName:"Invalid WebRTC function name"},n.throughputThreshold={video:{green:1024,red:256},audio:{green:30,red:8}},n.currOverPrevFrameRateThreshold={video:{green:.8,red:.3}},n.rttThreshold={video:{green:400,red:1e3}},n.fractionalLossThreshold={video:{green:.1,red:.5},audio:{green:.15,red:.3}},n.eModelThreshold={audio:{green:240,red:400}},n.codeBaseType={chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},n.browserName={chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari",opera:"Opera"},n.osName={windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"},n.mediaType={audio:"audio",video:"video"},n.streamType={inbound:"inbound",outbound:"outbound"},n.fabricStateChangeType={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},n.wsConnectionState={initiated:"initiated",connected:"connected",closed:"closed"},n.csCallBackMessages={authSuccessful:"SDK authentication successful.",authFailed:"SDK authentication failed.",authProtocolInvalid:"Fatal authentication error. Invalid auth protocol message.",authOngoing:"Authentication on going.",wsConnected:"WebSocket establishment successful.",wsClosed:"WebSocket server closed.",wsFailed:"WebSocket establishment failed."},n.oneWayMediaTypes={audio:"audio",video:"video",screen:"screen"},n.limitationType={cpu:"cpu",network:"network"},n.qualityDisruptionTypes={qpchange:"qpchange"},n.callbackFunctions={stats:"stats",defaultConfig:"defaultConfig",recommendedConfig:"recommendedConfig",preCallTestResults:"preCallTestResults",preCallTest:"preCallTest",connectionRecommendation:"connectionRecommendation",mediaDisruption:"mediaDisruption",pctConnectionQualityChange:"pctConnectionQualityChange"},n.mediaDisruptionCallbackType={oneWayMediaStart:"oneWayMediaStart",oneWayMediaStop:"oneWayMediaStop",circuitBreaker:"circuitBreaker"},n.circuitBreakerDisruptionType={mediaTimeout:"mediaTimeout",congestion:"congestion",mediaUsability:"mediaUsability",RTCPTimeout:"RTCPTimeout"},n.endpointType={peer:"peer",server:"server"},n.transmissionDirection={sendonly:"sendonly",receiveonly:"receiveonly",sendrecv:"sendrecv",inactive:"inactive"},n.adaptiveStatsIntervalsInMs={min:2e3,max:3e4},n.adaptiveStatsThresholds={maxMarginFactor:15,marginReductionFactor:.5,marginIncreaseFactor:2,maxGradualCounter:4,rippleBase:2,marginDecreaseIntervalInMs:3e3,minIntervalInMs:2e3,maxIntervalInMs:3e4,windowSize:100,resetThreshold:3,minThreshold:{rtt:100,throughput:200,fractionalLoss:.1},eps:9e-5,maxInitialTimeoutInMs:3e4,initialNotifyIntervalTimeoutInMs:5e3},n.statsDestination={callback:"callback",backend:"backend"},n.echoDetectionLabel={unacceptable:"unacceptable",limitingCase:"limitingCase",acceptable:"acceptable"},n.tmpConferenceId="csio-conf-id-tmp",n.pctSampleSize=100;n.maxSBTTreeSize=600},{}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.restStatsUrl=n.restEventUrl=n.dashboardUrl=n.csioDebug=n.configServiceUrl=n.collectorUrl=n.collectLegacyStats=n.collectIP=n.collectHeadsetStats=n.callbackLogger=n.authServiceUrl=n.authRetryTimeout=void 0,n.setAuthServiceUrl=function(e){n.authServiceUrl=r=e},n.setCallbackLogger=function(e){n.callbackLogger=f=e},n.setCollectHeadsetStats=function(e){n.collectHeadsetStats=d=e},n.setCollectIP=function(e){n.collectIP=l=e},n.setCollectLegacyStats=function(e){n.collectLegacyStats=u=e},n.setCollectorUrl=function(e){n.collectorUrl=o=e},n.setConfigServiceUrl=function(e){n.configServiceUrl=a=e},n.setDashboardUrl=function(e){n.dashboardUrl=i=e},n.setRestEventUrl=function(e){n.restEventUrl=s=e},n.setRestStatsUrl=function(e){n.restStatsUrl=c=e},n.version=void 0;n.version="3.73.21";var r="https://auth.callstats.io/",i=(n.authServiceUrl=r,"https://dashboard.callstats.io/"),o=(n.dashboardUrl=i,"https://collector.callstats.io:443/"),a=(n.collectorUrl=o,n.csioDebug="false",null),s=(n.configServiceUrl=a,n.authRetryTimeout=5e3,null),c=(n.restEventUrl=s,null),u=(n.restStatsUrl=c,!0),l=(n.collectLegacyStats=u,!0),d=(n.collectIP=l,!0),f=(n.collectHeadsetStats=d,null);n.callbackLogger=f},{}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MainFSM=n.MainEvents=void 0;var r=e("./statemachine"),f=e("../utility/registry"),p=i(e("../utility/csiologger")),o=i(e("../utility/utils")),h=i(e("../utility/ipdiscovery")),u=i(e("../utility/timestamps")),y=i(e("../config/constants")),v=i(e("../config/settings")),a=e("../statspipeline/statsadapter"),s=e("../statspipeline/statsparser"),c=e("../statspipeline/statsmonitor"),l=e("../statspipeline/statstransmitter"),d=e("../statspipeline/statsassembler");function g(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(g=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==m(e)&&"function"!=typeof e)return{default:e};t=g(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?w(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function C(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=T(n),t=(e=r?(e=T(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===m(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P="Created",_="Initializing",O="Idle",E="Run",I={onStart:"onStart",onInitialize:"onInitialize",onAddNewFabric:"onAddNewFabric",onSendFabricEvent:"onSendFabricEvent",onReportError:"onReportError",onAssociateMstWithUserID:"onAssociateMstWithUserID",onSetProxyConfig:"onSetProxyConfig",onAttachWifiStatsHandler:"onAttachWifiStatsHandler",onResetWifiStatsHandler:"onResetWifiStatsHandler",onSendUserFeedback:"onSendUserFeedback",onOn:"onOn",onSetIdentifiers:"onSetIdentifiers",onMakePrecallTest:"onMakePrecallTest",onStartPrecallTests:"onStartPrecallTests",onSendCallDetails:"onSendCallDetails",onSendCustomStats:"onSendCustomStats",onSendCustomEvent:"onSendCustomEvent"};n.MainEvents=I;var R="onServicesFinished";e=function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&k(t,e);var n,r=C(i);function i(){var e;if(this instanceof i)return e=r.call(this,P),p.log("FSM:",e.getState()),e.fire(I.onStart),e.run(),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,i=arguments[1],o=0;o<r;o++)if(t=n[o],e.call(i,t,o,n))return t}}),e;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"proceed",value:function(e,t){switch(this.getState()){case P:switch(e){case I.onStart:this.onStart.apply(this,b(t));break;case I.onInitialize:this.setState(_),p.log("FSM:",this.getState()),this.onInitialize.apply(this,b(t));break;case I.onOn:this.onOn.apply(this,b(t));break;case I.onSetProxyConfig:this.onSetProxyConfig.apply(this,b(t));break;case I.onStartPrecallTests:this.onStartPrecallTests.apply(this,b(t))}break;case _:switch(e){case R:this.onServicesFinished()&&(this.setState(O),p.log("FSM:",this.getState()));break;case I.onAddNewFabric:this.onAddNewFabric.apply(this,b(t));break;case I.onSendFabricEvent:this.onSendFabricEvent.apply(this,b(t));break;case I.onSendCallDetails:this.onSendCallDetails.apply(this,b(t));break;case I.onSendCustomEvent:this.onSendCustomEvent.apply(this,b(t));break;case I.onSendCustomStats:this.onSendCustomStats.apply(this,b(t));break;case I.onReportError:this.onReportError.apply(this,b(t));break;case I.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,b(t));break;case I.onSendUserFeedback:this.onSendUserFeedback.apply(this,b(t));break;case I.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,b(t));break;case I.onResetWifiStatsHandler:this.onResetWifiStatsHandler.apply(this,b(t));break;case I.onOn:this.onOn.apply(this,b(t));break;case I.onMakePrecallTest:this.onMakePrecallTest.apply(this,b(t));break;case I.onSetIdentifiers:this.onSetIdentifiers.apply(this,b(t));break;case I.onSetProxyConfig:this.onSetProxyConfig.apply(this,b(t));break;case I.onStartPrecallTests:this.onStartPrecallTests.apply(this,b(t))}break;case O:case E:switch(e){case I.onAddNewFabric:this.onAddNewFabric.apply(this,b(t));break;case I.onSendFabricEvent:this.onSendFabricEvent.apply(this,b(t));break;case I.onSendCallDetails:this.onSendCallDetails.apply(this,b(t));break;case I.onSendCustomEvent:this.onSendCustomEvent.apply(this,b(t));break;case I.onSendCustomStats:this.onSendCustomStats.apply(this,b(t));break;case I.onReportError:this.onReportError.apply(this,b(t));break;case I.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,b(t));break;case I.onSendUserFeedback:this.onSendUserFeedback.apply(this,b(t));break;case I.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,b(t));break;case I.onResetWifiStatsHandler:this.onResetWifiStatsHandler.apply(this,b(t));break;case I.onOn:this.onOn.apply(this,b(t));break;case I.onSetProxyConfig:this.onSetProxyConfig.apply(this,b(t));break;case I.onMakePrecallTest:this.onMakePrecallTest.apply(this,b(t));break;case I.onSetIdentifiers:this.onSetIdentifiers.apply(this,b(t));break;case I.onStartPrecallTests:this.onStartPrecallTests.apply(this,b(t))}}}},{key:"onStart",value:function(){f.Registry.getEndpoint().setup(),this.authenticator=f.Registry.getAuthenticator(),this.configservicewrapper=f.Registry.getConfigServiceWrapper(),this.precalltest=f.Registry.getPreCallTest();var e=f.Registry.getStatsAdapter(),t=f.Registry.getStatsParser(),n=f.Registry.getStatsMonitor(),r=f.Registry.getStatsTransmitter(),i=f.Registry.getStatsAssembler();e.connect(a.StatsAdapterIO.RawStatsOut,t.getPort(s.StatsParserIO.RawStatsIn)),t.connect(s.StatsParserIO.PcStatsTupleOut,n.getPort(c.StatsMonitorIO.PcStatsTupleIn)),n.connect(c.StatsMonitorIO.StatsTupleOut,i.getPort(d.StatsAssemblerIO.StatsTupleIn)),i.connect(d.StatsAssemblerIO.CallstatsOut,r.getPort(l.StatsTransmitterIO.CallstatsIn)),e.connect(a.StatsAdapterIO.UnprocessedOut,r.getPort(l.StatsTransmitterIO.UnprocessedIn))}},{key:"setupConnection",value:function(){var e=this;this.connectionManager=f.Registry.getConnectionManager(),this.connectionManager.setupCollectorConnection(),this.connectionManager.setup().then(function(){p.log("Connected to connectionManager"),e.fire(R),e.run()}).catch(function(e){return p.log("Could not connect to connectionManager",e)})}},{key:"setup",value:function(){var e=this;this.clocksync=f.Registry.getClockSync(),f.Registry.getGenericEventHandler().sendEvent(y.logEvents.log,{msg:"Starting clockSync"}),this.clocksync.initiate().then(function(){p.log("Clocksync completed"),p.sendLog(y.logEvents.warn,"Clocksync completed"),e.fire(R),e.run()}).catch(function(e){p.sendLog(y.logEvents.error,"Could not finish ClockSync"),p.log("Could not finish ClockSync",e)})}},{key:"onInitialize",value:function(e,t,n,r,i,o){var a=this,s=f.Registry.getCredentials();s.setAppId(e),s.setUserId(t),f.Registry.getCallbacks().set(y.callbackFunctions.stats,i),this.doPrecalltest=!0,o&&(!0===o.disableBeforeUnloadHandler&&this.setBeforeUnloadHandler(),o.applicationVersion&&f.Registry.getEndpoint().setAppVersion(o.applicationVersion),o.disablePrecalltest&&(this.doPrecalltest=!1),o.siteID&&("string"!=typeof o.siteID?p.error("Invalid configParams: siteId must be string"):s.setSiteId(o.siteID)),o.additionalIDs&&("object"!==m(o.additionalIDs)?p.error("Invalid configParams: additionalIDs must be object"):(console.log("Setting application IDs",o.additionalIDs),s.setAdditionalIDs(o.additionalIDs))),"boolean"==typeof o.collectLegacyStats&&v.setCollectLegacyStats(o.collectLegacyStats),"boolean"==typeof o.collectIP&&v.setCollectIP(o.collectIP),"boolean"==typeof o.collectHeadsetStats&&v.setCollectHeadsetStats(o.collectHeadsetStats),o.callbackLogger&&"function"==typeof o.callbackLogger&&v.setCallbackLogger(o.callbackLogger)),this.setup(),v.collectHeadsetStats&&f.Registry.getJabraService().initJabraService(),this.authenticator.initiate(e,n,t,r).then(function(e){p.log("Authentication complete"),p.sendLog(y.logEvents.warn,"Authentication complete"),a.setupConnection(),!0===f.Registry.getCredentials().isAdaptiveStatsEnabled()?f.Registry.getStatsMonitor().setIntervals(y.adaptiveStatsIntervalsInMs.min,y.adaptiveStatsIntervalsInMs.max):(t=f.Registry.getCredentials().getStatsSubmissionInterval(),f.Registry.getStatsMonitor().setIntervals(t,t)),a.fire(R),a.run();var t=a.authenticator.getIceServers(),n=f.Registry.getCredentials().getIngestedEvents();t&&a.doPrecalltest&&n.includes("precallTestResultsAutomatic")&&f.Registry.getPCTRunnerService().doPrecalltest(t,"callstats",{isRunManually:!1,runByUser:!1}),v.configServiceUrl&&(a.configservicewrapper.initiateInternalConfig().then(function(){p.log("ConfigService internal config:",a.configservicewrapper.getInternalConfig()),a.fire(R),a.run()},function(e){return p.log(e)}),a.configservicewrapper.initiateAppConfig().then(function(){var e=f.Registry.getCallbacks().get(y.callbackFunctions.defaultConfig),t=a.configservicewrapper.getAppDefaultConfig(),e=(e&&t&&e(t),f.Registry.getCallbacks().get(y.callbackFunctions.recommendedConfig)),t=a.configservicewrapper.getAppRecommendedConfig();e&&t&&e(t),a.fire(R),a.run()},function(e){return p.log(e)}))},function(e){p.log(e)})}},{key:"setBeforeUnloadHandler",value:function(){window&&window.addEventListener&&(p.log("setBeforeUnloadHandler"),window.addEventListener("beforeunload",function(e){return f.Registry.getConferenceManager().conferenceMap.forEach(function(e,t){e&&e.getPeerConnectionManager().pcHandlers.forEach(function(e,t){f.Registry.getEventMessageBuilder().make(y.internalFabricEvent.userLeft,e.getConferenceId(),e.getPeerConnection())})}),"Are you sure you want to close the call?"}))}},{key:"onServicesFinished",value:function(){return!!(this.connectionManager&&this.connectionManager.isReady()&&this.clocksync.isCompleted()&&this.authenticator.isCompleted())&&(f.Registry.getTransmissionManager().trySend(),!0)}},{key:"onAddNewFabric",value:function(t,e,n,r,i,o,a){var s,c=this,u=(p.warn("FSM onAddNewFabric"),f.Registry.getConferenceManager().add(r,f.Registry.getCredentials()),f.Registry.getConferenceManager().get(r)),l=u.getPeerConnectionManager(),d=!1,l=(l.addPcHandler(t,e,n,r,i,o,a),{endpointInfo:f.Registry.getEndpoint().serialize()}),e=f.Registry.getCredentials().getUserIdObject(),n=(e&&e.userName&&(l.userName=String(e.userName)),e&&e.loginID&&(l.loginID=String(e.loginID)),u.isUserJoinedSent()||(u.resetUcId(),l.disableGeoIP=!v.collectIP,f.Registry.getEventMessageBuilder().make(y.internalFabricEvent.userJoined,r,t,l),u.setUserJoinedSent(!0),s=e?String(e.userName):null,v.collectIP?(h.getRemoteAddress(function(e){d||(d=!0,c.sendUserDetailsEvent(t,r,s,e,!0))}),setTimeout(function(){d||(d=!0,c.sendUserDetailsEvent(t,r,s,[],!0))},5e3)):d||(d=!0,this.sendUserDetailsEvent(t,r,s,[],!1))),f.Registry.getPCTRunnerService().getPrecallTestIds()),i=(f.Registry.getPCTRunnerService().resetPrecallTestIds(),v.collectHeadsetStats&&f.Registry.getJabraService().startJabraMonitoring(r),this.precalltest.getId());i&&n.push(i),0<n.length&&f.Registry.getEventMessageBuilder().make(y.precalltestEvents.associate,r,t,{ids:n})}},{key:"onStartPrecallTests",value:function(e,t){var n=f.Registry.getAuthenticator().getIceServers();n[0].label="callstats-pct",e.push(n[0]),f.Registry.getPCTRunnerService().start(e,t)}},{key:"onSendCallDetails",value:function(e,t,n){p.warn("FSM onSendCallDetails");var r={};r.callType=n.callType,r.role=n.role,n.contactQueue&&(r.contactQueue=n.contactQueue),n.contactQueueID&&(r.contactQueueID=n.contactQueueID),n.routingProfile&&(r.routingProfile=n.routingProfile),n.routingProfileID&&(r.routingProfileID=n.routingProfileID),n.contactID&&(r.contactID=n.contactID),n.acceptedTimestamp&&(r.acceptedAt=n.acceptedTimestamp),n.connectedTimestamp&&(r.connectedAt=n.connectedTimestamp),n.originalContactID&&(r.originalContactID=n.originalContactID),n.siteID&&(r.siteID=n.siteID,f.Registry.getCredentials().setSiteId(n.siteID)),n.extensionVersion&&(r.extensionVersion=n.extensionVersion,f.Registry.getCredentials().setExtensionVersion(n.extensionVersion)),n.shimVersion&&(r.shimVersion=n.shimVersion,f.Registry.getCredentials().setShimVersion(n.shimVersion)),f.Registry.getEventMessageBuilder().make(y.fabricEvent.callDetails,t,e,r)}},{key:"onSendCustomEvent",value:function(e,t,n){if(p.warn("FSM onSendCustomEvent"),n&&1===n.length){var r=n[0];if("conferenceSummary"===r.type)return void f.Registry.getEventMessageBuilder().make(y.customEvents.conferenceSummary,t,e,r)}f.Registry.getEventMessageBuilder().make(y.customEvents.event,t,e,{eventList:n})}},{key:"onSendCustomStats",value:function(e,t,n){p.warn("FSM onSendCustomStats");var r={};r.stats=n,f.Registry.getEventMessageBuilder().make(y.customEvents.stats,t,e,r)}},{key:"onSendFabricEvent",value:function(e,t,n,r){p.warn("FSM onSendFabricEvent");var i={},r=(r&&(i=r).ssrc&&(i.ssrc=String(i.ssrc)),t===y.fabricEvent.activeDeviceList&&(i={mediaDeviceList:o.normalizeMediaDeviceList(r.deviceList)}),f.Registry.getEventMessageBuilder().make(t,n,e,i),f.Registry.getConferenceManager().get(n));r&&(i=r.getPeerConnectionManager().getPcHandler(e),t!==y.fabricEvent.fabricTerminated&&t!==y.internalFabricEvent.fabricSetupFailed||(i.stopUserAliveHandler(),i.setPcState(y.fabricState.terminated),i.stopStatsPolling(),i.stopPCStateMonitoring(),r.getPeerConnectionManager().removePcStats(i&&i.getPcHash()),r.updateState()),t===y.fabricEvent.fabricHold&&(i.setPcState(y.fabricState.hold),i.stopStatsPolling()),t===y.fabricEvent.fabricResume&&(i.setPcState(y.fabricState.established),i.startStatsPolling()),t===y.fabricEvent.audioMute&&i.setAudioMuted(!0),t===y.fabricEvent.audioUnmute&&i.setAudioMuted(!1))}},{key:"onReportError",value:function(e,t,n,r,i,o){p.warn("FSM onReportError");var a={delay:0,reason:this.callFailureClassifier(n),function:n,magicKey:f.Registry.getEndpoint().getMagicKey(),endpoint:f.Registry.getEndpoint().serialize(),level:"debug"};if(r&&(c=this.formatDomError(r),a.message=c.message,a.messageType=c.messageType,a.name=r.name,a.stack=r.stack),e){var s,c=f.Registry.getConferenceManager().get(t);if(!(s=c?c.getPeerConnectionManager().getPcHandler(e):s))return void p.error("onReportError: No handler found for given PeerConnection!");a.delay=u.getCurrent()-s.getStartTime(),a.fabricState=s.getPcState(),a.iceConnectionState=s.getIceConnectionState(),(i||o||e&&"closed"!==e.signalingState)&&f.Registry.getCredentials().getCollectSDP()&&n!==y.webRTCFunctions.applicationLog&&((r={}).localSDP=this.pickSDP(e,i,"localDescription"),r.remoteSDP=this.pickSDP(e,o,"remoteDescription"),f.Registry.getEventMessageBuilder().make(y.callstatsChannels.sdpSubmission,t,e,r))}n===y.webRTCFunctions.applicationLog||n===y.webRTCFunctions.applicationError?f.Registry.getEventMessageBuilder().make(y.fabricEvent.applicationErrorLog,t,e,a):n===y.webRTCFunctions.iceConnectionFailure?this.handleIceConnectionFailure(e,t,a):(f.Registry.getEventMessageBuilder().make(y.fabricEvent.fabricSetupFailed,t,e,a),n===y.webRTCFunctions.getUserMedia&&this.handleGUMErrors(t))}},{key:"onAssociateMstWithUserID",value:function(e,t,n,r,i,o){n=f.Registry.getConferenceManager().get(n);n&&("string"!=typeof r&&(r+=""),n.getPeerConnectionManager().getPcHandler(e).updateSSRCInfo(r,t,i,o))}},{key:"onResetWifiStatsHandler",value:function(){f.Registry.getWifiStatsExecutor().resetGetWifiStatsMethod()}},{key:"onAttachWifiStatsHandler",value:function(e){f.Registry.getWifiStatsExecutor().setGetWifiStatsMethod(e)}},{key:"onSetProxyConfig",value:function(e){p.warn("FSM onSetProxyConfig"),e.collectorURL&&v.setCollectorUrl(e.collectorURL),e.authServiceURL&&v.setAuthServiceUrl(e.authServiceURL),e.restEventURL&&v.setRestEventUrl(e.restEventURL),e.restStatsURL&&v.setRestStatsUrl(e.restStatsURL),e.appSettingsURL&&v.setConfigServiceUrl(e.appSettingsURL)}},{key:"onSendUserFeedback",value:function(e,t,n){var r={feedback:{overallRating:t.overall}};t.video&&(r.feedback.videoQualityRating=t.video),t.audio&&(r.feedback.audioQualityRating=t.audio),t.comment&&(r.feedback.comments=t.comment),f.Registry.getEventMessageBuilder().make(y.callstatsChannels.userFeedback,e,null,r)}},{key:"onOn",value:function(e,t){f.Registry.getCallbacks().set(e,t)}},{key:"onSetIdentifiers",value:function(e,t){var n;e.conferenceID&&(f.Registry.getConferenceManager().updateConferenceId(e.conferenceID),f.Registry.getTransmissionManager().updateConferenceId(e.conferenceID),f.Registry.getTransmissionManager().trySend()),e.remoteUserID&&t&&((n=f.Registry.getConferenceManager().getConferenceForPc(t))?(n=n.getPeerConnectionManager().getPcHandler(t))?(n.updateRemoteId(e.remoteUserID),f.Registry.getTransmissionManager().trySend()):p.log("pcHandler not found"):p.log("onSetIdentifiers conference not found"))}},{key:"onMakePrecallTest",value:function(e,t,n){var r=e,t=t||"callstats";n?(n.isRunManually=!0)!==n.runByUser&&(n.runByUser=!1):n={isRunManually:!0,runByUser:!0},e||(r=this.authenticator.getIceServers(),t="callstats"),f.Registry.getPCTRunnerService().doPrecalltest(r,t,n)}},{key:"sendUserDetailsEvent",value:function(e,t,n,r,i){f.Registry.getEventMessageBuilder().make(y.internalFabricEvent.userDetails,t,e,{userName:n,localIpAddressInfo:r,collectIP:i})}},{key:"handleIceConnectionFailure",value:function(e,t,n){var r,i;!e||(r=(i=f.Registry.getConferenceManager().get(t))?i.getPeerConnectionManager().getPcHandler(e):r)&&(r.isFabricSetupSent()?((i={localIceCandidates:[],remoteIceCandidates:[],iceCandidatePairs:[]}).delay=u.getCurrent()-r.getStartTime(),i.currIceConnectionState="failed",i.prevIceConnectionState="disconnected",f.Registry.getEventMessageBuilder().make(y.internalFabricEvent.iceFailed,t,e,i)):(n.delay=u.getCurrent()-r.getStartTime(),n.fabricState=r.getPcState(),n.iceConnectionState=r.getIceConnectionState(),f.Registry.getEventMessageBuilder().make(y.fabricEvent.fabricSetupFailed,t,e,n)))}},{key:"handleGUMErrors",value:function(e){var t,n=f.Registry.getConferenceManager().get(e);n||(f.Registry.getConferenceManager().add(e,f.Registry.getCredentials()),n=f.Registry.getConferenceManager().get(e)),n.getUcId()||((t={endpointInfo:f.Registry.getEndpoint().serialize()}).disableGeoIP=!v.collectIP,f.Registry.getEventMessageBuilder().make(y.internalFabricEvent.userJoined,e,null,t),n.setUserJoinedSent(!0))}},{key:"callFailureClassifier",value:function(e){var t;return y.webRTCFunctions.hasOwnProperty(e)?e===y.webRTCFunctions.createOffer||e===y.webRTCFunctions.createAnswer||e===y.webRTCFunctions.setRemoteDescription?t=y.callFailureReasons.negotiationFailure:e===y.webRTCFunctions.setLocalDescription||e===y.webRTCFunctions.addIceCandidate?t=y.callFailureReasons.sdpError:e===y.webRTCFunctions.getUserMedia?t=y.callFailureReasons.mediaConfigError:e===y.webRTCFunctions.iceConnectionFailure?t=y.callFailureReasons.iceFailure:e===y.webRTCFunctions.signalingError?t=y.callFailureReasons.signalingError:e!==y.webRTCFunctions.applicationLog&&!y.webRTCFunctions.applicationError||(t=y.callFailureReasons.applicationLog):t=y.callFailureReasons.invalidWebRTCFunctionName,t}},{key:"formatDomError",value:function(e){var t={},n={};return e&&(window.DOMException&&e instanceof window.DOMException?(n.message=e.message,n.name=e.name,t.messageType="domError"):"object"===m(e)?(e.message&&(n.message=e.message),e.name&&(n.name=e.name),e.constraintName&&(n.name=e.constraintName),e.stack&&(n.stack=e.stack),t.messageType="json"):(n=e,t.messageType="text")),"object"===m(n)?t.message=JSON.stringify(n):t.message=n,t}},{key:"pickSDP",value:function(e,t,n){return t||(e&&e[n]?e[n].sdp:"")}},{key:"truncateString",value:function(e){return 2e4<e.length&&(p.log("Log exceeds 20kb, It will be truncated"),e=e.substring(0,2e4)),e}},{key:"truncateLog",value:function(e){return e&&("string"==typeof e?e=this.truncateString(e):"object"===m(e)&&e.message&&(e.message=this.truncateString(e.message))),e}}])&&S(t.prototype,e),n&&S(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.StateMachine);n.MainFSM=e},{"../config/constants":50,"../config/settings":51,"../statspipeline/statsadapter":99,"../statspipeline/statsassembler":100,"../statspipeline/statsmonitor":102,"../statspipeline/statsparser":103,"../statspipeline/statstransmitter":104,"../utility/csiologger":119,"../utility/ipdiscovery":124,"../utility/registry":128,"../utility/timestamps":132,"../utility/utils":134,"./statemachine":54}],53:[function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.ProgramEvent=void 0;var r=function(){function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.type=e,this.args=void 0!==t?t:null}var e,t,r;return e=n,(t=[{key:"getType",value:function(){return this.type}},{key:"getArgs",value:function(){return this.args}}])&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();n.ProgramEvent=r},{}],54:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.StateMachine=void 0;var i=e("./programevent"),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../utility/csiologger"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.events=[],this.state=e}var e,n,r;return e=t,(n=[{key:"fire",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=new i.ProgramEvent(e,n);this.events.push(e)}},{key:"proceed",value:function(e,t){o.warn("You need to overwrite the proceed function inan extended StateMachine")}},{key:"setState",value:function(e){this.state=e}},{key:"getState",value:function(){return this.state}},{key:"run",value:function(){var e;this.events.length<1||(e=this.events.shift(),this.proceed(e.getType(),e.getArgs()))}}])&&c(e.prototype,n),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();n.StateMachine=e},{"../utility/csiologger":119,"./programevent":53}],55:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.GetStatsHandler=void 0;var s=r(e("../config/constants")),i=e("../statspipeline/statsadapter"),c=e("../utility/registry"),u=r(e("../config/settings")),l=r(e("../utility/csiologger"));function d(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(d=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=d(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function o(e,t,n,r,i){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.pc=e,this.interval=n,this.codeBase=r,this.browserName=i,this.getStatsTimer=null,this.isPromiseBased=!0,this.pcHash=t,this.genericevent=c.Registry.getGenericEventHandler()}var e,t,n;return e=o,(t=[{key:"startStatsPolling",value:function(){var e=this;e.getStatsTimer||(l.log("startStatsPolling for ",e.pcHash),this.getStatsTimer=setInterval(function(){e.csioGetStats(e.statsHandler,e.pcHash)},e.interval))}},{key:"stopStatsPolling",value:function(){this.getStatsTimer&&(clearInterval(this.getStatsTimer),this.getStatsTimer=null)}},{key:"csioGetStats",value:function(e,t){var n=s.codeBaseType.firefox,r=s.codeBaseType.chrome,i=s.codeBaseType.edge,o=s.browserName.safari,a=this.pc;if(a)if("closed"===a.iceConnectionState)this.stopStatsPolling();else try{this.isTemaSys()?this.getStatsTemasys(e,t):this.codeBase===n?this.getStatsFirefox(e,t):this.browserName===o?this.getStatsSafari(e,t):this.codeBase===r?this.getStatsChrome(e,t):this.codeBase===i&&this.getStatsEdge(e,t)}catch(e){l.log("csioGetStats: Error ",e)}}},{key:"getStatsTemasys",value:function(t,n){this.pc.getStats(null,function(e){t(e,n)},function(e){l.log("getStatsTemasys error",e)})}},{key:"getStatsFirefox",value:function(t,n){var r=this,i=this.pc;if(r.isPromiseBased)try{i.getStats().then(function(e){t(e,n)}).catch(function(e){console.log("getstats error ",e),r.isPromiseBased=!1,i.getStats(null,function(e){t(e,n)})})}catch(e){r.isPromiseBased=!1,r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Firefox getStats reports error ",error:e.message+":"+e.stack}),i.getStats(null,function(e){t(e,n)})}else i.getStats(null,function(e){t(e,n)})}},{key:"getStatsChrome",value:function(n,r){var e=this,t=this,i=t.pc;if(window&&window.csioReactNative)i.getStats().then(function(e){n(e,r)}).catch(function(e){l.error("Chrome getStats Error [react-native]",e)});else if(t.isPromiseBased)try{i.getStats().then(function(t){u.collectLegacyStats?e.getLegacyStatsChrome().then(function(e){n(t,r,e)}):n(t,r)}).catch(function(e){l.log("Chrome getStats Error ",e),t.isPromiseBased=!1,t.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:e.message+":"+e.stack}),i.getStats(function(e){n(e,r)})})}catch(e){t.isPromiseBased=!1,t.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:e.message+":"+e.stack}),i.getStats(function(e){n(e,r)})}else i.getStats(function(e){n(e,r)})}},{key:"getLegacyStatsChrome",value:function(){var t=this.pc;return new Promise(function(o,e){t.getStats(function(e){for(var t=[],n=e.result(),r=0;r<n.length;++r){var i=n[r];"ssrc"!==i.type&&"VideoBwe"!==i.type||t.push(i)}o(t)})})}},{key:"getStatsEdge",value:function(t,n){var r=this;r.pc.getStats().then(function(e){t(e,n)}).catch(function(e){t({},n),e?r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Edge getStats reports error",error:e.message+":"+e.stack}):r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Edge getStats reports error"})})}},{key:"getStatsSafari",value:function(t,n){var r=this;r.pc.getStats().then(function(e){t(e,n)}).catch(function(e){r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Safari getStats reports error",error:e.message+":"+e.stack})})}},{key:"statsHandler",value:function(e,t,n){var r=c.Registry.getStatsAdapter();if(e&&r)try{r.transmit(i.StatsAdapterIO.RawStatsIn,e,t,n)}catch(e){l.log("statsHandler: Error ",e),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"statsHandler: Error",error:e.message+":"+e.stack})}}},{key:"mediaTrackStatsHandler",value:function(e,t){t(c.Registry.getStatsAdapter().getMediaTracksInfo(e))}},{key:"iceCandidatesHandler",value:function(e,t){t(c.Registry.getStatsAdapter().getIceCandidates(e))}},{key:"getMediaTracksInfo",value:function(){var n=this;return new Promise(function(t,e){n.csioGetStats(n.mediaTrackStatsHandler,function(e){t(e)})})}},{key:"getIceCandidates",value:function(){var n=this;return new Promise(function(t,e){n.csioGetStats(n.iceCandidatesHandler,function(e){t(e)})})}},{key:"isTemaSys",value:function(){return!!(window&&window.AdapterJS&&window.AdapterJS.WebRTCPlugin&&window.AdapterJS.WebRTCPlugin.plugin)}}])&&f(e.prototype,t),n&&f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}();n.GetStatsHandler=e},{"../config/constants":50,"../config/settings":51,"../statspipeline/statsadapter":99,"../utility/csiologger":119,"../utility/registry":128}],56:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.PcCallbackHandler=void 0;var c=i(e("../config/constants")),u=e("../utility/registry"),l=i(e("../utility/timestamps")),r=i(e("../config/callstatserrors")),d=i(e("../utility/csiologger"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function s(e,t,n,r,i,o){var a=this;if(!(this instanceof s))throw new TypeError("Cannot call a class as a function");t&&(this.conferenceId=e,this.pc=t,this.getStatsHandler=n,this.userAlive=r,this.callback=o,this.remoteId=i,this.clocksync=u.Registry.getClockSync(),this.emb=u.Registry.getEventMessageBuilder(),this.precalltest=u.Registry.getPreCallTest(),this.genericevent=u.Registry.getGenericEventHandler(),this.iceCandidates=[],this.iceConnectionState=t.iceConnectionState,this.iceGatheringState=t.iceGatheringState,this.signalingState=t.signalingState,this.oldIceConnectionState="",this.oldIceGatheringState="",this.iceConnectionStateTS="",this.negotiationNeeded=0,this.pcState=c.fabricState.initializing,this.disruptedTS=0,this.connectionDisruptedTS=0,this.startTime=l.getCurrent(),this.established=!1,this.activeIceCandidatePair=null,this.prevActiveIceCandidatePair=null,this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceCandidatePairs=[],this.iceConnectivityDelay=0,this.iceGatheringDelay=0,this.fabricSetupSent=!1,this.pcMonitoringTimer=null,this.pc&&this.pc.addEventListener?(this.pc.addEventListener("icecandidate",this.iceCandidateCallback.bind(this),!1),this.pc.addEventListener("iceconnectionstatechange",this.handleIceState.bind(this),!1),this.pc.addEventListener("signalingstatechange",this.handleSignallingState.bind(this),!1),this.pc.addEventListener("negotiationneeded",this.pcNegotiationNeededCallback.bind(this),!1),this.pc.addEventListener("track",this.handleTrack.bind(this),!1)):this.pc&&this.pc.attachEvent?(d.info("attachEvent"),this.pc.attachEvent("onicecandidate",this.iceCandidateCallback.bind(this)),this.pc.attachEvent("oniceconnectionstatechange",this.handleIceState.bind(this)),this.pc.attachEvent("onsignalingstatechange",this.handleSignallingState.bind(this)),this.pc.attachEvent("onnegotiationneeded",this.pcNegotiationNeededCallback.bind(this)),this.pc.attachEvent("track",this.handleTrack.bind(this),!1)):d.error("callstats cannot monitor or collect stats"),t.getConfiguration&&(e=t.getConfiguration())&&(this.iceServersURLs=this.getIceServerURLs(e.iceServers),this.sdpSemantics=e.sdpSemantics),!t||"connected"!==t.iceConnectionState&&"completed"!==t.iceConnectionState||(this.pcState=c.fabricState.established,this.getStatsHandler.getIceCandidates().then(function(e){a.localIceCandidates=e.localIceCandidates,a.remoteIceCandidates=e.remoteIceCandidates,a.iceCandidatePairs=e.iceCandidatePairs,a.prevActiveIceCandidatePair=a.activeIceCandidatePair,a.activeIceCandidatePair=a.getActiveIceCandidatePair(),a.sendfabricSetup(),a.startStatsPolling()}).catch(function(e){a.sendfabricSetup(),a.startStatsPolling()})),this.startPCStateMonitoring())}var e,t,n;return e=s,(t=[{key:"getPcState",value:function(){return this.pc||(this.pcState=c.fabricState.terminated),"closed"===this.pc.iceConnectionState&&(this.pcState=c.fabricState.terminated),this.pcState}},{key:"checkPCStates",value:function(){this.pc||this.stopPCStateMonitoring(),this.handleIceState(),this.handleSignallingState()}},{key:"startPCStateMonitoring",value:function(){var e=this;this.pcMonitoringTimer||(this.pcMonitoringTimer=setInterval(function(){e.checkPCStates()},1e3))}},{key:"stopPCStateMonitoring",value:function(){this.pcMonitoringTimer&&(clearInterval(this.pcMonitoringTimer),this.pcMonitoringTimer=null)}},{key:"getIceServerURLs",value:function(e){var t=[];if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r&&r.urls)for(var i=0;i<r.urls.length;i++)t.push(r.urls[i])}return t}},{key:"iceCandidateCallback",value:function(e){var t,n,r;e&&e.candidate&&e.candidate.candidate&&"0"!==(t=e.candidate.candidate.split(" "))[4]&&"0"!==t[5]&&(n=!!t[4]&&-1!==t[4].indexOf(":"),r="1"===t[1]?"rtp":"rtcp",r={transport:t[2],protocol:r,typePreference:t[3],address:n?"["+t[4]+"]:"+t[5]:t[4]+":"+t[5],type:t[7],media:e.candidate.sdpMid},-1===this.iceCandidates.indexOf(r)&&(this.iceCandidates.push(r),d.warn("CALLBACK: ICE candidate",r)))}},{key:"sendFabricStateChange",value:function(e){this.emb.make(c.internalFabricEvent.fabricStateChange,this.conferenceId,this.pc,e)}},{key:"handleTrack",value:function(e){var r,i,o=this;e&&e.track&&(r=e.track.id,e=e.track.kind,i={ssrc:String(0),highResTs:u.Registry.getClockSync().getSynchronizedTimestamp(),kind:e},this.getStatsHandler.getMediaTracksInfo().then(function(e){for(var t,n=0;n<e.length;++n)if(r===e[n].trackIdentifier){i.ssrc=String(e[n].ssrc);break}o.conferenceId&&(t=u.Registry.getConferenceManager().get(o.conferenceId))&&t.getPeerConnectionManager()&&null===t.getPeerConnectionManager().getPcHandler(o.pc).videoElemTag&&o.emb.make(c.internalFabricEvent.mediaPlaybackStart,o.conferenceId,o.pc,i)}))}},{key:"handleIceState",value:function(){var t,n,r=this;this.handleIceGatheringState(),this.handleIceConnectionState()&&(this.iceConnectionStateTS=this.clocksync.getSynchronizedTimestamp(),"complete"===this.iceGatheringState&&"checking"===this.iceConnectionState&&this.handleIceChecking(),t={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState},n=this.iceConnectionState,this.getStatsHandler.getIceCandidates().then(function(e){r.localIceCandidates=e.localIceCandidates,r.remoteIceCandidates=e.remoteIceCandidates,r.iceCandidatePairs=e.iceCandidatePairs,r.prevActiveIceCandidatePair=r.activeIceCandidatePair,r.activeIceCandidatePair=r.getActiveIceCandidatePair(),"connected"===n||"completed"===n?r.handleIceConnectedOrCompleted(t):"failed"===n?r.handleIceFailed(t):"disconnected"===n?r.handleIceDisconnected(t):"closed"===n?r.handleIceClosed(t):"new"===n&&r.handleIceRestart(t)}))}},{key:"handleIceConnectionState",value:function(){if(this.pc&&this.iceConnectionState===this.pc.iceConnectionState)return!1;this.oldIceConnectionState=this.iceConnectionState,this.iceConnectionState=this.pc.iceConnectionState,d.warn("CALLBACK: ICE connection state change",this.oldIceConnectionState,"->",this.iceConnectionState);var e={changedState:c.fabricStateChangeType.iceConnectionState,prevState:this.oldIceConnectionState,newState:this.iceConnectionState};return this.sendFabricStateChange(e),!0}},{key:"handleIceGatheringState",value:function(){var e;"closed"===this.pc.iceConnectionState||"closed"===this.pc.signalingState||this.pc&&this.iceGatheringState===this.pc.iceGatheringState||("complete"===this.pc.iceGatheringState&&(this.iceGatheringDelay=l.getCurrent()-this.startTime),this.oldIceGatheringState=this.iceGatheringState,this.iceGatheringState=this.pc.iceGatheringState,d.warn("CALLBACK: ICE gathering state change",this.oldIceGatheringState,"->",this.iceGatheringState),e={changedState:c.fabricStateChangeType.iceGatheringState,prevState:this.oldIceGatheringState,newState:this.iceGatheringState},this.sendFabricStateChange(e))}},{key:"handleIceChecking",value:function(){var e,t=l.getCurrent();"disconnected"!==this.oldIceConnectionState||this.pcState!==c.fabricState.checkingDisrupted&&this.pcState!==c.fabricState.disrupted||(e={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState,delay:t-this.connectionDisruptedTS},this.pcState===c.fabricState.disrupted&&(e.prevIceCandidatePair=this.prevActiveIceCandidatePair,e.currIceCandidatePair=this.activeIceCandidatePair,e.delay=t-this.disruptedTS,this.emb.make(c.internalFabricEvent.iceDisruptionEnd,this.conferenceId,this.pc,e)),this.pcState=c.fabricState.initializing,this.emb.make(c.internalFabricEvent.iceConnectionDisruptionEnd,this.conferenceId,this.pc,e))}},{key:"handleIceConnectedOrCompleted",value:function(e){var t=this,n=l.getCurrent();this.pcState===c.fabricState.disrupted&&(e.prevIceCandidatePair=this.prevActiveIceCandidatePair,e.currIceCandidatePair=this.activeIceCandidatePair,e.delay=n-this.disruptedTS,this.emb.make(c.internalFabricEvent.iceDisruptionEnd,this.conferenceId,this.pc,e)),this.iceConnectivityDelay=n-this.startTime,this.established=!0,this.pcState=c.fabricState.established,this.getStatsHandler.getIceCandidates().then(function(e){t.localIceCandidates=e.localIceCandidates,t.remoteIceCandidates=e.remoteIceCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.prevActiveIceCandidatePair=t.activeIceCandidatePair,t.activeIceCandidatePair=t.getActiveIceCandidatePair(),t.sendfabricSetup(),t.startStatsPolling()}).catch(function(e){t.sendfabricSetup(),t.startStatsPolling()})}},{key:"sendfabricSetup",value:function(){var e,t;this.fabricSetupSent?d.log("fabricSetup has been sent already"):(e={delay:l.getCurrent()-this.startTime,iceGatheringDelay:this.iceGatheringDelay,iceConnectivityDelay:this.iceConnectivityDelay,localIceCandidates:this.localIceCandidates,remoteIceCandidates:this.remoteIceCandidates,iceCandidatePairs:this.iceCandidatePairs,remoteEndpointType:c.endpointType.peer,fabricTransmissionDirection:c.transmissionDirection.sendrecv,iceServers:this.iceServersURLs,sdpSemantics:this.sdpSemantics},(t=this.getActiveIceCandidatePair())&&(e.selectedCandidatePairID=t.id),this.fabricSetupSent=!0,this.conferenceId&&(t=u.Registry.getConferenceManager().get(this.conferenceId))&&t.getPeerConnectionManager()&&(t=t.getPeerConnectionManager().getPcHandler(this.pc),e.remoteEndpointType=t.getRemoteEndpointType(),e.fabricTransmissionDirection=t.getFabricTransmissionDirection()),this.pcState=c.fabricState.established,this.emb.make(c.internalFabricEvent.fabricSetup,this.conferenceId,this.pc,e))}},{key:"isFabricSetupSent",value:function(){return this.fabricSetupSent}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"handleIceFailed",value:function(e){e.currIceCandidatePair=this.activeIceCandidatePair,e.delay=l.getCurrent()-this.startTime,this.pcState=c.fabricState.failed,"checking"===e.prevIceConnectionState?this.sendIceFailed(e):"completed"===e.prevIceConnectionState||"connected"===e.prevIceConnectionState||"disconnected"===e.prevIceConnectionState&&this.established?this.emb.make(c.internalFabricEvent.fabricDropped,this.conferenceId,this.pc,e):"disconnected"===e.prevIceConnectionState&&this.sendIceFailed(e)}},{key:"getActiveIceCandidatePair",value:function(){var e=null,t=this.iceCandidatePairs;return t&&0<t.length&&(0<(t=t.filter(function(e){return"true"===e.selected||"true"===e.googActiveConnection||!0===e.selected||!0===e.googActiveConnection})).length&&(e=t[0])),e}},{key:"sendIceFailed",value:function(e){e.localIceCandidates=this.localIceCandidates,e.remoteIceCandidates=this.remoteIceCandidates,e.iceCandidatePairs=this.iceCandidatePairs,d.log("sending icefailed ",e),this.emb.make(c.internalFabricEvent.iceFailed,this.conferenceId,this.pc,e)}},{key:"sendFabricTransportSwitch",value:function(e){var t=this,n={};n.prevIceCandidatePair=t.activeIceCandidatePair,n.relayType=e,n.currIceConnectionState=t.iceConnectionState,n.prevIceConnectionState=t.oldIceConnectionState,n.switchDelay=null,t.getStatsHandler.getIceCandidates().then(function(e){t.localIceCandidates=e.localIceCandidates,t.remoteIceCandidates=e.remoteIceCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.activeIceCandidatePair=t.getActiveIceCandidatePair(),n.currIceCandidatePair=t.activeIceCandidatePair,n.localIceCandidates=t.localIceCandidates,n.remoteIceCandidates=t.remoteIceCandidates,d.log("sending fabric transport switch ",n),"completed"!==n.currIceConnectionState&&"connected"!==n.currIceConnectionState||"completed"!==n.prevIceConnectionState&&"connected"!==n.prevIceConnectionState||t.emb.make(c.internalFabricEvent.fabricTransportSwitch,t.conferenceId,t.pc,n)})}},{key:"handleIceDisconnected",value:function(e){var t=l.getCurrent();this.startTime=t,e.prevIceConnectionStateTs=this.iceConnectionStateTS,e.currIceCandidatePair=this.activeIceCandidatePair,"connected"===e.prevIceConnectionState||"completed"===e.prevIceConnectionState?(this.pcState=c.fabricState.disrupted,this.disruptedTS=t,this.emb.make(c.internalFabricEvent.iceDisruptionStart,this.conferenceId,this.pc,e),this.callback&&this.callback(r.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed.")):"checking"===e.prevIceConnectionState&&(this.pcState=c.fabricState.checkingDisrupted,this.connectionDisruptedTS=t,this.emb.make(c.internalFabricEvent.iceConnectionDisruptionStart,this.conferenceId,this.pc,e),this.callback&&this.callback(r.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed."))}},{key:"handleIceClosed",value:function(e){"new"===e.prevIceConnectionState||"checking"===e.prevIceConnectionState?(e.delay=l.getCurrent()-this.startTime,e.localIceCandidates=this.localIceCandidates,e.remoteIceCandidates=this.remoteIceCandidates,e.iceCandidatePairs=this.iceCandidatePairs,this.emb.make(c.internalFabricEvent.iceAborted,this.conferenceId,this.pc,e)):"connected"!==e.prevIceConnectionState&&"completed"!==e.prevIceConnectionState||(e.prevIceCandidatePair=this.activeIceCandidatePair,this.emb.make(c.internalFabricEvent.iceTerminated,this.conferenceId,this.pc,e)),this.pcState=c.fabricState.terminated,this.conferenceId&&u.Registry.getConferenceManager().get(this.conferenceId).updateState(),this.stopStatsPolling()}},{key:"handleIceRestart",value:function(e){e.prevIceCandidatePair=this.prevActiveIceCandidatePair,"new"!==e.prevIceConnectionState&&(d.log("iceRestarted sending"),this.established=!1,this.emb.make(c.internalFabricEvent.iceRestarted,this.conferenceId,this.pc,e))}},{key:"handleSignallingState",value:function(){var e,t,n=this;this.signalingState!==this.pc.signalingState&&(e=this.signalingState,this.signalingState=this.pc.signalingState,d.warn("CALLBACK: signaling state change",e,"->",this.signalingState),e={changedState:c.fabricStateChangeType.signalingState,prevState:e,newState:this.signalingState},this.sendFabricStateChange(e),"have-remote-offer"!==this.signalingState&&"stable"!==this.signalingState||(this.precalltest.callStarts(),u.Registry.getPCTRunnerService().setCallInProgress(!0),this.genericevent.sendEvent(c.logEvents.log,{msg:"precalltest told to stop "})),"closed"===this.signalingState&&(this.emb.make(c.fabricEvent.fabricTerminated,this.conferenceId,this.pc),this.userAlive.stop(),this.precalltest.callFinished(),u.Registry.getPCTRunnerService().setCallInProgress(!1),this.stopStatsPolling(),this.stopPCStateMonitoring(),this.pcState=c.fabricState.terminated,this.conferenceId&&((e=u.Registry.getConferenceManager().get(this.conferenceId))&&e.getPeerConnectionManager()&&(t=e.getPeerConnectionManager().getPcHandler(this.pc),e.getPeerConnectionManager().removePcStats(t&&t.getPcHash())),e.updateState())),"have-local-offer"!==this.signalingState&&"have-local-pranswer"!==this.signalingState&&"stable"!==this.signalingState||(d.log(this.signalingState,".. requesting sender config."),u.Registry.getConfigServiceWrapper().initiateSenderConfig(this.pc).then(function(){var e=u.Registry.getConfigServiceWrapper().getSenderConfig(),t=(d.log("Sender config:",e),c.callstatsChannels.senderConfiguration);e&&u.Registry.getEventMessageBuilder().make(t,n.conferenceId,n.pc,e)}).catch(function(e){d.warn(e)})))}},{key:"pcNegotiationNeededCallback",value:function(e){e&&(this.negotiationNeeded++,this.startTime=l.getCurrent(),d.warn("CALLBACK: negotiation needed",this.negotiationNeeded))}}])&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}();n.PcCallbackHandler=e},{"../config/callstatserrors":49,"../config/constants":50,"../utility/csiologger":119,"../utility/registry":128,"../utility/timestamps":132}],57:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.PeerConnectionHandler=void 0;var c=e("../utility/registry"),r=e("../peerconnection/pccallbackhandler"),i=e("../browserapi/devices"),o=e("./useralivehandler"),s=e("./getstatshandler"),u=p(e("../config/constants")),l=p(e("../utility/timestamps")),d=p(e("../utility/csiologger"));function f(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(f=function(e){return e?n:t})(e))}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=f(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){t&&y(e.prototype,t),n&&y(e,n),Object.defineProperty(e,"prototype",{writable:!1})}e=function(){function n(e){h(this,n),this.pc=e.pc,this.remoteId=e.remoteId,this.fabricUsage=e.fabricUsage,this.callback=e.callback,this.conferenceId=e.conferenceId,this.remoteEndpointType=e.remoteEndpointType,this.fabricTransmissionDirection=e.fabricTransmissionDirection,this.clocksync=c.Registry.getClockSync(),this.startTime=this.clocksync.getSynchronizedTimestamp(),this.credentials=c.Registry.getCredentials(),this.pcHash=this.generatePcHash(),this.ssrcMap=new Map,this.localSdp=null,this.remoteSdp=null,this.transportInfo=null,this.userAliveHandler=new o.UserAliveHandler(this.conferenceId,this.pc),this.userAliveHandler.start(),this.emb=c.Registry.getEventMessageBuilder(),this.devices=new i.Devices(this.conferenceId,this.pc);var t=c.Registry.getEndpoint();this.getStatsHandler=new s.GetStatsHandler(this.pc,this.pcHash,e.interval,t.getCodeBase(),t.getBrowserName()),this.pcCallbackHandler=new r.PcCallbackHandler(this.conferenceId,this.pc,this.getStatsHandler,this.userAliveHandler,this.remoteId,this.callback),this.devices.collectConnected(),this.fabricTransmissionDirection||(this.fabricTransmissionDirection="sendrecv"),this.remoteEndpointType||(this.remoteEndpointType="peer"),this.ttfmSentSSRCs=[],this.isMuted=!1,this.videoElemTag=null}return v(n,[{key:"getFabricTransmissionDirection",value:function(){return this.fabricTransmissionDirection}},{key:"getRemoteEndpointType",value:function(){return this.remoteEndpointType}},{key:"stopUserAliveHandler",value:function(){this.userAliveHandler.stop()}},{key:"getPcState",value:function(){return this.pcCallbackHandler.getPcState()}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"stopPCStateMonitoring",value:function(){this.pcCallbackHandler.stopPCStateMonitoring()}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"setPcState",value:function(e){e in u.fabricState?this.pcCallbackHandler.pcState=e:d.error("setPcState: Invalid state")}},{key:"setAudioMuted",value:function(e){this.isMuted=e}},{key:"getAppId",value:function(){return this.credentials.getAppId()}},{key:"getLocalId",value:function(){return this.credentials.getUserId()}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getPeerConnection",value:function(){return this.pc}},{key:"getRemoteId",value:function(){return this.remoteId}},{key:"isFabricSetupSent",value:function(){return this.pcCallbackHandler.isFabricSetupSent()}},{key:"getStartTime",value:function(){return this.startTime}},{key:"getCallback",value:function(){return this.callback}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getIceCandidates",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceCandidates:null}},{key:"getIceConnectionState",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceConnectionState:null}},{key:"getNegotiationsNumber",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.negotiationNeeded:0}},{key:"sendFabricTransportSwitch",value:function(e){this.pcCallbackHandler&&this.pcCallbackHandler.sendFabricTransportSwitch(e)}},{key:"getSdp",value:function(){return{localSdp:this.localSdp,remoteSdp:this.remoteSdp}}},{key:"setSdp",value:function(e,t){this.localSdp=e,this.remoteSdp=t}},{key:"generatePcHash",value:function(){var e=(Math.random()+1).toString(36);return e.substring(2,e.length)}},{key:"getTransportInfo",value:function(){return this.transportInfo}},{key:"setTransportInfo",value:function(e){this.transportInfo=e}},{key:"updateSDP",value:function(e){var t,n,r=this;if(this.pc&&this.pc.localDescription&&(t=this.pc.localDescription.sdp),this.pc&&this.pc.remoteDescription&&(n=this.pc.remoteDescription.sdp),t&&n&&(t!==this.localSdp||n!==this.remoteSdp)){this.parseSDP(t,u.streamType.outbound),this.parseSDP(n,u.streamType.inbound);for(var i={localSDP:t!==this.localSdp?t:"",remoteSDP:n!==this.remoteSdp?n:""},o=(""===t&&""===remoteSDP||!c.Registry.getCredentials().getCollectSDP()||this.emb.make(u.internalFabricEvent.sdpSubmission,this.conferenceId,this.pc,i),e&&e.forEach(function(e){var t=String(e.data.ssrc),n=r.ssrcMap.get(t);(n=n||{}).mediaType=e.data.mediaType,n.reportType=e.reportType,n.ssrc=t,r.ssrcMap.set(t,n)}),[]),a=(this.ssrcMap.forEach(function(e,t){e.msid&&e.mslabel&&e.label&&o.push(e)}),{ssrcData:o}),s=0;s<a.ssrcData.length;s+=1)a.ssrcData[s].userID=c.Registry.getCredentials().getUserId();this.emb.make(u.internalFabricEvent.ssrcMap,this.conferenceId,this.pc,a),this.setSdp(t,n)}}},{key:"parseSDP",value:function(e,o){var a=this,t=RegExp.prototype.test.bind(/^([a-z])=(.*)/),s=/^ssrc:(\d*) ([\w_]*):(.*)/,c=/^ssrc-group:SIM (\d*)/;e.split(/(\r\n|\r|\n)/).filter(t).forEach(function(e){var t,n,r,i=e[0],e=e.slice(2);"a"===i&&s.test(e)&&(t=(i=e.match(s))[1],n=i[2],i=i[3],(r=(r=a.ssrcMap.get(t))||{}).ssrc=t,r[n]=i,r.localStartTime=l.getCurrent(),r.syncedStartTime=a.clocksync.getSynchronizedTimestamp(),r.streamType=o,c.test(e)&&(r.ssrcGroup={},r.ssrcGroup[o]={},r.ssrcGroup[o].simulcastGroup=e.match(/\d+/g)),a.ssrcMap.set(t,r))})}},{key:"getSSRCInfo",value:function(e){return this.ssrcMap.get(e)}},{key:"setupVideoTagMethods",value:function(e,t){var n=this,r=document.getElementById(e);r&&(n.videoElemTag=e,r.addEventListener&&(r.addEventListener("canplay",function(){var e;n.ttfmSentSSRCs.includes(String(t))||(e={ssrc:String(t),highResTs:c.Registry.getClockSync().getSynchronizedTimestamp()},n.ttfmSentSSRCs.push(String(t)),n.emb.make(u.internalFabricEvent.mediaPlaybackStart,n.conferenceId,n.pc,e))}),r.addEventListener("suspend",function(){var e={ssrc:String(t),highResTs:c.Registry.getClockSync().getSynchronizedTimestamp()};n.emb.make(u.internalFabricEvent.mediaPlaybackSuspended,n.conferenceId,n.pc,e)})))}},{key:"updateSSRCInfo",value:function(e,t,n,r){var i=this.ssrcMap.get(e);(i=i||{}).ssrc=e,i.remoteUserID=t,i.usageLabel=n,i.associatedVideoTag=r,this.ssrcMap.set(e,i),r&&t!==this.credentials.getUserId()&&this.setupVideoTagMethods(r,e)}},{key:"updateConferenceId",value:function(e){this.conferenceId=e,this.userAliveHandler.updateConferenceId(e)}},{key:"updateRemoteId",value:function(e){this.remoteId=e}}],[{key:"Builder",get:function(){return function(){function e(){h(this,e)}return v(e,[{key:"withPc",value:function(e){return this.pc=e,this}},{key:"withInterval",value:function(e){return this.interval=e,this}},{key:"withRemoteId",value:function(e){return this.remoteId=e,this}},{key:"withFabricUsage",value:function(e){return this.fabricUsage=e,this}},{key:"withConferenceId",value:function(e){return this.conferenceId=e,this}},{key:"withRemoteEndpointType",value:function(e){return this.remoteEndpointType=e,this}},{key:"withFabricTransmissionDirection",value:function(e){return this.fabricTransmissionDirection=e,this}},{key:"withCallback",value:function(e){return this.callback=e,this}},{key:"make",value:function(){return new n(this)}}]),e}()}}]),n}();n.PeerConnectionHandler=e},{"../browserapi/devices":33,"../config/constants":50,"../peerconnection/pccallbackhandler":56,"../utility/csiologger":119,"../utility/registry":128,"../utility/timestamps":132,"./getstatshandler":55,"./useralivehandler":59}],58:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.PeerConnectionManager=void 0;var c=e("./peerconnectionhandler"),u=e("../utility/registry"),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.pcHandlers=new Map}var t,n,r;return t=e,(n=[{key:"removePcHandler",value:function(e){var e=this.getPcHandler(e);e&&(e=e.getPcHash(),this.pcHandlers.delete(e))}},{key:"removePcStats",value:function(e){e&&u.Registry.getStatsMonitor().delete(e)}},{key:"addPcHandler",value:function(e,t,n,r,i,o,a){var s;this.getPcHandler(e)||(s=5e3,u.Registry.getCredentials().isAdaptiveStatsEnabled()&&(s=1e3),e=(new c.PeerConnectionHandler.Builder).withPc(e).withRemoteId(t).withFabricUsage(n).withConferenceId(r).withRemoteEndpointType(i).withFabricTransmissionDirection(o).withCallback(a).withInterval(s).make(),this.pcHandlers.set(e.getPcHash(),e))}},{key:"getPcHandler",value:function(n){var r=null;return n&&this.pcHandlers.forEach(function(e,t){e&&e.getPeerConnection()===n&&(r=e)}),r}},{key:"getPcHandlerByHash",value:function(e){return e&&this.pcHandlers.has(e)?this.pcHandlers.get(e):null}},{key:"getPeerConnectionStatus",value:function(){return this.pcHandlers.forEach(function(e,t){if(e.getPcState()!==i.fabricState.terminated)return e.getPcState()}),i.fabricState.terminated}},{key:"updateConferenceId",value:function(n){this.pcHandlers.forEach(function(e,t){e.updateConferenceId(n)})}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.PeerConnectionManager=e},{"../config/constants":50,"../utility/registry":128,"./peerconnectionhandler":57}],59:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.UserAliveHandler=void 0;var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants")),r=e("../utility/timeoutprocess"),s=e("../utility/registry");function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=i(n),t=(e=r?(e=i(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e=function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e);var n,r=d(i);function i(e,t){var n;if(this instanceof i)return(n=r.call(this,1e4)).emb=s.Registry.getEventMessageBuilder(),n.pc=t,n.conferenceId=e,n.setCallback(n.send),n;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"send",value:function(){this.conferenceId!==o.tmpConferenceId&&this.pc&&this.emb.make(o.internalFabricEvent.userAlive,this.conferenceId,this.pc)}},{key:"updateConferenceId",value:function(e){this.conferenceId=e}}])&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.TimeoutProcess);n.UserAliveHandler=e},{"../config/constants":50,"../utility/registry":128,"../utility/timeoutprocess":131}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Authenticator=void 0;var i=e("./jwt/jwt"),o=e("./jwt/jwttoken"),s=v(e("../config/settings")),c=v(e("../utility/base64")),u=v(e("../config/callstatserrors")),l=v(e("../config/constants")),d=v(e("../browserapi/localstorage")),f=v(e("../utility/json")),p=e("./xmlhttp"),r=e("./xmlhttpservice"),h=e("../utility/registry"),y=v(e("../utility/csiologger"));function a(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(a=function(e){return e?n:t})(e))}function v(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==g(e)&&"function"!=typeof e)return{default:e};t=a(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:n):r.value}).apply(this,arguments)}function w(e,t){return(w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function S(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=k(n),t=(e=r?(e=k(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=s.authRetryTimeout,T="urn:x-callstats:auth:errorActions",e=function(e){var t=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e);var n,r=S(a);function a(){var e;if(this instanceof a)return(e=r.call(this,"Authenticator")).clockSync=h.Registry.getClockSync(),e.credentials=h.Registry.getCredentials(),e.generateTurnCredentials=!1,e;throw new TypeError("Cannot call a class as a function")}return t=a,(e=[{key:"initiate",value:function(e,r,t,i){var o=this;return this.inProgress?(i&&i(u.csError.authOngoing,null),new Promise(function(e,t){t(new Error("".concat(o.name,": in progress")))})):e&&t?(this.appId=e,"object"===g(t)?this.userId=t.aliasName:this.userId=t,this.initCallback=i,"function"==typeof r?(this.setTokenGenerator(r),b(k(a.prototype),"initiate",this).call(this)):new Promise(function(t,n){o.createTokenGenerator(r).then(function(e){o.setTokenGenerator(e),b(k(a.prototype),"initiate",o).call(o).then(function(){t()},function(e){n(e)})},function(e){i&&i(u.csError.authError,e.toString()),n(new Error("".concat(o.name,": tokenGenerator creation problem (").concat(e,")")))})})):new Promise(function(e,t){t(new Error("".concat(o.name,": Empty credentials")))})}},{key:"setGenerateTurnCredentials",value:function(e){this.generateTurnCredentials=e}},{key:"getToken",value:function(){var e=null;return e=this.token?this.token.getToken():e}},{key:"getTaasEnabled",value:function(){var e=!1;return e=this.token?this.token.getTaasEnabled():e}},{key:"isTokenValid",value:function(){return!!this.token&&this.token.isValid(this.credentials)}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"getIceServers",value:function(){return this.iceServers}},{key:"getTurnServers",value:function(){return this.turnServers}},{key:"reset",value:function(){this.token=null,this.reauthTimer=null,this.renew=!1,this.credentials=null,this.jwt=new i.Jwt,this.tokenGenerator=function(e,t){t("Token generator is not set")},this.elapsed=0,this.iceServers=null,this.turnServers=null,b(k(a.prototype),"reset",this).call(this)}},{key:"setupToken",value:function(e){d.store("csio_auth_data",JSON.stringify(e)),this.token=new o.JwtToken(e,this.clockSync)}},{key:"clearReauthTimer",value:function(){null!==this.reauthTimer&&(clearTimeout(this.reauthTimer),this.reauthTimer=null)}},{key:"setupReauthTimer",value:function(e){var t=this;t.clearReauthTimer(),t.reauthTimer=setTimeout(function(){t.reAuthenticate()},e)}},{key:"reAuthenticate",value:function(){this.inProgress||(this.inProgress=!0,this.token=null,this.sendRequest())}},{key:"handleErrorActions",value:function(e){var t,n;0!==e.length&&((t=e.shift()).action===u.authErrorActions.RETRY&&(n=t.params.timeout||s.authRetryTimeout,this.setupReauthTimer(n),this.handleErrorActions(e)),t.action===u.authErrorActions.GET_NEW_TOKEN&&(this.renew=!0,this.handleErrorActions(e)),t.action===u.authErrorActions.REPORT_ERROR&&(y.error("".concat(this.name,": ").concat(t.params.errorReason)),this.initCallback&&this.initCallback(u.csError.authError,"".concat(this.name,": ").concat(t.params.errorReason)),this.handleErrorActions(e)))}},{key:"setTokenGenerator",value:function(e){this.tokenGenerator=e}},{key:"handleResponse",value:function(e){var t=e.getXhr(),e=e.getElapsed(),n=f.parse(t.response);n?n[T]&&0<n[T].length?this.handleErrorActions(n[T]):200===t.status?"bearer"!==n.token_type?(y.error("".concat(this.name,": successful, but token type was not bearer. Scheduling retry.")),this.sendNextRequest()):(this.setupToken(n.access_token),n.iceServers&&(this.iceServers=n.iceServers),n.turnServers&&(this.turnServers=n.turnServers),n.metadata&&n.metadata.urls&&!window.csioproxy&&(this.backendURLs=n.metadata.urls,this.backendURLs.events&&s.setRestEventUrl(this.backendURLs.events+"/"),this.backendURLs.stats&&s.setRestStatsUrl(this.backendURLs.stats+"/"),this.backendURLs.config&&s.setConfigServiceUrl(this.backendURLs.config+"/")),t=parseInt(1e3*parseInt(n.expires_in)*.9),this.setupReauthTimer(t),this.renew=!1,this.initCallback&&this.initCallback(u.csError.success,l.csCallBackMessages.authSuccessful),this.elapsed=e,this.completeProcess()):(y.error("Authentication failed, but no error actions were defined in response."),this.sendNextRequest()):(y.error("".concat(this.name,": invalid authentication response")),this.sendNextRequest())}},{key:"request",value:function(){var n=this,e=(this.clearReauthTimer(),new Promise(function(e,t){n.tempResolve=e,n.tempReject=t}));return this.tokenGenerator(this.renew,function(e,t){if(null!==e)return n.initCallback&&n.initCallback(u.csError.tokenGenerationError,e.toString()),n.rejectCb(new Error(n.name+": tokenGenerationError")),y.error("tokenGenerationError ",e),null;e=s.authServiceUrl+"authenticate",t={client_id:n.userId+"@"+n.appId,code:t,grant_type:"authorization_code"};(0,p.sendPostRequest)(e,{"Content-Type":"application/x-www-form-urlencoded"},C,t).then(function(e){n.tempResolve(e)},function(e){n.tempReject(e)})}),e}},{key:"tokenGeneratorCreator",value:function(r,i){var o=this;return function(e,t){var n=null;if(!e&&null!==n)return t(null,n);e={userID:o.userId,appID:o.appId,generateTurnCredentials:o.generateTurnCredentials};i&&(e.keyId=i),o.jwt.sign({alg:"HS256"},e,r).then(function(e){t(null,n=e)}).catch(function(e){t(e)})}}},{key:"createTokenGenerator",value:function(i){var o=this;return new Promise(function(t,n){var r=null;-1<i.indexOf(":")&&(r=c.strtohex(i.split(":")[0]),i=i.split(":")[1]),o.jwt.importKey(i).then(function(e){i=null;e=o.tokenGeneratorCreator(e,r);t(e)}).catch(function(e){y.error("".concat(o.name,": could not import key (").concat(e,")")),n(e)})})}}])&&m(t.prototype,e),n&&m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(r.XMLHttpService);n.Authenticator=e},{"../browserapi/localstorage":34,"../config/callstatserrors":49,"../config/constants":50,"../config/settings":51,"../utility/base64":116,"../utility/csiologger":119,"../utility/json":125,"../utility/registry":128,"./jwt/jwt":69,"./jwt/jwttoken":70,"./xmlhttp":75,"./xmlhttpservice":76}],61:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.GenericEventHandler=void 0;var s=r(e("../config/settings")),c=e("./xmlhttp"),i=e("../utility/registry"),o=r(e("../utility/csiologger"));function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.credentials=i.Registry.getCredentials(),this.enabled=!1}var t,n,r;return t=e,(n=[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"sendEvent",value:function(e,t){this.send(e,t).then(function(e){o.log("Got generic response: %o",e)}).catch(function(e){o.log("Got error for generic request",e)})}},{key:"send",value:function(i,o){var a;return this.enabled?(a=this,new Promise(function(t,n){var e={appID:a.credentials.appId,userID:encodeURIComponent(a.credentials.userId),version:s.version,eventType:i,data:o},r=s.collectorUrl+"generics";(0,c.sendPostRequest)(r,{"Content-Type":"application/json"},5e3,e).then(function(e){t(e.getXhr().response)},function(e){n(e)})})):new Promise(function(e,t){t(new Error("GenericEvent Error: not enabled"))})}}])&&l(t.prototype,n),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.GenericEventHandler=e},{"../config/settings":51,"../utility/csiologger":119,"../utility/registry":128,"./xmlhttp":75}],62:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.ClockSync=void 0;var o=i(e("../config/settings")),s=e("./xmlhttp"),c=i(e("../utility/timestamps")),r=e("./xmlhttpservice"),u=e("../utility/registry"),l=i(e("../config/constants"));function d(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(d=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=d(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:n):r.value}).apply(this,arguments)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function y(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=v(n),t=(e=r?(e=v(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e=function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e);var n,r=y(i);function i(){var e;if(this instanceof i)return(e=r.call(this,"ClockSync")).currentOffset=0,e.completed=!1,e;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"initiate",value:function(){return this.startTime=c.getCurrent(),p(v(i.prototype),"initiate",this).call(this)}},{key:"getSynchronizedTimestamp",value:function(){return c.getCurrent()+this.currentOffset}},{key:"getElapsed",value:function(){return this.isCompleted()?this.endTime-this.startTime:null}},{key:"getOffset",value:function(){return this.currentOffset}},{key:"reset",value:function(){this.currentOffset=0,this.offsetResults=[],this.startTime=0,this.endTime=0,p(v(i.prototype),"reset",this).call(this)}},{key:"request",value:function(){var e=o.collectorUrl+"clockSync";return(0,s.sendGetRequest)(e,null,5e3)}},{key:"handleResponse",value:function(e){var t=e.getXhr(),e=e.getElapsed(),t=JSON.parse(t.response),n=c.getCurrent();this.handleMessage(t,e,n)}},{key:"handleMessage",value:function(e,t,n){t/=2;6e4<t?(u.Registry.getGenericEventHandler().sendEvent(l.logEvents.log,{msg:"latency > MAX_ALLOWED_LATENCY: clockSync reset"}),this.offsetResults=[]):this.addOffset(e,t,n),5<=this.offsetResults.length?(this.calculateOffset(),this.endTime=c.getCurrent(),this.completeProcess()):this.sendRequest()}},{key:"isCompleted",value:function(){return this.completed}},{key:"addOffset",value:function(e,t,n){e=e.now+t;this.offsetResults.push(e-n)}},{key:"calculateOffset",value:function(){var e=this.offsetResults.reduce(function(e,t){return e+t});this.currentOffset=e/this.offsetResults.length,this.currentOffset=isNaN(this.currentOffset)?0:this.currentOffset,u.Registry.getGenericEventHandler().sendEvent(l.logEvents.log,{msg:"clockSync Done, offset is: "+this.currentOffset+"results length"+this.offsetResults.length}),this.offsetResults=[],this.completed=!0}}])&&f(t.prototype,e),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.XMLHttpService);n.ClockSync=e},{"../config/constants":50,"../config/settings":51,"../utility/registry":128,"../utility/timestamps":132,"./xmlhttp":75,"./xmlhttpservice":76}],63:[function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.CollectorConnection=void 0;var r=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.connected=!1,this.reconnected=!1,this.conferenceUrl={}}var t,n,r;return t=e,(n=[{key:"setup",value:function(){return new Promise(function(e,t){e()})}},{key:"isReady",value:function(){return this.connected}},{key:"send",value:function(e){}}])&&i(t.prototype,n),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.CollectorConnection=r},{}],64:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServiceGet=void 0;var o=e("../xmlhttp"),r=e("../xmlhttpservice"),a=e("../../utility/registry");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:n):r.value}).apply(this,arguments)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=d(n),t=(e=r?(e=d(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e=function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var n,r=l(i);function i(){if(this instanceof i)return r.call(this,"ConfigService");throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"initiate",value:function(e){var n=this;return this.url=e,this.authToken=a.Registry.getAuthenticator().getToken(),this.authToken?c(d(i.prototype),"initiate",this).call(this):new Promise(function(e,t){t(new Error("".concat(n.name,": authToken has to be string")))})}},{key:"getConfig",value:function(){return this.config}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"reset",value:function(){this.authToken=null,this.url=null,this.config=null,this.elapsed=0,c(d(i.prototype),"reset",this).call(this)}},{key:"request",value:function(){var e={Authorization:"Bearer "+this.authToken};return(0,o.sendGetRequest)(this.url,e,2e3)}},{key:"handleResponse",value:function(e){var t=e.getXhr(),e=e.getElapsed();this.config=JSON.parse(t.response),this.elapsed=e,this.completeProcess()}}])&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.XMLHttpService);n.ConfigServiceGet=e},{"../../utility/registry":128,"../xmlhttp":75,"../xmlhttpservice":76}],65:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServicePost=void 0;var o=e("../xmlhttp"),e=e("./configserviceget");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:n):r.value}).apply(this,arguments)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=l(n),t=(e=r?(e=l(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e=function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e);var n,r=u(i);function i(){if(this instanceof i)return r.call(this);throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"initiate",value:function(e,t){return this.body=t,s(l(i.prototype),"initiate",this).call(this,e)}},{key:"request",value:function(){var e={Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"};return(0,o.sendPostRequest)(this.url,e,2e3,this.body)}}])&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(e.ConfigServiceGet);n.ConfigServicePost=e},{"../xmlhttp":75,"./configserviceget":64}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServiceWrapper=void 0;var i=e("./configserviceget"),o=e("./configservicepost"),a=r(e("../../config/settings")),s=e("../../utility/registry"),c=r(e("../../utility/csiologger"));function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==l(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.internalConfigService=new i.ConfigServiceGet,this.appConfigService=new i.ConfigServiceGet,this.senderConfigService=new o.ConfigServicePost,this.defaultSenderConfig=null}var t,n,r;return t=e,(n=[{key:"initiateInternalConfig",value:function(){var n=this,e=s.Registry.getCredentials().getAppId();return e?(e=a.configServiceUrl+e,this.internalConfigService.initiate(e+"/configurations/internal")):new Promise(function(e,t){c.log("appId has to be string"),t(new Error("".concat(n.internalConfigService.name,": appId has to be string")))})}},{key:"initiateAppConfig",value:function(){var n=this,e=s.Registry.getCredentials().getAppId();return e?(e=a.configServiceUrl+e,this.appConfigService.initiate(e+"/configurations")):new Promise(function(e,t){c.log("appId has to be string"),t(new Error("".concat(n.appConfigService.name,": appId has to be string")))})}},{key:"initiateSenderConfig",value:function(e){var t,n,r=this;return this.senderConfigService.getConfig()?new Promise(function(e,t){c.log("sender config already present"),t(new Error("".concat(r.senderConfigService.name,": sender config already present")))}):(n=s.Registry.getCredentials().getAppId(),t=s.Registry.getCredentials().getUserId(),n&&t?(this.defaultSenderConfig=this.getCurrentVideoSenderConfig(e),this.defaultSenderConfig?(e=a.configServiceUrl+n,n={app_id:n,local_id:t,rtc_rtp_parameters:this.defaultSenderConfig},this.senderConfigService.initiate(e+"/configurations",n)):new Promise(function(e,t){c.log("Could not obtain a sender config"),t(new Error("".concat(r.senderConfigService.name,": Could not obtain a sender config")))})):new Promise(function(e,t){c.log("appId and userId have to be string"),t(new Error("".concat(r.senderConfigService.name,": appId and userId have to be string")))}))}},{key:"getInternalConfig",value:function(){return this.internalConfigService.getConfig()}},{key:"getAppDefaultConfig",value:function(){var e=this.appConfigService.getConfig(),t={peerConnection:null,media:null};return e.default&&(e.default.peerConnection&&(t.peerConnection=e.default.peerConnection),e.default.media&&(t.media=e.default.media)),t}},{key:"getAppRecommendedConfig",value:function(){var e=this.appConfigService.getConfig(),t={};return e.recommended&&(e.recommended.peerConnection&&(t.peerConnection=e.recommended.peerConnection),e.recommended.media&&(t.media=e.recommended.media)),t}},{key:"getSenderConfig",value:function(){var e=this.senderConfigService.getConfig();return e&&e.recommended&&e.recommended.sender?e.recommended.sender:null}},{key:"getDefaultSenderConfig",value:function(){return this.defaultSenderConfig||null}},{key:"getInternalElapsed",value:function(){return this.internalConfigService.getElapsed()}},{key:"getAppElapsed",value:function(){return this.appConfigService.getElapsed()}},{key:"getSenderElapsed",value:function(){return this.senderConfigService.getElapsed()}},{key:"getCurrentVideoSenderConfig",value:function(e){var t={encodings:[{maxBitrate:0}]},n=s.Registry.getConferenceManager().getConferenceForPc(e);if(!n)return c.warn("No conference found for PC, skipping"),null;if(1<n.getPeerConnectionManager().pcHandlers.size)return c.warn("Multiple PCs found, skipping"),null;if(!e.getSenders||"function"!=typeof e.getSenders)return c.warn("Get senders error"),t;for(var r,i=e.getSenders(),o=0;o<i.length;o+=1){var a=i[o];if("object"!==l(a)||!a.track||"object"!==l(a.track)||!a.track.kind)return c.warn("Access senders error"),null;if("video"===a.track.kind){if(r)return c.warn("Multiple video sender, skipping"),null;r=a}}return r?r.getParameters&&"function"==typeof r.getParameters?"object"!==l(n=r.getParameters())?null:("encodings"in n||(n.encodings=[]),0===n.encodings.length&&n.encodings.push({maxBitrate:0}),n):(c.warn("Sender getParameters error"),t):(c.warn("No video sender found"),null)}}])&&d(t.prototype,n),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.ConfigServiceWrapper=e},{"../../config/settings":51,"../../utility/csiologger":119,"../../utility/registry":128,"./configserviceget":64,"./configservicepost":65}],67:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionManager=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants")),o=e("./restcollectorconnection"),s=e("../utility/registry");function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.connection=null}var t,n,r;return t=e,(n=[{key:"setupCollectorConnection",value:function(){this.connection=new o.RestCollectorConnection}},{key:"setup",value:function(){return this.connection?this.connection.setup():new Promise(function(e,t){t()})}},{key:"isReady",value:function(){return!!this.connection&&this.connection.isReady()}},{key:"send",value:function(e){this.connection?this.connection.send(e):s.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"Connection not available to the collector"})}}])&&u(t.prototype,n),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.ConnectionManager=e},{"../config/constants":50,"../utility/registry":128,"./restcollectorconnection":72}],68:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.JabraService=void 0;var i=r(e("../utility/timestamps")),o=r(e("../config/constants")),s=e("../utility/registry"),c=r(e("../utility/csiologger")),u=r(e("@gnaudio/jabra-browser-integration"));function l(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(l=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.isTxSpeechStarted=!1,this.isRxSpeechStarted=!1,this.isCrossTalkStarted=!1,this.conferenceID=null,this.started=!1,this.eventList=[],this.statsList=[]}var t,n,r;return t=e,(n=[{key:"sendJabraActiveState",value:function(e,t){void 0===e&&void 0===t||(!this.isTxSpeechStarted&&e?this.isTxSpeechStarted=!0:!1===e&&this.isTxSpeechStarted&&(this.isTxSpeechStarted=!1,this.isCrossTalkStarted||this.sendCustomEvent("agentSpeakingStop")),!this.isRxSpeechStarted&&t?this.isRxSpeechStarted=!0:!1===t&&this.isRxSpeechStarted&&(this.isRxSpeechStarted=!1,this.isCrossTalkStarted||this.sendCustomEvent("contactSpeakingStop")),this.isTxSpeechStarted&&this.isRxSpeechStarted?this.isCrossTalkStarted=!0:this.isCrossTalkStarted&&(this.isTxSpeechStarted||this.isRxSpeechStarted)&&(this.isCrossTalkStarted=!1,this.sendCustomEvent("crossTalkStop")),this.isCrossTalkStarted?this.sendCustomEvent("crossTalkStart"):this.isTxSpeechStarted?this.sendCustomEvent("agentSpeakingStart"):this.isRxSpeechStarted&&this.sendCustomEvent("contactSpeakingStart"))}},{key:"sendCustomStats",value:function(e,t){this.conferenceID&&(e&&(e={name:"noiseDb",value:e,timestamp:i.getCurrent()},this.statsList.push(e)),t&&(e={name:"exposureDb",value:t,timestamp:i.getCurrent()},this.statsList.push(e)),40<=this.statsList.length&&(s.Registry.getEventMessageBuilder().make(o.customEvents.stats,this.conferenceID,null,{stats:this.statsList}),this.statsList=[]))}},{key:"sendCustomEvent",value:function(e){this.conferenceID&&(e={type:e,timestamp:i.getCurrent(),source:"Jabra"},this.eventList.push(e),10===this.eventList.length&&(s.Registry.getEventMessageBuilder().make(o.customEvents.event,this.conferenceID,null,{eventList:this.eventList}),this.eventList=[]))}},{key:"initJabraEventListeners",value:function(){var i=this;u&&(u.addEventListener("device attached",function(){console.log("Jabra - device attached")}),u.addEventListener("mute",function(e){i.sendCustomEvent("mute")}),u.addEventListener("unmute",function(e){i.sendCustomEvent("unmute")}),u.addEventListener("devlog",function(e){var t=void 0,n=e.data["TX Acoustic Logging Level"],n=(void 0!==n&&(t=parseInt(n)),void 0),r=e.data["RX Acoustic Logging Level"],r=(void 0!==r&&(n=parseInt(r)),i.sendCustomStats(t,n),e.data.ID),t=("VOLUP TAP"===r?i.sendCustomEvent("volumeUp"):"VOLDOWN TAP"===r&&i.sendCustomEvent("volumeDown"),e.data["Mute State"]),n=("TRUE"===t?i.sendCustomEvent("mute"):"FALSE"===t&&i.sendCustomEvent("unmute"),e.data["Boom Position Guidance OK"]),r=("TRUE"===n?i.sendCustomEvent("boomArmPositionOk"):"FALSE"===n&&i.sendCustomEvent("boomArmPositionNotOk"),void 0),t=e.data.Speech_Analysis_TX,n=(void 0!==t&&(r="true"===t.toString().toLowerCase()),void 0),t=e.data.Speech_Analysis_RX;void 0!==t&&(n="true"===t.toString().toLowerCase()),i.sendJabraActiveState(r,n)}))}},{key:"initJabraService",value:function(){u&&u.init().then(function(){return u.getInstallInfo()}).then(function(e){e.installationOk?c.log("CallstatsJabraShim: Jabra Installation check succeded"):c.log("CallstatsJabraShim: Browser SDK Installation incomplete. Please (re)install")}).catch(function(e){e&&c.log(e.name+": "+e.message)})}},{key:"startJabraMonitoring",value:function(e){this.started||(this.started=!0,e?(c.info("startJabraMonitoring starting"),this.eventList=[],this.statsList=[],this.conferenceID=e,this.initJabraEventListeners()):c.error("CallstatsJabraShim: Cannot startJabraMonitoring/Invalid Arguments"))}},{key:"stopJabraMonitoring",value:function(){this.started=!1,0<this.eventList.length&&(s.Registry.getEventMessageBuilder().make(o.customEvents.event,this.conferenceID,null,{eventList:this.eventList}),this.eventList=[]),0<this.statsList.length&&(s.Registry.getEventMessageBuilder().make(o.customEvents.stats,this.conferenceID,null,{stats:this.statsList}),this.statsList=[]),this.conferenceID=null,this.isTxSpeechStarted=!1,this.isRxSpeechStarted=!1,this.isCrossTalkStarted=!1}}])&&d(t.prototype,n),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.JabraService=e},{"../config/constants":50,"../utility/csiologger":119,"../utility/registry":128,"../utility/timestamps":132,"@gnaudio/jabra-browser-integration":1}],69:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Jwt=void 0;var l=r(e("../../utility/base64")),d=r(e("../../utility/csiologger")),i=e("../../utility/registry"),f=r(e("../../config/constants"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.cryptotype=null,window.crypto&&window.crypto.subtle?(this.cryptotype="standard",this.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(this.cryptotype="webkit",this.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(this.cryptotype="ie",this.subtlecrypto=window.msCrypto.subtle):(this.subtlecrypto=null,d.info("WebCryptography API not supported in this browser.")),this.browserName=i.Registry.getEndpoint().getBrowserName()}var t,n,r;return t=e,(n=[{key:"sign",value:function(a,s,c){var u=this;return new Promise(function(n,r){"HS256"!==a.alg&&r("Use header.alg=HS256"),a=JSON.stringify(a),"string"!=typeof s&&(s=JSON.stringify(s));var t=l.urlencodeUnicode(a)+"."+l.urlencodeUnicode(s),e=(window.csioReactNative&&window.csiosign(t,c,function(e,t){e?(d.log("Token sign error",e),r(error)):n(t)}),new ArrayBuffer(t.length)),i=new Uint8Array(e),e={name:"HMAC"};"ie"!==u.cryptotype&&"webkit"!==u.cryptotype&&u.browserName!==f.browserName.edge||(e.hash={name:"sha-256"});for(var o=t.length-1;0<=o;o--)i[o]=t.charCodeAt(o);e=u.subtlecrypto.sign(e,c,i);"ie"===u.cryptotype?(e.onerror=r,e.oncomplete=function(e){t=u.buildToken(e.target.result,t),n(t)}):e.then(function(e){t=u.buildToken(e,t),n(t)}).catch(function(e){r(e)})})}},{key:"buildToken",value:function(e,t){for(var n="",r=new Uint8Array(e),i=r.byteLength,o=0;o<i;o++)n+=String.fromCharCode(r[o]);return t+="."+l.urlencode(n)}},{key:"decode",value:function(e){try{var t=e.split(".")[1],n=l.decode(t);return JSON.parse(n)}catch(e){return d.error("Could not decode token. "),null}}},{key:"importKey",value:function(a){var s=this;return new Promise(function(t,e){if(window.csioReactNative)t(a);else{if("webkit"===s.cryptotype)for(;a.length<32;)a+="\0";var n={kty:"oct",k:l.urlencode(a),alg:"HS256"},r={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===s.cryptotype?n.extractable=!1:n.ext=!1,"webkit"===s.cryptotype&&(r=null,n.use="sig"),"ie"===s.cryptotype||"webkit"===s.cryptotype)for(var i=JSON.stringify(n),n=new Uint8Array(i.length),o=0;o<i.length;o++)n[o]=i.charCodeAt(o);r=s.subtlecrypto.importKey("jwk",n,r,!1,["sign"]);"ie"===s.cryptotype?(r.onerror=e,r.oncomplete=function(e){t(e.target.result)}):r.then(t).catch(e)}})}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.Jwt=e},{"../../config/constants":50,"../../utility/base64":116,"../../utility/csiologger":119,"../../utility/registry":128}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.JwtToken=void 0;var i=e("./jwt"),o=e("../../utility/registry");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.token=e,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.appId=null,this.userId=null,this.tokenPayload=null,this.jwt=new i.Jwt,this.expires=null,this.clockSync=o.Registry.getClockSync(),this.taasEnabled=!1,this.enableMLNotification=!1,this.setupTokenPayload()}var e,n,r;return e=t,(n=[{key:"getToken",value:function(){return this.token}},{key:"getTaasEnabled",value:function(){return this.taasEnabled}},{key:"setupTokenPayload",value:function(){var e,t=this.jwt.decode(this.token);t&&(this.statsSubmissionInterval=parseInt(t.submissionInterval,10),this.collectSDP=t.collectSDP,this.taasEnabled=t.taasEnabled,this.appId=t.appID,this.userId=t.userID,this.ingestedEvents=t.ingestedEvents,this.enableMLNotification=t.mlPipelineEnabled,navigator.mozGetUserMedia?(e=t.expiry.split(" ").join("T"),this.expires=Date.parse(e)):this.expires=new Date(t.expiry),o.Registry.getCredentials().setStatsSubmissionInterval(this.statsSubmissionInterval),o.Registry.getCredentials().setCollectSDP(this.collectSDP),o.Registry.getCredentials().setIngestedEvents(this.ingestedEvents),"boolean"==typeof this.enableMLNotification&&o.Registry.getCredentials().setEnableMLNotification(this.enableMLNotification))}},{key:"isValid",value:function(e){var t=!1;return t=null!==this.token&&this.appId===e.appId&&this.userId===encodeURIComponent(e.userId)&&new Date(this.clockSync.getSynchronizedTimestamp())<this.expires?!0:t}}])&&a(e.prototype,n),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();n.JwtToken=e},{"../../utility/registry":128,"./jwt":69}],71:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.PCTRunnerService=void 0;var s=e("../utility/registry"),c=r(e("../utility/pctutility")),u=r(e("../config/constants")),o=u,l=r(e("../utility/csiologger"));function d(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(d=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=d(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.interval=6e4,this.iceServers=[],this.iceServersIndex=0,this.timer=null,this.precalltest=s.Registry.getPreCallTest(),this.callInProgress=!1,this.precalltestIds=[]}var t,n,r;return t=e,(n=[{key:"handlePrecallTestResults",value:function(e,t){var n,r=s.Registry.getCallbacks().get(u.callbackFunctions.preCallTestResults),i=s.Registry.getCallbacks().get(u.callbackFunctions.preCallTest),o=s.Registry.getCallbacks().get(u.callbackFunctions.pctConnectionQualityChange);if(e&&(t||c.storePctResults(e),this.precalltestIds.push(e.id),e.tests&&e.tests.ice&&(""===e.tests.ice.turnIpAddress&&delete e.tests.ice.turnIpAddress,""===e.tests.ice.turnIpVersion&&delete e.tests.ice.turnIpVersion,""===e.tests.ice.turnTransport&&delete e.tests.ice.turnTransport),e.tests&&(e.tests.endpointInfo=s.Registry.getEndpoint().serialize()),e.tests&&(e.tests.rtt||e.tests.ice||e.tests.throughput)?e.tests.mediaConnectivity=!0:e.tests.mediaConnectivity=!1,c.addPctMeasurementToAggregator(e),a={},(n=s.Registry.getCredentials().getUserIdObject())&&(a.userName=n.userName,a.loginID=n.loginID),a.results=e,s.Registry.getEventMessageBuilder().make(u.precalltestEvents.results,null,null,a)),i&&i(e),r){if(t)return l.warn("precalltest error:",n={msg:"precalltest error: "+t}),s.Registry.getGenericEventHandler().sendEvent(u.logEvents.log,n),void r(u.callstatsAPIReturnStatus.failure,null);var a=c.getPublicPrecalltestResults(e);r(e.status,a)}s.Registry.getCredentials().getEnableMLNotification()&&o&&e&&e.mlNotification&&e.mlNotification.sendFlag&&(i={timestamp:Date.now(),notificationID:e.id},e.mlNotification.notification&&null!==e.mlNotification.notification&&(i.notification=e.mlNotification.notification.text,i.notificationCode=e.mlNotification.notification.code),e.mlNotification.connectivity&&null!==e.mlNotification.connectivity&&(i.connectivity=e.mlNotification.connectivity.text,i.connectivityCode=e.mlNotification.connectivity.code),e.mlNotification.status&&null!==e.mlNotification.status&&(i.status=e.mlNotification.status.text,i.statusCode=e.mlNotification.status.code),e.mlNotification.summary&&null!==e.mlNotification.summary&&(i.summary=e.mlNotification.summary.text,i.summaryCode=e.mlNotification.summary.code),e.tests.ice&&(i.localIp=e.tests.ice.localIP,i.networkType=e.tests.ice.localIPNetworkType),i.clearNotification=e.mlNotification.clearNotification,o(i),e.mlNotification.clearNotification||this.sendMLNotificationEvent(e))}},{key:"sendMLNotificationEvent",value:function(e){var t={},n=s.Registry.getCredentials().getUserIdObject();n&&(t.userName=n.userName,t.loginID=n.loginID),t.notification=e.mlNotification,t.notificationID=e.id,t.endpointInfo=s.Registry.getEndpoint().serialize(),e.tests&&e.tests.ice&&(t.localIP=e.tests.ice.localIP,t.localIPNetworkType=e.tests.ice.localIPNetworkType),s.Registry.getEventMessageBuilder().make(u.precalltestEvents.notification,null,null,t)}},{key:"precalltestRunnerCallback",value:function(e,t){this.handlePrecallTestResults(e,t),this.iceServersIndex++,this.startPrecallTest()}},{key:"doPrecalltestCallback",value:function(e,t){this.handlePrecallTestResults(e,t)}},{key:"start",value:function(e,t){this.iceServers=e,this.interval=t,this.iceServersIndex=0,this.timer&&clearTimeout(this.timer),this.startPrecallTest()}},{key:"startPrecallTest",value:function(){var e,t,n,r=this,i=s.Registry.getEndpoint().serialize();i.buildName===o.browserName.safari&&i.buildVersion.startsWith("13.")||this.callInProgress||((i=this.iceServers[this.iceServersIndex])?(e={},t=i.label,"callstats-pct"===i.label?(n=s.Registry.getAuthenticator().getIceServers(),e.urls=n[0].urls,e.username=n[0].username,e.credential=n[0].credential):(e.urls=i.urls,e.username=i.username,e.credential=i.credential),n={provider:t,isRunManually:!0,runByUser:!1,enableMLNotification:s.Registry.getCredentials().getEnableMLNotification()},this.precalltest.start([e],n,this.precalltestRunnerCallback.bind(this))):((i=s.Registry.getCallbacks().get(u.callbackFunctions.connectionRecommendation))&&i(s.Registry.getPCTAggregator().getRanking()),this.timer=setTimeout(function(){r.start(r.iceServers,r.interval)},this.interval)))}},{key:"doPrecalltest",value:function(e,t,n){var r=s.Registry.getEndpoint().serialize();r.buildName===o.browserName.safari&&r.buildVersion.startsWith("13.")||(r={provider:t,isRunManually:n.isRunManually,runByUser:n.runByUser,enableMLNotification:s.Registry.getCredentials().getEnableMLNotification()},this.precalltest.start(e,r,this.doPrecalltestCallback.bind(this)))}},{key:"setCallInProgress",value:function(e){this.callInProgress=e,this.callInProgress?this.timer&&clearTimeout(this.timer):(this.iceServersIndex=0,this.startPrecallTest())}},{key:"stop",value:function(){this.timer&&clearTimeout(this.timer),this.interval=6e4,this.iceServers=[],this.iceServersIndex=0,this.timer=null}},{key:"getPrecallTestIds",value:function(){return this.precalltestIds}},{key:"resetPrecallTestIds",value:function(){this.precalltestIds=[]}}])&&i(t.prototype,n),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.PCTRunnerService=e},{"../config/constants":50,"../utility/csiologger":119,"../utility/pctutility":127,"../utility/registry":128}],72:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.RestCollectorConnection=void 0;var s=e("../utility/registry"),c=e("./xmlhttp"),r=e("./collectorconnection"),o=e("./restrelays"),u=i(e("../config/constants")),l=i(e("../utility/csiologger"));function d(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(d=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=d(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=y(n),t=(e=r?(e=y(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e=function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e);var n,r=h(i);function i(){var e;if(this instanceof i)return(e=r.call(this)).relays=new o.RestRelays,e;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"isReady",value:function(){return!0}},{key:"send",value:function(t){var e,n={"Content-Type":"application/json",Authorization:"Bearer "+s.Registry.getAuthenticator().getToken()},r=t.eventType,i=t.confID,o=t.ucID,a=this.relays,o=a.getRequestUrl(r,i,o);o?(e=this.getMessage(r,t),l.log("sending ",o,t),(0,c.sendPostRequest)(o,n,5e3,e).then(function(e){e&&e.xhr?((e=JSON.parse(e.xhr.response))&&"success"!==e.status&&(s.Registry.getGenericEventHandler().sendEvent(u.logEvents.restResponseError,{msg:"response failure "+i+":"+r+":"+e.msg+":"+e.status+JSON.stringify(t)}),l.error("Response error:",e.msg,t),l.sendLog(u.logEvents.error,"response failure "+i+":"+r+":"+e.msg+":"+e.status+JSON.stringify(t)),"Token has expired"===e.msg&&s.Registry.getAuthenticator().reAuthenticate()),a.handleResponse(r,e,i)):l.log("Response for request is null")},function(e){l.error(e)})):l.warn("Resulting request URL is null, no action for message type: "+r)}},{key:"getMessage",value:function(e,t){delete t.confID,delete t.channel,delete t.token,delete t.appID,delete t.action,delete t.ucID,delete t.version,delete t.timeShift;var n=decodeURIComponent(t.localID),n=(t.localID=n,decodeURIComponent(t.remoteID));return t.remoteID=n,e===u.callstatsChannels.processedStats&&(t.eventType="stats"),t}}])&&f(t.prototype,e),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.CollectorConnection);n.RestCollectorConnection=e},{"../config/constants":50,"../utility/csiologger":119,"../utility/registry":128,"./collectorconnection":63,"./restrelays":73,"./xmlhttp":75}],73:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.RestRelays=void 0;var i=l(e("../config/constants")),o=l(e("../config/settings")),s=e("../utility/registry"),c=e("../utility/url"),r=l(e("../utility/csiologger"));function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){t&&f(e.prototype,t),n&&f(e,n),Object.defineProperty(e,"prototype",{writable:!1})}var e=function(){function t(){var e;d(this,t),this.items=(e=y(),new Map([[i.fabricEvent.fabricTerminated,new h(i.urlType.events,"/events/fabric/terminated",e)],[i.fabricEvent.audioMute,new h(i.urlType.events,"/events/media/actions",e)],[i.fabricEvent.audioUnmute,new h(i.urlType.events,"/events/media/actions",e)],[i.fabricEvent.videoPause,new h(i.urlType.events,"/events/media/actions",e)],[i.fabricEvent.videoResume,new h(i.urlType.events,"/events/media/actions",e)],[i.fabricEvent.screenShareStart,new h(i.urlType.events,"/events/media/actions",e)],[i.fabricEvent.screenShareStop,new h(i.urlType.events,"/events/media/actions",e)],[i.fabricEvent.activeDeviceList,new h(i.urlType.events,"/events/devices/list",e)],[i.fabricEvent.applicationErrorLog,new h(i.urlType.events,"/events/app/logs",e)],[i.fabricEvent.dominantSpeaker,new h(i.urlType.events,"/events/dominantspeaker",e)],[i.fabricEvent.fabricHold,new h(i.urlType.events,"/events/fabric/actions",e)],[i.fabricEvent.fabricResume,new h(i.urlType.events,"/events/fabric/actions",e)],[i.fabricEvent.callUnAnswered,new h(i.urlType.events,"/events/fabric/actions",e)],[i.internalFabricEvent.oneWayMediaStart,new h(i.urlType.events,"/events/fabric/disruptions",e)],[i.internalFabricEvent.oneWayMediaStop,new h(i.urlType.events,"/events/fabric/disruptions",e)],[i.internalFabricEvent.circuitBreaker,new h(i.urlType.events,"/events/fabric/disruptions",e)],[i.internalFabricEvent.fabricSetup,new h(i.urlType.events,"/events/fabric/setup",e)],[i.fabricEvent.callDetails,new h(i.urlType.events,"/events/fabric/details",e)],[i.fabricEvent.fabricSetupFailed,new h(i.urlType.events,"/events/fabric/setupfailed",e)],[i.internalFabricEvent.userJoined,new h(i.urlType.events,"",y(function(e,t){t=decodeURIComponent(t);var n=s.Registry.getConferenceManager().get(t);n&&(r.log("UcId is - ",e.ucID,t),n.setUcId(e.ucID),s.Registry.getTransmissionManager().trySend())}))],[i.internalFabricEvent.userLeft,new h(i.urlType.events,"/events/user/left",e)],[i.internalFabricEvent.userAlive,new h(i.urlType.events,"/events/user/alive",e)],[i.internalFabricEvent.fabricTransportSwitch,new h(i.urlType.events,"/events/fabric/transportchange",e)],[i.internalFabricEvent.mediaPlaybackStart,new h(i.urlType.events,"/events/media/pipeline",e)],[i.internalFabricEvent.mediaPlaybackSuspended,new h(i.urlType.events,"/events/media/pipeline",e)],[i.internalFabricEvent.mediaPlaybackStalled,new h(i.urlType.events,"/events/media/pipeline",e)],[i.internalFabricEvent.ssrcMap,new h(i.urlType.events,"/events/ssrcmap",e)],[i.internalFabricEvent.connectedDeviceList,new h(i.urlType.events,"/events/devices/list",e)],[i.internalFabricEvent.sdpSubmission,new h(i.urlType.events,"/events/sdp",e)],[i.internalFabricEvent.iceDisruptionStart,new h(i.urlType.events,"/events/ice/status",e)],[i.internalFabricEvent.iceDisruptionEnd,new h(i.urlType.events,"/events/ice/status",e)],[i.internalFabricEvent.iceConnectionDisruptionStart,new h(i.urlType.events,"/events/ice/status",e)],[i.internalFabricEvent.iceConnectionDisruptionEnd,new h(i.urlType.events,"/events/ice/status",e)],[i.internalFabricEvent.iceAborted,new h(i.urlType.events,"/events/ice/status",e)],[i.internalFabricEvent.iceTerminated,new h(i.urlType.events,"/events/ice/status",e)],[i.internalFabricEvent.iceFailed,new h(i.urlType.events,"/events/ice/status",e)],[i.internalFabricEvent.iceRestarted,new h(i.urlType.events,"/events/ice/status",e)],[i.internalFabricEvent.fabricDropped,new h(i.urlType.events,"/events/fabric/status",e)],[i.customEvents.event,new h(i.urlType.events,"/events/customevent",e)],[i.customEvents.conferenceSummary,new h(i.urlType.events,"/events/conferencesummary",e)],[i.callstatsChannels.processedStats,new h(i.urlType.stats,"/stats",e)],[i.customEvents.stats,new h(i.urlType.stats,"/customstats",e)],[i.internalFabricEvent.fabricStateChange,new h(i.urlType.events,"/events/fabric/statechange",e)],[i.callstatsChannels.userFeedback,new h(i.urlType.events,"/events/feedback",e)],[i.precalltestEvents.results,new h(i.urlType.events,"/events/precall",e)],[i.precalltestEvents.associate,new h(i.urlType.events,"/events/precall",e)],[i.precalltestEvents.notification,new h(i.urlType.events,"/events/precallnotification",e)],[i.internalFabricEvent.userDetails,new h(i.urlType.events,"/events/userdetails",e)]]))}return p(t,[{key:"getRequestUrl",value:function(e,t,n){return this.items.has(e)?this.items.get(e).getRequestUrl(e,t,n):(r.warn("EventType Unsupported ",e),null)}},{key:"handleResponse",value:function(e,t,n){this.items.has(e)?this.items.get(e).handleResponse(t,n,e):r.warn("No response handler for event type "+e)}}]),t}(),h=(n.RestRelays=e,function(){function r(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;d(this,r),this.baseUrlType=e,this.urlAppendix=t,this.responseHandler=n}return p(r,[{key:"getRequestUrl",value:function(e,t,n){return o.restEventUrl&&o.restStatsUrl?(this.makeRequestUrl(e,t,n),this.requestUrl.toString()):null}},{key:"makeRequestUrl",value:function(e,t,n){var r=this.baseUrlType===i.urlType.events?o.restEventUrl:o.restStatsUrl;e===i.precalltestEvents.results||e===i.precalltestEvents.notification?this.requestUrl=new c.Url(r,s.Registry.getCredentials().getAppId(),this.urlAppendix):(e===i.internalFabricEvent.userJoined&&n&&(n=""),this.requestUrl=new c.Url(r,s.Registry.getCredentials().getAppId()+"/conferences/"+t,n,this.urlAppendix))}},{key:"handleResponse",value:function(e,t,n){this.responseHandler(e,t,n)}}]),r}());function y(e,t){var r=0<arguments.length&&void 0!==e?e:null,i=1<arguments.length&&void 0!==t?t:null;return function(e,t,n){"success"===e.status?r&&r(e,t):i&&i(e)}}},{"../config/constants":50,"../config/settings":51,"../utility/csiologger":119,"../utility/registry":128,"../utility/url":133}],74:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.TransmissionManager=void 0;var i=r(e("../utility/timestamps")),o=e("../collections/cache"),s=e("../utility/registry"),c=r(e("../config/constants")),u=r(e("../utility/csiologger"));function l(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(l=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.cache=[],this.connectionManager=s.Registry.getConnectionManager(),this.lastTS=0,this.timerStarted=!1,this.lastUserAliveTS={}}var t,n,r;return t=e,(n=[{key:"send",value:function(e){(e.isCachable()||e.canBeSent())&&(this.cache[e.getConferenceId()]||(this.cache[e.getConferenceId()]=new o.Cache),this.cache[e.getConferenceId()].add(e,e.isPriority()),this.trySend())}},{key:"trySend",value:function(){this.connectionManager.isReady()?this.timerStarted||(this.timeToSend()?this.sendMessage()&&this.startTimer():0<this.getCacheLength()&&this.startTimer()):this.setupConnection()}},{key:"setupConnection",value:function(){this.connectionManager.setup().then(function(){u.log("Connected to connectionManager")}).catch(function(e){return u.log("Could not connect to connectionManager",e)})}},{key:"canSendUserAlive",value:function(e,t){return!this.lastUserAliveTS[t]||!(e-this.lastUserAliveTS[t]<9e3)}},{key:"eventCanBeSent",value:function(e,t){var n=[c.internalFabricEvent.circuitBreaker,c.internalFabricEvent.oneWayMediaStart,c.internalFabricEvent.oneWayMediaStop,c.fabricEvent.applicationErrorLog,c.internalFabricEvent.sdpSubmission,c.callstatsChannels.userFeedback,c.fabricEvent.activeDeviceList,c.internalFabricEvent.connectedDeviceList,c.fabricEvent.dominantSpeaker,c.internalFabricEvent.mediaPlaybackStart,c.internalFabricEvent.mediaPlaybackSuspended,c.precalltestEvents.results,c.precalltestEvents.associate],r=[c.precalltestEvents.results,c.precalltestEvents.associate];if(!n.includes(e))return!0;n=s.Registry.getCredentials().getIngestedEvents();if(r.includes(e)){if(e===c.precalltestEvents.results){r=!(!t||!t.results)&&t.results.runManually;if(r&&n.includes("precallTestResultsManual"))return!0;if(!r&&n.includes("precallTestResultsAutomatic"))return!0}else if(e===c.precalltestEvents.associate&&n.includes("precallTestResultsAutomatic"))return!0;return!1}return!(e!==c.callstatsChannels.userFeedback||!n.includes("userFeedback"))||!!n.includes(e)}},{key:"sendMessage",value:function(){var e,t,n;if(0===this.getCacheLength())return!1;for(n in this.cache)if(this.cache.hasOwnProperty(n)&&(t=n,(e=this.cache[t].peak())&&e.canBeSent()))break;if(!e||!e.canBeSent())return!1;if(e=this.cache[t].pop(),this.lastTS=i.getCurrent(),e.eventType===c.internalFabricEvent.userAlive){if(!this.canSendUserAlive(this.lastTS,t))return!0;this.lastUserAliveTS[t]=this.lastTS}var r=e.toJson();return this.eventCanBeSent(e.eventType,r)?(u.log("sending message type :",e.eventType,r),this.connectionManager.send(r)):u.log("Not sending message type :",e.eventType,r),!0}},{key:"startTimer",value:function(){var e=this;this.timerStarted||0!=this.getCacheLength()&&(this.timerStarted=!0,setTimeout(function(){e.timerStarted=!1,e.trySend()},200))}},{key:"timeToSend",value:function(){return i.getCurrent()>=this.lastTS+200}},{key:"getCacheLength",value:function(){var e,t=0;for(e in this.cache)this.cache.hasOwnProperty(e)&&(t+=this.cache[e].length());return t}},{key:"updateConferenceId",value:function(e){var t=c.tmpConferenceId;this.cache[t]&&this.cache[t].updateConferenceId(e)}}])&&d(t.prototype,n),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.TransmissionManager=e},{"../collections/cache":37,"../config/constants":50,"../utility/csiologger":119,"../utility/registry":128,"../utility/timestamps":132}],75:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.sendGetRequest=function(e,t,n){return o("GET",e,t,n,null)},n.sendPostRequest=function(e,t,n,r){return o("POST",e,t,n,r)};var h=r(e("../utility/timestamps")),y=r(e("../config/constants")),v=e("../utility/registry");function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.xhr=e,this.elapsed=t}var e,t,r;return e=n,(t=[{key:"getXhr",value:function(){return this.xhr}},{key:"getElapsed",value:function(){return this.elapsed}}])&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();function o(u,l,d,f,p){return new Promise(function(t,e){var n,r,i=new XMLHttpRequest,o=v.Registry.getEndpoint().getBrowserName();if(i){for(var a in n=h.getCurrent(),i.open(u,l),o!==y.browserName.msie&&(i.timeout=f),d)d.hasOwnProperty(a)&&i.setRequestHeader(a,d[a]);o=null;if("POST"===u){if("application/x-www-form-urlencoded"===d["Content-Type"]){var s,c=[];for(s in p)p.hasOwnProperty(s)&&c.push(encodeURIComponent(s)+"="+encodeURIComponent(p[s]));o=c.join("&")}"application/json"===d["Content-Type"]&&(o=JSON.stringify(p))}i.onload=function(){r=h.getCurrent();var e=new g(i,r-n);t(e)},i.ontimeout=function(){e(new Error("connection timeout"))},i.onreadystatechange=function(){4===i.readyState&&0===i.status&&e(new Error("no server response received"))},i.send(o)}else e(new Error("creating instance failed"))})}},{"../config/constants":50,"../utility/registry":128,"../utility/timestamps":132}],76:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.XMLHttpService=void 0;var s=e("../utility/sigmoid"),r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../utility/csiologger"));function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"XMLHttpService",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1e4,r=this,i=o;if(!(r instanceof i))throw new TypeError("Cannot call a class as a function");this.name=e,this.minRetryTimeout=t,this.sigmoid=new s.Sigmoid(n-t,15,.5),this.reset()}var e,t,n;return e=o,(t=[{key:"reset",value:function(){this.inProgress=!1,this.completed=!1,this.resolveCb&&this.rejectCb(new Error("".concat(this.name,": resetting"))),this.resolveCb=null,this.rejectCb=null}},{key:"initiate",value:function(){var e,n=this;return this.inProgress?new Promise(function(e,t){t(new Error("".concat(n.name,": in progress")))}):(e=new Promise(function(e,t){n.resolveCb=e,n.rejectCb=t}),this.inProgress=!0,this.sendRequest(),e)}},{key:"isCompleted",value:function(){return this.completed}},{key:"handleSendError",value:function(e){r.log("".concat(this.name,": send next request (").concat(e,")")),this.sendNextRequest()}},{key:"handleResponseProxy",value:function(e){this.handleResponse(e),this.resetTimeout()}},{key:"handleResponse",value:function(e){r.error("".concat(this.name,": handleResponse() not implemented")),this.completeProcess()}},{key:"completeProcess",value:function(){this.inProgress=!1,this.completed=!0,this.resolveCb.apply(this,arguments)}},{key:"request",value:function(){return r.error("".concat(this.name,": request() not implemented!")),new Promise(function(e,t){e()})}},{key:"sendRequest",value:function(){var e;!this.inProgress||(e=this.request())&&e.then(this.handleResponseProxy.bind(this),this.handleSendError.bind(this))}},{key:"sendNextRequest",value:function(){setTimeout(this.sendRequest.bind(this),this.getTimeout())}},{key:"resetTimeout",value:function(){this.sigmoid.reset()}},{key:"getTimeout",value:function(){return this.minRetryTimeout+this.sigmoid.getActual()}}])&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}();n.XMLHttpService=e},{"../utility/csiologger":119,"../utility/sigmoid":130}],77:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.CircuitBreakerEvent=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.circuitBreakerType=e,this.ssrc=t}var e,t,r;return e=n,r=[{key:"isBadTrack",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return!t||(!(e=t.getRequestedMeasurement())||e.getReportType()===i.reportType.remote&&t.getStreamType()===i.streamType.outbound)}}],(t=[{key:"getCircuitBreakerType",value:function(){return this.circuitBreakerType}},{key:"getContent",value:function(){return{disruptionType:this.circuitBreakerType,ssrc:this.ssrc.toString()}}}])&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();n.CircuitBreakerEvent=e},{"../config/constants":50}],78:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.IntervalStatsMonitor=void 0;var r=u(e("../utility/timestamps")),i=u(e("../config/constants")),o=u(e("./validator")),s=["ssrc","streamType","reportType"];function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function d(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function f(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],0<=t.indexOf(n)||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),o=0;o<i.length;o++)n=i[o],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function p(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?h(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t,n){t&&v(e.prototype,t),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1})}var m=function(){function t(e){y(this,t),this.hasMultipleRecords=!1,this.currentStats=e,this.previousStats=e,this.previousCallBackStats=e,this.previousStatsTime=r.getCurrent(),this.previousCallBackStatsTime=r.getCurrent()}return g(t,[{key:"setCurrent",value:function(e){this.currentStats=e,this.hasMultipleRecords=!0}},{key:"outdate",value:function(e){e===i.statsDestination.backend?(this.previousStats=this.currentStats,this.previousStatsTime=r.getCurrent()):(this.previousCallBackStats=this.currentStats,this.previousCallBackStatsTime=r.getCurrent())}},{key:"getCurrent",value:function(){return this.currentStats}},{key:"multipleRecords",value:function(){return this.hasMultipleRecords}},{key:"getPrevious",value:function(e){return e===i.statsDestination.backend?this.previousStats:this.previousCallBackStats}},{key:"getElapsedTime",value:function(e){return r.getCurrent()-(e===i.statsDestination.backend?this.previousStatsTime:this.previousCallBackStatsTime)}}]),t}(),e=function(){function e(){y(this,e),this.measurementsHolderMap=new Map}return g(e,[{key:"set",value:function(e,t){this.measurementsHolderMap.has(e)?this.measurementsHolderMap.get(e).setCurrent(t):(t=new m(t),this.measurementsHolderMap.set(e,t))}},{key:"delete",value:function(e){e&&this.measurementsHolderMap.has(e)&&this.measurementsHolderMap.delete(e)}},{key:"getIntervalStats",value:function(e){for(var t=new Map,n=p(this.measurementsHolderMap.keys()),r=0,i=n.length;r<i;r+=1){var o,a=n[r],s=this.measurementsHolderMap.get(a);s&&(o=this.getIntervalStat(s,e),t.set(a,o),s.outdate(e))}return t}},{key:"getTotalBytes",value:function(e){e=e.getStreamType()===i.streamType.inbound?e.getReceivedBytes():e.getSentBytes();return o.checkForPositiveValue(e)?e:null}},{key:"getTotalPackets",value:function(e){e=e.getStreamType()===i.streamType.inbound?e.getReceivedPackets():e.getSentPackets();return o.checkForPositiveValue(e)?e:null}},{key:"getTotalLostPackets",value:function(e){e=e.getLostPackets();return o.checkForPositiveValue(e)?e:null}},{key:"getIntervalBitrate",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,e=this.getTotalBytes(e),t=this.getTotalBytes(t);return o.checkForPositiveValue(e)&&o.checkForPositiveValue(t)&&o.checkForPositiveValue(n)&&(e=(8*e-8*t)/Math.max(n,1),o.checkForPositiveValue(e))?e:null}},{key:"getIntervalPacketLoss",value:function(e,t,n){e=this.getTotalLostPackets(e);return n?(n=this.getTotalLostPackets(t),o.checkForPositiveValue(e)&&o.checkForPositiveValue(n)&&o.checkForPositiveValue(t=e-n)?t:null):o.checkForPositiveValue(e)?e:null}},{key:"getIntervalPacketRate",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return o.checkForPositiveValue(n)&&(e=this.getTotalPackets(e),t=this.getTotalPackets(t),!(!o.checkForPositiveValue(e)<0)&&o.checkForPositiveValue(t)&&(e=(e-t)/(Math.max(n,1)/1e3),o.checkForPositiveValue(e)))?e:null}},{key:"getIntervalFractionLost",value:function(e,t,n){n=this.getIntervalPacketLoss(e,t,n),e=this.getTotalPackets(e)-this.getTotalPackets(t);return o.checkForPositiveValue(n)&&o.checkForPositiveValue(e)&&(t=n/Math.max(e+n,1),o.checkForPositiveValue(t))?t:null}},{key:"getIntervalStat",value:function(n,e){var r=this,i=n.getPrevious(e),o=n.getCurrent();if(!i||!o)return[];for(var a=[],s=n.getElapsedTime(e),t=0,c=o.length;t<c;t+=1)!function(e){var t=o[e],e=i.find(function(e){return e.getSSRC()===t.getSSRC()&&e.getStreamType()===t.getStreamType()&&e.getReportType()===t.getReportType()});e&&(e={csioIntMs:s,csioIntBRKbps:r.getIntervalBitrate(t,e,s),csioIntPktLoss:r.getIntervalPacketLoss(t,e,n.multipleRecords()),csioIntPR:r.getIntervalPacketRate(t,e,s),csioIntFL:r.getIntervalFractionLost(t,e,n.multipleRecords()),ssrc:t.getSSRC(),streamType:t.getStreamType(),reportType:t.getReportType()},a.push(e))}(t);return a}}],[{key:"mergeIntervalStats",value:function(e,i){for(var t=0,n=e.length;t<n;t+=1){var o=e[t];i.has(o.pcHash)&&!function(){var e=i.get(o.pcHash)||[],t=o.ssrc||o.data&&o.data.ssrc,n=o.streamType||o.streamType&&o.data.streamType,r=o.reportType||o.reportType&&o.data.reportType,e=e.find(function(e){return e.ssrc===t&&e.streamType===n&&e.reportType===r});e&&(o.data=d(d({},o.data),function(e){e.ssrc,e.streamType,e.reportType;return f(e,s)}(e)))}()}return e}}]),e}();n.IntervalStatsMonitor=e},{"../config/constants":50,"../utility/timestamps":132,"./validator":114}],79:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Measurement=void 0;var r=e("./resolution"),P=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("./validator"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function T(){if(!(this instanceof T))throw new TypeError("Cannot call a class as a function");this.pcHash=null,this.ssrc=null,this.streamType=null,this.mediaType=null,this.reportType=null,this.resolution=null,this.frameRateReceived=null,this.frameHeight=null,this.frameWidth=null,this.droppedFramesNum=null,this.framesReceived=null,this.rtt=null,this.jitter=null,this.lostPackets=-1,this.receivedPackets=-1,this.sentPackets=-1,this.discardedPackets=-1,this.sentBytes=-1,this.receivedBytes=-1,this.fractionLost=-1,this.googEchoCancellationReturnLoss=-1,this.googEchoCancellationReturnLossEnhancement=-1,this.track=null}var e,t,n;return e=T,n=[{key:"make",value:function(e,t,n,r,i,o,a,s,c,u,l,d,f,p,h,y,v,g,m,b,w,S){function k(e,t){-1===[void 0,null].indexOf(t)&&(C[e]=t)}var C=new T;return k("pcHash",e),k("ssrc",t),k("streamType",n),k("mediaType",r),k("reportType",i),k("frameRateReceived",o),k("frameHeight",P.checkForNan(parseInt(a,10))),k("frameWidth",P.checkForNan(parseInt(s,10))),k("droppedFramesNum",c),k("framesReceived",u),k("rtt",l),k("jitter",d),k("lostPackets",f),k("receivedPackets",p),k("sentPackets",h),k("discardedPackets",y),k("sentBytes",v),k("receivedBytes",g),k("fractionLost",m),k("googEchoCancellationReturnLoss",b),k("googEchoCancellationReturnLossEnhancement",w),k("track",S),C.setFrameRateReceived(o),C}}],(t=[{key:"getPcHash",value:function(){return this.pcHash}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getReportType",value:function(){return this.reportType}},{key:"getResolution",value:function(){return this.resolution?this.resolution.toString():null}},{key:"getFrameRateReceived",value:function(){return this.frameRateReceived}},{key:"getFrameHeight",value:function(){return this.frameHeight}},{key:"getFrameWidth",value:function(){return this.frameWidth}},{key:"getDroppedFramesNum",value:function(){return this.droppedFramesNum}},{key:"getFramesReceived",value:function(){return this.framesReceived}},{key:"setFrameRateReceived",value:function(e){this.frameRateReceived=e,void 0!==this.frameRateReceived&&void 0!==this.frameWidth&&void 0!==this.frameHeight&&0<this.frameWidth&&0<this.frameHeight?this.resolution=new r.Resolution(this.frameWidth,this.frameHeight,this.frameRateReceived):this.resolution=null}},{key:"getJitter",value:function(){return this.jitter}},{key:"getRTT",value:function(){return this.rtt}},{key:"getLostPackets",value:function(){return this.lostPackets}},{key:"getDiscardedPackets",value:function(){return this.discardedPackets}},{key:"getReceivedPackets",value:function(){return this.receivedPackets}},{key:"getSentPackets",value:function(){return this.sentPackets}},{key:"getSentBytes",value:function(){return this.sentBytes}},{key:"getReceivedBytes",value:function(){return this.receivedBytes}},{key:"setFractionLost",value:function(e){this.fractionLost=void 0===e?null:e}},{key:"getFractionLost",value:function(){return this.fractionLost}},{key:"getGoogEchoCancellationReturnLoss",value:function(){return this.googEchoCancellationReturnLoss}},{key:"getGoogEchoCancellationReturnLossEnhancement",value:function(){return this.googEchoCancellationReturnLossEnhancement}},{key:"extractTrack",value:function(){var e=this.track;return this.track=null,e}},{key:"toString",value:function(){return"pcHash: "+this.pcHash+", ssrc: "+this.ssrc+", streamType: "+this.streamType+", mediaType: "+this.mediaType+", reportType: "+this.reportType+", frameRateReceived: "+this.frameRateReceived+", frameHeight: "+this.frameHeight+", frameWidth: "+this.frameWidth+", droppedFramesNum: "+this.droppedFramesNum+", rtt: "+this.rtt+", jitter: "+this.jitter+", lostPackets: "+this.lostPackets+", receivedPackets: "+this.receivedPackets+", sentPackets: "+this.sentPackets+", discardedPackets: "+this.discardedPackets+", sentBytes: "+this.sentBytes+", receivedBytes: "+this.receivedBytes+", fractionLost: "+this.fractionLost+", googEchoCancellationReturnLoss: "+this.googEchoCancellationReturnLoss+", googEchoCancellationReturnLossEnhancement: "+this.googEchoCancellationReturnLossEnhancement}}])&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),T}();n.Measurement=e},{"./resolution":98,"./validator":114}],80:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.AvDeSyncHolder=void 0;var i=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=this,o=a;if(!(i instanceof o))throw new TypeError("Cannot call a class as a function");this.audioSsrc=e,this.videoSsrc=t,this.estimatedAudioDelay=n,this.estimatedVideoDelay=r}var e,t,n;return e=a,(t=[{key:"getAudioSSRC",value:function(){return this.audioSsrc}},{key:"getVideoSSRC",value:function(){return this.videoSsrc}},{key:"setAudioDelay",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.audioSsrc=e,this.estimatedAudioDelay=t}},{key:"setVideoDelay",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.videoSsrc=e,this.estimatedVideoDelay=t}},{key:"getAudioDelay",value:function(){return this.estimatedAudioDelay}},{key:"getVideoDelay",value:function(){return this.estimatedVideoDelay}},{key:"getContent",value:function(){return{audioSsrc:this.audioSsrc.toString(),videoSsrc:this.videoSsrc.toString(),estimatedAudioDelay:this.estimatedAudioDelay,estimatedVideoDelay:this.estimatedVideoDelay}}}])&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}();n.AvDeSyncHolder=i},{}],81:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.AVDeSyncObserver=void 0;var d=r(e("../../config/constants")),f=r(e("../validator")),p=e("./avdesync/avdesyncholder");function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function h(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?i(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.avEstimatedDelays=new Map}var t,n,r;return t=e,(n=[{key:"isValidTrack",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return!!t&&(!!(e=t.getRequestedMeasurement())&&(e.getReportType()===d.reportType.local&&t.getStreamType()===d.streamType.inbound))}},{key:"getPCHash",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return(e=e&&e.getRequestedMeasurement())?e.getPcHash():null}},{key:"getEstimatedDelay",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return(e=e&&e.getTrack())&&e.data&&(e=parseFloat(e.data.googCurrentDelayMs),f.isNumber(e))?e:null}},{key:"isAVDeSync",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=Math.abs(e-t);return t<e?90<n:e<t&&185<n}},{key:"accept",value:function(){for(var i=this,o=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return i.isValidTrack(e)}),e=0,t=o.length;e<t;e+=1){var n=o[e],r=this.getPCHash(n),a=n.getSSRC(),s=this.getEstimatedDelay(n),r=(this.avEstimatedDelays.has(r)||this.avEstimatedDelays.set(r,new p.AvDeSyncHolder),this.avEstimatedDelays.get(r));n.getMediaType()===d.mediaType.audio?r.setAudioDelay(a,s):n.getMediaType()===d.mediaType.video&&r.setVideoDelay(a,s)}for(var c=h(this.avEstimatedDelays.values()),u=0,l=c.length;u<l;u+=1)!function(e){var t=c[e],e=t.getAudioDelay(),n=t.getVideoDelay();if(!f.isNumber(e)||!f.isNumber(n))return;var e=i.isAVDeSync(e,n),n=o.find(function(e){return e.getSSRC()===t.getAudioSSRC()}),r=o.find(function(e){return e.getSSRC()===t.getVideoSSRC()});n&&r&&(n.metrics&&(n.metrics.csioAvDesync=e),r.metrics&&(r.metrics.csioAvDesync=e))}(u)}},{key:"toString",value:function(){return"AVDeSyncObserver"}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.AVDeSyncObserver=e},{"../../config/constants":50,"../validator":114,"./avdesync/avdesyncholder":80}],82:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.CircuitBreakerObserver=void 0;var i=e("./circuitbreakerobserver/rtcptimeout/rtcptimeoutobserver"),o=e("./circuitbreakerobserver/mediatimeout/mediatimeoutobserver"),s=e("./circuitbreakerobserver/mediausability/mediausabilityobserver"),c=e("./circuitbreakerobserver/congestion/congestionobserver"),u=r(e("../../utility/timestamps")),l=e("../../utility/registry"),d=r(e("../../config/constants"));function f(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(f=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=f(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.notifierCallback=e,this.rtcpTimeoutObserver=new i.RTCPTimeoutObserver,this.mediaTimeoutObserver=new o.MediaTimoutObserver,this.mediaUsabilityObserver=new s.MediaUsabilityObserver,this.congestionObserver=new c.CongestionObserver,this.lastReportTime=u.getCurrent()}var e,n,r;return e=t,(n=[{key:"isDeadTrack",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=e&&e.getRequestedMeasurement();if(!t)return!0;if(e.getStreamType()===d.streamType.inbound){if(t.getReceivedBytes()<1)return!0}else if(t.getSentBytes()<1)return!0;return!e.lastTrack||!e.lastTrack.data||!e.lastTrack.data.mimeType&&!e.lastTrack.data.googCodecName}},{key:"accept",value:function(){var e,t,n,r,i=this,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;o&&(o=o.filter(function(e){return!1===i.isDeadTrack(e)}),e=u.getCurrent(),t=this.rtcpTimeoutObserver.check(o),n=this.mediaTimeoutObserver.check(o),r=this.mediaUsabilityObserver.check(o),o=this.congestionObserver.check(o),t&&0<t.length&&3e4<e-this.lastReportTime&&(this.lastReportTime=e,this.handleUserCallbackEvent(t),this.notifierCallback(t)),n&&0<n.length&&3e4<e-this.lastReportTime&&(this.lastReportTime=e,this.handleUserCallbackEvent(n),this.notifierCallback(n)),r&&0<r.length&&3e4<e-this.lastReportTime&&(this.lastReportTime=e,this.handleUserCallbackEvent(r),this.notifierCallback(r)),o&&0<o.length&&3e4<e-this.lastReportTime&&(this.lastReportTime=e,this.handleUserCallbackEvent(o),this.notifierCallback(o)))}},{key:"handleUserCallbackEvent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=l.Registry.getCallbacks().get(d.callbackFunctions.mediaDisruption);t&&"function"==typeof t&&e.forEach(function(e){e={type:d.mediaDisruptionCallbackType.circuitBreaker,payload:e.getContent()};t(e)})}}])&&p(e.prototype,n),r&&p(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();n.CircuitBreakerObserver=e},{"../../config/constants":50,"../../utility/registry":128,"../../utility/timestamps":132,"./circuitbreakerobserver/congestion/congestionobserver":83,"./circuitbreakerobserver/mediatimeout/mediatimeoutobserver":85,"./circuitbreakerobserver/mediausability/mediausabilityobserver":87,"./circuitbreakerobserver/rtcptimeout/rtcptimeoutobserver":89}],83:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.CongestionObserver=void 0;var o=i(e("../../../../config/constants")),s=e("../../../circuitbreakerevent"),r=i(e("../../../validator"));function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function i(){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.name="CongestionObserver"}var e,t,n;return e=i,n=[{key:"getTFRC",value:function(){var e,t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return n&&n.data&&!(n.data.csioIntFLRate<.001||n.data.csioAvgRtt<.01)&&(e=8*n.data.csioAvgPacketSize,n=n.data.csioAvgRtt*Math.sqrt(2*n.data.csioIntFLRate/3),r.checkForPositiveValue(e)&&r.checkForPositiveValue(n)&&(t=e/Math.max(n,1),r.checkForPositiveValue(t)))?t:0}},{key:"isGood",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return!(e<1)&&!((1<arguments.length&&void 0!==arguments[1]?arguments[1]:0)<=10*e)}}],(t=[{key:"check",value:function(){var r,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return e.hasTraffic()&&e.getStreamType()===o.streamType.outbound&&!1===s.CircuitBreakerEvent.isBadTrack(e)});if(!(e.length<1))return r=[],e.forEach(function(e){var t,n=e.getTrack();n&&n.data&&(t=i.getTFRC(n),i.isGood(t,n.data.csioAvgBRKbps)&&(t=new s.CircuitBreakerEvent(o.circuitBreakerDisruptionType.congestion,e.getSSRC()),r.push(t)))}),0<r.length?r:void 0}}])&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();n.CongestionObserver=e},{"../../../../config/constants":50,"../../../circuitbreakerevent":77,"../../../validator":114}],84:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MediaTimeout=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../../../../utility/timestamps"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.started=null,this.totalPackets=0}var t,n,r;return t=e,(n=[{key:"update",value:function(e){this.totalPackets=e}},{key:"getTotalPackets",value:function(){return this.totalPackets}},{key:"getStarted",value:function(){return this.started}},{key:"doReset",value:function(){this.started=null}},{key:"doStart",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;this.started=e||i.getCurrent()}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.MediaTimeout=e},{"../../../../utility/timestamps":132}],85:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MediaTimoutObserver=void 0;var o=r(e("../../../../utility/timestamps")),s=r(e("../../../../config/constants")),c=e("../../../circuitbreakerevent"),u=e("./mediatimeout");function l(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(l=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function i(){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.name="MediaTimeoutObserver",this.mediaTimeouts=new Map}var e,t,n;return e=i,n=[{key:"getTotalPackets",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return t&&(e=t.getTrack())&&e.data?t.getStreamType()===s.streamType.inbound?e.data.packetsReceived:e.data.packetsSent:0}}],(t=[{key:"observeMediaTimeout",value:function(e){var t,n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return e?(t=i.getTotalPackets(e),(n=this.mediaTimeouts.get(e.getSSRC()))?t>n.getTotalPackets()?(n.update(t,r?r.startTime:void 0),n.doReset(),null):n.getStarted()?(r?r.now:o.getCurrent())-n.getStarted()<1e4?null:new c.CircuitBreakerEvent(s.circuitBreakerDisruptionType.mediaTimeout,e.getSSRC()):(n.doStart(r?r.startTime:void 0),null):((n=new u.MediaTimeout).update(t,r?r.startTime:void 0),this.mediaTimeouts.set(e.getSSRC(),n),null)):null}},{key:"check",value:function(){var n,r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,e=e.filter(function(e){var t=e.getRequestedMeasurement();return t&&e.hasTraffic()&&t.getReportType()===s.reportType.remote&&!1===c.CircuitBreakerEvent.isBadTrack(e)});if(!(e.length<1))return n=[],e.forEach(function(e,t){e=r.observeMediaTimeout(e,i?i[t]:void 0);e&&n.push(e)}),0<n.length?n:void 0}}])&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();n.MediaTimoutObserver=e},{"../../../../config/constants":50,"../../../../utility/timestamps":132,"../../../circuitbreakerevent":77,"./mediatimeout":84}],86:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MediaUsability=void 0;var i=r(e("../../../../utility/timestamps")),o=r(e("../../../../config/constants")),s=r(e("../../../validator"));function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.flDistortedTime=null,this.rttDistortedTime=null}var t,n,r;return t=e,(n=[{key:"update",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;!e||(t=e.getTrack())&&t.data&&(this.checkFL(t.data.csioIntFLRate,e.getMediaType(),n),this.checkRTT(t.data.csioAvgRtt,e.getMediaType(),n))}},{key:"checkFL",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;s.checkForPositiveValue(e)&&(.99<e?null===this.flDistortedTime&&(this.flDistortedTime=t||i.getCurrent()):this.flDistortedTime=null)}},{key:"checkRTT",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;s.checkForPositiveValue(e)&&((t===o.mediaType.video?2e3:1500)<e?null===this.rttDistortedTime&&(this.rttDistortedTime=n||i.getCurrent()):this.rttDistortedTime=null)}},{key:"isDistorted",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,e=e||i.getCurrent();return!!(this.flDistortedTime&&5e3<e-this.flDistortedTime)||!!(this.rttDistortedTime&&15e3<e-this.rttDistortedTime)}}])&&u(t.prototype,n),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.MediaUsability=e},{"../../../../config/constants":50,"../../../../utility/timestamps":132,"../../../validator":114}],87:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MediaUsabilityObserver=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../../../../config/constants")),o=e("../../../circuitbreakerevent"),s=e("./mediausability");function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.name="MediaUsabilityObserver",this.mediaUsabilities=new Map}var t,n,r;return t=e,(n=[{key:"observeMediaUsability",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=this.mediaUsabilities.get(e.getSSRC());return n?(n.update(e,t?t.startTime:void 0),n.isDistorted(t?t.now:void 0)?new o.CircuitBreakerEvent(i.circuitBreakerDisruptionType.mediaUsability,e.getSSRC()):null):(n=new s.MediaUsability,this.mediaUsabilities.set(e.getSSRC(),n),null)}},{key:"check",value:function(){var n,r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,e=e.filter(function(e){return!1===o.CircuitBreakerEvent.isBadTrack(e)&&e.hasTraffic()});if(!(e.length<1))return n=[],e.forEach(function(e,t){e=r.observeMediaUsability(e,i?i[t]:void 0);e&&n.push(e)}),0<n.length?n:void 0}}])&&u(t.prototype,n),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.MediaUsabilityObserver=e},{"../../../../config/constants":50,"../../../circuitbreakerevent":77,"./mediausability":86}],88:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.RTCPTimeout=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../../../../utility/timestamps"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.lastApproved=null,this.lastRTCPTimestamp=null,this.networkRoundTripTime=5}var t,n,r;return t=e,(n=[{key:"update",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,t=t.getTrack();return!!t&&(!t.data.timestamp||(this.lastRTCPTimestamp?!t.data.timestamp||this.lastRTCPTimestamp<t.data.timestamp&&(e=t.data.timestamp-this.lastRTCPTimestamp,this.lastRTCPTimestamp=t.data.timestamp,this.networkRoundTripTime=.8*this.networkRoundTripTime+.2*e,this.lastApproved=n||i.getCurrent(),!0):(this.lastRTCPTimestamp=t.data.timestamp,this.lastApproved=n||i.getCurrent(),!0)))}},{key:"getLastApproved",value:function(){return this.lastApproved}},{key:"getLastRTCPTimestamp",value:function(){return this.lastRTCPTimestamp}},{key:"getNetworkRoundTripTime",value:function(){return this.networkRoundTripTime}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.RTCPTimeout=e},{"../../../../utility/timestamps":132}],89:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.RTCPTimeoutObserver=void 0;var i=r(e("../../../../utility/timestamps")),o=r(e("../../../../config/constants")),s=e("../../../circuitbreakerevent"),c=e("./rtcptimeout");function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.name="RTCPTimeoutObserver",this.rtcpTimeouts=new Map}var t,n,r;return t=e,(n=[{key:"observeRTCPTimeouts",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,r=this.rtcpTimeouts.get(t.getSSRC());return r?r.update(t,n?n.lastApproved:void 0)||(e=Math.max(3e4,5*r.getNetworkRoundTripTime()),(n?n.now:i.getCurrent())-r.getLastApproved()<e)?null:new s.CircuitBreakerEvent(o.circuitBreakerDisruptionType.RTCPTimeout,t.getSSRC()):((r=new c.RTCPTimeout).update(t,n?n.lastApproved:void 0),this.rtcpTimeouts.set(t.getSSRC(),r),null)}},{key:"check",value:function(){var n,r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,e=e.filter(function(e){var t=e.getRequestedMeasurement();return t&&e.getStreamType()===o.streamType.inbound&&t.getReportType()===o.reportType.remote});if(!(e.length<1))return n=[],e.forEach(function(e,t){e=r.observeRTCPTimeouts(e,i?i[t]:void 0);e&&n.push(e)}),0<n.length?n:void 0}}])&&l(t.prototype,n),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.RTCPTimeoutObserver=e},{"../../../../config/constants":50,"../../../../utility/timestamps":132,"../../../circuitbreakerevent":77,"./rtcptimeout":88}],90:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.CPULimitationObserver=void 0;var i=r(e("../../config/constants")),o=r(e("../../utility/timestamps"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1})}var d=function(){function e(){c(this,e),this.ewmaDiscardedPackets=0,this.ewmaLostPackets=0,this.ewmaDroppedFrames=0,this.last=0,this.noticed=0}return l(e,[{key:"test",value:function(e){var t,n,r=e.discardedPackets,i=e.lostPackets;return!(!i||i<1||!r||r<1)&&(0===this.last?(this.last=o.getCurrent(),this.ewmaLostPackets=i,this.ewmaDiscardedPackets=r,!1):(t=o.getCurrent(),n=Math.max(t-this.last,1),n=Math.min((5e3-n)/5e3,.9),e=e.droppedFrames,this.ewmaLostPackets=this.ewmaLostPackets*n+i,this.ewmaDroppedFrames=this.ewmaDroppedFrames*n+e,this.ewmaDiscardedPackets=this.ewmaDiscardedPackets*n+r,!(!e||e<1)&&(!(1<this.ewmaLostPackets||1<this.ewmaDiscardedPackets)&&(!(t-this.noticed<1e4)&&(!(this.ewmaDroppedFrames<1)&&(this.noticed=t,!0))))))}}]),e}(),e=function(){function t(e){c(this,t),this.notifyCallback=e,this.inbVideoTesters=new Map}return l(t,[{key:"accept",value:function(e){for(var t=e.filter(function(e){return e.getMediaType()===i.mediaType.video&&e.getStreamType()===i.streamType.inbound}),n=0;n<t.length;++n){var r=t[n];this.checkInboundVideo(r)}}},{key:"checkInboundVideo",value:function(e){var t=e.peek(),e=e.getSSRC();this.inbVideoTesters.has(e)||this.inbVideoTesters.set(e,new d),this.inbVideoTesters.get(e).test(t)&&(t={reason:i.limitationType.cpu,ssrc:e},this.notifyCallback(t))}},{key:"toString",value:function(){return"CPULimitationObserver"}}]),t}();n.CPULimitationObserver=e},{"../../config/constants":50,"../../utility/timestamps":132}],91:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.OneWayMediaObserver=void 0;var i=e("../onewaymediadisruption"),o=e("../../utility/registry"),s=r(e("../../config/constants")),c=r(e("../../utility/timestamps"));function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=Math.max(5,5)+5,f="STARTED",p="ENDED",h="NOOP",e=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.startTime=c.getCurrent(),this.notifierCallback=e,this.oneWayInbAudioDisruption={started:!1,disruptionCount:0,recoveryCount:0,disruption:void 0},this.oneWayOutbAudioDisruption={started:!1,disruptionCount:0,recoveryCount:0,disruption:void 0},this.browserName=o.Registry.getEndpoint().getBrowserName()}var e,n,r;return e=t,(n=[{key:"isDeadTrack",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=e&&e.getRequestedMeasurement();if(!t)return!0;if(e.getStreamType()===s.streamType.inbound){if(t.getReceivedBytes()<1)return!0}else if(t.getSentBytes()<1)return!0;return!e.lastTrack||!e.lastTrack.data||!e.lastTrack.data.mimeType&&!e.lastTrack.data.googCodecName}},{key:"isValidTrack",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s.streamType.inbound;return!!t&&(!!(e=t.getRequestedMeasurement())&&(e.getReportType()===s.reportType.local&&t.getStreamType()===n&&t.getMediaType()===s.mediaType.audio))}},{key:"handleUserCallbackEvent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=o.Registry.getCallbacks().get(s.callbackFunctions.mediaDisruption);t&&"function"==typeof t&&e.forEach(function(e){e={type:e.isStarted()?s.mediaDisruptionCallbackType.oneWayMediaStart:s.mediaDisruptionCallbackType.oneWayMediaStop,payload:e.getContent()};t(e)})}},{key:"accept",value:function(e){var t=this,n=e.filter(function(e){return t.isValidTrack(e,s.streamType.inbound)}),e=e.filter(function(e){return t.isValidTrack(e,s.streamType.outbound)}),n=this.getDisruptions(n,e);0<n.length&&(this.handleUserCallbackEvent(n),this.notifierCallback(n))}},{key:"toString",value:function(){return"DisruptionObserver"}},{key:"getDisruptedTrack",value:function(){var t=this;return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).find(function(e){return e&&!1===e.hasTraffic()&&!1===t.isDeadTrack(e)})}},{key:"isStartedAndHasTraffic",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=e.filter(function(e){return 0===e.getStartTime()}).length<1,n=e.filter(function(e){return!e.hasTraffic()}).length<1;return 0<e.length&&t&&n}},{key:"hasTracksAndTraffic",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=e.filter(function(e){return!e.hasTraffic()}).length<1;return 0<e.length&&t}},{key:"isInitialSetupDelayPassed",value:function(){return c.getCurrent()>this.startTime+15e3}},{key:"isInbOneWayAudioDisruption",value:function(e,t){if(this.isStartedAndHasTraffic(t)&&this.isInitialSetupDelayPassed())return t=void 0,this.hasTracksAndTraffic(e)||(e=(e=this.getDisruptedTrack(e))&&e.getSSRC())&&(t=new i.OneWayMediaDisruption(s.oneWayMediaTypes.audio,e,s.streamType.inbound)),t}},{key:"isOutbOneWayAudioDisruption",value:function(e,t){if(this.isStartedAndHasTraffic(e)&&this.isInitialSetupDelayPassed())return e=void 0,this.hasTracksAndTraffic(t)||(t=(t=this.getDisruptedTrack(t))&&t.getSSRC())&&(e=new i.OneWayMediaDisruption(s.oneWayMediaTypes.audio,t,s.streamType.outbound)),e}},{key:"updateDisruptionAndRecoveryCount",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return e?(t=Math.min(t+1,d),n=0):(n=Math.min(n+1,d),t=0),{disruptionCount:t,recoveryCount:n}}},{key:"getDisruptionState",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return!1===n&&5<=e?f:!0===n&&5<=t?p:h}},{key:"getAudioDisruption",value:function(e,t,n){var r=void 0,i=void 0;if(n!==s.streamType.inbound&&n===s.streamType.outbound)r=this.isOutbOneWayAudioDisruption(e,t),i=this.oneWayOutbAudioDisruption;else if(i)return e=(n=this.updateDisruptionAndRecoveryCount(r,i.disruptionCount,i.recoveryCount)).disruptionCount,t=n.recoveryCount,(n=this.getDisruptionState(e,t,i.started))===f?(i.started=!0,i.disruption=r.setStart(),i.disruptionCount=0,i.recoveryCount=0):n===p?(i.started=!1,i.disruption=i.disruption.setEnd(),i.disruptionCount=0,i.recoveryCount=0):(i.recoveryCount=t,i.disruptionCount=e),n!==h?i.disruption:void 0}},{key:"getDisruptions",value:function(e,t){var n=[],r=this.getAudioDisruption(e,t,s.streamType.inbound),e=this.getAudioDisruption(e,t,s.streamType.outbound);return r&&n.push(r),e&&n.push(e),n}}])&&l(e.prototype,n),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();n.OneWayMediaObserver=e},{"../../config/constants":50,"../../utility/registry":128,"../../utility/timestamps":132,"../onewaymediadisruption":95}],92:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.QPSumObserver=void 0;var i=o(e("../../config/constants")),r=o(e("../../utility/timestamps"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1})}var d=function(){function t(e){c(this,t),this.lastQpSum=null,this.qpAvg=null,this.noticed=0}return l(t,[{key:"test",value:function(e){var t,n,e=e.getTrack();return!!(e&&e.data&&e.data.qpSum)&&(this.lastQpSum?(n=e.data.qpSum-this.lastQpSum,this.lastQpSum=e.data.qpSum,null===this.qpAvg?this.qpAvg=n:this.qpAvg=.2*n+.8*this.qpAvg,t=Math.max(2*this.qpAvg,1),!(n<this.qpAvg+t)&&(n=r.getCurrent(),this.noticed<n-1e4)):(this.lastQpSum=e.data.qpSum,!1))}}]),t}(),e=function(){function t(e){c(this,t),this.notifyCallback=e,this.testers=new Map}return l(t,[{key:"accept",value:function(e){for(var t=0;t<e.length;++t){var n,r=e[t];r.getMediaType()===i.mediaType.video&&(n=r.getSSRC(),this.testers.has(n)||this.testers.set(n,new d(r)),this.testers.get(n).test(r)&&(n={reason:i.qualityDisruptionTypes.qpchange},this.notifyCallback(n)))}}},{key:"toString",value:function(){return"QPSumObserver"}}]),t}();n.QPSumObserver=e},{"../../config/constants":50,"../../utility/timestamps":132}],93:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.TrackMonitorTester=n.TestHelper=n.SendingTrigger=void 0;var o=r(e("../../utility/timestamps")),s=e("../../utility/runningstats"),i=r(e("../validator")),d=r(e("../../config/constants")),c=r(e("../../utility/csiologger"));function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function f(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1})}var v=function(){function i(e,t,n,r){p(this,i),t?n?r?(this.consecutivePositive=0,this.name=e,this.minThreshold=t,this.resetThreshold=r,this.runningStats=new s.RunningStats(n)):c.warn("resetThreshold was null or undefined : ".concat(r)):c.warn("windowLength was null or undefined : ".concat(n)):c.warn("minThreshold was null or undefined : ".concat(t))}return y(i,[{key:"doTest",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(null==e)return!1;this.runningStats.add(e);var n=this.runningStats.getMean(),r=this.runningStats.getStd();return!(!n||!r)&&(r=Math.max(this.minThreshold,2*r)*t,(t=Math.abs(n-e)>r)?(this.consecutivePositive+=1,this.consecutivePositive>this.resetThreshold&&this.runningStats.reset()):this.consecutivePositive=0,t)}}]),i}(),g=(n.TestHelper=v,function(){function l(e){var t=e.maxMarginFactor,t=void 0===t?d.adaptiveStatsThresholds.maxMarginFactor:t,n=e.marginReductionFactor,n=void 0===n?d.adaptiveStatsThresholds.marginReductionFactor:n,r=e.marginIncreaseFactor,r=void 0===r?d.adaptiveStatsThresholds.marginIncreaseFactor:r,i=e.marginDecreaseIntervalInMs,i=void 0===i?d.adaptiveStatsThresholds.marginDecreaseIntervalInMs:i,o=e.maxGradualCounter,o=void 0===o?d.adaptiveStatsThresholds.maxGradualCounter:o,a=e.minIntervalInMs,a=void 0===a?d.adaptiveStatsThresholds.minIntervalInMs:a,s=e.rippleBase,s=void 0===s?d.adaptiveStatsThresholds.rippleBase:s,c=e.windowSize,c=void 0===c?d.adaptiveStatsThresholds.windowSize:c,u=e.resetThreshold,u=void 0===u?d.adaptiveStatsThresholds.resetThreshold:u,e=e.minThreshold,e=void 0===e?d.adaptiveStatsThresholds.minThreshold:e;p(this,l),this.rttTester=new v("RTT Tester",e.rtt,c,u),this.throughputTester=new v("Throughput Tester",e.throughput,c,u),this.FLTester=new v("FL Tester",e.fractionalLoss,c,u),this.marginFactor=1,this.lastDecreased=0,this.lastTriggering=0,this.maxMarginFactor=t,this.marginReductionFactor=n,this.marginIncreaseFactor=r,this.marginDecreaseIntervalInMs=i,this.maxGradualCounter=o,this.gradualCounter=o,this.minIntervalInMs=a,this.rippleBase=s}return y(l,[{key:"test",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=t?{}:e.peek();if(n){var e=(t?{}:e.getTrack()).data,r=t?t.rtt:n.getRTT(),e=i.checkForNan(parseInt(t?t.throughput:e.intervalBandwidth,10)),n=t?t.loss:n.getFractionLost(),t=t?t.time:o.getCurrent(),r=this.rttTester.doTest(r,this.marginFactor),e=this.throughputTester.doTest(e,this.marginFactor),n=this.FLTester.doTest(n,this.marginFactor);if(r||e||n)return this.marginFactor=Math.min(this.marginFactor*this.marginIncreaseFactor,this.maxMarginFactor),this.lastTriggering=t,this.lastDecreased=t,!(this.gradualCounter=0);if(t-this.lastDecreased>this.marginDecreaseIntervalInMs&&(this.marginFactor=Math.max(this.marginFactor*this.marginReductionFactor,1),this.lastDecreased=t),this.gradualCounter<this.maxGradualCounter){r=this.minIntervalInMs*Math.pow(this.rippleBase,this.gradualCounter);if(this.lastTriggering<t-r)return this.lastTriggering=t,this.gradualCounter+=1,!0}}return!1}}]),l}()),e=(n.TrackMonitorTester=g,function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};p(this,n),e?(this.notifyCallback=e,this.minIntervalInMs=t.minIntervalInMs||d.adaptiveStatsThresholds.minIntervalInMs,this.maxIntervalInMs=t.maxIntervalInMs||d.adaptiveStatsThresholds.maxIntervalInMs,this.config=t,this.notified=0,this.testers=new Map):c.warn("notifyCallback was null or undefined : ".concat(e))}return y(n,[{key:"setup",value:function(e,t){this.minIntervalInMs=e,this.maxIntervalInMs=t}},{key:"getMostRecentTrackStartTime",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,t){return!!t&&("function"==typeof t.getCreationTime&&Math.max(t.getCreationTime(),e))},Number.MIN_VALUE)}},{key:"accept",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=t?t.time:o.getCurrent(),r=n-this.notified,i=this.doSend(e,t);this.minIntervalInMs===this.maxIntervalInMs?(c.log("Elapsed time in fix intervalset: "+r),r>this.minIntervalInMs&&(this.notifyCallback&&this.notifyCallback(t?n:null),this.notified=n)):r<this.minIntervalInMs||(!((e=t?void 0:this.getMostRecentTrackStartTime(e))&&n-e<d.adaptiveStatsThresholds.maxInitialTimeoutInMs&&r>d.adaptiveStatsThresholds.initialNotifyIntervalTimeoutInMs)&&r<this.maxIntervalInMs&&!1===i||(this.notifyCallback&&this.notifyCallback(t?n:null),this.notified=n))}},{key:"setIntervals",value:function(e,t){this.minIntervalInMs=e,this.maxIntervalInMs=t}},{key:"toString",value:function(){return"SendingTrigger"}},{key:"getTrackIdentifier",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;if(e){e=e.getRequestedMeasurement();if(e)return e.getSSRC()+"-"+e.getStreamType()+"-"+e.getReportType()}}},{key:"isGoodTracks",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return!!e&&(!!(e=e.getRequestedMeasurement())&&(e.getReportType()===d.reportType.local&&(e.getStreamType()===d.streamType.inbound||e.getStreamType()===d.streamType.outbound)))}},{key:"doSend",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;if(t){if(this.testers.has("test-ssrc")||this.testers.set("test-ssrc",new g(f(f({},this.config),{},{minIntervalInMs:this.minIntervalInMs,maxIntervalInMs:this.maxIntervalInMs}))),this.testers.get("test-ssrc").test(e,t))return!0}else for(var n=0;n<e.length;n+=1){var r=e[n];if(this.isGoodTracks(r)){var i=this.getTrackIdentifier(r);if(i)if(this.testers.has(i)||this.testers.set(i,new g(f(f({},this.config),{},{minIntervalInMs:this.minIntervalInMs,maxIntervalInMs:this.maxIntervalInMs}))),this.testers.get(i).test(r))return!0}}return!1}}]),n}());n.SendingTrigger=e},{"../../config/constants":50,"../../utility/csiologger":119,"../../utility/runningstats":129,"../../utility/timestamps":132,"../validator":114}],94:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.ThroughputObserver=void 0;var i=r(e("../../config/constants")),o=r(e("../../utility/timestamps"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.notifierCallback=e,this.observations=new Map}var e,n,r;return e=t,(n=[{key:"accept",value:function(e){var t,e=e.filter(function(e){return e.getMediaType()===i.mediaType.video&&e.getStreamType()===i.streamType.outbound});e.length<1||(t=this,e.forEach(function(e){t.observe(e)}))}},{key:"toString",value:function(){return"ThroughputObserver"}},{key:"getObservations",value:function(e){return this.observations.has(e)||this.observations.set(e,{ssrc:0,started:0,max:0,maxTs:0,stable:0,stableTs:0,ready:!1,maxVerified:!1,stableVerified:!1}),this.observations.get(e)}},{key:"observe",value:function(e){var t,n=e.getSSRC(),r=this.getObservations(n),i=o.getCurrent();!0!==r.ready&&(0===r.started?(r.ssrc=n,r.started=i):(e=(n=e.getTrack().data).csioIntBRKbps,t=Math.min(50,.05*e),r.max<e?(r.max=e,r.maxTs=i):1e4<i-r.maxTs&&(r.maxVerified=!0),i-r.started<15e3||(e-t<n.csioAvgBRKbps&&n.csioAvgBRKbps<e+t&&(r.stableTs=i,r.stable=e,r.stableVerified=!0),r.stableVerified&&r.maxVerified&&(n={ssrc:String(r.ssrc),maxsendingKBitrate:r.max,timeToMaxSendingKBitrate:r.maxTs-r.started,stablesendingKBitrate:r.stable,timeToStableSendingKBitrate:r.stableTs-r.started},this.notifierCallback(n),r.ready=!0))))}}])&&c(e.prototype,n),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();n.ThroughputObserver=e},{"../../config/constants":50,"../../utility/timestamps":132}],95:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.OneWayMediaDisruption=void 0;var i=function(){function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"0",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=this,o=a;if(!(i instanceof o))throw new TypeError("Cannot call a class as a function");this.mediaType=e,this.ssrc="".concat(t),this.streamType=n,this.started=r}var e,t,n;return e=a,(t=[{key:"setStart",value:function(){return this.started=!0,this}},{key:"setEnd",value:function(){return this.started=!1,this}},{key:"getContent",value:function(){return{mediaType:this.mediaType,ssrc:this.ssrc,streamType:this.streamType,disruptionType:this.streamType}}},{key:"isStarted",value:function(){return this.started}},{key:"toString",value:function(){return JSON.stringify({started:this.started,ssrc:this.ssrc,mediaType:this.mediaType,disruptionType:this.streamType})}}])&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}();n.OneWayMediaDisruption=i},{}],96:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.PcStats=void 0;var i=function(){function a(e,t,n,r,i,o){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.candidatePair=e,this.codec=t,this.pcHash=n,this.trackStats=r,this.transportStats=i,this.measurements=o}var e,t,n;return e=a,(t=[{key:"getCandidatePair",value:function(){return this.candidatePair}},{key:"getCodec",value:function(){return this.codec}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getMeasurements",value:function(){return this.measurements}}])&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}();n.PcStats=i},{}],97:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.QualityEvaluator=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function c(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function")}var t,n,r;return t=e,(n=[{key:"isAudio",value:function(e){return e&&e.data&&(e.mediaType===i.mediaType.audio||e.data.mediaType===i.mediaType.audio||e.data.csioMediaType===i.mediaType.audio)}},{key:"isVideo",value:function(e){return e&&e.data&&(e.mediaType===i.mediaType.video||e.data.mediaType===i.mediaType.video||e.data.csioMediaType===i.mediaType.video)}},{key:"isInbound",value:function(e){return e&&e.data&&(e.streamType===i.streamType.inbound||e.data.streamType===i.streamType.inbound||e.data.csioStreamType===i.streamType.inbound)}},{key:"isOutbound",value:function(e){return e&&e.data&&(e.streamType===i.streamType.outbound||e.data.streamType===i.streamType.outbound||e.data.csioStreamType===i.streamType.outbound)}},{key:"isInboundAudio",value:function(e){return this.isInbound(e)&&this.isAudio(e)}},{key:"isInboundVideo",value:function(e){return this.isInbound(e)&&this.isVideo(e)}},{key:"isOutboundAudio",value:function(e){return this.isOutbound(e)&&this.isAudio(e)}},{key:"isOutboundVideo",value:function(e){return this.isOutbound(e)&&this.isVideo(e)}},{key:"getDescendentRating",value:function(e,t){return t.green<=e?i.avQualityRatings.excellent:t.red<e?i.avQualityRatings.fair:i.avQualityRatings.bad}},{key:"getAscendingRating",value:function(e,t){return t.red<e?i.avQualityRatings.bad:t.green<=e?i.avQualityRatings.fair:i.avQualityRatings.excellent}},{key:"fromQualityString",value:function(){switch(0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.avQualityRatings.unknown){case i.avQualityRatings.bad:return i.qualityRating.bad;case i.avQualityRatings.fair:return i.qualityRating.fair;case i.avQualityRatings.excellent:return i.qualityRating.excellent}return 0}},{key:"toQualityString",value:function(){switch(0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.qualityRating.excellent){case i.qualityRating.excellent:return i.avQualityRatings.excellent;case i.qualityRating.good:case i.qualityRating.fair:case i.qualityRating.poor:return i.avQualityRatings.fair;case i.qualityRating.bad:return i.avQualityRatings.bad}return i.avQualityRatings.unknown}},{key:"inboundAudioQuality",value:function(){var e,t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data||{},n=[];return t.csioIntBRKbps&&0<t.csioIntBRKbps&&(e=this.getDescendentRating(t.csioIntBRKbps,i.throughputThreshold.audio),e=this.fromQualityString(e),n.push({result:e,weight:1})),t.csioIntFL&&0<t.csioIntFL&&(e=this.getAscendingRating(t.csioIntFL,i.fractionalLossThreshold.audio),e=this.fromQualityString(e),n.push({result:e,weight:1})),t.csioeM&&0<t.csioeM&&(e=this.getAscendingRating(t.csioeM,i.eModelThreshold.audio),t=this.fromQualityString(e),n.push({result:t,weight:1})),n}},{key:"inboundVideoQuality",value:function(){var e,t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data||{},n=[];return t.csioIntBRKbps&&0<t.csioIntBRKbps&&(e=this.getDescendentRating(t.csioIntBRKbps,i.throughputThreshold.video),e=this.fromQualityString(e),n.push({result:e,weight:1})),t.csioSig2Latency&&0<t.csioSig2Latency&&(e=this.getAscendingRating(t.csioSig2Latency,i.rttThreshold.video),e=this.fromQualityString(e),n.push({result:e,weight:1})),t.csioFrameRateMean&&t.prevFrameRateMean&&0<t.csioFrameRateMean&&0<t.csioPrevFrameRateMean&&(e=t.csioFrameRateMean/Math.max(t.csioPrevFrameRateMean,1),t=this.getDescendentRating(e,i.currOverPrevFrameRateThreshold.video),e=this.fromQualityString(t),n.push({result:e,weight:1})),n}},{key:"outboundAudioQuality",value:function(){var e,t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data||{},n=[];return t.csioIntBRKbps&&0<t.csioIntBRKbps&&(e=this.getDescendentRating(t.csioIntBRKbps,i.throughputThreshold.audio),e=this.fromQualityString(e),n.push({result:e,weight:1})),t.csioeM&&0<t.csioeM&&(e=this.getAscendingRating(t.csioeM,i.eModelThreshold.audio),t=this.fromQualityString(e),n.push({result:t,weight:1})),n}},{key:"outboundVideoQuality",value:function(){var e,t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data||{},n=[];return t.csioIntBRKbps&&0<t.csioIntBRKbps&&(e=this.getDescendentRating(t.csioIntBRKbps,i.throughputThreshold.video),e=this.fromQualityString(e),n.push({result:e,weight:1})),t.csioSig2Latency&&0<t.csioSig2Latency&&(e=this.getAscendingRating(t.csioSig2Latency,i.rttThreshold.video),e=this.fromQualityString(e),n.push({result:e,weight:1})),t.csioFrameRateMean&&t.prevFrameRateMean&&0<t.csioFrameRateMean&&0<t.csioPrevFrameRateMean&&(e=t.csioFrameRateMean/t.csioPrevFrameRateMean,t=this.getDescendentRating(e,i.currOverPrevFrameRateThreshold.video),e=this.fromQualityString(t),n.push({result:e,weight:1})),n}},{key:"getOverallTrackQuality",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=0,n=0,r=0,i=e.length;r<i;r+=1)t+=e[r].weight;for(var o=0,a=e.length;o<a;o+=1){var s=e[o];n+=s.result*s.weight/Math.max(t,1)}n=Math.floor(n);return this.toQualityString(n)}},{key:"updateQualityStats",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.tracks||[],n=0,r=t.length;n<r;n+=1){var i,o,a=t[n],s=[],s=(this.isInboundAudio(a)?(i=this.inboundAudioQuality(a),s.push.apply(s,c(i))):this.isInboundVideo(a)?(i=this.inboundVideoQuality(a),s.push.apply(s,c(i))):this.isOutboundAudio(a)?(o=this.outboundAudioQuality(a),s.push.apply(s,c(o))):this.isOutboundVideo(a)&&(o=this.outboundVideoQuality(a),s.push.apply(s,c(o))),this.getOverallTrackQuality(s));a.data.csioMark=s}return e}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.QualityEvaluator=e},{"../config/constants":50}],98:[function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.Resolution=void 0;var r=function(){function r(e,t,n){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.width=e,this.height=t,this.frameRate=n}var e,t,n;return e=r,(t=[{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getFrameRate",value:function(){return this.frameRate}},{key:"toString",value:function(){return this.width&&this.height&&this.frameRate?this.width.toString()+"X"+this.height.toString()+"X"+this.frameRate.toString():null}}])&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}();n.Resolution=r},{}],99:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAdapterIO=n.StatsAdapter=void 0;var s=i(e("../config/constants")),r=e("../collections/component"),c=e("../utility/registry"),o=i(e("../config/settings")),u=i(e("../utility/hash"));function l(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(l=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function p(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=y(n),t=(e=r?(e=y(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v={RawStatsIn:"RawStatsIn",RawStatsOut:"RawStatsOut",UnprocessedOut:"UnprocessedOut"},e=(n.StatsAdapterIO=v,function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e);var n,r=p(i);function i(e,t){var n;if(this instanceof i)return(n=r.call(this,"StatsAdapter")).bindPort(v.RawStatsIn,n.receiveRawData,h(n)),n.declarePort(v.RawStatsOut),n.declarePort(v.UnprocessedOut),n.codeBase=e,n.browser=t,n;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"receiveRawData",value:function(e,t,n){if(e){n=this.extractRawStats(n),e=this.extractRawStats(e);if(e){this.mergeStats(e,n),window&&window.csioReactNative&&(e=this.removeValues(e)),this.isConnected(v.UnprocessedOut)&&this.transmit(v.UnprocessedOut,e,t);var r=this.processRawStats(e,t);if(r&&r.transportStats)for(var i=0;i<r.transportStats.length;i++)r.transportStats[i].hash=this.getTransportHash(r.transportStats[i]);r&&r.transportStats&&this.checkTransportStatsUpdates(r.transportStats,t),(r=(r=r&&r.trackStats?this.backFillTrackStats(r):r)&&r.transportStats&&r.candidatePair?this.backFillCandidatePairStats(r):r).pcHash=t,this.transmit(v.RawStatsOut,r)}}}},{key:"isCandidateRelayed",value:function(e,t){return!(!e||"relay"!==e.candidateType&&"relayed"!==e.candidateType)||!(!t||"relay"!==t.candidateType&&"relayed"!==t.candidateType)}},{key:"mergeStats",value:function(e,t){var n=["inbound-rtp","outbound-rtp"],r=["googFrameRateOutput","googFrameRateDecoded","googFrameRateReceived","googFrameRateSent","framerateMean","framesPerSecond"];if(t){for(var i,o,a=new Map,s=0;s<t.length;s++)"VideoBwe"===t[s].type?i=t[s]:(o=parseInt(t[s].ssrc,10),a.set(o,t[s]));for(var c=0;c<e.length;c++){var u=e[c].type;if(n.includes(u)){var l,u=e[c].ssrc,d=a.get(u);for(l in d)d.hasOwnProperty(l)&&(l.startsWith("goog")||"audioOutputLevel"===l||"audioInputLevel"===l?e[c][l]=d[l]:"timestamp"===l&&(e[c].legacyTimeStamp=d.timestamp)),e[c].roundTripTime||(e[c].googRtt=d.googRtt),r.includes(l)&&(e[c].legacyFrameRatePerSecond=d[l])}}i&&e.push(i)}}},{key:"getTrack",value:function(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t)return e[n];return null}},{key:"removeValues",value:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.values){for(var r=0;r<n.values.length;++r)Object.assign(n,n.values[r]);delete n.values}}return e}},{key:"getMediaTracksInfo",value:function(e){if(!e)return null;for(var t=[],n=[],r=this.extractRawStats(e),i=0;i<r.length;++i){var o=r[i],o=this.statsClassifier(o);o.tracks?t.push(o.tracks.data):o.trackStats&&n.push(o.trackStats)}for(var a=0;a<t.length;++a){var s=t[a].trackId,s=this.getTrack(n,s);s&&this.mergeObjects(t[a],s)}return t}},{key:"getIceCandidates",value:function(e){return e?(e=this.extractRawStats(e),this.processRawStatsForIceInfo(e)):{localIceCandidates:[],remoteIceCandidates:[],iceCandidatePairs:[]}}},{key:"extractRawStats",value:function(e){var t=[];if(e&&e.result)t=e.result();else if(e&&e.forEach)e.forEach(function(e){t.push(e)});else for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);for(var r=[],i=0;i<t.length;i++){var o=this.getParsedStats(t[i]);r.push(o)}var a=r.filter(function(e){return"transport"===e.type});if(!(0<a.length))for(var s,c=0;c<r.length;c++)("candidate-pair"!==r[c].type&&"candidatepair"!==r[c].type||!r[c].selected)&&("googCandidatePair"!==r[c].type||!0!==r[c].googActiveConnection&&"true"!==r[c].googActiveConnection)||((s={}).selectedCandidatePairId=r[c].id,s.id=r[c].id,this.mergeObjects(s,r[c]),s.type="transport",r.push(s));return r}},{key:"normalizeIceCandidates",value:function(e){for(var t=[],n=0;n<e.length;n+=1){var r={},i=e[n];r.transport=i.protocol||"udp",r.ip=i.ip||i.ipAddress,r.port=i.portNumber?Number(i.portNumber):i.port,r.id=i.id,r.type=i.type,r.networkType=i.networkType,r.candidateType=i.candidateType,"ssltcp"===r.transport&&(r.transport="tcp"),r.id||(r.id="csio"+i.port),r.ip||i.address&&(r.ip=i.address),r.ip&&(o.collectIP||(r.ip=i.id),t.push(r))}return t}},{key:"normalizeCanidatePairs",value:function(e){for(var t=0;t<e.length;t+=1){var n=e[t];"in-progress"===n.state&&(n.state="inprogress"),n.state||(n.state="succeeded"),n.nominated||(n.nominated="true"===n.googActiveConnection),n.priority||(n.priority=123),n.id||(n.id="csio"+n.priority)}return e}},{key:"processRawStatsForIceInfo",value:function(e){var t,n=[],r=[],i=[];if(!e)return{localIceCandidates:n,remoteIceCandidates:r,iceCandidatePairs:i};for(var o=0;o<e.length;++o){var a=e[o],a=this.statsClassifier(a);a.candidatePair?i.push(a.candidatePair):a.transportStats?"transport"===a.transportStats.type?t=a.transportStats.selectedCandidatePairId:i.push(a.transportStats):a.localCandidate?n.push(a.localCandidate):a.remoteCandidate&&r.push(a.remoteCandidate)}if(t)for(var s=0;s<i.length;++s)i[s].id===t&&(i[s].googActiveConnection="true");return{localIceCandidates:this.normalizeIceCandidates(n),remoteIceCandidates:this.normalizeIceCandidates(r),iceCandidatePairs:this.normalizeCanidatePairs(i)}}},{key:"processRawStats",value:function(e,t){for(var n,r,i={localIceCandidates:{},remoteIceCandidates:{},tracks:[],candidatePair:[],transportStats:[],trackStats:[],codec:[]},o=0;o<e.length;o++){var a=e[o],a=this.statsClassifier(a);a.tracks?i.tracks.push(a.tracks):a.candidatePair?i.candidatePair.push(a.candidatePair):a.bwe?i.bwe=a.bwe:a.trackStats?i.trackStats.push(a.trackStats):a.codec?i.codec.push(a.codec):a.localCandidate?i.localIceCandidates[a.localCandidate.id]=a.localCandidate:a.remoteCandidate&&(i.remoteIceCandidates[a.remoteCandidate.id]=a.remoteCandidate),a.transportStats&&(this.codeBase!==s.codeBaseType.firefox?(0<parseInt(a.transportStats.bytesReceived,10)||0<parseInt(a.transportStats.bytesSent,10))&&i.transportStats.push(a.transportStats):"true"!==a.transportStats.selected&&!0!==a.transportStats.selected||i.transportStats.push(a.transportStats))}return i.tracks&&((n=c.Registry.getConferenceManager().getConferenceForPcHash(t))&&(r=n.getPeerConnectionManager().getPcHandlerByHash(t)),i.tracks.forEach(function(e){var t=r.getSSRCInfo(String(e.data.ssrc));void 0!==t&&t.localStartTime||r&&(r.updateSDP(i.tracks),t=r.getSSRCInfo(String(e.data.ssrc))),t&&(e.cname=t.cname,e.msid=t.msid,e.associatedVideoTag=t.associatedVideoTag,e.usageLabel=t.usageLabel)})),i.transportStats&&this.codeBase===s.codeBaseType.firefox&&(i.transportStats=this.getAddressInfoFromCandidates(i.transportStats,i.localIceCandidates,i.remoteIceCandidates)),i}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names){for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);e.id&&(t.id=e.id)}else Object.assign(t,e);if(t.values){for(var i=0;i<t.values.length;++i)Object.assign(t,t.values[i]);delete t.values}return t}},{key:"statsClassifier",value:function(r){function e(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return-1!==t.indexOf(r.type)}var t={},n=e("inbound-rtp","inboundrtp","remote-inbound-rtp"),i=e("outbound-rtp","outboundrtp","remote-outbound-rtp"),o=r.isRemote?"true"===r.isRemote||!0===r.isRemote:null;return null===o&&(o=e("remote-inbound-rtp","remote-outbound-rtp")),n||i?(t.tracks={},t.tracks.data=r,t.tracks.ssrc=r.ssrc,t.tracks.streamType=n?"inbound":"outbound",t.tracks.reportType=o?"remote":"local"):e("localcandidate","local-candidate")?t.localCandidate=r:e("remotecandidate","remote-candidate")?t.remoteCandidate=r:e("transport")?t.transportStats=r:e("VideoBwe")?t.bwe=r:e("track")?t.trackStats=r:e("candidate-pair","candidatepair","googCandidatePair")?t.candidatePair=r:e("codec")?t.codec=r:e("ssrc")&&(t.tracks={},t.tracks.data=r,t.tracks.ssrc=r.ssrc,t.tracks.reportType="local",t.tracks.streamType=r.bytesSent?"outbound":"inbound"),t}},{key:"getAddressInfoFromCandidates",value:function(e,t,n){for(var r,i,o=0;o<e.length;o++)r=t[e[o].localCandidateId],i=n[e[o].remoteCandidateId],r&&i&&(e[o].localAddr=r.ipAddress+":"+r.portNumber,e[o].remoteAddr=i.ipAddress+":"+i.portNumber,e[o].localAddrType=r.candidateType,e[o].remoteAddrType=i.candidateType,e[o].transportType=r.transport);return e}},{key:"getTransportHash",value:function(e){var t;return e&&(this.codeBase===s.codeBaseType.chrome?e.googLocalAddress?(t=e.googLocalAddress).concat(":",e.googRemoteAddress):e.selectedCandidatePairId&&(t=e.selectedCandidatePairId):this.codeBase===s.codeBaseType.firefox&&(t=e.localAddr).concat(":",e.remoteAddr)),u.generateHash(t)}},{key:"backFillTrackStats",value:function(e){for(var t,n,r=e.tracks.length,i=0;i<r;i++)(t=e.tracks[i]).data.trackId&&(n=this.getStatsForId(e.trackStats,t.data.trackId))&&(e.tracks[i].data=this.mergeObjects(e.tracks[i].data,n)),t.data.codecId&&(n=this.getStatsForId(e.codec,t.data.codecId))&&(e.tracks[i].data=this.mergeObjects(e.tracks[i].data,n));return e}},{key:"backFillCandidatePairStats",value:function(e){for(var t,n=e.transportStats.length,r=0;r<n;r++)(t=e.transportStats[r]).selectedCandidatePairId&&(t=this.getStatsForId(e.candidatePair,t.selectedCandidatePairId))&&(e.transportStats[r]=this.mergeObjects(e.transportStats[r],t),e.transportStats[r].csioIsRelayed=this.isCandidateRelayed(e.localIceCandidates[t.localCandidateId],e.remoteIceCandidates[t.remoteCandidateId]));return e}},{key:"mergeObjects",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&"id"!==n&&"type"!==n&&(e[n]=t[n]);return e}},{key:"getStatsForId",value:function(e,t){if(e){e=e.filter(function(e){return e.id===t});if(0<e.length)return e[0]}}},{key:"formatRelayType",value:function(e){var t="None";switch(e){case 0:t="TURN/TLS";break;case 1:t="TURN/TCP";break;case 2:t="TURN/UDP"}return t}},{key:"getRelayType",value:function(n,e){var r,i=this;return e.getIceCandidates().some(function(e){var t;return!!e.typePreference&&(t=e.typePreference>>24,"rtp"===e.protocol&&e.address===n&&(0<=t&&t<=2&&(r=i.formatTypePreference(t)),!0))}),r}},{key:"getTransportInfo",value:function(e,t){for(var n={},r=!1,i=0;i<e.length;i++){var o=e[i];if(navigator.mozGetUserMedia&&"candidatepair"===o.type&&("true"===o.selected||!0===o.selected)){n.foundActive=!0,n.localAddr=o.localAddr,n.remoteAddr=o.remoteAddr,n.localAddrType=o.localAddrType,n.remoteAddrType=o.remoteAddrType,n.transportType=o.transportType,n.localCandidateId=o.localCandidateId,n.remoteCandidateId=o.remoteCandidateId;break}if("googCandidatePair"===o.type&&("true"===o.googActiveConnection||!0===o.googActiveConnection)){n.foundActive=!0,n.localAddr=o.googLocalAddress,n.remoteAddr=o.googRemoteAddress,n.localAddrType=o.googLocalCandidateType,n.remoteAddrType=o.googRemoteCandidateType,n.transportType=o.googTransportType;break}if("transport"===o.type){r=!0,o.selectedCandidatePairId&&(n.selectedCandidatePairId=o.selectedCandidatePairId);break}}return r&&n.localAddr&&(n.ipv6=0===n.localAddr.indexOf("["),n.relayType=getRelayType(n.localAddr,t)),n}},{key:"sendFabricTransportSwitch",value:function(e,t){e.sendFabricTransportSwitch(t)}},{key:"checkTransportStatsUpdates",value:function(e,t){var n=c.Registry.getConferenceManager().getConferenceForPcHash(t);!n||(n=n.getPeerConnectionManager().getPcHandlerByHash(t))&&(t=this.getTransportInfo(e,n),!(e=n.getTransportInfo())||e.localAddr===t.localAddr&&e.remoteAddr===t.remoteAddr&&e.transportType===t.transportType&&e.selectedCandidatePairId===t.selectedCandidatePairId&&e.localCandidateId===t.localCandidateId&&e.remoteCandidateId===t.remoteCandidateId||(n.setTransportInfo(t),this.sendFabricTransportSwitch(n,t.relayType)))}}])&&d(t.prototype,e),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.Component));n.StatsAdapter=e},{"../collections/component":38,"../config/constants":50,"../config/settings":51,"../utility/hash":123,"../utility/registry":128}],100:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAssemblerIO=n.StatsAssembler=void 0;e=e("../collections/component");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=u(n),t=(e=r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l={StatsTupleIn:"StatsTupleIn",CallstatsOut:"CallstatsOut"},e=(n.StatsAssemblerIO=l,function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e);var n,r=s(i);function i(){var e;if(this instanceof i)return(e=r.call(this,"StatsAssembler")).pcHashes=[],e.bindPort(l.StatsTupleIn,e.receiveStats,c(e)),e.declarePort(l.CallstatsOut),e;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"receiveStats",value:function(n){for(var r=this,e=0;e<n.tracks.length;e++)!function(e){var t=n.tracks[e];if(r.pcHashes.find(function(e){return e===t.pcHash}))return;r.pcHashes.push(t.pcHash)}(e);for(var t=n.getTransportStats(),i=0;i<this.pcHashes.length;i++){var o=this.pcHashes[i],a={};a.codec=n.getCodec(),a.trackStats=n.getTrackStats(),a.tracks=[];for(var s,c=0;c<n.tracks.length;c++){var u=n.tracks[c];u.pcHash===o&&a.tracks.push(u)}t&&t.has(o)&&((s=t.get(o))&&1===s.length?a.Transport=s[0]:a.Transport=s,this.transmit(l.CallstatsOut,o,a,n.getDestination()))}}}])&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(e.Component));n.StatsAssembler=e},{"../collections/component":38}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StatsCallbackBuilder=void 0;var i=e("../utility/registry");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.callback=null}var t,n,r;return t=e,(n=[{key:"setCallback",value:function(e){this.callback=e}},{key:"buildStats",value:function(e,t){this.callback&&this.buildFromUnifiedFormat(e,t)}},{key:"getConnectionState",value:function(){var e=!0===navigator.onLine?"online":"offline";return e}},{key:"buildConferenceUrl",value:function(e){e=e.getConferenceId(),e=i.Registry.getConferenceManager().get(e);return e?e.getUrl():null}},{key:"buildFromUnifiedFormat",value:function(e,t){var n={};n.connectionState=this.getConnectionState(),n.conferenceURL=this.buildConferenceUrl(t),n.fabricState=t.getPcState(),n.streams={},n.mediaStreamTracks=[];for(var r=0;r<e.length;r++){var i,o,a=e[r];"inbound-rtp"!==a.type&&"outbound-rtp"!==a.type&&"ssrc"!==a.type&&"inboundrtp"!==a.type&&"outboundrtp"!==a.type||(i={ssrc:a.ssrc,statsType:a.type,fractionLoss:a.csioIntFL,bitrate:a.csioIntBRKbps,quality:a.csioMark,mediaType:a.csioMediaType,jitter:a.jitter,audioOutputLevel:a.audioOutputLevel,audioIntputLevel:a.audioInputLevel,audioLevel:a.audioLevel,averageRTT:a.csioAvgRtt,averageJitter:a.csioAvgJitter,packetLossPercentage:a.csioPktLossPercentage,rtt:a.roundTripTime,packetRate:a.csioIntPR,remoteUserID:t.getRemoteId()},(o=t.getSSRCInfo(a.ssrc+""))&&(i.cname=o.cname,i.msid=o.msid,i.usageLabel=o.usageLabel,i.associatedVideoTag=o.associatedVideoTag),a.hasOwnProperty("roundTripTime")?i.rtt=a.roundTripTime:a.hasOwnProperty("googRtt")?i.rtt=a.googRtt:a.hasOwnProperty("mozRtt")&&(i.rtt=a.mozRtt),a.hasOwnProperty("jitter")?i.jitter=a.jitter:a.hasOwnProperty("googJitterReceived")&&(i.jitter=a.googJitterReceived),"inboundrtp"===i.statsType?i.statsType="inbound-rtp":"outboundrtp"===i.statsType?i.statsType="outbound-rtp":"ssrc"===i.statsType&&(0<a.id.indexOf("send")?i.statsType="outbound-rtp":i.statsType="inbound-rtp"),"remote-inbound-rtp"===i.statsType||"remote-outbound-rtp"===i.statsType||!0!==a.isRemote&&"true"!==a.isRemote||(i.statsType="remote-"+i.statsType),n.streams[a.ssrc]=i,n.mediaStreamTracks.push(i))}this.callback(n)}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.StatsCallbackBuilder=e},{"../utility/registry":128}],102:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsMonitorIO=n.StatsMonitor=void 0;var r=e("../collections/component"),o=e("./tracksmonitor"),s=e("./transportsmonitor"),c=e("./intervalstatsmonitor"),u=e("./qualityevaluator"),l=e("./statstuple"),d=e("../utility/registry"),f=e("./monitorhooks/sendingtrigger"),p=e("./monitorhooks/onewaymediaobserver"),h=e("./monitorhooks/throughputobserver"),y=e("./monitorhooks/cpulimitationobserver"),v=e("./monitorhooks/qpsumobserver"),g=e("./monitorhooks/circuitbreakerobserver"),m=e("./monitorhooks/avdesyncobserver"),b=i(e("../utility/timestamps")),w=i(e("../config/constants")),S=i(e("../utility/csiologger"));function k(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(k=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=k(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return(T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function P(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=O(n),t=(e=r?(e=O(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _(t)}}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E={PcStatsTupleIn:"PcStatsTupleIn",StatsTupleOut:"StatsTupleOut"},e=(n.StatsMonitorIO=E,function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&T(t,e);var n,r=P(i);function i(e){var t;if(this instanceof i)return(t=r.call(this,"StatsMonitor")).bindPort(E.PcStatsTupleIn,t.receive,_(t)),t.declarePort(E.StatsTupleOut),t.lastPcStats=null,t.lastPcHash=null,t.tracksmonitor=new o.TracksMonitor,t.transportsmonitor=new s.TransportsMonitor(e),t.intervalstatsmonitor=new c.IntervalStatsMonitor,t.qualityevaluator=new u.QualityEvaluator,t.candidatepairs=new Map,t.monitorhooks=[],t.sendingTrigger=new f.SendingTrigger(t.sendStatsTuple.bind(_(t))),t.oneWayMediaObserver=new p.OneWayMediaObserver(t.sendDisruptions.bind(_(t))),t.throughputObserver=new h.ThroughputObserver(t.sendThroughputObservations.bind(_(t))),t.cpuLimitationObserver=new y.CPULimitationObserver(t.sendCPULimitationObservations.bind(_(t))),t.qpSumObserver=new v.QPSumObserver(t.sendQPSumDistortions.bind(_(t))),t.circuitBreakerObserver=new g.CircuitBreakerObserver(t.sendCircuitBreakerEvent.bind(_(t))),t.avDesyncObserver=new m.AVDeSyncObserver,t.setupHooks(),t.statsToCallbackSent=b.getCurrent(),t;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"setupHooks",value:function(){this.monitorhooks.push(this.sendingTrigger.accept.bind(this.sendingTrigger)),this.monitorhooks.push(this.oneWayMediaObserver.accept.bind(this.oneWayMediaObserver)),this.monitorhooks.push(this.throughputObserver.accept.bind(this.throughputObserver)),this.monitorhooks.push(this.cpuLimitationObserver.accept.bind(this.cpuLimitationObserver)),this.monitorhooks.push(this.qpSumObserver.accept.bind(this.qpSumObserver)),this.monitorhooks.push(this.circuitBreakerObserver.accept.bind(this.circuitBreakerObserver)),this.monitorhooks.push(this.avDesyncObserver.accept.bind(this.avDesyncObserver))}},{key:"setIntervals",value:function(e,t){this.sendingTrigger.setup(e,t)}},{key:"receive",value:function(e){for(var t=e.getPcHash(),n=(this.candidatepairs.set(t,e.getCandidatePair()),this.transportsmonitor.set(t,e.getTransportStats()),this.intervalstatsmonitor.set(t,e.getMeasurements()),e.getMeasurements()),r=0;r<n.length;r++){var i=n[r],o=this.tracksmonitor.getMonitor(i);o?o.add(i):S.warn("No monitor for ssrc "+i.getSSRC())}this.lastPcStats=e,this.lastPcHash=t;for(var a=this.tracksmonitor.getMonitors(),s=this.monitorhooks,c=0;c<s.length;c++)(0,s[c])(a);e=b.getCurrent();5e3<e-this.statsToCallbackSent&&(this.sendStatsTuple(w.statsDestination.callback),this.statsToCallbackSent=e)}},{key:"getCandidatePairs",value:function(){var n=[];return this.candidatepairs.forEach(function(e,t){n.push([t,e])}),n}},{key:"sendStatsTuple",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=(null===e&&(e=w.statsDestination.backend),new l.StatsTuple(this.getCandidatePairs(),this.lastPcStats.getCodec(),this.lastPcStats.getTrackStats(),this.transportsmonitor.getIntervalStats(),this.tracksmonitor.extractTracks(),this.intervalstatsmonitor.getIntervalStats(e),e)),e=this.qualityevaluator.updateQualityStats(e);this.transmit(E.StatsTupleOut,e)}},{key:"sendDisruptions",value:function(e){var t=this;e.forEach(function(e){e.isStarted()?t.sendEventMsg(w.internalFabricEvent.oneWayMediaStart,e.getContent()):t.sendEventMsg(w.internalFabricEvent.oneWayMediaStop,e.getContent())})}},{key:"sendCircuitBreakerEvent",value:function(e){var t=this;e.forEach(function(e){t.sendEventMsg(w.internalFabricEvent.circuitBreaker,e.getContent())})}},{key:"sendCPULimitationObservations",value:function(e){}},{key:"sendQPSumDistortions",value:function(e){}},{key:"sendThroughputObservations",value:function(e){this.sendEventMsg(w.internalFabricEvent.sendingThroughputObservations,e)}},{key:"sendEventMsg",value:function(e,t){var n,r,i;!this.lastPcHash||(n=d.Registry.getConferenceManager().getConferenceForPcHash(this.lastPcHash))&&(r=(n=n.getPeerConnectionManager().getPcHandlerByHash(this.lastPcHash)).getPeerConnection(),i=n.getConferenceId(),(e===w.internalFabricEvent.oneWayMediaStart||e===w.internalFabricEvent.oneWayMediaStop)&&n.isMuted||d.Registry.getEventMessageBuilder().make(e,i,r,t))}},{key:"delete",value:function(e){this.tracksmonitor&&this.tracksmonitor.deleteTracks(e),this.transportsmonitor&&this.transportsmonitor.delete(e),this.intervalstatsmonitor&&this.intervalstatsmonitor.delete(e),this.candidatepairs&&this.candidatepairs.has(e)&&this.candidatepairs.delete(e)}}])&&C(t.prototype,e),n&&C(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.Component));n.StatsMonitor=e},{"../collections/component":38,"../config/constants":50,"../utility/csiologger":119,"../utility/registry":128,"../utility/timestamps":132,"./intervalstatsmonitor":78,"./monitorhooks/avdesyncobserver":81,"./monitorhooks/circuitbreakerobserver":82,"./monitorhooks/cpulimitationobserver":90,"./monitorhooks/onewaymediaobserver":91,"./monitorhooks/qpsumobserver":92,"./monitorhooks/sendingtrigger":93,"./monitorhooks/throughputobserver":94,"./qualityevaluator":97,"./statstuple":105,"./tracksmonitor":112,"./transportsmonitor":113}],103:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsParserIO=n.StatsParser=void 0;var r=e("../collections/component"),s=e("./measurement"),c=e("./pcstats"),o=i(e("./validator")),u=i(e("../config/constants")),l=i(e("../utility/csiologger"));function d(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(d=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=d(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=v(n),t=(e=r?(e=v(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return y(t)}}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g={RawStatsIn:"RawStatsIn",PcStatsTupleOut:"PcStatsTupleOut"},e=(n.StatsParserIO=g,function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e);var n,r=h(i);function i(){var e;if(this instanceof i)return(e=r.call(this,"StatsParser")).bindPort(g.RawStatsIn,e.receive,y(e)),e.declarePort(g.PcStatsTupleOut),e;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"receive",value:function(e){if(null===e)l.warn("Stats object can not be null");else{for(var t=e.tracks,n=[],r=0;r<t.length;++r){var i=t[r];i&&i.data?(i=s.Measurement.make(e.pcHash,this.getSSRC(i),this.getStreamType(i),this.getMediaType(i),this.getReportType(i),this.getFrameRateReceived(i),this.getFrameHeight(i),this.getFrameWidth(i),this.getDroppedFramesNum(i),this.getFramesReceived(i),this.getRTT(i),this.getJitter(i),this.getLostPackets(i),this.getReceivedPackets(i),this.getSentPackets(i),this.getDiscardedPackets(i),this.getSentBytes(i),this.getReceivedBytes(i),this.getFractionLost(i),this.getGoogEchoCancellationReturnLoss(i),this.getGoogEchoCancellationReturnLossEnhancement(i),i),n.push(i)):l.log("No track or track.data.")}var o=new c.PcStats(e.candidatePair,e.codec,e.pcHash,e.trackStats,e.transportStats,n);this.transmit(g.PcStatsTupleOut,o)}}},{key:"getSSRC",value:function(e){return e.ssrc}},{key:"getStreamType",value:function(e){return e.streamType===u.streamType.inbound?u.streamType.inbound:e.streamType===u.streamType.outbound?u.streamType.outbound:void 0}},{key:"getSentBytes",value:function(e){return void 0!==e.data.bytesSent&&null!==(e=o.checkForNan(parseInt(e.data.bytesSent,10)))?e:-1}},{key:"getReceivedBytes",value:function(e){return void 0!==e.data.bytesReceived&&null!==(e=o.checkForNan(parseInt(e.data.bytesReceived,10)))?e:-1}},{key:"getReceivedPackets",value:function(e){return void 0!==e.data.packetsReceived&&null!==(e=o.checkForNegativeValue(parseInt(e.data.packetsReceived,10)))?e:-1}},{key:"getSentPackets",value:function(e){return void 0!==e.data.packetsSent&&null!==(e=o.checkForNegativeValue(parseInt(e.data.packetsSent,10)))?e:-1}},{key:"getDiscardedPackets",value:function(e){return void 0!==e.data.discardedPackets&&null!==(e=o.checkForNan(parseInt(e.data.discardedPackets,10)))?e:-1}},{key:"getLostPackets",value:function(e){return void 0!==e.data.packetsLost&&null!==(e=o.checkForNegativeValue(parseInt(e.data.packetsLost,10)))?e:-1}},{key:"getDroppedFramesNum",value:function(e){return void 0!==e.data.droppedFrames&&null!==(e=o.checkForNegativeValue(parseInt(e.data.droppedFrames,10)))?e:-1}},{key:"getFramesReceived",value:function(e){return void 0!==e.data.framesReceived&&null!==(e=o.checkForNegativeValue(parseInt(e.data.framesReceived,10)))?e:-1}},{key:"getFrameRateReceived",value:function(e){var t=null;return void 0!==e.data.framerateMean?t=parseInt(e.data.framerateMean,10):void 0!==e.data.framesPerSecond?t=parseInt(e.data.framesPerSecond,10):void 0!==e.data.googFrameRateOutput?t=parseInt(e.data.googFrameRateOutput,10):void 0!==e.data.googFrameRateDecoded?t=parseInt(e.data.googFrameRateDecoded,10):void 0!==e.data.googFrameRateReceived?t=parseInt(e.data.googFrameRateReceived,10):void 0!==e.data.googFrameRateSent&&(t=parseInt(e.data.googFrameRateSent,10)),t=void 0!==t?o.checkForNegativeValue(t):t}},{key:"getFrameHeight",value:function(e){var t;return void 0!==e.data.frameHeight?t=e.data.frameHeight:void 0!==e.data.googFrameHeightReceived?t=e.data.googFrameHeightReceived:void 0!==e.data.googFrameHeightSent&&(t=e.data.googFrameHeightSent),t}},{key:"getJitter",value:function(e){return void 0!==e.data.jitter?o.checkForNan(parseFloat(e.data.jitter,10)):void 0!==e.data.googJitterReceived?o.checkForNan(parseFloat(e.data.googJitterReceived,10)):void 0}},{key:"getFrameWidth",value:function(e){return void 0!==e.data.frameWidth?e.data.frameWidth:void 0!==e.data.googFrameWidthReceived?e.data.googFrameWidthReceived:void 0!==e.data.googFrameWidthSent?e.data.googFrameWidthSent:void 0}},{key:"getRTT",value:function(e){function t(e){return isNaN(e)||e<0?null:e}return void 0!==e.data.roundTripTime?t(parseFloat(e.data.roundTripTime,10)):void 0!==e.data.googRtt?t(parseFloat(e.data.googRtt,10)):void 0!==e.data.mozRtt?t(parseFloat(e.data.mozRtt,10)):void 0}},{key:"getMediaType",value:function(e){var t=u.mediaType.unknown;return e.data&&void 0!==e.data.mediaType?e.data.mediaType:e.data&&void 0!==e.data.kind?e.data.kind:(e.data.mediaType?t=e.data.mediaType:void 0!==e.data.googFrameRateReceived||void 0!==e.data.googFrameRateSent?t=u.mediaType.video:void 0!==e.data.audioInputLevel||void 0!==e.data.audioOutputLevel?t=u.mediaType.audio:void 0!==e.data.framerateMean&&(t=u.mediaType.video),t)}},{key:"getReportType",value:function(e){return e.reportType||u.reportType.unknown}},{key:"getFractionLost",value:function(e){return void 0===e.data.fractionLost?-1:(e=parseFloat(e.data.fractionLost,10),isNaN(e)||e<0?null:e)}},{key:"getGoogEchoCancellationReturnLoss",value:function(e){return void 0===e.data.googEchoCancellationReturnLoss?-1:o.checkForNan(parseFloat(e.data.googEchoCancellationReturnLoss,10))}},{key:"getGoogEchoCancellationReturnLossEnhancement",value:function(e){return void 0===e.data.googEchoCancellationReturnLossEnhancement?-1:o.checkForNan(parseFloat(e.data.googEchoCancellationReturnLossEnhancement,10))}}])&&f(t.prototype,e),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.Component));n.StatsParser=e},{"../collections/component":38,"../config/constants":50,"../utility/csiologger":119,"./measurement":79,"./pcstats":96,"./validator":114}],104:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsTransmitterIO=n.StatsTransmitter=void 0;var r=e("../collections/component"),l=e("../utility/registry"),o=i(e("../config/constants")),s=i(e("../utility/csiologger")),d=i(e("../config/settings"));function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function p(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=y(n),t=(e=r?(e=y(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v={CallstatsIn:"CallstatsIn",UnprocessedIn:"UnprocessedIn"},e=(n.StatsTransmitterIO=v,function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e);var n,r=p(i);function i(){var e;if(this instanceof i)return(e=r.call(this,"StatsTransmitter")).battery=l.Registry.getBattery(),e.lastUnprocessedStats={},e.bindPort(v.CallstatsIn,e.receiveCallstats,h(e)),e.bindPort(v.UnprocessedIn,e.receiveUnprocessed,h(e)),e;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"receiveUnprocessed",value:function(e,t){this.lastUnprocessedStats[t]=e}},{key:"receiveCallstats",value:function(e,t,n){t=this.getUnifiedFormat(t,e);t?this.send(e,t,n):s.warn("Content can not be sent")}},{key:"send",value:function(e,t,n){var r=l.Registry.getConferenceManager().getConferenceForPcHash(e);(r=r&&r.getPeerConnectionManager().getPcHandlerByHash(e))&&(e=r.getPcState())!==o.fabricState.terminated&&e!==o.fabricState.hold&&(n===o.statsDestination.callback?this.sendToStatsCallback(t.stats,r):l.Registry.getEventMessageBuilder().make(o.callstatsChannels.processedStats,r.getConferenceId(),r.getPeerConnection(),t))}},{key:"sendToStatsCallback",value:function(e,t){var n=l.Registry.getStatsCallbackBuilder();n&&n.buildStats(e,t)}},{key:"getUnifiedFormat",value:function(r,e){for(var t=this.lastUnprocessedStats[e],n=[],i=0;i<t.length;i++){var o=t[i],a=function(e){for(var t=0;t<r.tracks.length;t++){var n=r.tracks[t];if(n.data.id===e.id&&n.data.type===e.type)return n.data}return e.id===r.Transport.id&&e.type===r.Transport.type?r.Transport:null}(o);if(a)for(var s in a)a.hasOwnProperty(s)&&"id"!==s&&"type"!==s&&"timestamp"!==s&&(o[s]=a[s]);n.push(o)}for(var c=["localcandidate","local-candidate","remotecandidate","remote-candidate"],u=0;u<n.length;u++)!c.includes(n[u].type)||d.collectIP||(n[u].id||(n[u].id="csio-"+n[u].port),n[u].ip=n[u].id,n[u].address=n[u].id);e={stats:n};return e.wifiStats=l.Registry.getWifiStatsExecutor().getWifiStats(),e.batteryStatus={},e.batteryStatus.batteryLevel=this.battery.getLevel(),e.batteryStatus.isBatteryCharging=this.battery.getCharging(),-1===e.batteryStatus.batteryLevel&&(e.batteryStatus=null),e}}])&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.Component));n.StatsTransmitter=e},{"../collections/component":38,"../config/constants":50,"../config/settings":51,"../utility/csiologger":119,"../utility/registry":128}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StatsTuple=void 0;var c=e("./intervalstatsmonitor");function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function s(e,t,n,r,i,o,a){if(!(this instanceof s))throw new TypeError("Cannot call a class as a function");this.candidatePairs=e,this.codec=t,this.trackStats=n,this.transportStats=r,this.tracks=c.IntervalStatsMonitor.mergeIntervalStats(i,o),this.destination=a}var e,t,n;return e=s,(t=[{key:"getCandidatePairs",value:function(){return this.candidatePairs}},{key:"getCodec",value:function(){return this.codec}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getTracks",value:function(){return this.tracks}},{key:"getDestination",value:function(){return this.destination}}])&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}();n.StatsTuple=e},{"./intervalstatsmonitor":78}],106:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.EchoDetection=void 0;var r=o(e("../../config/constants")),i=o(e("../validator"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=d(n),t=(e=r?(e=d(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e=function(e){var t=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var n,o=l(a);function a(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=this,i=a;if(r instanceof i)return o.call(this,e,t,n);throw new TypeError("Cannot call a class as a function")}return t=a,e=[{key:"isValidTrack",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return!!e&&(e.getReportType()===r.reportType.local&&e.getStreamType()===r.streamType.outbound&&e.getMediaType()===r.mediaType.audio)}},{key:"getEModelValue",value:function(e,t){t=t-40*Math.log((1+e/10)/(1+e/150))+6*Math.pow(Math.E,e*e*-.3);return i.isNumber(t)?t:null}},{key:"getEchoRating",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return 14<=e?r.echoDetectionLabel.acceptable:8<e&&e<14?r.echoDetectionLabel.limitingCase:e<=8?r.echoDetectionLabel.unacceptable:null}}],(n=[{key:"detectEcho",value:function(e,t,n){return i.isNumber(e)&&i.isNumber(t)&&i.isNumber(n)?(n=a.getEModelValue(n/2,e+t),a.getEchoRating(n)):null}},{key:"add",value:function(e){this.filter(e)&&this.calculate(e)}},{key:"remove",value:function(e){}},{key:"calculate",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,e=this.detectEcho(e.getGoogEchoCancellationReturnLoss(),e.getGoogEchoCancellationReturnLossEnhancement(),e.getRTT());this.notify(e)}}])&&c(t.prototype,n),e&&c(t,e),Object.defineProperty(t,"prototype",{writable:!1}),a}(e("./swplugin").SWPlugin);n.EchoDetection=e},{"../../config/constants":50,"../validator":114,"./swplugin":109}],107:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(n),t=(e=r?(e=o(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.SWAvg=void 0;e=function(e){var t=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e);var n,o=c(a);function a(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=this,i=a;if(r instanceof i)return(r=o.call(this,e,t,n)).sum=0,r.counter=0,r;throw new TypeError("Cannot call a class as a function")}return t=a,(e=[{key:"add",value:function(e){this.filter(e)&&(this.sum+=this.extract(e),this.counter+=1,this.calculate())}},{key:"remove",value:function(e){}},{key:"calculate",value:function(){var e=0;this.counter<1||(e=this.sum/this.counter),this.notify(e)}}])&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(e("./swplugin").SWPlugin);n.SWAvg=e},{"./swplugin":109}],108:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(n),t=(e=r?(e=o(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.SWFunctor=void 0;e=function(e){var t=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e);var n,o=c(a);function a(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=this,i=a;if(r instanceof i)return(r=o.call(this,null,null,n)).addFunc=e,r.remFunc=t,r;throw new TypeError("Cannot call a class as a function")}return t=a,(e=[{key:"add",value:function(e){this.filter(e)&&this.addFunc&&this.addFunc(e)}},{key:"remove",value:function(e){this.filter(e)&&this.remFunc&&this.remFunc(e)}},{key:"toString",value:function(){return"SWFuncPlugin"}}])&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(e("./swplugin").SWPlugin);n.SWFunctor=e},{"./swplugin":109}],109:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.SWPlugin=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../../utility/csiologger"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=this,i=o;if(!(r instanceof i))throw new TypeError("Cannot call a class as a function");this.extractorFnc=e,this.notifierFnc=t,this.filterFunc=n}var e,t,n;return e=o,(t=[{key:"notify",value:function(e,t,n){this.notifierFnc?this.notifierFnc(e,t,n):r.warn("Failed notification for "+this.toString())}},{key:"extract",value:function(e){return this.extractorFnc?this.extractorFnc(e):(r.warn(this.toString()+" tried to extract without extractorFnc"),null)}},{key:"filter",value:function(e){return!this.filterFunc||this.filterFunc(e)}},{key:"add",value:function(e){r.log("Abstract method is called width value: "+e)}},{key:"remove",value:function(e){r.log("Abstract method is called with value: "+e)}},{key:"toString",value:function(){return"SWPlugin"}}])&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}();n.SWPlugin=e},{"../../utility/csiologger":119}],110:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.SWSBTreePercentile=void 0;var r=e("./swplugin"),o=e("../../collections/sizedbalancedtree"),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../../config/constants"));function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=i(n),t=(e=r?(e=i(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e=function(e){var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e);var n,r=d(i);function i(e,t,n){if(this instanceof i)return(e=r.call(this,e,t,n)).sbTree=new o.SizedBalancedTree(s.maxSBTTreeSize),e.result=null,e;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"add",value:function(e){this.filter(e)&&(this.sbTree.add(this.extract(e)),this.calculate())}},{key:"remove",value:function(e){}},{key:"calculate",value:function(){var e=this.sbTree.getSize(),t=Math.round(.5*e),t=this.sbTree.select(t),n=Math.round(.75*e),n=this.sbTree.select(n),e=Math.round(.95*e),e=this.sbTree.select(e);this.notify(t,n,e)}}])&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(r.SWPlugin);n.SWSBTreePercentile=e},{"../../collections/sizedbalancedtree":43,"../../config/constants":50,"./swplugin":109}],111:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.TrackMonitor=void 0;var p=e("../utility/registry"),r=e("../collections/slidingwindow"),s=e("../statspipeline/swplugins/swavg"),c=e("../statspipeline/swplugins/echodetection"),u=e("../statspipeline/swplugins/swsbtreepercentile"),l=e("../statspipeline/swplugins/swfunctor"),h=i(e("../utility/timestamps")),y=i(e("../config/constants")),v=i(e("./validator")),d=i(e("../utility/csiologger"));function f(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(f=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=f(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function o(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function g(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:n):r.value}).apply(this,arguments)}function w(e,t){return(w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function S(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=k(n),t=(e=r?(e=k(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e=function(e){var t=o;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e);var n,i=S(o);function o(e,t,n,r){if(this instanceof o)return(e=i.call(this,e,t)).thresholds=[],e.enableThresholds=!1,e.requestTime=0,e.started=0,e.created=h.getCurrent(),e.mediaType=r,e.streamType=n,e.metrics=e.makeTrack(),e.lastTrack={},e.prevFrameRateMean=null,e.ssrc=null,e;throw new TypeError("Cannot call a class as a function")}return t=o,e=[{key:"make",value:function(e,t,n,r){var e=new o(e,t,n,r),i=e.metrics;return e.attach(new s.SWAvg(function(e){return e.getJitter()},function(e){i.csioAvgJitter=e},function(e){e=e.getJitter();return v.isNumber(e)})),e.attach(new s.SWAvg(function(e){return e.getRTT()},function(e){i.csioAvgRtt=e},function(e){e=e.getRTT();return v.isNumber(e)})),e.attach(new c.EchoDetection(function(e){return e},function(e){i.csioEchoLabel=e},function(e){return c.EchoDetection.isValidTrack(e)})),e.attach(new u.SWSBTreePercentile(function(e){return e.getJitter()},function(e,t,n){i.csioPercentileJitter=n,i.csio75PercentileJitter=t},function(e){e=e.getJitter();return v.isNumber(e)})),e.attach(new u.SWSBTreePercentile(function(e){return e.getRTT()},function(e,t,n){i.csioSig2Latency=n,i.csioSig2Latency75=t,i.csioeM=n+40},function(e){e=e.getRTT();return v.isNumber(e)})),n===y.streamType.inbound?o.setupInboundMonitor(e):n===y.streamType.outbound?o.setupOutboundMonitor(e):d.warn("Unrecognized streamType ("+n+") at TrackMonitor"),r===y.mediaType.audio?o.setupAudioMonitor(e):r===y.mediaType.video?o.setupVideoMonitor(e):d.warn("Unrecognized mediaType ("+r+") at TrackMonitor"),e}},{key:"setupInboundMonitor",value:function(d){var f=d.metrics;d.addPreProcess(function(e){var t,n,r,i,o,a=e.getFractionLost();v.checkForPositiveValue(a)||(t=e.getLostPackets(),n=e.getReceivedPackets(),o=i=0,o=(r=d.getRequestedMeasurement())?(i=t-r.getLostPackets(),n-r.getReceivedPackets()):(i=t,n),v.checkForPositiveValue(i)&&v.checkForPositiveValue(o)&&(a=i/Math.max(o+i,1),v.checkForPositiveValue(a)&&(f.csioIntFLRate=a,e.setFractionLost(a))))}),d.addPreProcess(function(e){var t;!e.getFrameRateReceived()&&e.getFramesReceived()&&0<d.started&&(e=e.getFramesReceived(),0<(t=h.getCurrent()-d.started)&&0<=e&&(f.csioEstFrameRatePerSecond=1e3*e/t))}),d.attach(new l.SWFunctor(function(e){var t=h.getCurrent(),n=e.getResolution(),r=d.getRequestedMeasurement(),i=d.getRequestTime(),o=8*e.getReceivedBytes(),a=e.getReceivedPackets(),s=0,c=0,u=0,l=Math.max(t-d.getStartTime(),u),c=r?(s=o-8*r.getReceivedBytes(),Math.max(t-i,u)):(u=p.Registry.getCredentials().isAdaptiveStatsEnabled()?y.adaptiveStatsIntervalsInMs.min:p.Registry.getCredentials().getStatsSubmissionInterval(),l=Math.max(t-d.getStartTime(),u),s=o,Math.max(l,u));f.csioAvgBRKbps=o/l,f.intervalBandwidth=Math.max(s/c,0),f.csioAvgPacketSize=e.getReceivedBytes()/Math.max(a,1),f.csiores=n},null,null)),d.attach(new u.SWSBTreePercentile(function(e){return e.getFractionLost()},function(e,t,n){n=v.checkForPositiveValue(n)?n:null;f.csioPercentileFl=n},function(e){e=e.getFractionLost();return v.isNumber(e)&&v.checkForPositiveValue(e)}))}},{key:"setupOutboundMonitor",value:function(d){var f=d.metrics;d.addPreProcess(function(e){var t,n,r,i,o,a=e.getFractionLost();v.checkForPositiveValue(a)||(t=e.getLostPackets(),n=e.getSentPackets(),o=i=0,o=(r=d.getRequestedMeasurement())?(i=t-r.getLostPackets(),n-r.getSentPackets()):(i=t,n),v.checkForPositiveValue(i)&&v.checkForPositiveValue(o)&&(a=i/Math.max(o+i,1),v.checkForPositiveValue(a)&&(f.csioIntFLRate=a,e.setFractionLost(a))))}),d.attach(new l.SWFunctor(function(e){var t=h.getCurrent(),n=e.getResolution(),r=d.getRequestedMeasurement(),i=d.getRequestTime(),o=8*e.getSentBytes(),a=e.getSentPackets(),s=0,c=0,u=0,l=Math.max(t-d.getStartTime(),u),c=r?(s=o-8*r.getSentBytes(),Math.max(t-i,u)):(u=p.Registry.getCredentials().isAdaptiveStatsEnabled()?y.adaptiveStatsIntervalsInMs.min:p.Registry.getCredentials().getStatsSubmissionInterval(),l=Math.max(t-d.getStartTime(),u),s=o,Math.max(l,u));f.csioAvgBRKbps=o/l,f.intervalBandwidth=Math.max(s/c,0),f.csioAvgPacketSize=e.getSentBytes()/Math.max(a,1),f.csiores=n},null,null)),d.attach(new u.SWSBTreePercentile(function(e){return e.getFractionLost()},function(e,t,n){n=v.checkForPositiveValue(n)?n:null;f.csioPercentileFl=n},function(e){e=e.getFractionLost();return v.isNumber(e)&&v.checkForPositiveValue(e)}))}},{key:"setupAudioMonitor",value:function(e){var t=e.metrics;e.attach(new l.SWFunctor(function(e){t.csioMediaType=y.mediaType.audio},null,null))}},{key:"setupVideoMonitor",value:function(t){var n=t.metrics;t.attach(new s.SWAvg(function(e){return e.getFrameRateReceived()},function(e){t.prevFrameRateMean=n.csioFrameRateMean,n.csioPrevFrameRateMean=n.csioFrameRateMean,n.csioFrameRateMean=e},function(e){e=e.getFrameRateReceived();return v.isNumber(e)})),t.attach(new s.SWAvg(function(e){return e.getFrameHeight()},function(e){n.csioFrameHeightMean=e},function(e){e=e.getFrameHeight();return v.isNumber(e)})),t.attach(new s.SWAvg(function(e){return e.getFrameWidth()},function(e){n.csioFrameWidthMean=e},function(e){e=e.getFrameWidth();return v.isNumber(e)})),t.attach(new u.SWSBTreePercentile(function(e){return e.getFrameRateReceived()},function(e){n.csioFrameRate50Percentile=e},function(e){e=e.getFrameRateReceived();return v.isNumber(e)})),t.attach(new u.SWSBTreePercentile(function(e){return e.getFrameHeight()},function(e){n.csioFrameHeight50Percentile=e},function(e){e=e.getFrameHeight();return v.isNumber(e)})),t.attach(new u.SWSBTreePercentile(function(e){return e.getFrameWidth()},function(e){n.csioFrameWidth50Percentile=e},function(e){e=e.getFrameWidth();return v.isNumber(e)})),t.attach(new l.SWFunctor(function(e){n.csioMediaType=y.mediaType.video},null,null))}}],(n=[{key:"makeTrack",value:function(){var e={csioMediaType:void 0,csioMark:void 0,intervalBandwidth:void 0,csioAvgBRKbps:void 0,csioAvDesync:void 0,csioIntBRKbps:void 0,csioIntFL:void 0,csioIntFLRate:void 0,csioIntMs:void 0,csioIntPR:void 0,csioPercentileFl:void 0,csioAvgJitter:void 0,csioAvgRtt:void 0,csioEchoLabel:void 0,csioPercentileJitter:void 0,csioSig2Latency:void 0,csioTimeElapseMs:void 0,csioeM:void 0,csiores:void 0,csioFrameWidth95Percentile:void 0,csioFrameWidth50Percentile:void 0,csioFrameHeight95Percentile:void 0,csioFrameHeight50Percentile:void 0,csioFrameRate95Percentile:void 0,csioFrameRate50Percentile:void 0,csioFrameWidthMean:void 0,csioFrameHeightMean:void 0,csioFrameRateMean:void 0,csioIntPktRcv:void 0};return e}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"add",value:function(e){this.ssrc=e.getSSRC(),this.lastTrack=e.extractTrack(),this.lastTrack.pcHash=e.getPcHash(),0===this.started&&(this.started=h.getCurrent()),b(k(o.prototype),"add",this).call(this,e)}},{key:"hasTraffic",value:function(){return 0<this.metrics.intervalBandwidth}},{key:"getTrack",value:function(){var e=this.lastTrack;return e.data=g(g({},e.data),this.metrics),e}},{key:"extractTrack",value:function(){var e=this.lastTrack;return e.data=g(g({},e.data),this.metrics),this.requestTime=h.getCurrent(),this.requestedMeasurement=this.peek(),e}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getStartTime",value:function(){return this.started}},{key:"getCreationTime",value:function(){return this.created}},{key:"getRequestTime",value:function(){return Math.max(this.started,this.requestTime)}},{key:"getRequestedMeasurement",value:function(){return this.requestedMeasurement}},{key:"addPreProcess",value:function(e){b(k(o.prototype),"addPreProcess",this).call(this,e)}},{key:"addPostProcess",value:function(e){b(k(o.prototype),"addPostProcess",this).call(this,e)}}])&&m(t.prototype,n),e&&m(t,e),Object.defineProperty(t,"prototype",{writable:!1}),o}(r.SlidingWindow);n.TrackMonitor=e},{"../collections/slidingwindow":45,"../config/constants":50,"../statspipeline/swplugins/echodetection":106,"../statspipeline/swplugins/swavg":107,"../statspipeline/swplugins/swfunctor":108,"../statspipeline/swplugins/swsbtreepercentile":110,"../utility/csiologger":119,"../utility/registry":128,"../utility/timestamps":132,"./validator":114}],112:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.TracksMonitor=void 0;var i=e("./trackmonitor"),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/constants"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.inbMonitors=new Map,this.outbMonitors=new Map}var t,n,r;return t=e,(n=[{key:"getMonitor",value:function(e){var t=e.getStreamType(),n=e.getMediaType(),e=e.getSSRC(),r=null;return t===o.streamType.inbound?n===o.mediaType.audio?r=this.getInbAudioMonitor(e):n===o.mediaType.video&&(r=this.getInbVideoMonitor(e)):t===o.streamType.outbound&&(n===o.mediaType.audio?r=this.getOutbAudioMonitor(e):n===o.mediaType.video&&(r=this.getOutbVideoMonitor(e))),r}},{key:"extractTracks",value:function(){var n=[];return this.outbMonitors.forEach(function(e,t){n.push(e.extractTrack())}),this.inbMonitors.forEach(function(e,t){n.push(e.extractTrack())}),n}},{key:"deleteTracks",value:function(n){var r=this;this.outbMonitors.forEach(function(e,t){e=e.getRequestedMeasurement();e&&e.getPcHash()===n&&r.outbMonitors.has(t)&&r.outbMonitors.delete(t)}),this.inbMonitors.forEach(function(e,t){e=e.getRequestedMeasurement();e&&e.getPcHash()===n&&r.inbMonitors.has(t)&&r.inbMonitors.delete(t)})}},{key:"getTracks",value:function(){var n=[];return this.outbMonitors.forEach(function(e,t){n.push(e.getTrack())}),this.inbMonitors.forEach(function(e,t){n.push(e.getTrack())}),n}},{key:"getMonitors",value:function(){var n=[];return this.outbMonitors.forEach(function(e,t){n.push(e)}),this.inbMonitors.forEach(function(e,t){n.push(e)}),n}},{key:"getInbAudioMonitor",value:function(e){var t=this.inbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.inbound,o.mediaType.audio),this.inbMonitors.set(e,t)),t}},{key:"getInbVideoMonitor",value:function(e){var t=this.inbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.inbound,o.mediaType.video),this.inbMonitors.set(e,t)),t}},{key:"getOutbAudioMonitor",value:function(e){var t=this.outbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.outbound,o.mediaType.audio),this.outbMonitors.set(e,t)),t}},{key:"getOutbVideoMonitor",value:function(e){var t=this.outbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.outbound,o.mediaType.video),this.outbMonitors.set(e,t)),t}}])&&c(t.prototype,n),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.TracksMonitor=e},{"../config/constants":50,"./trackmonitor":111}],113:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.TransportsMonitor=void 0;var r=o(e("../config/constants")),i=o(e("../utility/timestamps"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1})}var d=function(){function t(e){c(this,t),this.previous=e,this.actual=e,this.outdated=i.getCurrent()}return l(t,[{key:"setActual",value:function(e){this.actual=e}},{key:"outdate",value:function(){this.previous=this.actual,this.outdated=i.getCurrent()}},{key:"getActual",value:function(){return this.actual}},{key:"getPrevious",value:function(){return this.previous}},{key:"getElapsedTime",value:function(){return i.getCurrent()-this.outdated}}]),t}(),e=function(){function t(e){c(this,t),this.stats=new Map,this.codeBase=e}return l(t,[{key:"set",value:function(e,t){var n=this.stats.get(e);if(n)n.setActual(t);else{if(t)for(var r=0;r<t.length;++r)t[r].csioTurnMins=0,t[r].csioBytesSent=0,t[r].csioBytesReceived=0;this.stats.set(e,new d(t))}}},{key:"delete",value:function(e){e&&this.stats.has(e)&&this.stats.delete(e)}},{key:"getIntervalStats",value:function(){var n=this,r=new Map;return this.stats.forEach(function(e,t){r.set(t,n.getIntervalStat(e)),e.outdate()}),r}},{key:"getIntervalStat",value:function(e){return this.codeBase===r.codeBaseType.chrome?this.getIntervalStatForChrome(e):this.getDefaultIntervalStat(e)}},{key:"getDefaultIntervalStat",value:function(e){var t=e.getActual(),n=e.getPrevious(),r=e.getElapsedTime();if(n)for(var i=0;i<t.length;++i){var o=t[i],a=n[i];if(!a||!o)return t;var s=parseInt(a.bytesReceived,10),c=parseInt(a.bytesSent,10);o.csioReceivedBwKbps=8*(parseInt(o.bytesReceived,10)-s)/r,o.csioSentBwKbps=8*(parseInt(o.bytesSent,10)-c)/r,o.csioIntBytesReceived=parseInt(o.bytesReceived,10)-s,o.csioIntBytesSent=parseInt(o.bytesSent,10)-c,o.csioIsRelayed&&(0<o.csioIntBytesSent||0<o.csioIntBytesReceived)?(o.csioTurnMins=r+a.csioTurnMins,o.csioBytesSent=a.csioBytesSent+o.csioIntBytesSent,o.csioBytesReceived=a.csioBytesReceived+o.csioIntBytesReceived):o.csioTurnMins=a.csioTurnMins}return t}},{key:"getIntervalStatForChrome",value:function(e){var t=e.getActual(),n=e.getPrevious(),r=e.getElapsedTime();if(!n)return actual;for(var i=0;i<t.length;++i){var o=t[i],a=n[i];if(!a||!o)return t;var s=parseInt(a.bytesReceived,10),c=parseInt(a.bytesSent,10);o.csioReceivedBwKbps=8*(parseInt(o.bytesReceived,10)-s)/r,o.csioSentBwKbps=8*(parseInt(o.bytesSent,10)-c)/r,o.csioIntBytesReceived=parseInt(o.bytesReceived,10)-s,o.csioIntBytesSent=parseInt(o.bytesSent,10)-c,void 0!==a.packetsSent&&void 0!==o.packetsSent&&(o.csioSentPacketRate=(parseInt(o.packetsSent,10)-parseInt(a.packetsSent,10))/(r/1e3),o.csioIntPacketsSent=parseInt(o.packetsSent,10)-parseInt(a.packetsSent,10)),void 0!==a.packetsReceived&&void 0!==o.packetsReceived&&(o.csioReceivedPacketRate=(parseInt(o.packetsReceived,10)-parseInt(a.packetsReceived,10))/(r/1e3),o.csioIntPacketsReceived=parseInt(o.packetsReceived,10)-parseInt(a.packetsReceived,10)),o.csioIsRelayed&&(0<o.csioIntBytesSent||0<o.csioIntBytesReceived)?(o.csioTurnMins=r+a.csioTurnMins,o.csioBytesSent=a.csioBytesSent+o.csioIntBytesSent,o.csioBytesReceived=a.csioBytesReceived+o.csioIntBytesReceived):o.csioTurnMins=a.csioTurnMins}return t}}]),t}();n.TransportsMonitor=e},{"../config/constants":50,"../utility/timestamps":132}],114:[function(e,t,n){"use strict";function r(e){return isNaN(e)?null:e}Object.defineProperty(n,"__esModule",{value:!0}),n.checkForNan=r,n.checkForNegativeValue=function(e){return null!==r(e)&&0<=e?e:null},n.checkForPositiveValue=function(e){return void 0!==e&&null!==r(e)&&0<=e},n.isNumber=function(e){return void 0!==e&&null!==r(e)&&Number.isFinite(e)}},{}],115:[function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.WifiStatsExecutor=void 0;var r=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.getWifiStatsMethod=null,this.wifiStats=null,this.interval=1e4}var t,n,r;return t=e,(n=[{key:"resetGetWifiStatsMethod",value:function(){this.getWifiStatsMethod=null}},{key:"setGetWifiStatsMethod",value:function(e){this.getWifiStatsMethod=e,this.wifiStatsHandler()}},{key:"getWifiStats",value:function(){return this.getWifiStatsMethod||(this.wifiStats=null),this.wifiStats}},{key:"wifiStatsHandler",value:function(){var t=this;t.getWifiStatsMethod&&t.getWifiStatsMethod().then(function(e){t.wifiStats=JSON.parse(e),setTimeout(function(){t.wifiStatsHandler()},t.interval)}).catch(function(){setTimeout(function(){t.wifiStatsHandler()},t.interval)})}}])&&i(t.prototype,n),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.WifiStatsExecutor=r},{}],116:[function(e,t,n){"use strict";function r(e){return window.btoa(e)}function o(e){return window.atob(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.decode=o,n.encode=r,n.strtohex=function(e){for(var t=o(e.replace(/[ \r\n]+$/,"")),n=[],r=0;r<t.length;++r){var i=t.charCodeAt(r).toString(16);1===i.length&&(i="0"+i),n.push(i)}return n.join("")},n.urlencode=function(e){return r(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},n.urlencodeUnicode=function(e){return function(e){return r(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}},{}],117:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Callbacks=void 0;var i=r(e("../config/constants")),o=e("./registry"),s=r(e("./csiologger"));function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.callbacks={}}var t,n,r;return t=e,(n=[{key:"set",value:function(e,t){"function"==typeof t&&(i.callbackFunctions.hasOwnProperty(e)?(this.callbacks[e]=t,e===i.callbackFunctions.stats&&o.Registry.getStatsCallbackBuilder().setCallback(t)):s.error("Couldn't set callback: ".concat(e)))}},{key:"get",value:function(e){return this.callbacks.hasOwnProperty(e)?this.callbacks[e]:null}}])&&u(t.prototype,n),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.Callbacks=e},{"../config/constants":50,"./csiologger":119,"./registry":128}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Credentials=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};t=a(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("./csiologger"));function a(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(a=function(e){return e?n:t})(e))}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.appId=null,this.userId=null,this.userIdObject=null,this.deviceId=null,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.adaptiveStatsEnabled=!1,this.siteId=null,this.additionalIDs=null,this.ingestedEvents=[],this.enableMLNotification=!1}var t,n,r;return t=e,(n=[{key:"getAppId",value:function(){return this.appId}},{key:"setAppId",value:function(e){this.appId="string"==typeof e?parseInt(e,10):e}},{key:"getSiteId",value:function(){return this.siteId}},{key:"setSiteId",value:function(e){this.siteId=e}},{key:"getUserId",value:function(){return this.userId}},{key:"setUserId",value:function(e){"object"===s(e)?(this.userId=e.aliasName,this.setUserIdObject(e)):this.userId=e}},{key:"getUserIdObject",value:function(){return this.userIdObject}},{key:"setUserIdObject",value:function(e){this.userIdObject=e}},{key:"getStatsSubmissionInterval",value:function(){return this.statsSubmissionInterval}},{key:"setStatsSubmissionInterval",value:function(e){i.log("setStatsSubmissionInterval is ",e),this.statsSubmissionInterval=e}},{key:"getEnableMLNotification",value:function(){return this.enableMLNotification}},{key:"setEnableMLNotification",value:function(e){this.additionalIDs&&"WorkW"===this.additionalIDs.productName||(this.enableMLNotification=e)}},{key:"getCollectSDP",value:function(){return this.collectSDP}},{key:"setCollectSDP",value:function(e){this.collectSDP=e}},{key:"getIngestedEvents",value:function(){return this.ingestedEvents}},{key:"setIngestedEvents",value:function(e){e&&0<e.length&&(this.ingestedEvents=e)}},{key:"isAdaptiveStatsEnabled",value:function(){return this.adaptiveStatsEnabled}},{key:"setAdaptiveStatsEnabled",value:function(){this.adaptiveStatsEnabled=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"getAdditionalIDs",value:function(){return this.additionalIDs}},{key:"setAdditionalIDs",value:function(e){this.additionalIDs=e}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.Credentials=e},{"./csiologger":119}],119:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.error=function(){var e;(e=console).warn.apply(e,arguments)},n.info=function(){var e;"true"===r.csioDebug&&(e=console).info.apply(e,arguments)},n.log=function(){var e;"true"===r.csioDebug&&(e=console).log.apply(e,arguments)},n.sendLog=function(e,t){r.callbackLogger&&r.callbackLogger({logLevel:e,args:[t]})},n.warn=function(){var e;"true"===r.csioDebug&&(e=console).warn.apply(e,arguments)};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../config/settings"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}},{"../config/settings":51}],120:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Endpoint=void 0;var i=r(e("../browserapi/localstorage")),o=r(e("../browserapi/detectbrowser")),s=r(e("../utility/timestamps")),c=r(e("../utility/hash"));function u(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(u=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.id=null,this.appversion=null,this.magicKey=Math.floor(4294967296*Math.random()),this.browserName=null,this.browserVersion=null,this.osName=null,this.osVersion=null,this.codeBase=null,this.userAgent=null,this.retrieveId()}var t,n,r;return t=e,(n=[{key:"setup",value:function(){var e=o.detect();this.browserName=e.browserName,this.browserVersion=e.browserVersion,this.osName=e.os,this.osVersion=e.osVersion,this.codeBase=e.codeBase,this.userAgent=e.userAgent}},{key:"retrieveId",value:function(){var e,t=this,n=i.get("endpointID");null===n?(e=s.getCurrent(),e=Math.random()*e,c.generateSHA256(e.toString(),function(e){t.id=e,i.store("endpointID",e)})):this.id=n}},{key:"getId",value:function(){return this.id}},{key:"getAppVersion",value:function(){return this.appversion}},{key:"setAppVersion",value:function(e){this.appversion=e}},{key:"getMagicKey",value:function(){return this.magicKey}},{key:"getBrowserName",value:function(){return this.browserName}},{key:"getBrowserVersion",value:function(){return this.browserVersion}},{key:"getOsName",value:function(){return this.osName}},{key:"getOsVersion",value:function(){return this.osVersion}},{key:"getCodeBase",value:function(){return this.codeBase}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"serialize",value:function(){return{type:"browser",buildName:this.browserName,buildVersion:this.browserVersion,appVersion:this.appversion,os:this.osName,osVersion:this.osVersion,userAgent:this.userAgent}}}])&&l(t.prototype,n),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.Endpoint=e},{"../browserapi/detectbrowser":32,"../browserapi/localstorage":34,"../utility/hash":123,"../utility/timestamps":132}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventMessage=void 0;var r=i(e("../config/constants")),o=i(e("../config/settings")),a=e("./registry"),s=i(e("./csiologger"));function c(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(c=function(e){return e?n:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==u(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var e=function(){function i(e,t,n,r){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.eventType=e,this.customEntries=n,this.pcHandler=r,this.auth=a.Registry.getAuthenticator(),this.clocksync=a.Registry.getClockSync(),this.timestamp=this.clocksync.getSynchronizedTimestamp(),this.conferenceId=t,this.clockUnSynced=!this.clocksync.isCompleted()}var e,t,n;return e=i,n=[{key:"checkCustomEntries",value:function(e,t){if(!d[e])return s.error("eventType not recognized:",e),!1;var n,r=d[e];for(n in r)if(!t.hasOwnProperty(n)||u(t[n])!==r[n])return s.error("customEntries for",e,"should have",n,"of type",r[n]),!1;return!0}}],(t=[{key:"updateConferenceId",value:function(e){s.log("updating conferenceId to ",this.eventType,this.conferenceId,e),this.conferenceId=e}},{key:"toJson",value:function(){var e;return this.canBeSent()?(e=this.getCommonHeader(),Object.assign(e,this.customEntries),this.eventType===r.internalFabricEvent.userJoined&&delete e.connectionID,e):null}},{key:"getCallback",value:function(){return this.pcHandler?this.pcHandler.getCallback():null}},{key:"canBeSent",value:function(){var e,t=r.tmpConferenceId;if(this.conferenceId===t)return!1;if(this.pcHandler&&!this.pcHandler.getRemoteId())return!1;if(this.eventType!==r.precalltestEvents.results&&this.eventType!==r.precalltestEvents.notification){t=a.Registry.getConferenceManager().get(this.conferenceId);if(!t)return!1;e=t.getUcId()}return!!this.auth.getToken()&&(this.auth.isTokenValid()?!!(this.isPriority()||this.clocksync.isCompleted()&&e)&&!(this.eventType===r.internalFabricEvent.userAlive&&!e):(this.auth.reAuthenticate(),!1))}},{key:"isCachable",value:function(){return-1===[r.internalFabricEvent.userAlive].indexOf(this.eventType)}},{key:"isPriority",value:function(){var e=!1;return e=this.eventType!==r.internalFabricEvent.userJoined&&this.eventType!==r.precalltestEvents.results&&this.eventType!==r.precalltestEvents.notification&&this.eventType!==r.internalFabricEvent.userAlive?e:!0}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getCommonHeader",value:function(){var e={version:o.version,callstatsVersion:o.version,channel:this.decideChannel(),timestamp:this.timestamp,action:this.eventType,eventType:this.eventType,localID:encodeURIComponent(a.Registry.getCredentials().getUserId()),timeShift:0,appID:a.Registry.getCredentials().getAppId(),deviceID:a.Registry.getEndpoint().getId(),token:this.auth.getToken(),confID:encodeURIComponent(this.conferenceId)},t=(this.clockUnSynced&&(e.timestamp+=this.clocksync.getOffset()),this.eventType!==r.internalFabricEvent.userJoined&&this.eventType!==r.internalFabricEvent.fabricSetup&&this.eventType!==r.fabricEvent.fabricSetupFailed&&this.eventType!==r.precalltestEvents.results&&this.eventType!==r.precalltestEvents.notification||(e.siteID=a.Registry.getCredentials().getSiteId()),this.eventType!==r.internalFabricEvent.userJoined&&this.eventType!==r.precalltestEvents.results&&this.eventType!==r.precalltestEvents.notification||(e.additionalIDs=a.Registry.getCredentials().getAdditionalIDs()),a.Registry.getConferenceManager().get(this.conferenceId));return e.ucID=t?t.getUcId():null,this.pcHandler?(e.remoteID=encodeURIComponent(this.pcHandler.getRemoteId()),e.connectionID=this.pcHandler.getPcHash()):(e.remoteID=encodeURIComponent(a.Registry.getCredentials().getUserId()),e.connectionID=encodeURIComponent(a.Registry.getCredentials().getUserId())),e.remoteID||(e.remoteID=encodeURIComponent(a.Registry.getCredentials().getUserId())),e}},{key:"decideChannel",value:function(){if(this.eventType==r.callstatsChannels.sdpSubmission)return r.callstatsChannels.sdpSubmission;if(this.eventType==r.callstatsChannels.userFeedback)return r.callstatsChannels.userFeedback;if(this.eventType==r.callstatsChannels.processedStats)return r.callstatsChannels.processedStats;for(var e in r.precalltestEvents)if(this.eventType==r.precalltestEvents[e])return r.callstatsChannels.preCallTest;return r.callstatsChannels.callstatsEvent}}])&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(),d=(n.EventMessage=e,{});d[r.internalFabricEvent.userJoined]={endpointInfo:"object"},d[r.internalFabricEvent.userLeft]={},d[r.internalFabricEvent.userAlive]={},d[r.internalFabricEvent.userDetails]={},d[r.internalFabricEvent.connectedDeviceList]={mediaDeviceList:"object"},d[r.fabricEvent.activeDeviceList]={mediaDeviceList:"object"},d[r.fabricEvent.audioMute]={},d[r.fabricEvent.audioUnmute]={},d[r.fabricEvent.videoPause]={},d[r.fabricEvent.videoResume]={},d[r.fabricEvent.screenShareStart]={},d[r.fabricEvent.screenShareStop]={},d[r.internalFabricEvent.mediaPlaybackStart]={ssrc:"string"},d[r.internalFabricEvent.mediaPlaybackSuspended]={ssrc:"string"},d[r.internalFabricEvent.mediaPlaybackStalled]={ssrc:"string"},d[r.internalFabricEvent.oneWayMedia]={mediaType:"string",ssrc:"string"},d[r.internalFabricEvent.oneWayMediaStart]={mediaType:"string",disruptionType:"string",ssrc:"string"},d[r.internalFabricEvent.oneWayMediaStop]={mediaType:"string",disruptionType:"string",ssrc:"string"},d[r.internalFabricEvent.circuitBreaker]={disruptionType:"string",ssrc:"string"},d[r.internalFabricEvent.fabricSetup]={localIceCandidates:"object",remoteIceCandidates:"object",iceCandidatePairs:"object"},d[r.fabricEvent.callDetails]={callType:"string"},d[r.fabricEvent.fabricSetupFailed]={delay:"number",reason:"string",function:"string",endpoint:"object"},d[r.internalFabricEvent.fabricStateChange]={changedState:"string",prevState:"string",newState:"string"},d[r.internalFabricEvent.fabricDropped]={prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",delay:"number"},d[r.internalFabricEvent.iceConnectionDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},d[r.internalFabricEvent.iceConnectionDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",delay:"number"},d[r.internalFabricEvent.iceDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},d[r.internalFabricEvent.iceDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},d[r.internalFabricEvent.iceFailed]={localIceCandidates:"object",prevIceConnectionState:"string",currIceConnectionState:"string",delay:"number"},d[r.internalFabricEvent.iceAborted]={prevIceConnectionState:"string",currIceConnectionState:"string"},d[r.internalFabricEvent.iceRestarted]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},d[r.internalFabricEvent.fabricTransportSwitch]={prevIceCandidatePair:"object",currIceCandidatePair:"object"},d[r.internalFabricEvent.iceTerminated]={prevIceConnectionState:"string",currIceConnectionState:"string"},d[r.fabricEvent.fabricTerminated]={},d[r.fabricEvent.fabricHold]={},d[r.fabricEvent.fabricResume]={},d[r.fabricEvent.callUnAnswered]={},d[r.callstatsChannels.sdpSubmission]={localSDP:"string",remoteSDP:"string"},d[r.internalFabricEvent.ssrcMap]={ssrcData:"object"},d[r.callstatsChannels.userFeedback]={feedback:"object"},d[r.internalFabricEvent.sendingThroughputObservations]={ssrc:"string",maxsendingKBitrate:"number",timeToMaxSendingKBitrate:"number",stablesendingKBitrate:"number",timeToStableSendingKBitrate:"number"},d[r.fabricEvent.dominantSpeaker]={},d[r.fabricEvent.applicationErrorLog]={message:"string",messageType:"string"},d[r.callstatsChannels.processedStats]={stats:"object"},d[r.customEvents.stats]={stats:"object"},d[r.customEvents.event]={eventList:"object"},d[r.customEvents.conferenceSummary]={pstnTime:"number",ringingTime:"number",contactID:"string",isCallForwarded:"boolean"},d[r.callstatsChannels.senderConfiguration]={rtc_rtp_parameters:"object"},d[r.internalFabricEvent.limitationObservations]={reason:"string"},d[r.qualityDisruptionTypes.qpchange]={reason:"string"},d[r.precalltestEvents.results]={results:"object"},d[r.precalltestEvents.associate]={ids:"object"},d[r.precalltestEvents.notification]={}},{"../config/constants":50,"../config/settings":51,"./csiologger":119,"./registry":128}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventMessageBuilder=void 0;var a=e("./eventmessage"),s=r(e("../config/constants")),c=e("./registry"),u=r(e("./csiologger"));function l(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(l=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==d(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.transmissionmanager=c.Registry.getTransmissionManager()}var t,n,r;return t=e,(n=[{key:"make",value:function(e,t,n){var r,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e||null===i||"object"!==d(i))return u.error("failed typeof checks:",e,d(e),d(i),i),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"failed typeof checks:"+e+":"+d(i)+":"+d(e)}),!1;if(null===t&&e!==s.precalltestEvents.results&&e!==s.precalltestEvents.notification)return u.error("failed conferenceId checks:",e,t),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"failed conferenceId checks:"+e}),!1;if(!n&&e!==s.callstatsChannels.userFeedback&&e!==s.fabricEvent.applicationErrorLog&&e!==s.fabricEvent.fabricSetupFailed&&e!==s.internalFabricEvent.userJoined&&e!==s.precalltestEvents.results&&e!==s.precalltestEvents.notification&&e!==s.customEvents.stats&&e!==s.customEvents.event&&e!==s.customEvents.conferenceSummary)return u.error("peerconnection cannot be null",e),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"peerconnection cannot be null"+e}),!1;if(!a.EventMessage.checkCustomEntries(e,i))return u.error("failed checks:",e,i),c.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"failed customEntries checks:"+e}),!1;t&&(o=c.Registry.getConferenceManager().get(t))&&n&&(r=o.getPeerConnectionManager().getPcHandler(n));var o=new a.EventMessage(e,t,i,r);return this.transmissionmanager.send(o),!0}}])&&i(t.prototype,n),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.EventMessageBuilder=e},{"../config/constants":50,"./csiologger":119,"./eventmessage":121,"./registry":128}],123:[function(e,t,n){"use strict";function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=0;if(!e)return n;for(var r=0,i=e.length;r<i;r++){n=(n<<5)-n+e.charCodeAt(r);n|=0}return t&&t(n+""),n+""}function o(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t[t.length]=r:(127<r&&r<2048?t[t.length]=r>>6|192:(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128),t[t.length]=63&r|128)}return new Uint8Array(t).buffer}function a(e){for(var t,n=new DataView(e),r="",i=0;i<n.byteLength;i++)r+=t=(t=n.getUint8(i).toString(16)).length<2?"0"+t:t;return r}Object.defineProperty(n,"__esModule",{value:!0}),n.generateHash=i,n.generateSHA256=function(e,t){var n={name:"SHA-256"};{var r;window.crypto?(r=window.crypto.subtle||window.crypto.webkitSubtle)?r.digest(n,o(e)).then(function(e){t(a(e))}).catch(function(){i(e,t)}):i(e,t):window.msCrypto&&window.msCrypto.subtle?((r=window.msCrypto.subtle.digest(n,o(e))).oncomplete=function(e){e.target&&t(a(e.target.result))},r.onerror=function(){i(e,t)}):i(e,t)}}},{}],124:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.getRemoteAddress=function(a){var s,c,e=null,r=[],i=[],t=[];t.push({urls:["stun:taas-oci.callstats.io:443"],username:"discoverip-pct"}),t.push({urls:["stun:taas-oci.callstats.io:80"],username:"discoverip-pct"}),RTCPeerConnection?e=RTCPeerConnection:webkitRTCPeerConnection?e=webkitRTCPeerConnection:mozRTCPeerConnection?e=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(e=window.RTCPeerConnection);t={iceTransportPolicy:"all",iceServers:t};try{s=new e(t),c=new e(t)}catch(e){a(r)}s.createDataChannel("ipd",{negotiated:!0,id:0}),s.onicecandidate=function(e){var t,n;e.candidate&&e.candidate.candidate&&(t=(n=e.candidate.candidate.split(" "))[7].toLowerCase(),n=n[4],"host"!==t&&(i.includes(n)||"srflx"!==t&&"prflx"!==t||(i.push(n),r.push({address:n,candidateType:t}),a(r)),c.addIceCandidate(e.candidate).then(function(){u.log("Ice candidate added successfully to the pc2")}).catch(function(e){u.log("addIceCandidate failure to pc2",e)})))},c.onicecandidate=function(e){var t,n;e.candidate&&e.candidate.candidate&&(t=(n=e.candidate.candidate.split(" "))[7].toLowerCase(),n=n[4],"host"===t||"srflx"!==t&&"prflx"!==t||(i.includes(n)||(i.push(n),r.push({address:n,candidateType:t}),a(r)),s.addIceCandidate(e.candidate).then(function(){u.log("Ice candidate added successfully to the pc1")}).catch(function(e){u.log("addIceCandidate failure to pc1",e)})))},s.createOffer().then(function(e){var r,i,o;e=e,i=c,o=a,(r=s).setLocalDescription(e).then(function(){u.log("pc1  setLocalDescription success")}).catch(function(e){o([])}),i.setRemoteDescription(e).then(function(){u.log("pc2  setRemoteDescription success")}).catch(function(e){o([])}),i.createAnswer().then(function(e){var t,n;e=e,t=r,n=o,i.setLocalDescription(e).then(function(){u.log("pc2  setLocalDescription success")}).catch(function(e){n([])}),t.setRemoteDescription(e).then(function(){u.log("pc1  setRemoteDescription success")}).catch(function(e){n([])})}).catch(function(e){o([])})}).catch(function(e){a(r)})};var u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("./csiologger"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}},{"./csiologger":119}],125:[function(e,t,n){"use strict";function r(e){return!!/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}Object.defineProperty(n,"__esModule",{value:!0}),n.isValid=r,n.parse=function(e){var t=null;return t=null!==e&&r(e)?JSON.parse(e):t}},{}],126:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.setErrorEventListener=function(){window&&window.addEventListener&&window.addEventListener("error",function(e){var t=s.Registry.getGenericEventHandler();if(e&&e.filename&&-1<e.filename.indexOf("callstats")){for(var n=!1,r={fileName:e.filename,line:e.lineno,col:e.colno,jsVersion:c.version,eventType:"error",message:e.message,pageURL:window.location.href},i=s.Registry.getConferenceManager().getConferenceIds(),o=0;o<i.length;o++)r.conferenceID=i[o],t.sendEvent(u.logEvents.error,r),n=!0;n||t.sendEvent(u.logEvents.error,r)}})};var s=e("./registry"),c=r(e("../config/settings")),u=r(e("../config/constants"));function l(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(l=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}},{"../config/constants":50,"../config/settings":51,"./registry":128}],127:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.addPctMeasurementToAggregator=function(e){var t,n,r,i;e&&e.tests&&(e.tests.rtt&&(t=e.tests.rtt.median,n=e.tests.rtt.variance),e.tests.throughput&&(i=e.tests.throughput.average,r=Math.max(e.tests.throughput.fractionLostBytes,0)),i=new o.PCTMeasurement(i,t,n,r,e.provider,e.timestamp),s.Registry.getPCTAggregator().addPCTMeasurement(i))},n.getPrecalltestResultsToStore=d,n.getPublicPrecalltestResults=i,n.storePctResults=function(e){e=d(e);if(e){var t=s.Registry.getCredentials().getAppId(),n=c.get("csioPctResultsArray"),r={},i=[];if(n)try{(r=JSON.parse(n))&&(i=r[t])&&50<=i.length&&i.shift()}catch(e){u.warn("csioPctResultsString JSON parse error")}(i&&i.push?i:i=[]).push(e),r[t]=i,c.store("csioPctResultsArray",JSON.stringify(r)),u.warn("Storing pct results",r)}};var o=e("../collections/pctmeasurement"),s=e("../utility/registry"),c=r(e("../browserapi/localstorage")),u=r(e("./csiologger"));function l(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(l=function(e){return e?n:t})(e))}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var n,r,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(i,n,r):i[n]=e[n]);return i.default=e,t&&t.set(e,i),i}function d(e){var t=i(e);return e&&e.tests&&(t.appID=s.Registry.getCredentials().getAppId(),t.resultID=e.id,t.failures=e.failures,t.startTimestamp=e.startTimestamp,t.endTimestamp=e.endTimestamp,e.notification&&(e.notification.summary&&(t.summary=e.notification.summary.text,t.summaryCode=e.notification.summary.code),e.notification.status&&(t.status=e.notification.status.text,t.statusCode=e.notification.status.code),e.notification.connectivity&&(t.connectivity=e.notification.connectivity.text,t.connectivityCode=e.notification.connectivity.code)),e.tests.ice&&(t.localIP=e.tests.ice.localIP,t.turnIpAddress=e.tests.ice.turnIpAddress,t.turnNetworkType=e.tests.ice.turnNetworkType)),t}function i(e){var t={mediaConnectivity:!1,throughput:null,fractionalLoss:null,rtt:null,jitter:null,timestamp:Date.now()};return e&&e.tests&&(t.provider=e.provider,t.startTimestamp=e.startTimestamp,t.endTimestamp=e.endTimestamp,e.tests.rtt&&(t.rtt=e.tests.rtt.median,t.mediaConnectivity=!0,t.jitter=e.tests.rtt.variance),e.tests.throughput&&(t.throughput=e.tests.throughput.average,t.fractionalLoss=Math.max(e.tests.throughput.fractionLostBytes,0),t.mediaConnectivity=!0,t.bytesSent=e.tests.throughput.bytesSent),e.tests.ice&&(e.tests.ice.relayTcpSuccess||e.tests.ice.relayTlsSuccess||e.tests.ice.relayUdpSuccess)&&(t.mediaConnectivity=!0),e.notification&&(t.notification=e.notification.notification,t.notificationCode=e.notification.notificationTextCode,t.sctCode=e.notification.notificationCode)),t}},{"../browserapi/localstorage":34,"../collections/pctmeasurement":40,"../utility/registry":128,"./csiologger":119}],128:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Registry=void 0;var i=e("../services/clocksync"),o=e("../services/configservice/configservicewrapper"),a=e("../services/authenticator"),s=e("../services/backendlog"),c=e("../services/transmissionmanager"),u=e("./eventmessagebuilder"),l=e("../conference/conferencemanager"),d=e("../utility/credentials"),f=e("../statspipeline/statsadapter"),p=e("../statspipeline/statsparser"),N=e("../statspipeline/statsmonitor"),B=e("../statspipeline/statstransmitter"),W=e("../statspipeline/statsassembler"),H=e("../utility/endpoint"),U=e("../browserapi/battery"),V=e("precalltest"),q=e("../statspipeline/wifistatsexecutor"),G=e("./callbacks"),z=e("../statspipeline/statscallbackbuilder"),Y=e("../services/connectionmanager"),J=e("../collections/pctaggregator"),Q=e("../services/pctrunnerservice"),K=e("../services/jabraservice");function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=null,v=null,g=null,m=null,b=null,w=null,S=null,k=null,C=null,T=null,P=null,_=null,O=null,E=null,I=null,R=null,M=null,j=null,x=null,F=null,D=null,A=null,L=null,e=function(){function n(){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function")}var e,t,r;return e=n,r=[{key:"getJabraService",value:function(){return L=L||new K.JabraService}},{key:"getPCTRunnerService",value:function(){return A=A||new Q.PCTRunnerService}},{key:"getPCTAggregator",value:function(){return D=D||new J.PCTAggregator}},{key:"getConferenceManager",value:function(){return R=R||new l.ConferenceManager}},{key:"getStatsCallbackBuilder",value:function(){return x=x||new z.StatsCallbackBuilder}},{key:"getClockSync",value:function(){return v=v||new i.ClockSync}},{key:"getWifiStatsExecutor",value:function(){return M=M||new q.WifiStatsExecutor}},{key:"getAuthenticator",value:function(){return g=g||new a.Authenticator}},{key:"getConfigServiceWrapper",value:function(){return m=m||new o.ConfigServiceWrapper}},{key:"getGenericEventHandler",value:function(){return b||(b=new s.GenericEventHandler).enable(),b}},{key:"getConnectionManager",value:function(){return F=F||new Y.ConnectionManager}},{key:"getTransmissionManager",value:function(){return w=w||new c.TransmissionManager}},{key:"getEventMessageBuilder",value:function(){return S=S||new u.EventMessageBuilder}},{key:"getCredentials",value:function(){return k=k||new d.Credentials}},{key:"getEndpoint",value:function(){return C=C||new H.Endpoint}},{key:"getStatsAdapter",value:function(){var e,t;return T||(e=n.getEndpoint().getCodeBase(),t=n.getEndpoint().getBrowserName(),T=new f.StatsAdapter(e,t)),T}},{key:"getPreCallTest",value:function(){return y=y||new V.PreCallTest}},{key:"getStatsParser",value:function(){return P=P||new p.StatsParser}},{key:"getStatsMonitor",value:function(){var e;return _||(e=n.getEndpoint().getCodeBase(),_=new N.StatsMonitor(e)),_}},{key:"getStatsTransmitter",value:function(){return O=O||new B.StatsTransmitter}},{key:"getStatsAssembler",value:function(){return E=E||new W.StatsAssembler}},{key:"getBattery",value:function(){return I=I||new U.Battery}},{key:"getCallbacks",value:function(){return j=j||new G.Callbacks}}],(t=null)&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();t.Registry=e},{"../browserapi/battery":31,"../collections/pctaggregator":39,"../conference/conferencemanager":48,"../services/authenticator":60,"../services/backendlog":61,"../services/clocksync":62,"../services/configservice/configservicewrapper":66,"../services/connectionmanager":67,"../services/jabraservice":68,"../services/pctrunnerservice":71,"../services/transmissionmanager":74,"../statspipeline/statsadapter":99,"../statspipeline/statsassembler":100,"../statspipeline/statscallbackbuilder":101,"../statspipeline/statsmonitor":102,"../statspipeline/statsparser":103,"../statspipeline/statstransmitter":104,"../statspipeline/wifistatsexecutor":115,"../utility/credentials":118,"../utility/endpoint":120,"./callbacks":117,"./eventmessagebuilder":122,precalltest:3}],129:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.RunningStats=void 0;var i=e("../collections/queue"),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("../statspipeline/validator"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100,t=this,n=r;if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");this.queue=new i.Queue(e),this.cumulativeSum=0}var e,t,n;return e=r,(t=[{key:"add",value:function(e){this.cumulativeSum+=e;e=this.queue.push(e);o.isNumber(e)&&(this.cumulativeSum-=e)}},{key:"getMean",value:function(){return this.queue.size()<1?null:this.cumulativeSum/this.queue.size()}},{key:"getVariance",value:function(){if(this.queue.size()<2)return null;for(var e=this.getMean(),t=0,n=this.queue.getFront();n;){var r=n,i=r.value-e;t+=i*i,n=r.next}return t/this.queue.size()}},{key:"getStd",value:function(){var e;return this.queue.size()<2?null:(e=this.getVariance(),Math.sqrt(e))}},{key:"reset",value:function(){this.cumulativeSum=0,this.queue.clear()}}])&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}();n.RunningStats=e},{"../collections/queue":42,"../statspipeline/validator":114}],130:[function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.Sigmoid=void 0;var r=function(){function r(e,t,n){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.max=e,this.midpoint=t,this.stepness=n,this.actualStep=0,this.reset()}var e,t,n;return e=r,(t=[{key:"reset",value:function(){this.actualStep=0}},{key:"setMidpoint",value:function(e){this.midpoint=e}},{key:"setMax",value:function(e){this.max=e}},{key:"setStepness",value:function(e){this.stepness=e}},{key:"increaseActualStep",value:function(e){this.actualStep+=e}},{key:"getActual",value:function(){return this.actualStep+=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,this.max/(1+Math.exp(-1*this.stepness*(this.actualStep-this.midpoint)))}}])&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}();n.Sigmoid=r},{}],131:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.TimeoutProcess=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r.default=e,t&&t.set(e,r);return r}(e("./csiologger"));function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function(e){return e?n:t})(e))}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.interval=e,this.timerId=null,this.callback=function(){i.warn("no callback function set",this)}}var e,n,r;return e=t,(n=[{key:"setCallback",value:function(e){this.callback=e}},{key:"start",value:function(){var e=this;this.timerId=setInterval(function(){e.callback()},this.interval)}},{key:"stop",value:function(){clearInterval(this.timerId),this.timerId=null}},{key:"isStarted",value:function(){return null!==this.timerId}}])&&o(e.prototype,n),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();n.TimeoutProcess=e},{"./csiologger":119}],132:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrent=function(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()},n.getSinceOrigin=function(){return window&&window.performance&&window.performance.now?window.performance.now():null}},{}],133:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.Url=void 0;var o=function(){function a(e){var t=this,n=a;if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");this.base=e;for(var r=arguments.length,i=new Array(1<r?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];this.appendixes=i}var e,t,n;return e=a,n=[{key:"concat",value:function(e,t){var n,r;return t?e?(n="/"===e.substr(e.length-1),r="/"===t.substring(0,1),n||r?n&&r?e+t.substring(1):e+t:e+"/"+t):t:e}}],(t=[{key:"append",value:function(e){this.appendixes.push(e)}},{key:"toString",value:function(){var t=this.getString(this.base),n=this;return this.appendixes.forEach(function(e){null!=e&&(e=n.getString(e),t=a.concat(t,e))}),t}},{key:"getString",value:function(e){switch(r(e)){case"function":return this.getString(e());case"number":return e+"";default:return e}}}])&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}();n.Url=o},{}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.assignPollyfill=function(){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},writable:!0,configurable:!0})},n.isIntegerPollyfill=function(){Number.isInteger||(Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e})},n.normalizeMediaDeviceList=function(e){var t=[];if(e)for(var n=0;n<e.length;n++){var r={};r.mediaDeviceID=e[n].deviceId,r.groupID=e[n].groupId,r.kind=e[n].kind,r.label=e[n].label,r.mediaDeviceID&&t.push(r)}return t}},{}]},{},[36]);